const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AutoSuggestAnswers-BcT4VVDN.js","assets/index-DJmmfyRE.js","assets/index-CykrPP6v.css","assets/lib-bK_kZcEm.js","assets/utilities-8g5q_ELR.js","assets/AutoSuggestAnswers-vl2QUoNQ.css"])))=>i.map(i=>d[i]);
import{x as se,y as n,z as fs,E as Rs,G as hs,H as m,J as xe,u as Me,c as oe,r as E,K as Ge,L as fe,M as te,N as Ue,O as As,P as Fe,S as Re,T as Gs,U as Se,n as e,B,p as We,R as me,D as he,q as Ee,s as Ss,t as _s,v as Ts,w as Ns,o as vs}from"./index-DJmmfyRE.js";import{L as le,F as ae,f as $e,a as Ve,e as ze,g as Ke,h as Be,i as _e,j as N,S as je,k as Te,s as js,l as Os,C as qe,m as He,u as Oe,Q as Xe,d as Ie,n as Is,o as bs,B as Qe,p as Ds,q as Cs,r as ks,M as Ae}from"./Options-C5emv0aG.js";import"./utilities-8g5q_ELR.js";const Ne={topId:"",parentId:"null",id:se,groupTitle:"",title:"",source:0,status:0,included:!1},Je={topId:"null",parentId:"null",id:"define at BackEnd",kind:0,title:"",link:"",header:"",level:0,variations:[],hasSubGroups:!1,groupRows:[],answerRows:[],numOfAnswers:0,hasMoreAnswers:!1,isExpanded:!1,doc1:""},Ls=(s,l)=>{console.log("------------------------------->"),console.log("------------------------------->",l.type),console.log("------------------------------->");const{groupRow:w}=l.payload;if(l.type===n.SET_KEY_EXPANDED){const{keyExpanded:g}=l.payload;return{...s,keyExpanded:g,nodeOpened:g===null?!0:s.nodeOpened}}let o=w?!fs.includes(l.type):!1;const{topRows:c}=s,a=Rs.includes(l.type)?{...s}:Ps(s,l);if(o&&w){let g;const{topId:x,id:G}=w;if(G===x)g=c.map(A=>A.id===x?new Q(w).groupRow:new Q(A).groupRow);else{const A=c.find(f=>f.id===x);Q.idToSet=l.type==="SET_GROUP_ADDED"?se:G,Q.newGroupRow=w;const t=new Q(A).groupRow;g=c.map(f=>f.id===x?t:new Q(f).groupRow),Q.idToSet=""}a.topRows=g}if(hs.includes(l.type)){const{keyExpanded:g}=a,x={keyExpanded:g};localStorage.setItem("GROUPS_STATE",JSON.stringify(x))}return console.log("GroupReducer newState",a),a},Ps=(s,l)=>{switch(l.type){case n.SET_TOP_ROWS_LOADING:return{...s,loadingGroups:!0,topRowsLoading:!0,topRowsLoaded:!1};case n.SET_TOP_ROWS:{const{topRows:o}=l.payload;return console.log("=> GroupsReducer ActionTypes.SET_TOP_ROWS",s.topRows,o),{...s,topRows:o,topRowsLoading:!1,topRowsLoaded:!0,loadingGroups:!1}}case n.SET_ALL_GROUP_ROWS:{const{allGroupRows:o}=l.payload;return{...s,allGroupRows:o,allGroupRowsLoaded:Date.now()}}case n.SET_ALL_GROUP_ROWS:{const{allGroupRows:o}=l.payload;return{...s,allGroupRows:o,allGroupRowsLoaded:Date.now()}}case n.SET_NODE_EXPANDING_UP_THE_TREE:{const{groupId_answerId_done:o}=l.payload;return{...s,groupId_answerId_done:o,nodeOpening:!0,loadingGroups:!0,nodeOpened:!1,activeGroup:null,activeAnswer:null}}case n.SET_NODE_EXPANDED_UP_THE_TREE:{const{group:o,answerId:c,answer:a,formMode:g}=l.payload;return{...s,activeGroup:o,activeAnswer:a,selectedAnswerId:c,formMode:g,nodeOpening:!1,nodeOpened:!0,loadingGroups:!1}}case n.SET_LOADING_GROUPS:return{...s,loadingGroups:!0};case n.SET_LOADING_GROUP:return{...s,loadingGroup:!0,groupLoaded:!1};case n.FORCE_OPEN_NODE:const{keyExpanded:w}=l.payload;return alert("FORCE_OPEN_NODE is deprecated, use SET_ANSWER_SELECTED instead"),{...s,topRows:s.topRows.filter(o=>o.parentId===null),keyExpanded:w,nodeOpened:!1,activeGroup:null,activeAnswer:null,selectedAnswerId:null};case n.SET_SUB_GROUPS:return{...s,loadingGroup:!1};case n.SET_ERROR:{const{error:o,whichRowId:c}=l.payload;return{...s,error:o,whichRowId:c,loadingGroups:!1,loadingAnswers:!1,loadingGroup:!1,groupLoaded:!1,loadingAnswer:!1,answerLoaded:!1}}case n.SET_GROUP:{const{groupRow:o}=l.payload;return console.assert(xe(o)),{...s,loadingGroup:!1,groupLoaded:!0,activeGroup:o,activeAnswer:null,selectedAnswerId:null}}case n.SET_ROW_EXPANDING:return{...s,rowExpanding:!0,rowExpanded:!1,loadingGroups:!0};case n.SET_ROW_EXPANDED:{const{groupRow:o}=l.payload,{topId:c,id:a}=o,{keyExpanded:g}=s,x=g?g.answerId:null;return{...s,loadingGroups:!1,keyExpanded:{topId:c,groupId:a,answerId:x},activeAnswer:null,selectedAnswerId:x,loadingAnswer:!1,answerLoaded:!1,rowExpanding:!1,rowExpanded:!0}}case n.SET_ROW_COLLAPSED:{const{groupRow:o}=l.payload,{topId:c,parentId:a}=o;return{...s,loadingGroups:!1,keyExpanded:{topId:c,groupId:a??"",answerId:null},rowExpanding:!1,rowExpanded:!0,activeGroup:null,activeAnswer:null,selectedAnswerId:null}}case n.SET_GROUP_TO_VIEW:{const{groupRow:o}=l.payload;console.assert(xe(o));const a={...o,isExpanded:!1};return{...s,formMode:m.ViewingGroup,loadingGroup:!1,activeGroup:a,activeAnswer:null,selectedAnswerId:null,error:void 0}}case n.SET_GROUP_TO_ADD_TOP:{const{newGroupRow:o}=l.payload;return{...s,loadingGroup:!1,groupLoaded:!0,activeGroup:{...o,doc1:""},activeAnswer:null,selectedAnswerId:null,topRows:[o,...s.topRows],formMode:m.AddingGroup}}case n.SET_GROUP_TO_ADD:{const{newGroupRow:o}=l.payload;return{...s,loadingGroup:!1,groupLoaded:!0,activeGroup:{...o,doc1:""},activeAnswer:null,selectedAnswerId:null,formMode:m.AddingGroup}}case n.SET_GROUP_ADDED:{const{groupRow:o}=l.payload;console.assert(xe(o));const a={...o,isExpanded:!1},{topId:g,id:x}=a;return{...s,formMode:m.EditingGroup,loadingGroup:!1,groupLoaded:!1,activeGroup:a,activeAnswer:null,selectedAnswerId:null,keyExpanded:{topId:g,groupId:x,answerId:null}}}case n.SET_GROUP_TO_EDIT:case n.SET_GROUP_UPDATED:{const{groupRow:o,group:c}=l.payload;console.assert(xe(o));const{topId:a,id:g}=c;return{...s,formMode:m.EditingGroup,loadingGroup:!1,groupLoaded:!0,keyExpanded:{topId:a,groupId:g,answerId:null},activeGroup:c,activeAnswer:null,selectedAnswerId:null,error:void 0}}case n.SET_ANSWERS_LOADING:return{...s,loadingAnswers:!0,answerLoaded:!1};case n.GROUP_ANSWERS_LOADED:return{...s,loadingAnswers:!1};case n.GROUP_DELETED:{const{groupRow:o,id:c}=l.payload,a=o?s.topRows:s.topRows.filter(g=>g.id!==c);return{...s,topRows:a,loadingGroups:!1,activeGroup:null,formMode:m.None,error:void 0,whichRowId:void 0,keyExpanded:{topId:o?o.topId:"",groupId:o?o.parentId??"":"",answerId:""}}}case n.CANCEL_GROUP_FORM:case n.CLOSE_GROUP_FORM:return{...s,activeGroup:null,formMode:m.None};case n.CANCEL_ADD_GROUP:{const{topRows:o}=l.payload;return{...s,topRows:o,activeGroup:null,activeAnswer:null,selectedAnswerId:null,formMode:m.None}}case n.SET_LOADING_ANSWER:return{...s,loadingAnswer:!0,answerLoaded:!1};case n.CANCEL_ADD_ANSWER:return{...s,formMode:m.None,activeAnswer:null,selectedAnswerId:null};case n.SET_ANSWER_SELECTED:{const{answerKey:o}=l.payload,{topId:c,parentId:a,id:g}=o;return{...s,topRows:s.topRows.filter(x=>x.parentId===null),keyExpanded:{topId:c,groupId:a,answerId:g},activeGroup:null,activeAnswer:null,selectedAnswerId:null}}case n.ADD_NEW_ANSWER_TO_ROW:{const{newAnswerRow:o}=l.payload;return{...s,selectedAnswerId:o.id}}case n.SET_ANSWER:{const{answer:o,formMode:c}=l.payload;return console.log(n.SET_ANSWER,o),{...s,activeGroup:null,activeAnswer:o,formMode:c,error:void 0,loadingGroup:!1,loadingAnswer:!1,answerLoaded:!0}}case n.SET_ANSWER_AFTER_ASSIGN_ANSWER:{const{answer:o}=l.payload;return{...s,activeAnswer:o,loadingAnswer:!1,answerLoaded:!0}}case n.SET_ANSWER_TO_VIEW:{const{answer:o}=l.payload,{keyExpanded:c}=s;return{...s,formMode:m.ViewingAnswer,keyExpanded:c,activeAnswer:o,loadingAnswer:!1,answerLoaded:!0}}case n.SET_ANSWER_TO_EDIT:{const{answer:o}=l.payload,{topId:c,id:a,parentId:g}=o;return{...s,keyExpanded:{topId:c,groupId:g,answerId:a},activeAnswer:o,formMode:m.EditingAnswer,selectedAnswerId:o.id,loadingAnswer:!1,answerLoaded:!0}}case n.ANSWER_DELETED:return{...s,activeAnswer:null,selectedAnswerId:null,formMode:m.None,loadingAnswer:!1,answerLoaded:!0};case n.CANCEL_ANSWER_FORM:case n.CLOSE_ANSWER_FORM:return{...s,formMode:m.None,activeAnswer:null,selectedAnswerId:null};default:return alert(`Action ${l.type} not allowed`),{...s}}};class Q{static idToSet;static newGroupRow;constructor(l){const{topId:w,id:o,parentId:c,title:a,link:g,kind:x,header:G,level:A,variations:t,numOfAnswers:f,hasSubGroups:v,groupRows:T,created:D,modified:O,answerRows:k,isExpanded:z}=l,S=T.map(I=>(console.log("DeepClone >>>>>>>>>>>>>>>",I.id),I.id===Q.idToSet?{...Q.newGroupRow}:new Q(I).groupRow));this.groupRow={topId:w,parentId:c,id:o,kind:x,title:a,link:g,header:G,level:A,hasSubGroups:v,groupRows:S,numOfAnswers:f,answerRows:k,variations:t??[],created:D,modified:O,isExpanded:z}}groupRow}const Ye=E.createContext({}),Ze=E.createContext(()=>null),Us={formMode:m.None,allGroupRows:new Map,allGroupRowsLoaded:void 0,topRows:[],topRowsLoading:!1,topRowsLoaded:!1,nodeOpening:!1,nodeOpened:!1,keyExpanded:null,groupId_answerId_done:void 0,activeGroup:null,activeAnswer:null,selectedAnswerId:null,loadingGroups:!1,loadingAnswers:!1,loadingGroup:!1,groupLoaded:!1,loadingAnswer:!1,answerLoaded:!1,error:void 0,rowExpanding:!1,rowExpanded:!1},Fs=({children:s})=>{const{loadAllGroupRowsGlobal:l}=Me(),w=oe(),{KnowledgeAPI:o,isAuthenticated:c,workspace:a,authUser:g,canEdit:x}=w,{nickName:G}=g,[A,t]=E.useReducer(Ls,Us),{formMode:f,activeGroup:v,activeAnswer:T,keyExpanded:D,topRows:O,allGroupRows:k,allGroupRowsLoaded:z}=A;console.log("----->>> ----->>> ----->>> GroupProvider",O),E.useEffect(()=>{let i=a==="DEMO"?{topId:"MTS",groupId:"REMOTECTRLS",answerId:"qqqqqq111"}:null;if("localStorage"in window){let r=localStorage.getItem("GROUPS_STATE");if(console.log("GROUPS_STATE from localStorage",r),r!==null){const u=JSON.parse(r);u.keyExpanded!==null&&(i=u.keyExpanded)}}t({type:n.SET_KEY_EXPANDED,payload:{keyExpanded:i}})},[a]);const S=E.useCallback(async(i,r,u=null,p=void 0)=>{const d=localStorage.getItem("accessToken");if(d)try{console.log("------Execute endpoint:",r);let y=null;const h=new Headers,j=`Bearer ${d}`;h.append("Authorization",j),u&&h.append("Content-Type","application/json");let C={method:i,headers:h,body:u?JSON.stringify(u):null};if(y=await fetch(r,C),y.ok){if(y.status===200||y.status===201){let V=null;try{V=await y.json()}catch{t({type:n.SET_ERROR,payload:{error:new Error(`Response status: ${y.status}`),whichRowId:p}})}finally{return V}}}else{const{errors:V}=await y.json(),Y=new Error(V?.map(Z=>Z.message).join(`
`)??"unknown");t({type:n.SET_ERROR,payload:{error:Y,whichRowId:p}})}}catch(y){console.log("-------------->>> execute",i,r,y),t({type:n.SET_ERROR,payload:{error:new Error("fetch eror"),whichRowId:p}})}return null},[]),I=E.useCallback(async()=>new Promise(async i=>{const r=await l();t(r?{type:n.SET_ALL_GROUP_ROWS,payload:{allGroupRows:r}}:{type:n.SET_ERROR,payload:{error:new Error("Zajeb allGroupRows")}}),i(r)}),[l]),M=E.useCallback(async i=>{try{return k.get(i)}catch(r){console.log(r),t({type:n.SET_ERROR,payload:{error:r}})}},[k]);E.useEffect(()=>{(async()=>await I())()},[I]);const _=E.useCallback(async i=>{try{let r="";const u=[];return k.forEach((p,d)=>{d===i?r="":p.parentId===i&&u.push(p)}),{subGrps:u,parentHeader:r}}catch(r){return console.log(r),t({type:n.SET_ERROR,payload:{error:r}}),{subGrps:[],parentHeader:"Kiks subGrps"}}},[k]),F=E.useCallback(async()=>new Promise(async i=>{try{t({type:n.SET_TOP_ROWS_LOADING,payload:{}});const r=`${o.endpointGroupRow}/${a}/toprows`;console.log("GroupProvider loadTopRows url:",r),console.log("loadTopRows AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"),console.time(),await S("GET",r).then(u=>{console.timeEnd(),console.log("loadTopRows CCCCCCCCCCCCCCCCCCCC");const p=u.map(d=>(d.IsExpanded=D?d.Id===D.groupId:!1,new Ge(d).groupRow));t({type:n.SET_TOP_ROWS,payload:{topRows:p}}),i(!0)})}catch(r){console.log(r),t({type:n.SET_ERROR,payload:{error:r}})}}),[S,o.endpointGroupRow,D,a]),R=E.useCallback(async(i,r)=>{const{topId:u,id:p}=i;return console.log({groupKey:i,includeAnswerId:r}),new Promise(async d=>{try{const y=`${o.endpointGroup}/${a}/${u}/${p}/${X}/${r}`;console.time(),console.log("================ getGroup ======================="),await S("GET",y).then(h=>{console.timeEnd();const{groupDto:j,msg:C}=h;d(j?new fe(j).group:new Error(C))})}catch(y){console.log(y),d(y)}})},[S,o.endpointGroup,a]),b=E.useCallback(async(i,r)=>{if(i.topId===r)return i;const{groupRows:u}=i;let p=u.find(d=>d.id===r);if(!p)for(const d of u){const y=await b(d,r);if(y){p=y,console.log("findGroup Stop the loop for: "+r);break}}return p},[]),L=E.useCallback(async(i,r,u=!1)=>new Promise(async p=>{try{let{topId:d,parentId:y,id:h}=i;console.assert(h!==null,"id ne sme biti null u expandNodesUpToTheTree"),t({type:n.SET_NODE_EXPANDING_UP_THE_TREE,payload:{groupId_answerId_done:`${h}_${r}`}}),console.time();const j={topId:d,id:h,parentId:null},C=new te(j).toQuery(a),V=`${o.endpointGroupRow}?${C}&pageSize=${X}&includeAnswerId=${r??null}`;await S("GET",V).then(async Y=>{const{groupRowDto:Z}=Y;if(console.timeEnd(),Z){let ce=null,pe=null;const we=new Ge(Z).groupRow,ge=await b(we,h);if(y!==null){if(ce={...ge,doc1:""},r){const Le=ge.answerRows.find(Pe=>Pe.id===r&&Pe.included);Le&&(ce=null,pe={...Le,source:0,status:0})}}else console.log("WHAT");console.log(">>> expandNodeUpToTheTree groupRow",{topRowNew:we,groupRow:ge,answerId:"'"+(r??"jok")+"'"+(r??"JOK")});const xs=r?x?m.EditingAnswer:m.ViewingAnswer:x?m.EditingGroup:m.ViewingGroup;t({type:n.SET_NODE_EXPANDED_UP_THE_TREE,payload:{grpKey:i,groupRow:we,group:ce,answerId:r??null,answer:pe,formMode:xs,fromChatBotDlg:u}}),p(!0)}else p(!1)})}catch(d){console.log(d),t({type:n.SET_ERROR,payload:{error:d}})}}),[a,o.endpointGroupRow,S,k,b,x]),P=E.useCallback(async(i,r=!1,u=null)=>{const p=new te(i).toQuery(a);return new Promise(async d=>{try{const y=`${o.endpointGroupRow}/${r}/${X}/${u}?${p}`;console.time(),await S("GET",y).then(h=>{console.timeEnd();const{groupRowDto:j,msg:C}=h;d(j?new Ge(j).groupRow:new Error(C))})}catch(y){console.log(y),d(y)}})},[S,o.endpointGroupRow,a]),U=E.useCallback(async({groupKey:i,includeAnswerId:r,newAnswerRow:u,formMode:p})=>{try{t({type:n.SET_ROW_EXPANDING,payload:{}});const d=await P(i,!0,r);if(d instanceof Error)t({type:n.SET_ERROR,payload:{error:d}}),console.error({groupRow:d});else{let y;return r&&d.answerRows.filter(h=>h.included).length>0&&(y=r),u&&(d.answerRows=[u,...d.answerRows]),d.isExpanded=!0,console.log("@@@@@@@@@@@@@@@@@ expandGroup:",p,r),p===m.None&&r&&(p=x?m.EditingAnswer:m.ViewingAnswer),t({type:n.SET_ROW_EXPANDED,payload:{groupRow:d,formMode:p,selectedAnswerId:y}}),d}}catch(d){return console.log("error",d),t({type:n.SET_ERROR,payload:{error:d}}),null}},[x,P]),ne=E.useCallback(async i=>{const{topId:r,id:u}=i,p=O.find(y=>y.id===r),d=await b(p,u);d?(i={...d,isExpanded:!1,groupRows:[],answerRows:[]},t({type:n.SET_ROW_COLLAPSED,payload:{groupRow:i}})):t({type:n.SET_ERROR,payload:{error:new Error("findGroup sranje"),whichRowId:u}})},[b,O]),ue=E.useCallback(async i=>{try{t({type:n.CLOSE_GROUP_FORM,payload:{}});const{topId:r,id:u,level:p}=i??{topId:se,id:se,level:0},d={...Je,topId:r,parentId:i?u:null,id:se,level:p+1,title:"New Group",isExpanded:!1};if(i===null)t({type:n.SET_GROUP_TO_ADD_TOP,payload:{newGroupRow:d}});else{const y={...i,level:p+1,groupRows:[d,...i.groupRows],hasSubGroups:!0,isExpanded:!0};t({type:n.SET_GROUP_TO_ADD,payload:{groupRow:y,newGroupRow:{...d}}})}}catch(r){console.log("error",r),t({type:n.SET_ERROR,payload:{error:r}})}},[]),q=E.useCallback(async()=>{try{const{parentId:i}=v;let r,u=[];O.forEach(async p=>{i===null?u=O.filter(d=>d.id!==se):(r=await b(p,i),r&&(r.groupRows=r.groupRows.filter(d=>d.id!==se)))}),t({type:n.CANCEL_ADD_GROUP,payload:{topRows:u.length>0?u:O}})}catch(i){console.log("error",i),t({type:n.SET_ERROR,payload:{error:i}})}},[v,U]),de=E.useCallback(async i=>{const{id:r}=i;t({type:n.SET_LOADING_GROUP,payload:{}});try{const u=new Ue(i,a).groupDto;console.log("groupDto",{groupDto:u});const p=`${o.endpointGroup}`;console.time(),await S("POST",p,u,r).then(async d=>{console.timeEnd();const{groupDto:y}=d;if(y){const h=new fe(y).group;console.log("Group successfully created",{group:h}),t({type:n.CLOSE_GROUP_FORM,payload:{}}),k.set(h.id,{...h,isExpanded:!1}),h.parentId===null?t({type:n.SET_GROUP_ADDED,payload:{groupRow:h}}):t({type:n.SET_GROUP_ADDED,payload:{groupRow:h}})}})}catch(u){console.log(u),t({type:n.SET_ERROR,payload:{error:new Error("Server Error"),whichRowId:r}})}},[S,o.endpointGroup,I,F,a]),K=E.useCallback(async()=>{try{const{topId:i,parentId:r}=T,p={groupKey:{topId:i,parentId:r,id:r},formMode:m.None},d=await U(p);d&&t({type:n.CANCEL_ADD_ANSWER,payload:{groupRow:d}})}catch(i){console.log("error",i),t({type:n.SET_ERROR,payload:{error:i}})}},[T,U]),ie=E.useCallback(async(i,r)=>{f===m.AddingAnswer?await K():f===m.AddingGroup&&await q(),t({type:n.SET_LOADING_GROUP,payload:{groupRow:i}});const u=new te(i).groupKey,p=await R(u,r);p instanceof Error?t({type:n.SET_ERROR,payload:{error:p}}):(p.topId=i.topId,t({type:n.SET_GROUP_TO_VIEW,payload:{groupRow:p}}))},[q,K,f,R]),re=E.useCallback(async(i,r)=>{f===m.AddingAnswer?await K():f===m.AddingGroup&&await q(),t({type:n.SET_LOADING_GROUP,payload:{}});const u=new te(i).groupKey,p=await R(u,r);if(p instanceof Error)t({type:n.SET_ERROR,payload:{error:p}});else{const d={...p,isExpanded:!1,groupRows:[],answerRows:[]};t({type:n.SET_GROUP_TO_EDIT,payload:{groupRow:d,group:p}})}},[q,K,f,R]),W=E.useCallback(async i=>{t({type:n.SET_LOADING_GROUP,payload:{}});try{const r=new Ue(i,a).groupDto,u=`${o.endpointGroup}`;console.time(),await S("PUT",u,r).then(p=>{console.timeEnd();const{groupDto:d,msg:y}=p;if(d){const h=new fe(d).group,{topId:j}=h;h.isExpanded=!1,h.topId=j,t({type:n.SET_GROUP_UPDATED,payload:{group:h}})}else t({type:n.SET_ERROR,payload:{error:new Error(`${y}`)}})})}catch(r){return console.log(r),t({type:n.SET_ERROR,payload:{error:new Error("Karambol")}}),r}},[S,o.endpointGroup,a]),J=E.useCallback(async i=>{try{const{parentId:r,id:u}=i;i.modified={time:new Date,nickName:G};const p=new As(i,a).groupRowDto,d=`${o.endpointGroup}`;console.time(),t({type:n.SET_LOADING_GROUPS,payload:{}}),await S("DELETE",d,p).then(async y=>{console.timeEnd();const{groupDto:h,msg:j}=y;if(j==="OK"){console.log("Group successfully deleted",{groupRow:i});let C;if(r!==null){for await(const V of O)if(C=await b(V,r),C)break;C.hasSubGroups=h.HasSubGroups,C.hasSubGroups||(C.isExpanded=!1),C.groupRows=C.groupRows.filter(V=>V.id!==u)}t({type:n.GROUP_DELETED,payload:{groupRow:C,id:u}})}else t(j==="HasSubGroups"?{type:n.SET_ERROR,payload:{error:new Error("First remove sub groups"),whichRowId:h.Id}}:j==="HasAnswers"?{type:n.SET_ERROR,payload:{error:new Error("First remove group answers"),whichRowId:h.Id}}:{type:n.SET_ERROR,payload:{error:new Error(j),whichRowId:h.Id}})})}catch(r){return console.log(r),r}},[S,o.endpointGroup,U,I,F,a]),H=async(i,r)=>{try{console.log("Deleting Group Tag...",{groupKey:i,variationName:r}),console.log("Group Tag successfully deleted")}catch(u){console.log("error",u),t({type:n.SET_ERROR,payload:{error:u}})}},X=12,ds=E.useCallback(async({groupKey:i,startCursor:r,includeAnswerId:u})=>{try{const{topId:p,id:d}=i;t({type:n.SET_ANSWERS_LOADING,payload:{}});try{const y=`${o.endpointAnswer}/${a}/${p}/${d}/${r}/${X}/${u}`;console.time(),await S("GET",y).then(h=>{console.timeEnd();const{groupDto:j}=h;if(j!==null){const C=new fe(j).group;t({type:n.GROUP_ANSWERS_LOADED,payload:{groupRow:C}})}})}catch(y){console.log(y),t({type:n.SET_ERROR,payload:{error:y}})}}catch(p){console.log(p),t({type:n.SET_ERROR,payload:p})}},[S,o.endpointAnswer,a]),is=E.useCallback(async i=>{try{const{topId:r,id:u}=i;let p=await M(u);if(!p){alert(`Not found ${u}. Reload all Groups`);return}const d={topId:r,parentId:i.id,id:se,title:"answer text",groupTitle:p.title,included:!0},y={...Ne,...d,title:""},h=A.topRows.find(C=>C.id===r),j=await b(h,u);t({type:n.ADD_NEW_ANSWER_TO_ROW,payload:{groupRow:{...j,answerRows:[d,...j.answerRows]},newAnswerRow:d}}),t({type:n.SET_ANSWER,payload:{answer:y,formMode:m.AddingAnswer}})}catch(r){console.log("error",r),t({type:n.SET_ERROR,payload:{error:r}})}},[U,b,M,A.topRows]),cs=E.useCallback(async i=>{const{topId:r,id:u,parentId:p}=i;t({type:n.SET_LOADING_GROUP,payload:{}});try{i.created.nickName=G;const d=new Fe(i,a).answerDto,y=`${o.endpointAnswer}`;console.time(),console.log(">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> createAnswer",d),await S("POST",y,d).then(async h=>{if(console.timeEnd(),h){console.log("::::::::::::::::::::",{answerDtoEx:h});const{answerDto:j}=h;if(j){const C=new Re(j).answer;C.topId=r,console.log("Answer successfully created"),await I().then(async()=>{const Y={groupKey:{topId:r,parentId:p,id:p},formMode:m.EditingAnswer};await U(Y).then(()=>{t({type:n.SET_ANSWER,payload:{formMode:m.EditingAnswer,answer:C}})})})}}})}catch(d){console.log(d),t({type:n.SET_ERROR,payload:{error:new Error("Server Error"),whichRowId:u}})}},[S,o.endpointAnswer,U,I,G,a]),ps=E.useCallback(async(i,r,u)=>{const{id:p}=r;try{r.modified.nickName=G;const d=new Fe(r,a).answerDto,y=`${o.endpointAnswer}`;console.time(),d.oldParentId=i,console.log(">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> updateAnswer",d);let h=null;return await S("PUT",y,d).then(async j=>{console.timeEnd();const{answerDto:C,msg:V}=j;if(C){h=new Re(C).answer,console.log("Answer successfully updated: ",h);const{topId:Y,parentId:Z}=h;if(u){const{topId:ce,parentId:pe,id:we}=h,ge={topId:ce,groupId:pe,answerId:we};t({type:n.FORCE_OPEN_NODE,payload:{keyExpanded:ge}})}else{const pe={groupKey:{topId:Y,parentId:Z,id:Z},formMode:m.EditingAnswer};await U(pe).then(()=>{t({type:n.SET_ANSWER,payload:{formMode:m.EditingAnswer,answer:h}})})}}else t({type:n.SET_ERROR,payload:{error:new Error(V)}})}),h}catch(d){console.log(d),t({type:n.SET_ERROR,payload:{error:new Error("Server Error"),whichRowId:p}})}},[S,o.endpointAnswer,U,G,a]),us=E.useCallback(async(i,r)=>{const{id:u,parentId:p,topId:d}=i;t({type:n.SET_LOADING_ANSWER,payload:{}});try{const y=new Gs(i,a).answerRowDto,h=`${o.endpointAnswer}`;console.time(),await S("DELETE",h,y).then(async j=>{const{answerDto:C}=j;if(console.timeEnd(),C){const V=new Re(C).answer;console.log("Answer successfully deleted"),r&&t({type:n.ANSWER_DELETED,payload:{answer:V}});const Z={groupKey:{topId:d,parentId:p,id:p},formMode:m.None};await U(Z).then(()=>{})}else console.error(j),t({type:n.SET_ERROR,payload:{error:new Error("Server Error"),whichRowId:u}})})}catch(y){console.log(y),t({type:n.SET_ERROR,payload:{error:new Error("Server Error"),whichRowId:u}})}},[S,o.endpointAnswer,U,a]),ye=E.useCallback(async i=>new Promise(async r=>{try{const u=new Se(i).toQuery(a),p=`${o.endpointAnswer}?${u}`;console.time(),console.log("getAnswer",i),await S("GET",p).then(d=>{console.timeEnd();const{answerDto:y,msg:h}=d;if(y){const j={answer:new Re(y).answer,msg:h};r(j)}else r({answer:null,msg:h})})}catch(u){console.log(u),r({answer:null,msg:"Problemos"})}}),[S,o.endpointAnswer,a]),ws=E.useCallback(async i=>{const r=new Se(i).answerKey;t({type:n.SET_LOADING_ANSWER,payload:{}});const u=await ye(r);f===m.AddingAnswer?await K():f===m.AddingGroup&&await q();const{answer:p,msg:d}=u;p?(p.topId=i.topId,t({type:n.SET_ANSWER_TO_VIEW,payload:{answer:p}})):t({type:n.SET_ERROR,payload:{error:new Error(d)}})},[q,K,f,ye]),gs=E.useCallback(async i=>{const r=new Se(i).answerKey;f===m.AddingAnswer?await K():f===m.AddingGroup&&await q(),t({type:n.SET_LOADING_ANSWER,payload:{}}),console.log("editAnswer:",r);const u=await ye(r),{answer:p,msg:d}=u;p?(p.topId=i.topId,t({type:n.CLOSE_ANSWER_FORM,payload:{answer:p}}),t({type:n.SET_ANSWER_TO_EDIT,payload:{answer:p}})):t({type:n.SET_ERROR,payload:{error:new Error(d)}})},[q,K,f,ye]),Es=E.useCallback(async(i,r,u)=>{const p=O.find(y=>y.id===i);let d=await b(p,r);console.log("PROVIDER onGroupTitleChanged::",d.title,u),d.title!==u&&(d.title=u===""?"New Category":u,t({type:n.RE_RENDER_TREE,payload:{}}))},[b,O]),ms=E.useCallback(async(i,r,u)=>{const p=O.find(y=>y.id===i);let d=await b(p,r);if(d){const y=d.answerRows.find(h=>h.id===r);y.title!==u&&(y.title=u===""?"New Question":u,console.log("onAnswerTitleChanged+++>>>",r,d),t({type:n.ANSWER_TITLE_CHANGED,payload:{groupRow:d}}))}},[b,O]),ys={state:A,getSubGrps:_,getGrp:M,loadAllGroupRows:I,expandNodesUpToTheTree:L,loadTopRows:F,addGroup:ue,cancelAddGroup:q,createGroup:de,viewGroup:ie,editGroup:re,updateGroup:W,deleteGroup:J,deleteGroupVariation:H,expandGroup:U,collapseGroup:ne,onGroupTitleChanged:Es,loadGroupAnswers:ds,addAnswer:is,cancelAddAnswer:K,createAnswer:cs,viewAnswer:ws,editAnswer:gs,updateAnswer:ps,deleteAnswer:us,onAnswerTitleChanged:ms};return!c||!z?null:e.jsx(Ye.Provider,{value:ys,children:e.jsx(Ze.Provider,{value:t,children:s})})};function $(){return E.useContext(Ye)}const be=()=>E.useContext(Ze);var ee=(s=>(s.SET_LOADING="SET_LOADING",s.SET_SUB_CATS="SET_SUB_CATS",s.SET_ERROR="SET_ERROR",s.SET_EXPANDED="SET_EXPANDED",s.SET_PARENT_CAT="SET_PARENT_CAT",s))(ee||{});const Ms=({cat:s,dispatch:l,setParentGrp:w,selId:o})=>{const{topId:c,parentId:a,id:g,title:x,level:G,isExpanded:A}=s,t={topId:c,parentId:a,id:g},f=D=>{l({type:ee.SET_EXPANDED,payload:{id:g,expanding:!A}})},v=D=>{w(D)},T=e.jsxs("div",{className:"d-flex justify-content-start align-items-center w-100 text-primary",children:[e.jsx(B,{variant:"link",size:"sm",className:"py-0 px-1",onClick:D=>{f(),D.stopPropagation(),D.preventDefault()},title:"Expand",children:e.jsx(ae,{icon:A?$e:Ve,size:"lg"})}),e.jsx(B,{variant:"link",size:"sm",className:"py-0 mx-0 text-decoration-none",title:g,onClick:()=>v(s),children:x})]});return e.jsxs(e.Fragment,{children:[e.jsx(le.Item,{variant:"primary",className:"py-0 px-1 w-100",as:"li",children:T}),A&&e.jsx(le.Item,{className:"py-0 px-0",variant:"primary",as:"li",children:e.jsx(ss,{selId:o,level:G+1,groupKey:t,setParentId:w})})]})},Ws={loading:!1,parentId:null,title:"",cats:[]},$s=(s,l)=>{switch(l.type){case ee.SET_LOADING:return{...s,loading:!0};case ee.SET_SUB_CATS:{const{subGrps:w}=l.payload;return{...s,cats:s.cats.concat(w),loading:!1}}case ee.SET_ERROR:{const{error:w}=l.payload;return{...s,error:w,loading:!1}}case ee.SET_EXPANDED:{const{id:w,expanding:o}=l.payload;let{cats:c}=s;if(!o){const a=es(c,w);console.log("clean:",a),a.length>0&&(c=c.filter(g=>!a.includes(g.id)))}return{...s,cats:s.cats.map(a=>a.id===w?{...a,isExpanded:o}:a)}}case ee.SET_PARENT_CAT:{const{cat:w}=l.payload,{id:o,title:c}=w;return{...s,parentId:o,title:c}}default:return s}};function es(s,l){let w=s.filter(o=>o.parentId===l).map(o=>o.id);return w.forEach(o=>{const c=o?es(s,o):[];w=w.concat(c)}),w}const ss=({selId:s,groupKey:l,level:w,setParentId:o})=>{const[c,a]=E.useReducer($s,Ws),{getSubGrps:g}=$(),{id:x}=l??{id:null},[G]=E.useState(l);E.useEffect(()=>{(async()=>{const f=await g(x),{subGrps:v}=f;a({type:ee.SET_SUB_CATS,payload:{subGrps:v}})})()},[g,G,x]);const A=c.cats.filter(f=>f.parentId===x),t=f=>{a({type:ee.SET_PARENT_CAT,payload:{cat:f}}),o(f)};return e.jsxs("div",{className:w>1?"border  border-7 ms-4 h-25":"border border-7  h-25",style:{overflowY:"auto"},children:[e.jsx(le,{as:"ul",variant:"dark",className:"mb-0",children:A.filter(f=>f.id!==s).map(f=>e.jsx(Ms,{cat:f,selId:s,dispatch:a,setParentGrp:t},f.id))}),c.error&&c.error.message]})},De=({answer:s,submitForm:l,children:w,showCloseButton:o,source:c=0,closeModal:a})=>{const{state:g,onAnswerTitleChanged:x}=$();let{formMode:G}=g;const A=G===m.ViewingAnswer,t=G===m.EditingAnswer,f=G===m.AddingAnswer,v=A,{topId:T,id:D,title:O}=s,k=be(),z=()=>{a?a():k({type:n.CLOSE_ANSWER_FORM,payload:{answer:s}})},S=()=>{a?a():k({type:n.CANCEL_ANSWER_FORM,payload:{answer:s}})},[I,M]=E.useState(O),_=ze(I,500),F=E.useRef(null),R=Ke({enableReinitialize:!0,initialValues:s,validationSchema:Be().shape({title:_e().required("Required"),parentId:_e().required("Required").notOneOf(["000000000000000000000000"])}),onSubmit:P=>{l(P),M(P.title)}});E.useEffect(()=>{(async()=>R.values.title!==_&&x(T,D,R.values.title))()},[_,R.values.title,x,T,D]),E.useEffect(()=>{F.current.focus(),c!==0&&R.setFieldValue("source",c)},[R,F,c]);const b=P=>{R.handleChange(P);const U=P.target.value;M(U)},L=P=>{R.setFieldValue("parentId",P.id),R.setFieldValue("groupTitle",P.title)};return e.jsxs("div",{className:"form-wrapper px-3 py-1 my-0 my-1 w-100 answer-form",children:[o&&e.jsx(We,{onClick:z,className:"float-end"}),e.jsx(me,{className:"text-center",children:e.jsxs(N.Label,{children:["Answer  ",A?"Viewing":t?"Editing":"Adding"]})}),e.jsxs(N,{onSubmit:R.handleSubmit,children:[e.jsxs(je,{direction:"horizontal",gap:0,className:"border",children:[e.jsx("div",{className:"p-0",children:e.jsx(N.Label,{children:"Group:"})}),e.jsx("div",{className:"p-1",children:e.jsxs(N.Group,{controlId:"parentId",className:"group-select form-select-sm w-90",children:[e.jsxs(he,{children:[e.jsx(he.Toggle,{variant:"light",id:"dropdown-basic",className:"px-2 py-0 text-primary border",disabled:v,children:e.jsx("span",{className:"text-wrap me-1",children:R.values.groupTitle})}),e.jsx(he.Menu,{className:"p-0 border",children:e.jsx(he.Item,{className:"p-0 m-0 rounded-3",children:e.jsx(ss,{selId:R.values.parentId,groupKey:null,level:1,setParentId:L})})})]}),e.jsx(N.Control,{as:"input",name:"parentId",onChange:R.handleChange,value:R.values.parentId?R.values.parentId:"",placeholder:"Group",className:"text-primary w-100",disabled:v,hidden:!0}),e.jsx(N.Text,{className:"text-danger",children:R.touched.parentId&&R.errors.parentId?e.jsx("div",{className:"text-danger",children:R.errors.parentId?"required":""}):null})]})})]}),e.jsxs(N.Group,{controlId:"title",children:[e.jsx(N.Label,{children:"Title"}),e.jsx(N.Control,{as:"textarea",name:"title",placeholder:R.values.title==="new Answer"?"new Answer":"answer text",ref:F,onChange:b,value:R.values.title,rows:3,className:"text-primary w-100",disabled:v}),e.jsx(N.Text,{className:"text-danger",children:R.touched.title&&R.errors.title?e.jsx("div",{className:"text-danger",children:R.errors.title}):null})]}),e.jsxs(me,{children:[e.jsx(Ee,{children:e.jsxs(N.Group,{controlId:"source",children:[e.jsx(N.Label,{children:"Source"}),e.jsx(Te,{id:"source",name:"source",options:js,onChange:(P,U)=>{P.preventDefault(),R.setFieldValue("source",U)},value:R.values.source,disabled:v,classes:"text-primary"}),e.jsx(N.Text,{className:"text-danger",children:R.touched.source&&R.errors.source?e.jsx("div",{className:"text-danger",children:R.errors.source}):null})]})}),e.jsx(Ee,{children:e.jsxs(N.Group,{controlId:"status",children:[e.jsx(N.Label,{children:"Status"}),e.jsx(Te,{id:"status",name:"status",options:Os,onChange:(P,U)=>{P.preventDefault(),R.setFieldValue("status",U)},value:R.values.status,disabled:v,classes:"text-primary"}),e.jsx(N.Text,{className:"text-danger",children:R.touched.status&&R.errors.status?e.jsx("div",{className:"text-danger",children:R.errors.status}):null})]})})]}),(A||t)&&e.jsx("div",{className:"my-1",children:e.jsx(qe,{created:s.created,modified:s.modified,classes:"text-primary"})}),(R.dirty&&t||f)&&e.jsx(He,{cancelForm:S,handleSubmit:R.handleSubmit,title:w}),g.error&&e.jsx("div",{className:"text-danger",children:g.error.message})]})]})},Ce=({closeModal:s,showCloseButton:l,source:w,setError:o})=>{const{state:c,cancelAddAnswer:a,createAnswer:g}=$(),{activeAnswer:x}=c,G=x?x.topId:"",A=async()=>{await a()},t=async f=>{const v={...f,topId:G,created:{time:new Date,nickName:""},modified:void 0},T=await g(v,s!==void 0);T&&(T.message?o(T.message):s&&s())};return x?e.jsx(De,{answer:x,showCloseButton:l??!0,source:w??0,closeModal:A,submitForm:t,children:"Create Answer"}):null},os=({})=>{const{state:s,updateAnswer:l}=$(),{activeAnswer:w}=s;if(!w)return null;if(!w)return e.jsx("div",{children:"Loading answer to edit..."});const o=async c=>{const a={...c,created:void 0,modified:{time:new Date,nickName:""}},{parentId:g}=w,x=g!==a.parentId;await l(g,a,x)};return e.jsx(De,{answer:w,showCloseButton:!0,source:0,submitForm:o,children:"Update Answer"})},ns=({inLine:s})=>{console.log(s?"ViewAnswer inLine":"ViewAnswer not inLine");const{state:l}=$(),{activeAnswer:w}=l,[o,c]=E.useState(null);return E.useEffect(()=>{console.log("#################################### ViewAnswer setAnswer ...",{activeAnswer:w}),c(w)},[w]),e.jsx(De,{answer:o,showCloseButton:!0,source:0,submitForm:()=>{},children:"View Answer"})},Vs=({answerRow:s,isSelected:l})=>{const{id:w,topId:o,parentId:c,title:a}=s,g={topId:o,parentId:c,id:c},{canEdit:x,authUser:G}=oe(),{state:A,viewAnswer:t,addAnswer:f,editAnswer:v,deleteAnswer:T}=$(),{activeAnswer:D,formMode:O,loadingAnswer:k,answerLoaded:z}=A,S=D!==null&&D.id===w,I=O===m.AddingAnswer,M=()=>{s.modified={time:new Date,nickName:G.nickName},T(s,S)},_=async L=>{console.log("AnswerRow onSelectAnswer",{id:L}),x?await v(s):await t(s)},[F,R]=Oe();E.useEffect(()=>{(async()=>{if(l&&!k&&!z){switch(O){case m.ViewingAnswer:await t(s);break;case m.EditingAnswer:console.log("Zovem from AnswerRow"),x?await v(s):await t(s);break}document.getElementById(`AnswerRow${w}`)?.scrollIntoView({behavior:"smooth",block:"end"})}})()},[x,v,O,w,l,k,z,s,t]);const b=e.jsxs("div",{id:`AnswerRow${w}`,className:`d-relative d-flex justify-content-start align-items-center w-100 mt-0 answer-row${l?"-selected":""}`,style:{marginTop:"1px"},children:[e.jsx(B,{variant:"link",size:"sm",className:"d-flex align-items-center px-1 text-secondary",children:e.jsx("img",{width:"22",height:"18",src:Ss,alt:"Answer"})}),e.jsx(B,{variant:"link",size:"sm",className:`p-0 px-1 m-1 ms-0 answer-row-title ${S?"fw-bold":""}`,title:`id:${w.toString()}`,onClick:()=>_(w),disabled:I,children:a}),x&&!I&&R&&e.jsxs("div",{className:"position-absolute text-nowrap d-flex align-items-center border border-0 border-warning p-0 end-0",children:[e.jsx(B,{variant:"link",size:"sm",className:"ms-1 p-0 text-secondary d-flex align-items-center",title:"Add Answer",onClick:()=>{f(g,!0)},children:e.jsx("img",{width:"22",height:"18",src:Xe,alt:"Add Answer"})}),e.jsx(B,{variant:"link",size:"sm",className:"ms-0 p-0 text-secondary",onClick:M,children:e.jsx(ae,{icon:Ie,size:"lg"})})]})]});return e.jsxs(le.Item,{className:"py-0 px-0 w-100",as:"li",children:[l&&O===m.AddingAnswer&&e.jsxs(e.Fragment,{children:[e.jsx("div",{id:"div-answer",className:"ms-0 d-md-none w-100",children:e.jsx(Ce,{showCloseButton:!0,source:0})}),e.jsx("div",{ref:F,className:"d-none d-md-block  border rounded-3",children:b})]}),l&&O===m.EditingAnswer&&e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:F,className:"",children:b}),e.jsx("div",{id:"div-answer",className:"ms-0 d-md-none w-100",children:e.jsx(os,{inLine:!0})})]}),l&&O===m.ViewingAnswer&&e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:F,className:"",children:b}),e.jsx("div",{ref:F,id:"div-answer",className:"ms-0 d-md-none w-100",children:e.jsx(ns,{inLine:!0})})]}),!l&&e.jsx("div",{ref:F,className:"",children:b})]})},rs=({groupRow:s})=>{const{state:l,loadGroupAnswers:w}=$(),{keyExpanded:o,loadingAnswer:c,error:a,selectedAnswerId:g}=l,{answerId:x}=o;s.level+=1;const{answerRows:G}=s;let A=!1;async function t(){try{const T={groupKey:new te(s).groupKey,startCursor:G.length,includeAnswerId:x??null};console.log("^^^^^^^^^^^^^ loadMore"),console.log("^^^^^^^^^^^^^",{x:T}),console.log("^^^^^^^^^^^^^ loadMore"),await w(T)}catch{}}const[f,{rootRef:v}]=Is({loading:c,hasNextPage:A,onLoadMore:t,disabled:!!a,rootMargin:"0px 0px 100px 0px"});return e.jsxs("div",{ref:v,className:"ms-0",style:{maxHeight:"400px",overflowY:"auto"},children:[e.jsxs(bs,{children:[G.length===0&&e.jsx("label",{children:"No answers"}),G.map(T=>e.jsx(Vs,{answerRow:T,isSelected:T.id===g},T.id)),A]}),a&&e.jsxs("p",{children:["Error: ",a.message]})]})},zs=({groupKey:s,tag:l,groupInAdding:w})=>{const{name:o}=l,{canEdit:c}=oe(),{state:a,deleteGroupVariation:g}=$(),x=()=>{g(s,o)},[G,A]=Oe(),t=e.jsxs("div",{ref:G,children:[e.jsx(Qe,{pill:!0,bg:"secondary",children:o}),c&&!0&&A&&e.jsx(B,{variant:"link",size:"sm",className:"ms-0 py-0 mx-0 text-secondary",onClick:x,children:e.jsx(ae,{icon:Ie,size:"sm"})}),!1]});return e.jsx("div",{className:"py-1 px-1",children:t})},Ks=({groupKey:s,variations:l})=>{const{state:w}=$(),{error:o}=w;return E.useEffect(()=>{},[]),e.jsxs("div",{className:"ms-2",children:[e.jsxs(je,{direction:"horizontal",gap:2,children:[l.length===0&&e.jsx("div",{children:"No"}),l.length>0&&l.map(c=>e.jsx(zs,{groupKey:s,tag:c,groupInAdding:void 0}))]}),o&&e.jsxs("p",{children:["Error: ",o.message]})]})},ke=({formMode:s,group:l,submitForm:w,children:o})=>{const{onGroupTitleChanged:c}=$(),a=s===m.ViewingGroup,g=s===m.EditingGroup,x=s===m.AddingGroup,{topId:G,id:A,variations:t,answerRows:f,title:v}=l;console.log("GroupForm render: ",{topId:G,id:A,catTitle:v,formMode:s});const T=new te(l).groupKey;document.getElementById("div-details");const D=f&&f.length>0,O=be(),k=()=>{O({type:n.CLOSE_GROUP_FORM,payload:{}})},z=()=>{O({type:n.CANCEL_GROUP_FORM,payload:{}})},[S,I]=E.useState(v),M=ze(S,300),_=Ke({enableReinitialize:!0,initialValues:l,validationSchema:Be().shape({title:_e().required("Required")}),onSubmit:L=>{console.log("GroupForm.onSubmit",JSON.stringify(L,null,2)),w(L),I(L.title)}});E.useEffect(()=>{(async()=>(console.log("GroupForm.useEffect - onGroupTitleChanged",{debouncedSearchTerm:M,title:_.values.title}),_.values.title!==M&&c(G,A,_.values.title)))()},[M,_.values.title,c]);const F=L=>{_.handleChange(L);const P=L.target.value;I(P)},R=E.useRef(null),b=!1;return console.log("GroupForm render return: ",S),e.jsxs("div",{className:"form-wrapper p-2 group-form",children:[e.jsx(We,{onClick:k,className:"float-end"}),e.jsx(me,{className:"text-center text-muted",children:e.jsxs(N.Label,{children:["Group ",a?"Viewing":g?"Editing":"Adding"]})}),e.jsxs(N,{onSubmit:()=>_.handleSubmit,children:[e.jsx(N.Group,{controlId:"Variations",children:e.jsxs(je,{direction:"horizontal",gap:1,children:[e.jsx("div",{className:"px-0",children:e.jsx(N.Label,{children:"Variations:"})}),e.jsx("div",{className:"px-1 border border-1 border-secondary rounded",children:e.jsx(Ks,{groupKey:T,variations:t?t.map(L=>({name:L})):[]})}),e.jsx("div",{className:"ps-2",children:e.jsx(N.Label,{children:"Kind:"})}),e.jsx("div",{className:"px-1 border border-1 border-secondary rounded",children:e.jsxs(N.Group,{controlId:"kind",children:[e.jsx(Te,{id:"kind",name:"kind",options:Ds,onChange:(L,P)=>{L.preventDefault(),_.setFieldValue("kind",P)},value:_.values.kind,disabled:b,classes:"text-primary"}),e.jsx(N.Text,{className:"text-danger",children:_.touched.kind&&_.errors.kind?e.jsx("div",{className:"text-danger",children:_.errors.kind}):null})]})})]})}),e.jsxs(N.Group,{controlId:"title",children:[e.jsx(N.Label,{children:"Title"}),e.jsx(N.Control,{as:"textarea",name:"title",placeholder:"new Group",value:S,onChange:F,onFocus:L=>{s===m.AddingGroup&&L.target.select()},ref:R,rows:3,className:"text-primary w-100",disabled:a}),e.jsx(N.Text,{className:"text-danger",children:_.touched.title&&_.errors.title?e.jsx("div",{className:"text-danger",children:_.errors.title}):null})]}),e.jsxs(N.Group,{controlId:"link",children:[e.jsx(N.Label,{children:"Link"}),_.values.hasSubGroups?e.jsx(N.Control,{as:"input",placeholder:"/groups/...",name:"link",onChange:_.handleChange,className:"text-primary w-100",value:"Can't have link (has sub groups)",disabled:!0}):e.jsxs(e.Fragment,{children:[e.jsx(N.Control,{as:"input",placeholder:"/groups/...",name:"link",onChange:_.handleChange,className:"text-primary w-100",value:_.values.link??"",disabled:a}),e.jsx(N.Text,{className:"text-danger",children:_.touched.link&&_.errors.link?e.jsx("div",{className:"text-danger",children:_.errors.link}):null})]})]}),e.jsxs(N.Group,{children:[e.jsxs(N.Label,{className:"m-1 mb-0",children:["Answers (",`${_.values.numOfAnswers}`,") "]}),D&&e.jsx(rs,{groupRow:l})]}),(a||g)&&e.jsx(qe,{created:l.created,modified:l.modified,classes:"text-primary"}),(_.dirty&&g||x)&&e.jsx(He,{cancelForm:z,handleSubmit:_.handleSubmit,title:o})]})]})},ts=({inLine:s})=>{const l=oe(),{nickName:w}=l.authUser,{state:o,updateGroup:c,cancelAddGroup:a}=$(),{activeGroup:g,keyExpanded:x}=o,{answerId:G}=x,A=async()=>{await a()},t=async()=>{await a()},f=async v=>{const T={...v,created:void 0,modified:{time:new Date,nickName:w}};await c(T,!0)};return e.jsx(ke,{inLine:s,group:{...g},answerId:G,formMode:m.EditingGroup,cancel:A,close:t,submitForm:f,children:"Update Group"})},ve=({inLine:s})=>{const{state:l,cancelAddGroup:w}=$(),{activeGroup:o,keyExpanded:c}=l,{answerId:a}=c,g=async()=>{await w()};return e.jsx(ke,{inLine:s,group:{...o},answerId:a,formMode:m.ViewingGroup,close:g,cancel:g,submitForm:()=>{},children:"View Group"})},as=({activeGroup:s})=>{const l=oe(),{nickName:w}=l.authUser,{cancelAddGroup:o,createGroup:c}=$(),[a]=E.useState({...s}),g=async()=>{await o()},x=async()=>{await o()},G=async A=>{const t={...A,created:{time:new Date,nickName:w},modified:void 0};console.log("**********object",t),await c(t)};return!s===null?null:(console.log("AddGroup render >>>>>:",s),e.jsx(e.Fragment,{children:e.jsx(ke,{inLine:!1,group:a,answerId:null,formMode:m.AddingGroup,cancel:g,close:x,submitForm:G,children:"Create Group"})}))},Bs=({groupRow:s,answerId:l})=>{const{id:w,title:o,hasSubGroups:c,numOfAnswers:a,isExpanded:g,groupRows:x}=s;s.level+=1;const G=new te(s).groupKey,{canEdit:A,authUser:t}=oe(),{state:f,addGroup:v,viewGroup:T,editGroup:D,deleteGroup:O,expandGroup:k,collapseGroup:z,addAnswer:S}=$();let{formMode:I,activeGroup:M,loadingGroup:_,groupLoaded:F}=f;const R=M!==null&&M.id===w,b=I===m.AddingGroup,L=g&&a>0,P=()=>{s.modified={time:new Date,nickName:t.nickName},O(s)},U=async()=>{g?await z(s):await k({groupKey:G})},[ne,ue]=E.useState(!1);E.useEffect(()=>{ue(!0)},[x]);const q=async()=>{A?await D(s,l??"null"):await T(s,l??"null")},[de,K]=E.useState(!1);E.useEffect(()=>{de&&(v(s),K(!1))},[v,s,de]);const[ie,re]=E.useState(!1);E.useEffect(()=>{ie&&(S(G,g??!1),re(!1))},[S,G,g,ie]),E.useEffect(()=>{(async()=>{if(R&&!_&&!F&&!b)switch(console.log("GroupRow formMode:",I),I){case m.ViewingGroup:await T(s,l??"null");break;case m.EditingGroup:A?await D(s,l??"null"):await T(s,l??"null");break}})()},[A,G,F,s,D,k,I,b,R,_,l,T]);const[W,J]=Oe(),H=e.jsxs("div",{children:[e.jsxs("div",{id:`Row${w}`,className:`d-relative d-flex justify-content-start align-items-center w-100 mt-1 group-row${R?"-selected":""}`,style:{marginTop:"1px"},children:[e.jsx(B,{variant:"link",size:"sm",className:"py-0 px-1","aria-controls":w+"-2","aria-expanded":ne,onClick:X=>{U(),X.stopPropagation()},title:"Expand",disabled:b||!c&&a===0,children:e.jsx(ae,{icon:g?$e:Ve,size:"lg"})}),e.jsx(B,{variant:"link",size:"sm",className:"py-0 px-1 bg-light",title:"Expand",disabled:!0,children:e.jsx(ae,{icon:Cs,size:"sm"})}),e.jsx(B,{variant:"link",size:"sm",className:`py-0 ms-0 me-1 group-row-title ${R?"fw-bold text-white bg-transparent":""}`,title:w,onClick:q,disabled:b,children:o}),a>0&&e.jsxs(Qe,{pill:!0,bg:"secondary",className:"d-inline bg-transparent",children:[a,"Q"]}),A&&J&&a===0&&e.jsxs("div",{className:"position-absolute text-nowrap d-flex align-items-center border border-0 border-warning p-0 end-0",children:[e.jsx("div",{className:"d-flex align-items-center",children:e.jsx(B,{variant:"link",size:"sm",className:"border-0 py-0 px-0 ms-0 text-success",title:"Add SubGroup",onClick:async()=>{!g&&(c||a>0)&&await U(),setTimeout(()=>K(!0),1e3)},children:e.jsx(ae,{icon:ks,size:"lg"})})}),!b&&!c&&e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(B,{variant:"link",size:"sm",className:"p-0 mx-0 text-secondary d-flex align-items-center border border-0 border-warning",title:"Add Answer",onClick:async()=>{!g&&(c||a>0)&&await U(),setTimeout(()=>re(!0),500)},children:e.jsx("img",{width:"22",height:"18",src:Xe,alt:"Add Answer"})}),e.jsx(B,{variant:"link",size:"sm",className:"d-flex align-items-center border border-0 border-warning p-0",disabled:c||a>0,onClick:P,children:e.jsx(ae,{icon:Ie,size:"lg"})})]})]})]}),L&&e.jsx("div",{className:"ps-3",children:e.jsx(rs,{groupRow:s})})]});return e.jsxs(e.Fragment,{children:[e.jsxs(le.Item,{className:"py-0 px-1 w-100 group-bg",as:"li",children:[R&&I===m.AddingGroup&&e.jsxs("div",{children:[e.jsx("div",{ref:W,className:"",children:H}),e.jsx("div",{className:"ms-0 d-md-none w-100",children:e.jsx(as,{activeGroup:M})})]}),R&&I===m.EditingGroup&&e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:W,children:H}),e.jsx("div",{id:"divInLine",className:"ms-0 d-md-none w-100",children:e.jsx(ts,{inLine:!1})})]}),R&&I===m.ViewingGroup&&e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:W,children:H}),e.jsx("div",{id:"divInLine",className:"ms-0 d-md-none w-100",children:e.jsx(ve,{inLine:!1})})]}),R&&I===m.None&&e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:W,children:H}),e.jsx("div",{id:"divInLine",className:"ms-0 d-md-none w-100",children:e.jsx(ve,{inLine:!1})})]}),!R&&e.jsx("div",{ref:W,children:H})]}),f.error&&f.whichRowId===w&&e.jsx("div",{className:"text-danger",children:f.error.message}),g&&e.jsx(le.Item,{className:"py-0 px-0 border-0 border-warning border-bottom-0 group-bg p-0 m-0",variant:"primary",as:"li",children:e.jsx("div",{className:"rambo",children:c&&e.jsx(_s,{in:ne,children:e.jsx("div",{id:w+"-2",style:{marginTop:"1px"},children:e.jsx("div",{style:{border:"1px solid #ddd",borderRadius:"4px"},children:e.jsx(ls,{groupRow:s,isExpanded:g})})})})})})]})},ls=({groupRow:s})=>{const{level:l,groupRows:w}=s,{state:o}=$();let{keyExpanded:c}=o;const{answerId:a}=c??{answerId:null};return e.jsx("div",{className:l>1?"ms-2":"",children:e.jsx(le,{as:"ul",variant:"dark",className:"mb-0 group-bg",children:w.map(g=>e.jsx(Bs,{groupRow:g,answerId:a===""?null:a},g.id))})})},qs=s=>{const{isDarkMode:l}=oe(),[w,o]=E.useState("");return E.useEffect(()=>{},[]),e.jsxs(Ae,{show:s.show,onHide:s.onHide,animation:!0,centered:!0,size:"lg",className:"modal show",contentClassName:`${l?"bg-secondary bg-gradient":"bg-info bg-gradient"}`,children:[e.jsx(Ae.Header,{closeButton:!0,children:"Store new Answer to the Database"}),e.jsx(Ae.Body,{className:"py-0",children:e.jsx(Ce,{closeModal:s.onHide,showCloseButton:!1,source:1,setError:c=>o(c)})}),e.jsx(Ae.Footer,{children:w})]})},Hs=E.lazy(()=>vs(()=>import("./AutoSuggestAnswers-BcT4VVDN.js"),__vite__mapDeps([0,1,2,3,4,5])).then(s=>({default:s.AutoSuggestAnswers}))),Xs=({groupId_answerId:s,fromChatBotDlg:l})=>{const{state:w,expandNodesUpToTheTree:o,loadTopRows:c,addGroup:a}=$(),{allGroupRows:g,topRows:x,topRowsLoading:G,topRowsLoaded:A,keyExpanded:t,groupId_answerId_done:f,nodeOpening:v,nodeOpened:T,activeGroup:D,activeAnswer:O,formMode:k,loadingGroups:z,loadingGroup:S,loadingAnswers:I,loadingAnswer:M}=w,{searchAnswers:_,setLastRouteVisited:F,setChatBotDlgEnabled:R}=Me(),{isDarkMode:b,chatBotDlgEnabled:L,lastRouteVisited:P}=oe(),[U,ne]=E.useState(!1),[ue,q]=E.useState({...Ne}),de=be(),K=async W=>{de({type:n.SET_ANSWER_SELECTED,payload:{answerKey:W}})};let ie="";E.useEffect(()=>{(async()=>!G&&!A&&(console.log("ZOVEM 111 loadTopRows()"),await c()))()},[G,A,c]),E.useEffect(()=>{(async()=>{if(!v&&A&&x.length>0){if(s){if(s==="add_answer"){const W=localStorage.getItem("New_Answer");if(W){const J=JSON.parse(W);return q({...Ne,groupTitle:"Select",...J}),ne(!0),localStorage.removeItem("New_Answer"),null}}else if(s!==f){const W=s.split("_"),J=W[0],H=W[1],X={topId:"",id:J,parentId:"ROOT"};console.log("zovem expandNodesUpToTheTree 1111111111111111111)",{groupId_answerId:s},{groupId_answerId_done:f}),await o(X,H!=="null"?H:null),console.log("zavrsio expandNodeUpToTheTree 1111111111111111111 DONE)",{groupId_answerId:s})}}else if(t&&!T){const{topId:W,groupId:J,answerId:H}=t;if(J!==""){const X={topId:W,id:J,parentId:"ROOT"};console.log("zovem expandNodeUpToTheTree 2222222222222)",{keyExpanded:t,grpKey:X}),await o(X,H),console.log("zavrsio expandNodeUpToTheTree 2222222222222 DONE)")}}L||R()}})()},[s,f,A,t,v,T,o,l,L,R]);const re="/knowledge/groups";return E.useEffect(()=>{P!==re&&F(re)},[P,F]),s!=="add_answer"&&s&&s!==f?(console.log("zzzzzz loading...",{keyExpanded:t,groupId_answerId:s,groupId_answerId_done:f}),e.jsx("div",{children:"loading..."})):A?(console.log("===>>> Groups !!!!!!!!!!!!!!!!!",D),e.jsxs(e.Fragment,{children:[e.jsxs(Ns,{children:[e.jsxs("h5",{className:"text-warning mx-auto w-75 fw-bold",children:[e.jsx("span",{className:"groups",children:"Groups / "}),e.jsx("span",{className:"answers",children:"Answers"})]}),e.jsx(me,{className:`${b?"dark":""}`,children:e.jsx(Ee,{children:e.jsx("div",{className:"d-flex justify-content-start align-items-center",children:e.jsx("div",{className:"w-75 my-1 answers",children:e.jsx(E.Suspense,{fallback:e.jsx("div",{children:"Loading..."}),children:e.jsx(Hs,{tekst:ie,onSelectAnswer:K,allGroupRows:g,searchAnswers:_})})})})})}),e.jsx(B,{variant:"secondary",size:"sm",type:"button",style:{padding:"1px 4px"},onClick:()=>a(null),children:"Add Group"}),e.jsxs(me,{className:"my-1 h-auto",children:[e.jsx(Ee,{xs:12,md:5,children:e.jsx("div",{className:"groups-border",style:{position:"relative"},children:e.jsx(ls,{groupRow:{...Je,groupRows:x},isExpanded:!0})})}),e.jsx(Ee,{xs:0,md:7,children:e.jsxs("div",{id:"div-details",className:"d-none d-md-block",children:[D&&k===m.ViewingGroup&&e.jsx(ve,{inLine:!1}),D&&k===m.EditingGroup&&e.jsx(ts,{inLine:!1}),D&&k===m.AddingGroup&&e.jsx(as,{activeGroup:D}),O&&k===m.ViewingAnswer&&e.jsx(ns,{inLine:!1}),O&&k===m.EditingAnswer&&e.jsx(os,{inLine:!1}),O&&k===m.AddingAnswer&&e.jsx(Ce,{})]})})]})]}),U&&O&&e.jsx(qs,{show:U,onHide:()=>{ne(!1)},newAnswerRow:ue}),(z||I)&&e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{position:"absolute",top:"40%",left:"20%"},children:e.jsx("div",{className:`spinner-border ${I?"answer":"group"}-spinner`,role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})}),S&&e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{position:"absolute",top:"50%",left:"50%"},children:e.jsx("div",{className:"spinner-border group-spinner",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})}),M&&e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{position:"absolute",top:"50%",left:"50%"},children:e.jsx("div",{className:"spinner-border answer-spinner",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})})]})):(console.log("===>>> Groups  VRATIO"),null)},Zs=()=>{let{groupId_answerId:s,fromChatBotDlg:l}=Ts();if(s&&s==="groups"&&(s=void 0),s){const w=s.split("_");console.assert(w.length===2,"expected 'groupId_answerId'")}return e.jsx(Fs,{children:e.jsx(Xs,{groupId_answerId:s,fromChatBotDlg:l})})};export{Zs as default};
//# sourceMappingURL=Groups-Dvoplftx.js.map
