const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AssignedAnswers-ByHfqxAt.js","assets/index-CJXLliDA.js","assets/index-CykrPP6v.css","assets/Options-B04CbQ85.js","assets/lib-YOFMYlJ2.js","assets/AutoSuggestAnswers-BpqbUSwU.js","assets/AutoSuggestAnswers-vl2QUoNQ.css","assets/AutoSuggestQuestions-DLYsXzTw.js","assets/AutoSuggestQuestions-DN6HBK-e.css"])))=>i.map(i=>d[i]);
import{A as s,d as wt,a as ht,b as Ct,F as f,I as fe,u as ve,c as re,r as E,C as _e,e as xe,f as ie,g as Me,h as Rt,Q as Ue,i as ye,j as Tt,k as Ce,l as St,m as _t,n as e,B as Y,_ as It,o as Pe,R as Ee,D as we,p as pe,q as Nt,s as jt,t as vt,v as Ot}from"./index-CJXLliDA.js";import{L as oe,F as le,f as Be,a as $e,u as Re,B as Te,b as Ve,c as Ke,d as ze,e as Ie,g as j,S as Oe,h as Ne,s as Qt,i as At,C as Ye,j as We,Q as He,k as Qe,l as bt,m as Dt,n as kt,o as Lt,p as qt,M as he}from"./Options-B04CbQ85.js";import{f as Gt,a as Ft}from"./lib-YOFMYlJ2.js";import{A as Mt}from"./AutoSuggestQuestions-DLYsXzTw.js";const je={topId:"",parentId:"null",id:"generateId",categoryTitle:"",title:"",assignedAnswers:[],numOfAssignedAnswers:0,relatedFilters:[],numOfRelatedFilters:0,source:0,status:0,included:!1},Ae={topId:"null",parentId:"null",id:"define at BackEnd",kind:0,title:"",link:"",header:"",level:0,variations:[],hasSubCategories:!1,categoryRows:[],questionRows:[],numOfQuestions:0,hasMoreQuestions:!1,isExpanded:!1,doc1:""},Ut=(t,r)=>{console.log("------------------------------->"),console.log("------------------------------->",r.type),console.log("------------------------------->");const{categoryRow:u}=r.payload;if(r.type===s.SET_FROM_LOCAL_STORAGE){const{keyExpanded:y}=r.payload;return{...t,keyExpanded:y}}let o=u?!wt.includes(r.type):!1;const{topRows:d}=t,n=ht.includes(r.type)?{...t}:Pt(t,r);if(o&&u){let y;const{topId:h,id:C}=u;if(C===h)y=d.map(R=>R.id===h?new J(u).categoryRow:new J(R).categoryRow);else{const R=d.find(x=>x.id===h);J.idToSet=C,J.newCategoryRow=u;const i=new J(R).categoryRow;y=d.map(x=>x.id===h?i:new J(x).categoryRow),J.idToSet=""}n.topRows=y}if(Ct.includes(r.type)){const{keyExpanded:y}=n,h={keyExpanded:y};localStorage.setItem("CATEGORIES_STATE",JSON.stringify(h))}return console.log("CategoryReducer newState",n),n},Pt=(t,r)=>{switch(r.type){case s.SET_TOP_ROWS_LOADING:return{...t,loadingCategories:!0,topRowsLoading:!0,topRowsLoaded:!1};case s.SET_TOP_ROWS:{const{topRows:o}=r.payload;return console.log("=> CategoriesReducer ActionTypes.SET_TOP_ROWS",t.topRows,o),{...t,topRows:o,topRowsLoading:!1,topRowsLoaded:!0,loadingCategories:!1}}case s.SET_ALL_CATEGORY_ROWS:{const{allCategoryRows:o}=r.payload;return{...t,allCategoryRows:o,allCategoryRowsLoaded:Date.now()}}case s.SET_NODE_EXPANDING_UP_THE_TREE:{const{categoryId_questionId_done:o}=r.payload;return{...t,categoryId_questionId_done:o,nodeOpening:!0,loadingCategories:!0,nodeOpened:!1,activeCategory:null,activeQuestion:null}}case s.SET_NODE_EXPANDED_UP_THE_TREE:{const{category:o,formMode:d,questionId:n,question:y}=r.payload;return{...t,activeCategory:o,activeQuestion:y,selectedQuestionId:n,formMode:d,nodeOpening:!1,nodeOpened:!0,loadingCategories:!1}}case s.SET_LOADING_CATEGORY:return{...t,loadingCategory:!0,categoryLoaded:!1};case s.FORCE_OPEN_NODE:const{keyExpanded:u}=r.payload;return{...t,topRows:t.topRows.filter(o=>o.parentId===null),keyExpanded:u,nodeOpened:!1,activeCategory:null,activeQuestion:null,selectedQuestionId:null};case s.SET_SUB_CATEGORIES:return{...t,loadingCategory:!1};case s.SET_ERROR:{const{error:o,whichRowId:d}=r.payload;return{...t,error:o,whichRowId:d,loadingCategories:!1,loadingQuestions:!1,loadingCategory:!1,categoryLoaded:!1,loadingQuestion:!1,questionLoaded:!1}}case s.ADD_SUB_CATEGORY:{const{categoryKey:o,level:d}=r.payload,{topId:n}=o,y={...Ae,topId:n,level:d,parentId:""};return{...t,activeCategory:y,formMode:f.AddingCategory}}case s.SET_CATEGORY:{const{categoryRow:o}=r.payload;return console.assert(fe(o)),{...t,loadingCategory:!1,categoryLoaded:!0,activeCategory:o,activeQuestion:null,selectedQuestionId:null}}case s.SET_ROW_EXPANDING:return{...t,rowExpanding:!0,rowExpanded:!1,loadingCategories:!0};case s.SET_ROW_EXPANDED:{const{categoryRow:o}=r.payload,{topId:d,id:n}=o,{keyExpanded:y}=t,h=y?y.questionId:null;return{...t,loadingCategories:!1,keyExpanded:{topId:d,categoryId:n,questionId:h},activeQuestion:null,selectedQuestionId:h,loadingQuestion:!1,questionLoaded:!1,rowExpanding:!1,rowExpanded:!0}}case s.SET_ROW_COLLAPSED:{const{categoryRow:o}=r.payload,{topId:d,parentId:n}=o;return{...t,loadingCategories:!1,keyExpanded:{topId:d,categoryId:n??"",questionId:null},rowExpanding:!1,rowExpanded:!0,activeCategory:null,activeQuestion:null,selectedQuestionId:null}}case s.SET_CATEGORY_TO_VIEW:{const{categoryRow:o}=r.payload;console.assert(fe(o));const n={...o,isExpanded:!1};return{...t,formMode:f.ViewingCategory,loadingCategory:!1,activeCategory:n,activeQuestion:null,selectedQuestionId:null}}case s.SET_CATEGORY_TO_ADD_TOP:{const{newCategoryRow:o}=r.payload;return{...t,loadingCategory:!1,categoryLoaded:!0,activeCategory:{...o,doc1:""},activeQuestion:null,selectedQuestionId:null,topRows:[o,...t.topRows],formMode:f.AddingCategory}}case s.SET_CATEGORY_TO_ADD:{const{newCategoryRow:o}=r.payload;return{...t,loadingCategory:!1,categoryLoaded:!0,activeCategory:{...o,doc1:""},activeQuestion:null,selectedQuestionId:null,formMode:f.AddingCategory}}case s.SET_CATEGORY_ADDED:{const{categoryRow:o}=r.payload;console.assert(fe(o));const n={...o,isExpanded:!1},{topId:y,id:h}=n;return{...t,formMode:f.EditingCategory,loadingCategory:!1,categoryLoaded:!1,activeCategory:n,activeQuestion:null,selectedQuestionId:null,keyExpanded:{topId:y,categoryId:h,questionId:null}}}case s.SET_CATEGORY_TO_EDIT:case s.SET_CATEGORY_UPDATED:{const{categoryRow:o,category:d}=r.payload;console.assert(fe(o));const{topId:n,id:y}=d;return{...t,formMode:f.EditingCategory,loadingCategory:!1,categoryLoaded:!0,keyExpanded:{topId:n,categoryId:y,questionId:null},activeCategory:d,activeQuestion:null,selectedQuestionId:null}}case s.SET_CATEGORY_QUESTIONS_LOADING:return{...t,loadingQuestions:!0,questionLoaded:!1};case s.CATEGORY_QUESTIONS_LOADED:return{...t,loadingQuestions:!1};case s.DELETE_CATEGORY:return{...t,activeCategory:null,formMode:f.None,error:void 0,whichRowId:void 0};case s.CANCEL_CATEGORY_FORM:case s.CLOSE_CATEGORY_FORM:return{...t,activeCategory:null,formMode:f.None};case s.CANCEL_ADD_SUB_CATEGORY:return{...t,activeCategory:null,activeQuestion:null,selectedQuestionId:null,formMode:f.None};case s.SET_LOADING_QUESTION:return{...t,loadingQuestion:!0,questionLoaded:!1};case s.CANCEL_ADD_QUESTION:return{...t,formMode:f.None,activeQuestion:null,selectedQuestionId:null};case s.SET_QUESTION_SELECTED:{const{questionKey:o}=r.payload,{topId:d,parentId:n,id:y}=o;return{...t,topRows:t.topRows.filter(h=>h.parentId===null),keyExpanded:{topId:d,categoryId:n,questionId:y},activeCategory:null,activeQuestion:null,selectedQuestionId:null}}case s.ADD_NEW_QUESTION_TO_ROW:{const{newQuestionRow:o}=r.payload;return{...t,selectedQuestionId:o.id}}case s.SET_QUESTION:{const{question:o,formMode:d}=r.payload;return console.log(s.SET_QUESTION,o),{...t,activeCategory:null,activeQuestion:o,formMode:d,error:void 0,loadingCategory:!1,loadingQuestion:!1,questionLoaded:!0}}case s.SET_QUESTION_AFTER_ASSIGN_ANSWER:{const{question:o}=r.payload;return{...t,activeQuestion:o,loadingQuestion:!1,questionLoaded:!0}}case s.SET_QUESTION_TO_VIEW:{const{question:o}=r.payload,{keyExpanded:d}=t;return{...t,formMode:f.ViewingQuestion,keyExpanded:d,activeQuestion:o,loadingQuestion:!1,questionLoaded:!0}}case s.SET_QUESTION_TO_EDIT:{const{question:o}=r.payload,{topId:d,id:n,parentId:y}=o;return{...t,keyExpanded:{topId:d,categoryId:y,questionId:n},activeQuestion:o,formMode:f.EditingQuestion,selectedQuestionId:o.id,loadingQuestion:!1,questionLoaded:!0}}case s.QUESTION_DELETED:return{...t,activeQuestion:null,selectedQuestionId:null,formMode:f.None,loadingQuestion:!1,questionLoaded:!0};case s.CANCEL_QUESTION_FORM:case s.CLOSE_QUESTION_FORM:return{...t,formMode:f.None,activeQuestion:null,selectedQuestionId:null};default:return alert(`Action ${r.type} not allowed`),{...t}}};class J{static idToSet;static newCategoryRow;constructor(r){const{topId:u,id:o,parentId:d,title:n,link:y,kind:h,header:C,level:R,variations:i,numOfQuestions:x,hasSubCategories:b,categoryRows:I,created:Q,modified:U,questionRows:A,isExpanded:$}=r,T=I.map(v=>(console.log("DeepClone >>>>>>>>>>>>>>>",v.id),v.id===J.idToSet?{...J.newCategoryRow}:new J(v).categoryRow));this.categoryRow={topId:u,parentId:d,id:o,kind:h,title:n,link:y,header:C,level:R,hasSubCategories:b,categoryRows:T,numOfQuestions:x,questionRows:A,variations:i??[],created:Q,modified:U,isExpanded:$}}categoryRow}const Xe=E.createContext({}),Je=E.createContext(()=>null),Bt={formMode:f.None,allCategoryRows:new Map,allCategoryRowsLoaded:void 0,topRows:[],topRowsLoading:!1,topRowsLoaded:!1,nodeOpening:!1,nodeOpened:!1,keyExpanded:null,categoryId_questionId_done:void 0,activeCategory:null,activeQuestion:null,selectedQuestionId:null,loadingCategories:!1,loadingQuestions:!1,loadingCategory:!1,categoryLoaded:!1,loadingQuestion:!1,questionLoaded:!1,error:void 0,rowExpanding:!1,rowExpanded:!1},$t=({children:t})=>{const{loadAllCategoryRowsGlobal:r}=ve(),u=re(),{KnowledgeAPI:o,isAuthenticated:d,workspace:n,authUser:y,canEdit:h}=u,{nickName:C}=y,[R,i]=E.useReducer(Ut,Bt),{formMode:x,activeCategory:b,activeQuestion:I,keyExpanded:Q,topRows:U,allCategoryRows:A,allCategoryRowsLoaded:$}=R;console.log("----->>> ----->>> ----->>> CategoryProvider"),E.useEffect(()=>{let l=n==="DEMO"?{topId:"MTS",categoryId:"REMOTECTRLS",questionId:"qqqqqq111"}:{topId:"",categoryId:"",questionId:""};if("localStorage"in window){let a=localStorage.getItem("CATEGORIES_STATE");if(console.log("CATEGORIES_STATE loaded before signIn",a),a!==null){const p=JSON.parse(a);p.keyExpanded!==null&&(l=p.keyExpanded)}}i({type:s.SET_FROM_LOCAL_STORAGE,payload:{keyExpanded:l}})},[n]);const T=E.useCallback(async(l,a,p=null,g=void 0)=>{const c=localStorage.getItem("accessToken");if(c)try{console.log("------Execute endpoint:",a);let m=null;const w=new Headers,_=`Bearer ${c}`;w.append("Authorization",_),p&&w.append("Content-Type","application/json");let G={method:l,headers:w,body:p?JSON.stringify(p):null};if(m=await fetch(a,G),m.ok){if(m.status===200||m.status===201){let W=null;try{W=await m.json()}catch{i({type:s.SET_ERROR,payload:{error:new Error(`Response status: ${m.status}`),whichRowId:g}})}finally{return W}}}else{const{errors:W}=await m.json(),K=new Error(W?.map(ee=>ee.message).join(`
`)??"unknown");i({type:s.SET_ERROR,payload:{error:K,whichRowId:g}})}}catch(m){console.log("-------------->>> execute",l,a,m),i({type:s.SET_ERROR,payload:{error:new Error("fetch eror"),whichRowId:g}})}return null},[]),v=E.useCallback(async()=>new Promise(async l=>{const a=await r();i(a?{type:s.SET_ALL_CATEGORY_ROWS,payload:{allCategoryRows:a}}:{type:s.SET_ERROR,payload:{error:new Error("Zajeb allCategoryRows")}}),l(a)}),[r]),M=E.useCallback(async l=>{try{return A.get(l)}catch(a){console.log(a),i({type:s.SET_ERROR,payload:{error:a}})}},[A]);E.useEffect(()=>{(async()=>$===void 0&&await v())()},[$,v]);const N=E.useCallback(async l=>{try{let a="";const p=[];return A.forEach((g,c)=>{c===l?a="":g.parentId===l&&p.push(g)}),{subCats:p,parentHeader:a}}catch(a){return console.log(a),i({type:s.SET_ERROR,payload:{error:a}}),{subCats:[],parentHeader:"Kiks subCats"}}},[A]),V=E.useCallback(async()=>new Promise(async l=>{try{i({type:s.SET_TOP_ROWS_LOADING,payload:{}});const a=`${o.endpointCategoryRow}/${n}/null/topRows/all`;console.log("CategoryProvider loadTopRows url:",a),console.log("loadTopRows AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"),console.time(),await T("GET",a).then(p=>{console.timeEnd(),console.log("loadTopRows BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB");const g=p.map(c=>(c.IsExpanded=Q?c.Id===Q.categoryId:!1,new _e(c).categoryRow));i({type:s.SET_TOP_ROWS,payload:{topRows:g}}),l(!0)})}catch(a){console.log(a),i({type:s.SET_ERROR,payload:{error:a}})}}),[T,o.endpointCategoryRow,Q,n]),k=E.useCallback(async(l,a)=>{const{topId:p,id:g}=l;return console.log({categoryKey:l,includeQuestionId:a}),new Promise(async c=>{try{const m=`${o.endpointCategory}/${n}/${p}/${g}/${ae}/${a}`;console.time(),console.log("================ getCategory ======================="),await T("GET",m).then(w=>{console.timeEnd();const{categoryDto:_,msg:G}=w;c(_?new xe(_).category:new Error(G))})}catch(m){console.log(m),c(m)}})},[T,o.endpointCategory,n]),D=E.useCallback(async(l,a)=>{if(l.topId===a)return l;const{categoryRows:p}=l;let g=p.find(c=>c.id===a);if(!g)for(const c of p){const m=await D(c,a);if(m){g=m,console.log("findCategory Stop the loop for: "+a);break}}return g},[]),L=E.useCallback(async(l,a,p=!1)=>new Promise(async g=>{try{let{topId:c,parentId:m,id:w}=l;if(console.assert(w!==null,"id ne sme biti null u expandNodesUpToTheTree"),w){const K=A.get(w);K?(c=K.topId,m=K.parentId):alert("reload all categoryRow:"+w)}i({type:s.SET_NODE_EXPANDING_UP_THE_TREE,payload:{fromChatBotDlg:p,categoryId_questionId_done:`${w}_${a}`}}),console.time();const _={topId:c,id:w,parentId:null},G=new ie(_).toQuery(n),W=`${o.endpointCategoryRow}?${G}&pageSize=${ae}&includeQuestionId=${a??null}`;await T("GET",W).then(async K=>{const{categoryRowDto:ee}=K;if(console.timeEnd(),ee){let ce=null,ue=null,ge=new _e(ee).categoryRow;if(m!==null){const qe=await D(ge,w);if(ce={...qe,doc1:""},a){const Ge=qe.questionRows.find(Fe=>Fe.id===a&&Fe.included);Ge&&(ce=null,ue={...Ge,assignedAnswers:[],numOfAssignedAnswers:0,numOfRelatedFilters:0,relatedFilters:[],source:0,status:0})}}console.log(">>> expandNodeUpToTheTree categoryRow",{categoryRow:ge,questionId:"'"+(a??"jok")+"'"+(a??"JOK")});const Se=a?h?f.EditingQuestion:f.ViewingQuestion:h?f.EditingCategory:f.ViewingCategory;i({type:s.SET_NODE_EXPANDED_UP_THE_TREE,payload:{catKey:l,categoryRow:ge,category:ce,questionId:a??null,question:ue,formMode:Se,fromChatBotDlg:p}}),g(!0)}else g(!1)})}catch(c){console.log(c),i({type:s.SET_ERROR,payload:{error:c}})}}),[n,o.endpointCategoryRow,T,A,D,h]),P=E.useCallback(async(l,a=!1,p=null)=>{const g=new ie(l).toQuery(n);return new Promise(async c=>{try{const m=`${o.endpointCategoryRow}/${a}/${ae}/${p}?${g}`;console.time(),await T("GET",m).then(w=>{console.timeEnd();const{categoryRowDto:_,msg:G}=w;c(_?new _e(_).categoryRow:new Error(G))})}catch(m){console.log(m),c(m)}})},[T,o.endpointCategoryRow,n]),q=E.useCallback(async({categoryKey:l,includeQuestionId:a,newQuestionRow:p,formMode:g})=>{try{i({type:s.SET_ROW_EXPANDING,payload:{}});const c=await P(l,!0,a);if(c instanceof Error)i({type:s.SET_ERROR,payload:{error:c}}),console.error({cat:c});else{let m;return a&&c.questionRows.filter(w=>w.included).length>0&&(m=a),p&&(c.questionRows=[p,...c.questionRows]),c.isExpanded=!0,console.log("@@@@@@@@@@@@@@@@@ expandCategory:",g,a),g===f.None&&a&&(g=h?f.EditingQuestion:f.ViewingQuestion),i({type:s.SET_ROW_EXPANDED,payload:{categoryRow:c,formMode:g,selectedQuestionId:m}}),c}}catch(c){return console.log("error",c),i({type:s.SET_ERROR,payload:{error:c}}),null}},[h,P]),Z=E.useCallback(async l=>{const{topId:a,id:p}=l,g=U.find(m=>m.id===a),c=await D(g,p);c?(l={...c,isExpanded:!1,categoryRows:[],questionRows:[]},i({type:s.SET_ROW_COLLAPSED,payload:{categoryRow:l}})):i({type:s.SET_ERROR,payload:{error:new Error("findCategory sranje"),whichRowId:p}})},[D,U]),S=E.useCallback(async l=>{try{i({type:s.CLOSE_CATEGORY_FORM,payload:{}});const{topId:a,id:p,parentId:g,level:c}=l??{topId:"generateId",id:"generateId",parentId:null,level:0},m={...Ae,topId:a,parentId:l?p:g,id:"generateId",level:c+1,title:"",isExpanded:!1};if(l===null)i({type:s.SET_CATEGORY_TO_ADD_TOP,payload:{newCategoryRow:m}});else{const w={...l,level:c+1,categoryRows:[m,...l.categoryRows],hasSubCategories:!0,isExpanded:!0};i({type:s.SET_CATEGORY_TO_ADD,payload:{categoryRow:w,newCategoryRow:m}})}}catch(a){console.log("error",a),i({type:s.SET_ERROR,payload:{error:a}})}},[]),z=E.useCallback(async()=>{try{const{topId:l,id:a,parentId:p}=b,c={categoryKey:{topId:l,parentId:p,id:a},formMode:f.None},m=await q(c);m&&i({type:s.CANCEL_ADD_SUB_CATEGORY,payload:{categoryRow:m}})}catch(l){console.log("error",l),i({type:s.SET_ERROR,payload:{error:l}})}},[b,q]),se=E.useCallback(async l=>{const{id:a}=l;i({type:s.SET_LOADING_CATEGORY,payload:{}});try{const p=new Me(l,n).categoryDto;console.log("categoryDto",{categoryDto:p});const g=`${o.endpointCategory}`;console.time(),await T("POST",g,p,a).then(async c=>{console.timeEnd();const{categoryDto:m}=c;if(m){const w=new xe(m).category;console.log("Category successfully created",{category:w}),await v().then(async()=>{await V(),w.parentId===null?i({type:s.SET_CATEGORY_ADDED,payload:{categoryRow:w}}):i({type:s.SET_CATEGORY_ADDED,payload:{categoryRow:w}})})}})}catch(p){console.log(p),i({type:s.SET_ERROR,payload:{error:new Error("Server Error"),whichRowId:a}})}},[T,o.endpointCategory,v,V,n]),O=E.useCallback(async()=>{try{const{topId:l,parentId:a}=I,g={categoryKey:{topId:l,parentId:a,id:a},formMode:f.None},c=await q(g);c&&i({type:s.CANCEL_ADD_QUESTION,payload:{categoryRow:c}})}catch(l){console.log("error",l),i({type:s.SET_ERROR,payload:{error:l}})}},[I,q]),F=E.useCallback(async(l,a)=>{x===f.AddingQuestion?await O():x===f.AddingCategory&&await z(),i({type:s.SET_LOADING_CATEGORY,payload:{categoryRow:l}});const p=new ie(l).categoryKey,g=await k(p,a);g instanceof Error?i({type:s.SET_ERROR,payload:{error:g}}):(g.topId=l.topId,i({type:s.SET_CATEGORY_TO_VIEW,payload:{categoryRow:g}}))},[z,O,x,k]),H=E.useCallback(async(l,a)=>{x===f.AddingQuestion?await O():x===f.AddingCategory&&await z(),i({type:s.SET_LOADING_CATEGORY,payload:{}});const p=new ie(l).categoryKey,g=await k(p,a);if(g instanceof Error)i({type:s.SET_ERROR,payload:{error:g}});else{const c={...g,isExpanded:!1,categoryRows:[],questionRows:[]};i({type:s.SET_CATEGORY_TO_EDIT,payload:{categoryRow:c,category:g}})}},[z,O,x,k]),X=E.useCallback(async l=>{i({type:s.SET_LOADING_CATEGORY,payload:{}});try{const a=new Me(l,n).categoryDto,p=`${o.endpointCategory}`;console.time(),await T("PUT",p,a).then(g=>{console.timeEnd();const{categoryDto:c,msg:m}=g;if(c){const w=new xe(c).category,{topId:_}=w;w.isExpanded=!1,w.topId=_,i({type:s.SET_CATEGORY_UPDATED,payload:{category:w}})}else i({type:s.SET_ERROR,payload:{error:new Error(`${m}`)}})})}catch(a){return console.log(a),i({type:s.SET_ERROR,payload:{error:new Error("Karambol")}}),a}},[T,o.endpointCategory,n]),ne=E.useCallback(async l=>{try{const{topId:a,parentId:p}=l,g=new Rt(l,n).categoryRowDto,c=`${o.endpointCategory}`;console.time(),await T("DELETE",c,g).then(async m=>{console.timeEnd();const{categoryDto:w,msg:_}=m;_==="OK"?(console.log("Category successfully deleted",{categoryRow:l}),await v().then(async()=>{const G={categoryKey:{topId:a,parentId:"",id:p},formMode:f.None};p?await V():await q(G).then(()=>{})})):i(_==="HasSubCategories"?{type:s.SET_ERROR,payload:{error:new Error("First remove sub categories"),whichRowId:w.Id}}:_==="HasQuestions"?{type:s.SET_ERROR,payload:{error:new Error("First remove category questions"),whichRowId:w.Id}}:{type:s.SET_ERROR,payload:{error:new Error(_),whichRowId:w.Id}})})}catch(a){return console.log(a),a}},[T,o.endpointCategory,q,v,V,n]),de=async(l,a)=>{try{console.log("Deleting Category Tag...",{categoryKey:l,variationName:a}),console.log("Category Tag successfully deleted")}catch(p){console.log("error",p),i({type:s.SET_ERROR,payload:{error:p}})}},ae=12,lt=E.useCallback(async({categoryKey:l,startCursor:a,includeQuestionId:p})=>{try{const{topId:g,id:c}=l;i({type:s.SET_CATEGORY_QUESTIONS_LOADING,payload:{}});try{const m=`${o.endpointQuestion}/${n}/${g}/${c}/${a}/${ae}/${p}`;console.time(),await T("GET",m).then(w=>{console.timeEnd();const{categoryDto:_}=w;if(_!==null){const G=new xe(_).category;i({type:s.CATEGORY_QUESTIONS_LOADED,payload:{categoryRow:G}})}})}catch(m){console.log(m),i({type:s.SET_ERROR,payload:{error:m}})}}catch(g){console.log(g),i({type:s.SET_ERROR,payload:g})}},[T,o.endpointQuestion,n]),dt=E.useCallback(async l=>{try{const{topId:a,id:p}=l;let g=await M(p);if(!g){alert(`Not found ${p}. Reload all Categories`);return}const c={topId:a,parentId:l.id,id:"generateId",title:"question text",categoryTitle:g.title,numOfAssignedAnswers:0,included:!0},m={...je,...c,title:""},w=R.topRows.find(G=>G.id===a),_=await D(w,p);i({type:s.ADD_NEW_QUESTION_TO_ROW,payload:{categoryRow:{..._,questionRows:[c,..._.questionRows]},newQuestionRow:c}}),i({type:s.SET_QUESTION,payload:{question:m,formMode:f.AddingQuestion}})}catch(a){console.log("error",a),i({type:s.SET_ERROR,payload:{error:a}})}},[q,D,M,R.topRows]),ct=E.useCallback(async l=>{const{topId:a,id:p,parentId:g}=l;i({type:s.SET_LOADING_CATEGORY,payload:{}});try{l.created.nickName=C;const c=new Ue(l,n).questionDto,m=`${o.endpointQuestion}`;console.time(),console.log(">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> createQuestion",c),await T("POST",m,c).then(async w=>{if(console.timeEnd(),w){console.log("::::::::::::::::::::",{questionDtoEx:w});const{questionDto:_}=w;if(_){const G=new ye(_).question;G.topId=a,console.log("Question successfully created"),await v().then(async()=>{const K={categoryKey:{topId:a,parentId:g,id:g},formMode:f.EditingQuestion};await q(K).then(()=>{i({type:s.SET_QUESTION,payload:{formMode:f.EditingQuestion,question:G}})})})}}})}catch(c){console.log(c),i({type:s.SET_ERROR,payload:{error:new Error("Server Error"),whichRowId:p}})}},[T,o.endpointQuestion,q,v,C,n]),ut=E.useCallback(async(l,a,p)=>{const{id:g}=a;try{a.modified.nickName=C;const c=new Ue(a,n).questionDto,m=`${o.endpointQuestion}`;console.time(),c.oldParentId=l,console.log(">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> updateQuestion",c);let w=null;return await T("PUT",m,c).then(async _=>{console.timeEnd();const{questionDto:G,msg:W}=_;if(G){w=new ye(G).question,console.log("Question successfully updated: ",w);const{topId:K,parentId:ee}=w;if(p){const{topId:ce,parentId:ue,id:ge}=w,Se={topId:ce,categoryId:ue,questionId:ge};i({type:s.FORCE_OPEN_NODE,payload:{keyExpanded:Se}})}else{const ue={categoryKey:{topId:K,parentId:ee,id:ee},formMode:f.EditingQuestion};await q(ue).then(()=>{i({type:s.SET_QUESTION,payload:{formMode:f.EditingQuestion,question:w}})})}}else i({type:s.SET_ERROR,payload:{error:new Error(W)}})}),w}catch(c){console.log(c),i({type:s.SET_ERROR,payload:{error:new Error("Server Error"),whichRowId:g}})}},[T,o.endpointQuestion,q,C,n]),gt=E.useCallback(async(l,a)=>{const{id:p,parentId:g,topId:c}=l;i({type:s.SET_LOADING_QUESTION,payload:{}});try{const m=new Tt(l,n).questionRowDto,w=`${o.endpointQuestion}`;console.time(),await T("DELETE",w,m).then(async _=>{const{questionDto:G}=_;if(console.timeEnd(),G){const W=new ye(G).question;console.log("Question successfully deleted"),a&&i({type:s.QUESTION_DELETED,payload:{question:W}});const ee={categoryKey:{topId:c,parentId:g,id:g},formMode:f.None};await q(ee).then(()=>{})}else console.error(_),i({type:s.SET_ERROR,payload:{error:new Error("Server Error"),whichRowId:p}})})}catch(m){console.log(m),i({type:s.SET_ERROR,payload:{error:new Error("Server Error"),whichRowId:p}})}},[T,o.endpointQuestion,q,n]),me=E.useCallback(async l=>new Promise(async a=>{try{const p=new Ce(l).toQuery(n),g=`${o.endpointQuestion}?${p}`;console.time(),console.log("getQuestion",l),await T("GET",g).then(c=>{console.timeEnd();const{questionDto:m,msg:w}=c;if(m){const _={question:new ye(m).question,msg:w};a(_)}else a({question:null,msg:w})})}catch(p){console.log(p),a({question:null,msg:"Problemos"})}}),[T,o.endpointQuestion,n]),yt=E.useCallback(async l=>{const a=new Ce(l).questionKey;i({type:s.SET_LOADING_QUESTION,payload:{}});const p=await me(a);x===f.AddingQuestion?await O():x===f.AddingCategory&&await z();const{question:g,msg:c}=p;g?(g.topId=l.topId,i({type:s.SET_QUESTION_TO_VIEW,payload:{question:g}})):i({type:s.SET_ERROR,payload:{error:new Error(c)}})},[z,O,x,me]),pt=E.useCallback(async l=>{const a=new Ce(l).questionKey;x===f.AddingQuestion?await O():x===f.AddingCategory&&await z(),i({type:s.SET_LOADING_QUESTION,payload:{}}),console.log("editQuestion:",a);const p=await me(a),{question:g,msg:c}=p;g?(g.topId=l.topId,i({type:s.CLOSE_QUESTION_FORM,payload:{question:g}}),i({type:s.SET_QUESTION_TO_EDIT,payload:{question:g}})):i({type:s.SET_ERROR,payload:{error:new Error(c)}})},[z,O,x,me]),Et=E.useCallback(async(l,a,p)=>{try{var{topId:g,id:c}=p,m={topId:g,id:c,created:{time:new Date,nickName:C}};const w=new St(m).assignedAnswerDto;w.QuestionKeyDto=new _t(a,n).dto;let _=null;const G=`${o.endpointQuestionAnswer}/${l}`;console.time(),await T("POST",G,w).then(async W=>{console.timeEnd();const{questionDto:K}=W;console.log("::::::::::::::::::::",{questionDtoEx:W}),K&&(_=new ye(K).question,console.log("Question successfully modified"))}),_&&i({type:s.SET_QUESTION_AFTER_ASSIGN_ANSWER,payload:{question:_}})}catch(w){console.log("error",w),i({type:s.SET_ERROR,payload:{error:w}})}},[T,o.endpointQuestionAnswer,C,n]),mt=E.useCallback(async(l,a,p)=>{},[D,U]),ft=E.useCallback(async(l,a,p)=>{const{parentId:g,id:c}=a,m=await D(l,g);if(m){const w=m.questionRows.find(_=>_.id===c);w.title=p,console.log("onQuestionTitleChanged+++>>>",c,m),i({type:s.QUESTION_TITLE_CHANGED,payload:{categoryRow:m}})}},[D]),xt={state:R,loadAllCategoryRows:v,getSubCats:N,getCat:M,expandNodesUpToTheTree:L,loadTopRows:V,addSubCategory:S,cancelAddCategory:z,createCategory:se,viewCategory:F,editCategory:H,updateCategory:X,deleteCategory:ne,deleteCategoryVariation:de,expandCategory:q,collapseCategory:Z,onCategoryTitleChanged:mt,loadCategoryQuestions:lt,addQuestion:dt,cancelAddQuestion:O,createQuestion:ct,viewQuestion:yt,editQuestion:pt,updateQuestion:ut,deleteQuestion:gt,onQuestionTitleChanged:ft,assignQuestionAnswer:Et};return!d||!$?null:e.jsx(Xe.Provider,{value:xt,children:e.jsx(Je.Provider,{value:i,children:t})})};function B(){return E.useContext(Xe)}const be=()=>E.useContext(Je);var te=(t=>(t.SET_LOADING="SET_LOADING",t.SET_SUB_CATS="SET_SUB_CATS",t.SET_ERROR="SET_ERROR",t.SET_EXPANDED="SET_EXPANDED",t.SET_PARENT_CAT="SET_PARENT_CAT",t))(te||{});const Vt=({cat:t,dispatch:r,setParentCat:u,selId:o})=>{const{topId:d,parentId:n,id:y,title:h,level:C,isExpanded:R}=t,i={topId:d,parentId:n,id:y},x=Q=>{r({type:te.SET_EXPANDED,payload:{id:y,expanding:!R}})},b=Q=>{u(Q)},I=e.jsxs("div",{className:"d-flex justify-content-start align-items-center w-100 text-primary",children:[e.jsx(Y,{variant:"link",size:"sm",className:"py-0 px-1",onClick:Q=>{x(),Q.stopPropagation(),Q.preventDefault()},title:"Expand",children:e.jsx(le,{icon:R?Be:$e,size:"lg"})}),e.jsx(Y,{variant:"link",size:"sm",className:"py-0 mx-0 text-decoration-none",title:y,onClick:()=>b(t),children:h})]});return e.jsxs(e.Fragment,{children:[e.jsx(oe.Item,{variant:"primary",className:"py-0 px-1 w-100",as:"li",children:I}),R&&e.jsx(oe.Item,{className:"py-0 px-0",variant:"primary",as:"li",children:e.jsx(et,{selId:o,level:C+1,categoryKey:i,setParentId:u})})]})},Kt={loading:!1,parentId:null,title:"",cats:[]},zt=(t,r)=>{switch(r.type){case te.SET_LOADING:return{...t,loading:!0};case te.SET_SUB_CATS:{const{subCats:u}=r.payload;return{...t,cats:t.cats.concat(u),loading:!1}}case te.SET_ERROR:{const{error:u}=r.payload;return{...t,error:u,loading:!1}}case te.SET_EXPANDED:{const{id:u,expanding:o}=r.payload;let{cats:d}=t;if(!o){const n=Ze(d,u);console.log("clean:",n),n.length>0&&(d=d.filter(y=>!n.includes(y.id)))}return{...t,cats:t.cats.map(n=>n.id===u?{...n,isExpanded:o}:n)}}case te.SET_PARENT_CAT:{const{cat:u}=r.payload,{id:o,title:d}=u;return{...t,parentId:o,title:d}}default:return t}};function Ze(t,r){let u=t.filter(o=>o.parentId===r).map(o=>o.id);return u.forEach(o=>{const d=o?Ze(t,o):[];u=u.concat(d)}),u}const et=({selId:t,categoryKey:r,level:u,setParentId:o})=>{const[d,n]=E.useReducer(zt,Kt),{getSubCats:y}=B(),{id:h}=r??{id:null},[C]=E.useState(r);E.useEffect(()=>{(async()=>{const x=await y(h),{subCats:b}=x;n({type:te.SET_SUB_CATS,payload:{subCats:b}})})()},[y,C,h]);const R=d.cats.filter(x=>x.parentId===h),i=x=>{n({type:te.SET_PARENT_CAT,payload:{cat:x}}),o(x)};return e.jsxs("div",{className:u>1?"border  border-7 ms-4 h-25":"border border-7  h-25",style:{overflowY:"auto"},children:[e.jsx(oe,{as:"ul",variant:"dark",className:"mb-0",children:R.filter(x=>x.id!==t).map(x=>e.jsx(Vt,{cat:x,selId:t,dispatch:n,setParentCat:i},x.id))}),d.error&&d.error.message]})},Yt=({relatedFilter:t})=>{const{filter:r,numOfUsages:u,created:o,lastUsed:d}=t,{time:n,nickName:y}=o,h=`Created by: ${y}, ${Gt(new Date(n))}`,C=!1,R=I=>{console.log("RelatedFilter onSelectAnswer",{filter:I})},[i,x]=Re(),b=e.jsxs("div",{ref:i,className:"d-flex justify-content-start align-items-center w-100 text-light related-filter-row",children:[e.jsx(Y,{variant:"link",size:"sm",className:"py-0 mx-0 title text-light text-wrap",title:h,onClick:()=>R(r),disabled:C,children:r}),e.jsxs(Te,{pill:!0,bg:"secondary",className:`text-light ${u===0?"d-none":"d-inline"}`,children:[u,u===1?" usage":" usages"]}),e.jsx("span",{className:"small ms-1",children:Ft(d.time)}),x]});return e.jsx(oe.Item,{className:"py-0 px-0",as:"li",children:b},r)},Wt=({relatedFilters:t})=>{const{globalState:r}=ve(),{variant:u}=r,{state:o}=B(),d=async n=>{console.log("RelatedFilters unAssignFilter",{relatedFilter:n})};return e.jsx("div",{className:"mx-0 my-1 border rounded-2 px-1 py-1border-light fs-6 related-filters",children:e.jsxs("div",{children:[e.jsx("label",{className:"text-muted",children:"Most frequently selected Filters (for the next Question in ChatBot)"}),t.length>0?e.jsx(oe,{as:"ul",variant:u,className:"my-1",children:t.map(n=>e.jsx(Yt,{relatedFilter:n,unAssignFilter:d},n.filter))}):e.jsx("div",{className:"border text-light",children:"No filters"}),o.error&&e.jsx("div",{children:"state.error"})]})})},De=({question:t,submitForm:r,children:u,showCloseButton:o,source:d=0,closeModal:n})=>{const{state:y,onQuestionTitleChanged:h}=B();let{formMode:C,topRows:R}=y;const i=E.lazy(()=>It(()=>import("./AssignedAnswers-ByHfqxAt.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8])).then(O=>({default:O.default}))),x=C===f.ViewingQuestion,b=C===f.EditingQuestion,I=C===f.AddingQuestion,Q=x,{topId:U,id:A,assignedAnswers:$,relatedFilters:T,title:v}=t,M=new Ce(t).questionKey,N=be(),V=()=>{n?n():N({type:s.CLOSE_QUESTION_FORM,payload:{question:t}})},k=()=>{n?n():N({type:s.CANCEL_QUESTION_FORM,payload:{question:t}})},[D,L]=E.useState(A+"/"+v),P=Ve(D,500),[q]=E.useState(R.find(O=>O.id===U)),Z=E.useRef(null),S=Ke({enableReinitialize:!0,initialValues:t,validationSchema:ze().shape({title:Ie().required("Required"),parentId:Ie().required("Required").notOneOf(["000000000000000000000000"])}),onSubmit:O=>{r(O),L(O.id+"/"+O.title)}});E.useEffect(()=>{(async()=>{const F=P.split("/"),H=F[0];if(S.values.id===H){console.log("QuestionForm.useEffect - onQuestioTitleChanged",{debouncedSearchTerm:P,searchTerm:D,title:S.values.title});const X=F[1];await h(q,S.values,X)}})()},[P,S.values,h,D,q]),E.useEffect(()=>{Z.current.focus(),d!==0&&S.setFieldValue("source",d)},[S,Z,d]);const z=O=>{S.handleChange(O);const F=O.target.value;L(A+"/"+F)},se=O=>{S.setFieldValue("parentId",O.id),S.setFieldValue("categoryTitle",O.title)};return console.log("@@@@@@@@@@@@@@@@@@@@@ QuestionForm.render: ",{searchTerm:D,qTitle:v,debouncedSearchTerm:P}),e.jsxs("div",{className:"form-wrapper px-3 py-1 my-0 my-1 w-100 question-form",children:[o&&e.jsx(Pe,{onClick:V,className:"float-end"}),e.jsx(Ee,{className:"text-center",children:e.jsxs(j.Label,{children:["Question  ",x?"Viewing":b?"Editing":"Adding"]})}),e.jsxs(j,{onSubmit:S.handleSubmit,children:[e.jsxs(Oe,{direction:"horizontal",gap:0,className:"border",children:[e.jsx("div",{className:"p-0",children:e.jsx(j.Label,{children:"Category:"})}),e.jsx("div",{className:"p-1",children:e.jsxs(j.Group,{controlId:"parentId",className:"category-select form-select-sm w-90",children:[e.jsxs(we,{children:[e.jsx(we.Toggle,{variant:"light",id:"dropdown-basic",className:"px-2 py-0 text-primary border",disabled:Q,children:e.jsx("span",{className:"text-wrap me-1",children:S.values.categoryTitle})}),e.jsx(we.Menu,{className:"p-0 border",children:e.jsx(we.Item,{className:"p-0 m-0 rounded-3",children:e.jsx(et,{selId:S.values.parentId,categoryKey:null,level:1,setParentId:se})})})]}),e.jsx(j.Control,{as:"input",name:"parentId",onChange:S.handleChange,value:S.values.parentId?S.values.parentId:"",placeholder:"Category",className:"text-primary w-100",disabled:Q,hidden:!0}),e.jsx(j.Text,{className:"text-danger",children:S.touched.parentId&&S.errors.parentId?e.jsx("div",{className:"text-danger",children:S.errors.parentId?"required":""}):null})]})})]}),e.jsxs(j.Group,{controlId:"title",children:[e.jsx(j.Label,{children:"Title"}),e.jsx(j.Control,{as:"textarea",name:"title",placeholder:S.values.title==="new Question"?"new Question":"question text",ref:Z,onChange:z,value:S.values.title,rows:3,className:"text-primary w-100",disabled:Q}),e.jsx(j.Text,{className:"text-danger",children:S.touched.title&&S.errors.title?e.jsx("div",{className:"text-danger",children:S.errors.title}):null})]}),e.jsxs(Ee,{children:[e.jsx(pe,{children:e.jsxs(j.Group,{controlId:"source",children:[e.jsx(j.Label,{children:"Source"}),e.jsx(Ne,{id:"source",name:"source",options:Qt,onChange:(O,F)=>{O.preventDefault(),S.setFieldValue("source",F)},value:S.values.source,disabled:Q,classes:"text-primary"}),e.jsx(j.Text,{className:"text-danger",children:S.touched.source&&S.errors.source?e.jsx("div",{className:"text-danger",children:S.errors.source}):null})]})}),e.jsx(pe,{children:e.jsxs(j.Group,{controlId:"status",children:[e.jsx(j.Label,{children:"Status"}),e.jsx(Ne,{id:"status",name:"status",options:At,onChange:(O,F)=>{O.preventDefault(),S.setFieldValue("status",F)},value:S.values.status,disabled:Q,classes:"text-primary"}),e.jsx(j.Text,{className:"text-danger",children:S.touched.status&&S.errors.status?e.jsx("div",{className:"text-danger",children:S.errors.status}):null})]})})]}),(x||b)&&e.jsxs("div",{className:"my-1",children:[e.jsx(E.Suspense,{fallback:e.jsx("div",{children:"Loading..."}),children:e.jsx(i,{questionKey:M,questionTitle:D,assignedAnswers:$,isDisabled:Q})}),e.jsx(Wt,{questionKey:M,questionTitle:D,relatedFilters:T}),e.jsx(Ye,{created:t.created,modified:t.modified,classes:"text-primary"})]}),(S.dirty&&b||I)&&e.jsx(We,{cancelForm:k,handleSubmit:S.handleSubmit,title:u}),y.error&&e.jsx("div",{className:"text-danger",children:y.error.message})]})]})},ke=({closeModal:t,showCloseButton:r,source:u,setError:o})=>{const{state:d,cancelAddQuestion:n,createQuestion:y}=B(),{activeQuestion:h}=d,C=h?h.topId:"",R=async()=>{await n()},i=async x=>{const b={...x,topId:C,created:{time:new Date,nickName:""},modified:void 0},I=await y(b,t!==void 0);I&&(I.message?o(I.message):t&&t())};return h?e.jsx(De,{question:h,showCloseButton:r??!0,source:u??0,closeModal:R,submitForm:i,children:"Create Question"}):null},tt=({})=>{const{state:t,updateQuestion:r}=B(),{activeQuestion:u}=t;if(!u)return null;if(!u)return e.jsx("div",{children:"Loading question to edit..."});const o=async d=>{const n={...d,created:void 0,modified:{time:new Date,nickName:""}},{parentId:y}=u,h=y!==n.parentId;await r(y,n,h)};return e.jsx(De,{question:u,showCloseButton:!0,source:0,submitForm:o,children:"Update Question"})},ot=({inLine:t})=>{console.log(t?"ViewQuestion inLine":"ViewQuestion not inLine");const{state:r}=B(),{activeQuestion:u}=r,[o,d]=E.useState(null);return E.useEffect(()=>{console.log("#################################### ViewQuestion setQuestion ...",{activeQuestion:u}),d(u)},[u]),e.jsx(De,{question:o,showCloseButton:!0,source:0,submitForm:()=>{},children:"View Question"})},Ht=({questionRow:t,isSelected:r})=>{const{id:u,topId:o,parentId:d,title:n,numOfAssignedAnswers:y}=t,h={topId:o,parentId:d,id:d},{canEdit:C,authUser:R}=re(),{state:i,viewQuestion:x,addQuestion:b,editQuestion:I,deleteQuestion:Q}=B(),{activeQuestion:U,formMode:A,loadingQuestion:$,questionLoaded:T}=i,v=U!==null&&U.id===u,M=A===f.AddingQuestion,N=()=>{t.modified={time:new Date,nickName:R.nickName},Q(t,v)},V=async P=>{console.log("QuestionRow onSelectQuestion",{id:P}),C?await I(t):await x(t)},[k,D]=Re();E.useEffect(()=>{(async()=>{if(r&&!$&&!T){switch(A){case f.ViewingQuestion:await x(t);break;case f.EditingQuestion:console.log("Zovem from QuestionRow"),C?await I(t):await x(t);break}document.getElementById(`QuestionRow${u}`)?.scrollIntoView({behavior:"smooth",block:"end"})}})()},[C,I,A,u,r,$,T,t,x]);const L=e.jsxs("div",{id:`QuestionRow${u}`,className:`d-relative d-flex justify-content-start align-items-center w-100 mt-0 question-row${r?"-selected":""}`,style:{marginTop:"1px"},children:[e.jsx(Y,{variant:"link",size:"sm",className:"d-flex align-items-center px-1 text-secondary",children:e.jsx("img",{width:"22",height:"18",src:Nt,alt:"Question"})}),e.jsx(Y,{variant:"link",size:"sm",className:`p-0 px-1 m-1 ms-0 question-row-title ${v?"fw-bold":""}`,title:`id:${u.toString()}`,onClick:()=>V(u),disabled:M,children:n}),e.jsxs(Te,{pill:!0,bg:"secondary",className:`text-info ${y===0?"d-none":"d-inline"}`,children:[y,"a"]}),C&&!M&&D&&e.jsxs("div",{className:"position-absolute text-nowrap d-flex align-items-center border border-0 border-warning p-0 end-0",children:[e.jsx(Y,{variant:"link",size:"sm",className:"ms-1 p-0 text-secondary d-flex align-items-center",title:"Add Question",onClick:()=>{b(h,!0)},children:e.jsx("img",{width:"22",height:"18",src:He,alt:"Add Question"})}),e.jsx(Y,{variant:"link",size:"sm",className:"ms-0 p-0 text-secondary",onClick:N,children:e.jsx(le,{icon:Qe,size:"lg"})})]})]});return e.jsxs(oe.Item,{className:"py-0 px-0 w-100",as:"li",children:[r&&A===f.AddingQuestion&&e.jsxs(e.Fragment,{children:[e.jsx("div",{id:"div-question",className:"ms-0 d-md-none w-100",children:e.jsx(ke,{showCloseButton:!0,source:0})}),e.jsx("div",{ref:k,className:"d-none d-md-block  border rounded-3",children:L})]}),r&&A===f.EditingQuestion&&e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:k,className:"",children:L}),e.jsx("div",{id:"div-question",className:"ms-0 d-md-none w-100",children:e.jsx(tt,{inLine:!0})})]}),r&&A===f.ViewingQuestion&&e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:k,className:"",children:L}),e.jsx("div",{ref:k,id:"div-question",className:"ms-0 d-md-none w-100",children:e.jsx(ot,{inLine:!0})})]}),!r&&e.jsx("div",{ref:k,className:"",children:L})]})},st=({categoryRow:t})=>{const{state:r,loadCategoryQuestions:u}=B(),{keyExpanded:o,loadingQuestion:d,error:n,selectedQuestionId:y}=r,{questionId:h}=o;t.level+=1;const{questionRows:C}=t;let R=!1;async function i(){try{const I={categoryKey:new ie(t).categoryKey,startCursor:C.length,includeQuestionId:h??null};console.log("^^^^^^^^^^^^^ loadMore"),console.log("^^^^^^^^^^^^^",{x:I}),console.log("^^^^^^^^^^^^^ loadMore"),await u(I)}catch{}}const[x,{rootRef:b}]=bt({loading:d,hasNextPage:R,onLoadMore:i,disabled:!!n,rootMargin:"0px 0px 100px 0px"});return e.jsxs("div",{ref:b,className:"ms-0",style:{maxHeight:"400px",overflowY:"auto"},children:[e.jsxs(Dt,{children:[C.length===0&&e.jsx("label",{children:"No questions"}),C.map(I=>e.jsx(Ht,{questionRow:I,isSelected:I.id===y},I.id)),R]}),n&&e.jsxs("p",{children:["Error: ",n.message]})]})},Xt=({categoryKey:t,tag:r,categoryInAdding:u})=>{const{name:o}=r,{canEdit:d}=re(),{state:n,deleteCategoryVariation:y}=B(),h=()=>{y(t,o)},[C,R]=Re(),i=e.jsxs("div",{ref:C,children:[e.jsx(Te,{pill:!0,bg:"secondary",children:o}),d&&!0&&R&&e.jsx(Y,{variant:"link",size:"sm",className:"ms-0 py-0 mx-0 text-secondary",onClick:h,children:e.jsx(le,{icon:Qe,size:"sm"})}),!1]});return e.jsx("div",{className:"py-1 px-1",children:i})},Jt=({categoryKey:t,variations:r})=>{const{state:u}=B(),{error:o}=u;return E.useEffect(()=>{},[]),e.jsxs("div",{className:"ms-2",children:[e.jsxs(Oe,{direction:"horizontal",gap:2,children:[r.length===0&&e.jsx("div",{children:"No variations"}),r.length>0&&r.map(d=>e.jsx(Xt,{categoryKey:t,tag:d,categoryInAdding:void 0}))]}),o&&e.jsxs("p",{children:["Error: ",o.message]})]})},Le=({formMode:t,category:r,submitForm:u,children:o})=>{const{onCategoryTitleChanged:d}=B(),n=t===f.ViewingCategory,y=t===f.EditingCategory,h=t===f.AddingCategory,{topId:C,id:R,variations:i,questionRows:x,title:b}=r;console.log("CategoryForm render: ",{topId:C,id:R,catTitle:b,formMode:t});const I=new ie(r).categoryKey;document.getElementById("div-details");const Q=x&&x.length>0,U=be(),A=()=>{U({type:s.CLOSE_CATEGORY_FORM,payload:{}})},$=()=>{U({type:s.CANCEL_CATEGORY_FORM,payload:{}})},[T,v]=E.useState(b),M=Ve(T,300),N=Ke({enableReinitialize:!0,initialValues:r,validationSchema:ze().shape({title:Ie().required("Required")}),onSubmit:L=>{console.log("CategoryForm.onSubmit",JSON.stringify(L,null,2)),u(L),v(L.title)}});E.useEffect(()=>{(async()=>(console.log("CategoryForm.useEffect - onCategoryTitleChanged",{debouncedSearchTerm:M,title:N.values.title}),M&&N.values.title!==M&&await d(C,R,M)))()},[M,N.values,d]);const V=L=>{N.handleChange(L);const P=L.target.value;v(P)},k=E.useRef(null);E.useEffect(()=>{k.current.focus()},[r.title,k]);const D=!1;return console.log("CategoryForm render return: ",T),e.jsxs("div",{className:"form-wrapper p-2 category-form",children:[e.jsx(Pe,{onClick:A,className:"float-end"}),e.jsx(Ee,{className:"text-center text-muted",children:e.jsxs(j.Label,{children:["Category ",n?"Viewing":y?"Editing":"Adding"]})}),e.jsxs(j,{onSubmit:()=>N.handleSubmit,children:[e.jsx(j.Group,{controlId:"Variations",children:e.jsxs(Oe,{direction:"horizontal",gap:1,children:[e.jsx("div",{className:"px-0",children:e.jsx(j.Label,{children:"Variations:"})}),e.jsx("div",{className:"px-1 border border-1 border-secondary rounded",children:e.jsx(Jt,{categoryKey:I,variations:i?i.map(L=>({name:L})):[]})}),e.jsx("div",{className:"ps-2",children:e.jsx(j.Label,{children:"Kind:"})}),e.jsx("div",{className:"px-1 border border-1 border-secondary rounded",children:e.jsxs(j.Group,{controlId:"kind",children:[e.jsx(Ne,{id:"kind",name:"kind",options:kt,onChange:(L,P)=>{L.preventDefault(),N.setFieldValue("kind",P)},value:N.values.kind,disabled:D,classes:"text-primary"}),e.jsx(j.Text,{className:"text-danger",children:N.touched.kind&&N.errors.kind?e.jsx("div",{className:"text-danger",children:N.errors.kind}):null})]})})]})}),e.jsxs(j.Group,{controlId:"title",children:[e.jsx(j.Label,{children:"Title"}),e.jsx(j.Control,{as:"textarea",name:"title",placeholder:N.values.title==="new Category"?"new Category":"category text",value:T,onChange:V,ref:k,rows:3,className:"text-primary w-100",disabled:n}),e.jsx(j.Text,{className:"text-danger",children:N.touched.title&&N.errors.title?e.jsx("div",{className:"text-danger",children:N.errors.title}):null})]}),e.jsxs(j.Group,{controlId:"link",children:[e.jsx(j.Label,{children:"Link"}),N.values.hasSubCategories?e.jsx(j.Control,{as:"input",placeholder:"/categories/...",name:"link",onChange:N.handleChange,className:"text-primary w-100",value:"Can't have link (has sub categories)",disabled:!0}):e.jsxs(e.Fragment,{children:[e.jsx(j.Control,{as:"input",placeholder:"/categories/...",name:"link",onChange:N.handleChange,className:"text-primary w-100",value:N.values.link??"",disabled:n}),e.jsx(j.Text,{className:"text-danger",children:N.touched.link&&N.errors.link?e.jsx("div",{className:"text-danger",children:N.errors.link}):null})]})]}),e.jsxs(j.Group,{children:[e.jsxs(j.Label,{className:"m-1 mb-0",children:["Questions (",`${N.values.numOfQuestions}`,") "]}),Q&&e.jsx(st,{categoryRow:r})]}),(n||y)&&e.jsx(Ye,{created:r.created,modified:r.modified,classes:"text-primary"}),(N.dirty&&y||h)&&e.jsx(We,{cancelForm:$,handleSubmit:N.handleSubmit,title:o})]})]})},nt=({inLine:t})=>{const r=re(),{nickName:u}=r.authUser,{state:o,updateCategory:d}=B(),{activeCategory:n,keyExpanded:y}=o,{questionId:h}=y,C=async R=>{const i={...R,created:void 0,modified:{time:new Date,nickName:u}};await d(i,!0)};return e.jsx(Le,{inLine:t,category:{...n},questionId:h,formMode:f.EditingCategory,submitForm:C,children:"Update Category"})},at=({inLine:t})=>{const{state:r}=B(),{activeCategory:u,keyExpanded:o}=r,{questionId:d}=o;return e.jsx(Le,{inLine:t,category:{...u},questionId:d,formMode:f.ViewingCategory,submitForm:()=>{},children:"View Category"})},rt=({activeCategory:t})=>{const r=re(),{nickName:u}=r.authUser,{createCategory:o}=B(),[d]=E.useState({...t}),n=async y=>{const h={...y,created:{time:new Date,nickName:u},modified:void 0};console.log("**********object",h),await o(h)};return!t===null?null:(console.log("AddCategory render >>>>>:",t),e.jsx(e.Fragment,{children:e.jsx(Le,{inLine:!1,category:d,questionId:null,formMode:f.AddingCategory,submitForm:n,children:"Create Category"})}))},Zt=({categoryRow:t,questionId:r})=>{const{id:u,title:o,hasSubCategories:d,numOfQuestions:n,isExpanded:y,categoryRows:h}=t;t.level+=1;const C=new ie(t).categoryKey,{canEdit:R,authUser:i}=re(),{state:x,addSubCategory:b,viewCategory:I,editCategory:Q,deleteCategory:U,expandCategory:A,collapseCategory:$,addQuestion:T}=B();let{formMode:v,activeCategory:M,loadingCategory:N,categoryLoaded:V}=x;const k=M!==null&&M.id===u,D=v===f.AddingCategory,L=y&&n>0,P=()=>{t.modified={time:new Date,nickName:i.nickName},U(t)},q=async()=>{if(y)await $(t);else{const ae={categoryKey:C,byClick:!0,formMode:R?f.EditingCategory:f.ViewingCategory};await A(ae)}},[Z,S]=E.useState(!1);E.useEffect(()=>{S(!0)},[h]);const z=async()=>{R?await Q(t,r??"null"):await I(t,r??"null")},[se,O]=E.useState(!1);E.useEffect(()=>{se&&(b(t),O(!1))},[b,t,se]);const[F,H]=E.useState(!1);E.useEffect(()=>{F&&(T(C,y??!1),H(!1))},[T,C,y,F]),E.useEffect(()=>{(async()=>{if(k&&!N&&!V&&!D)switch(console.log("CategoryRow formMode:",v),v){case f.ViewingCategory:await I(t,r??"null");break;case f.EditingCategory:R?await Q(t,r??"null"):await I(t,r??"null");break}})()},[R,C,V,t,Q,A,v,D,k,N,r,I]);const[X,ne]=Re(),de=e.jsxs("div",{children:[e.jsxs("div",{id:`Row${u}`,className:`d-relative d-flex justify-content-start align-items-center w-100 mt-1 category-row${k?"-selected":""}`,style:{marginTop:"1px"},children:[e.jsx(Y,{variant:"link",size:"sm",className:"py-0 px-1","aria-controls":u+"-2","aria-expanded":Z,onClick:ae=>{q(),ae.stopPropagation()},title:"Expand",disabled:D||!d&&n===0,children:e.jsx(le,{icon:y?Be:$e,size:"lg"})}),e.jsx(Y,{variant:"link",size:"sm",className:"py-0 px-1 bg-light",title:"Expand",disabled:!0,children:e.jsx(le,{icon:Lt,size:"sm"})}),e.jsx(Y,{variant:"link",size:"sm",className:`py-0 ms-0 me-1 category-row-title ${k?"fw-bold text-white bg-transparent":""}`,title:u,onClick:z,disabled:D,children:o}),n>0&&e.jsxs(Te,{pill:!0,bg:"secondary",className:"d-inline bg-transparent",children:[n,"Q"]}),R&&ne&&e.jsxs("div",{className:"position-absolute text-nowrap d-flex align-items-center border border-0 border-warning p-0 end-0",children:[e.jsx("div",{className:"d-flex align-items-center",children:e.jsx(Y,{variant:"link",size:"sm",className:"border-0 py-0 px-0 ms-0 text-success",title:"Add SubCategory",onClick:async()=>{!y&&(d||n>0)&&await q(),setTimeout(()=>O(!0),500)},children:e.jsx(le,{icon:qt,size:"lg"})})}),!D&&!d&&e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(Y,{variant:"link",size:"sm",className:"p-0 mx-0 text-secondary d-flex align-items-center border border-0 border-warning1",title:"Add Question",onClick:async()=>{!y&&(d||n>0)&&await q(),setTimeout(()=>H(!0),500)},children:e.jsx("img",{width:"22",height:"18",src:He,alt:"Add Question"})}),e.jsx(Y,{variant:"link",size:"sm",className:"d-flex align-items-center border border-0 border-warning p-0",disabled:d||n>0,onClick:P,children:e.jsx(le,{icon:Qe,size:"lg"})})]})]})]}),L&&e.jsx("div",{className:"ps-3",children:e.jsx(st,{categoryRow:t})})]});return e.jsxs(e.Fragment,{children:[e.jsxs(oe.Item,{className:"py-0 px-1 w-100 category-bg",as:"li",children:[k&&v===f.AddingCategory&&e.jsxs("div",{children:[e.jsx("div",{ref:X,className:"",children:de}),e.jsx("div",{className:"ms-0 d-md-none w-100",children:e.jsx(rt,{activeCategory:M})})]}),k&&v===f.EditingCategory&&e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:X,children:de}),e.jsx("div",{id:"divInLine",className:"ms-0 d-md-none w-100",children:e.jsx(nt,{inLine:!1})})]}),k&&v===f.ViewingCategory&&e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:X,children:de}),e.jsx("div",{id:"divInLine",className:"ms-0 d-md-none w-100",children:e.jsx(at,{inLine:!1})})]}),!k&&e.jsx("div",{ref:X,children:de})]}),x.error&&x.whichRowId===u&&e.jsx("div",{className:"text-danger",children:x.error.message}),y&&e.jsx(oe.Item,{className:"py-0 px-0 border-0 border-warning border-bottom-0 category-bg p-0 m-0",variant:"primary",as:"li",children:e.jsx("div",{className:"rambo",children:d&&e.jsx(jt,{in:Z,children:e.jsx("div",{id:u+"-2",style:{marginTop:"1px"},children:e.jsx("div",{style:{border:"1px solid #ddd",borderRadius:"4px"},children:e.jsx(it,{categoryRow:t,isExpanded:y})})})})})})]})},it=({categoryRow:t})=>{const{level:r,categoryRows:u}=t,{state:o}=B();let{keyExpanded:d}=o;const{questionId:n}=d??{questionId:null};return e.jsx("div",{className:r>1?"ms-2":"",children:e.jsx(oe,{as:"ul",variant:"dark",className:"mb-0 category-bg",children:u.map(y=>e.jsx(Zt,{categoryRow:y,questionId:n===""?null:n},y.id))})})},eo=t=>{const{isDarkMode:r}=re(),[u,o]=E.useState("");return E.useEffect(()=>{},[]),e.jsxs(he,{show:t.show,onHide:t.onHide,animation:!0,centered:!0,size:"lg",className:"modal show",contentClassName:`${r?"bg-secondary bg-gradient":"bg-info bg-gradient"}`,children:[e.jsx(he.Header,{closeButton:!0,children:"Store new Question to the Database"}),e.jsx(he.Body,{className:"py-0",children:e.jsx(ke,{closeModal:t.onHide,showCloseButton:!1,source:1,setError:d=>o(d)})}),e.jsx(he.Footer,{children:u})]})},to=({categoryId_questionId:t,fromChatBotDlg:r})=>{const{state:u,expandNodesUpToTheTree:o,loadTopRows:d,addSubCategory:n}=B(),{allCategoryRows:y,topRows:h,topRowsLoading:C,topRowsLoaded:R,keyExpanded:i,categoryId_questionId_done:x,nodeOpening:b,nodeOpened:I,activeCategory:Q,activeQuestion:U,formMode:A,loadingCategories:$,loadingCategory:T,loadingQuestions:v,loadingQuestion:M}=u,{searchQuestions:N,setLastRouteVisited:V,setChatBotDlgEnabled:k}=ve(),{isDarkMode:D,chatBotDlgEnabled:L}=re(),[P,q]=E.useState(!1),[Z,S]=E.useState({...je}),z=be(),se=async F=>{z({type:s.SET_QUESTION_SELECTED,payload:{questionKey:F}})};let O="";return E.useEffect(()=>{(async()=>!C&&!R&&(console.log("ZOVEM 111 loadTopRows()"),await d()))()},[C,R,d,r]),E.useEffect(()=>{(async()=>{if(!b&&R&&h.length>0){if(t){if(t==="add_question"){const F=localStorage.getItem("New_Question");if(F){const H=JSON.parse(F);return S({...je,categoryTitle:"Select",...H}),q(!0),localStorage.removeItem("New_Question"),null}}else if(t!==x){const F=t.split("_"),H=F[0],X=F[1],ne={topId:"",id:H,parentId:"ROOT"};console.log("zovem expandNodesUpToTheTree 1111111111111111111)",{categoryId_questionId:t},{categoryId_questionId_done:x}),await o(ne,X!=="null"?X:null,r==="from_chat"),console.log("zavrsio expandNodeUpToTheTree 1111111111111111111 DONE)",{categoryId_questionId:t})}}else if(i&&!I){const{topId:F,categoryId:H,questionId:X}=i;if(H!==""){const ne={topId:F,id:H,parentId:"ROOT"};console.log("zovem expandNodeUpToTheTree 2222222222222)",{keyExpanded:i,catKey:ne}),await o(ne,X),console.log("zavrsio expandNodeUpToTheTree 2222222222222 DONE)")}}L||k()}})()},[t,x,R,i,b,I,o,r,L,k]),E.useEffect(()=>{},[V]),t!=="add_question"&&t&&t!==x?(console.log("zzzzzz loading...",{keyExpanded:i,categoryId_questionId:t,categoryId_questionId_done:x}),e.jsx("div",{children:"loading..."})):R?(console.log("===>>> Categories !!!!!!!!!!!!!!!!!",Q),e.jsxs(e.Fragment,{children:[e.jsxs(Ot,{children:[e.jsxs("h5",{className:"text-warning mx-auto w-75 fw-bold",children:[e.jsx("span",{className:"categories",children:"Categories / "}),e.jsx("span",{className:"questions",children:"Questions"})]}),e.jsx(Ee,{className:`${D?"dark":""}`,children:e.jsx(pe,{children:e.jsx("div",{className:"d-flex justify-content-start align-items-center",children:e.jsx("div",{className:"w-75 my-1 questions",children:e.jsx(Mt,{tekst:O,onSelectQuestion:se,allCategoryRows:y,searchQuestions:N})})})})}),e.jsx(Y,{variant:"secondary",size:"sm",type:"button",style:{padding:"1px 4px"},onClick:()=>n(null),children:"Add Category"}),e.jsxs(Ee,{className:"my-1 h-auto",children:[e.jsx(pe,{xs:12,md:5,children:e.jsx("div",{className:"categories-border",style:{position:"relative"},children:e.jsx(it,{categoryRow:{...Ae,categoryRows:h},isExpanded:!0})})}),e.jsx(pe,{xs:0,md:7,children:e.jsxs("div",{id:"div-details",className:"d-none d-md-block",children:[Q&&A===f.ViewingCategory&&e.jsx(at,{inLine:!1}),Q&&A===f.EditingCategory&&e.jsx(nt,{inLine:!1}),Q&&A===f.AddingCategory&&e.jsx(rt,{activeCategory:Q}),U&&A===f.ViewingQuestion&&e.jsx(ot,{inLine:!1}),U&&A===f.EditingQuestion&&e.jsx(tt,{inLine:!1}),U&&A===f.AddingQuestion&&e.jsx(ke,{})]})})]})]}),P&&U&&e.jsx(eo,{show:P,onHide:()=>{q(!1)},newQuestionRow:Z}),($||v)&&e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{position:"absolute",top:"40%",left:"20%"},children:e.jsx("div",{className:`spinner-border ${v?"question":"category"}-spinner`,role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})}),T&&e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{position:"absolute",top:"50%",left:"50%"},children:e.jsx("div",{className:"spinner-border category-spinner",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})}),M&&e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{position:"absolute",top:"50%",left:"50%"},children:e.jsx("div",{className:"spinner-border question-spinner",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})})]})):(console.log("===>>> Categories  VRATIO"),null)},oo=()=>{let{categoryId_questionId:t,fromChatBotDlg:r}=vt();if(t&&t==="categories"&&(t=void 0),t){const u=t.split("_");console.assert(u.length===2,"expected 'categoryId_questionId'")}return e.jsx($t,{children:e.jsx(to,{categoryId_questionId:t,fromChatBotDlg:r})})},io=Object.freeze(Object.defineProperty({__proto__:null,default:oo},Symbol.toStringTag,{value:"Module"}));export{io as C,B as u};
//# sourceMappingURL=Categories-tAtakXVm.js.map
