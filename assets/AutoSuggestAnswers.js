import{aq as S,n as u,T as p}from"./index.js";import{l as w,A as f,a as m,b as x}from"./lib.js";import{d as A,e as R}from"./utilities.js";const b=f;class j extends S.Component{state;isMob;allGroupRows;searchAnswers;debouncedLoadSuggestions;constructor(e){console.log("AutoSuggestAnswers CONSTRUCTOR"),super(e),this.state={value:e.tekst||"",suggestions:[],noSuggestions:!1,highlighted:""},this.allGroupRows=e.allGroupRows,this.searchAnswers=e.searchAnswers,this.isMob=w.isMobile,this.loadSuggestions=this.loadSuggestions.bind(this),this.debouncedLoadSuggestions=A(this.loadSuggestions,300)}async loadSuggestions(e){this.setState({isLoading:!0}),console.time();const t=await this.getSuggestions(e);console.timeEnd(),e===this.state.value?this.setState({isLoading:!1,suggestions:t,noSuggestions:t.length===0}):this.setState({isLoading:!1})}componentDidMount(){setTimeout(()=>{window.focus()},300)}render(){const{value:e,suggestions:t,noSuggestions:n}=this.state;return u.jsxs("div",{children:[u.jsx(b,{onSuggestionsClearRequested:this.onSuggestionsClearRequested,multiSection:!0,suggestions:t,onSuggestionsFetchRequested:this.onSuggestionsFetchRequested.bind(this),onSuggestionSelected:this.onSuggestionSelected.bind(this),getSuggestionValue:this.getSuggestionValue,renderSuggestion:this.renderSuggestion,renderSectionTitle:this.renderSectionTitle,getSectionSuggestions:this.getSectionSuggestions,onSuggestionHighlighted:this.onSuggestionHighlighted.bind(this),highlightFirstSuggestion:!1,renderInputComponent:this.renderInputComponent,focusInputOnSuggestionClick:!this.isMob,inputProps:{placeholder:"Type 'remote'",value:e,onChange:(o,g)=>this.onChange(o,g),autoFocus:!0}}),n&&u.jsx("div",{className:"no-suggestions",children:"No answers to suggest"})]})}async getSuggestions(e){const t=R(e.trim());if(t==="")return[];if(e.length<3)return[];const n=new Map,o=[];try{console.log("--------->>>>> getSuggestions");var g=await this.searchAnswers(t,10);g.forEach(s=>{console.log("answerRow",s);const{topId:l,parentId:i,id:r,title:a,included:h}=s,c=new p(s).answerKey;if(!o.includes(c)){o.push(c);const d={topId:l,parentId:i,id:r,title:a,groupTitle:"",included:h};n.has(i)?n.get(i).push(d):n.set(i,[d])}})}catch(s){console.debug(s)}if(o.length===0)return[];try{let s=[];return n.forEach((l,i)=>{const r={id:i,groupTitle:"",groupParentTitle:"kuro",parentGroupUp:"",answerRows:[]};if(i!==null){const a=this.allGroupRows.get(i);if(a){const{title:h,titlesUpTheTree:c}=a;r.groupTitle=h,r.parentGroupUp=c}else alert(`${i} Not found in allCats`)}l.forEach(a=>{r.answerRows.push(a)}),s.push(r)}),s}catch(s){console.log(s)}return[]}onSuggestionsClearRequested=()=>{this.setState({suggestions:[],noSuggestions:!1})};onSuggestionSelected(e,t){e.preventDefault();const n=t.suggestion,{topId:o,parentId:g,id:s}=n;this.props.onSelectAnswer({topId:o,parentId:g,id:s},this.state.value)}renderSuggestion(e,t){const n=m(e.title,t.query),o=x(e.title,n);return u.jsx("span",{className:"d-inline-block text-truncate",style:{textAlign:"left"},children:o.map((g,s)=>{const l=g.highlight?"react-autosuggest__suggestion-match":void 0;return u.jsx("span",{className:`${l??""}`,children:g.text},s)})})}renderSectionTitle(e){const{parentGroupUp:t}=e;return u.jsx("span",{children:t})}renderInputComponent(e){const{ref:t,...n}=e;return u.jsx("div",{children:u.jsx("input",{ref:t,autoFocus:!0,...n})})}onChange(e,{newValue:t}){e.preventDefault(),this.setState({value:t})}async onSuggestionsFetchRequested({value:e}){return this.debouncedLoadSuggestions(e)}getSuggestionValue(e){return e.title}getSectionSuggestions(e){return e.answerRows}onSuggestionHighlighted(e){this.setState({highlighted:e.suggestion})}}export{j as AutoSuggestAnswers};
//# sourceMappingURL=AutoSuggestAnswers.js.map
