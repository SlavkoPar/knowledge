const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AutoSuggestAnswers.js","assets/index.js","assets/index.css","assets/lib.js","assets/utilities.js","assets/AutoSuggestAnswers.css"])))=>i.map(i=>d[i]);
import{_ as de,A as r,d as St,a as jt,b as Nt,F as w,I as Re,u as Ne,c as le,r as m,C as Ae,e as Te,f as ce,g as Pe,h as _t,Q as $e,i as me,j as vt,k as je,l as At,m as It,n as e,B as F,o as Ot,p as Ue,R as we,D as Se,q as Ee,s as bt,t as Qt,v as Dt,w as kt}from"./index.js";import{L as te,F as ie,f as Me,a as ze,u as xe,M as B,b as Lt,c as Gt,d as _e,B as ve,e as Ve,g as Ke,h as Ye,i as Ie,j as b,S as De,k as Oe,s as qt,l as Ft,C as Be,m as We,n as Pt,o as $t,p as Ut,q as Mt,r as zt}from"./Options.js";import{f as He,a as Vt}from"./utilities.js";import{A as Kt}from"./AutoSuggestQuestions.js";import"./lib.js";const be={topId:"",parentId:"null",id:de,categoryTitle:"",title:"",assignedAnswers:[],numOfAssignedAnswers:0,relatedFilters:[],numOfRelatedFilters:0,source:0,status:0,included:!1},Xe={topId:"null",parentId:"null",id:"define at BackEnd",kind:0,title:"",link:"",header:"",level:0,variations:[],hasSubCategories:!1,categoryRows:[],questionRows:[],numOfQuestions:0,hasMoreQuestions:!1,isExpanded:!1,doc1:""},Yt=(t,i)=>{console.log("------------------------------->"),console.log("------------------------------->",i.type),console.log("------------------------------->");const{categoryRow:g}=i.payload;if(i.type===r.SET_KEY_EXPANDED){const{keyExpanded:l}=i.payload;return{...t,keyExpanded:l,nodeOpened:l===null?!0:t.nodeOpened}}let s=g?!St.includes(i.type):!1;const{topRows:a}=t,u=jt.includes(i.type)?{...t}:Bt(t,i);if(s&&g){let l;const{topId:f,id:R}=g,h=i.payload.idToSet??R;if(R===f)l=a.map(S=>S.id===h?new ee(g).categoryRow:new ee(S).categoryRow);else{const S=a.find(T=>T.id===f);ee.idToSet=h,ee.newCategoryRow=g;const o=new ee(S).categoryRow;l=a.map(T=>T.id===f?o:new ee(T).categoryRow),ee.idToSet=""}u.topRows=l}if(Nt.includes(i.type)){const{keyExpanded:l}=u,f={keyExpanded:l};localStorage.setItem("CATEGORIES_STATE",JSON.stringify(f))}return console.log("CategoryReducer newState",u),u},Bt=(t,i)=>{switch(i.type){case r.SET_TOP_ROWS_LOADING:return{...t,loadingCategories:!0,topRowsLoading:!0,topRowsLoaded:!1};case r.SET_TOP_ROWS:{const{topRows:s}=i.payload;return console.log("=> CategoriesReducer ActionTypes.SET_TOP_ROWS",t.topRows,s),{...t,topRows:s,topRowsLoading:!1,topRowsLoaded:!0,loadingCategories:!1}}case r.SET_ALL_CATEGORY_ROWS:{const{allCategoryRows:s}=i.payload;return{...t,allCategoryRows:s,allCategoryRowsLoaded:Date.now()}}case r.SET_ALL_GROUP_ROWS:{const{allGroupRows:s}=i.payload;return{...t,allGroupRows:s,allGroupRowsLoaded:Date.now()}}case r.SET_NODE_EXPANDING_UP_THE_TREE:{const{categoryId_questionId_done:s}=i.payload;return{...t,categoryId_questionId_done:s,nodeOpening:!0,loadingCategories:!0,nodeOpened:!1,activeCategory:null,activeQuestion:null}}case r.SET_NODE_EXPANDED_UP_THE_TREE:{const{category:s,questionId:a,question:u,formMode:l}=i.payload;return{...t,activeCategory:s,activeQuestion:u,selectedQuestionId:a,formMode:l,nodeOpening:!1,nodeOpened:!0,loadingCategories:!1}}case r.SET_LOADING_CATEGORIES:return{...t,loadingCategories:!0};case r.SET_LOADING_CATEGORY:return{...t,loadingCategory:!0,categoryLoaded:!1};case r.FORCE_OPEN_NODE:const{keyExpanded:g}=i.payload;return alert("FORCE_OPEN_NODE is deprecated, use SET_QUESTION_SELECTED instead"),{...t,topRows:t.topRows.filter(s=>s.parentId===null),keyExpanded:g,nodeOpened:!1,activeCategory:null,activeQuestion:null,selectedQuestionId:null};case r.SET_SUB_CATEGORIES:return{...t,loadingCategory:!1};case r.SET_ERROR:{const{error:s,whichRowId:a}=i.payload;return{...t,error:s,whichRowId:a,loadingCategories:!1,loadingQuestions:!1,loadingCategory:!1,categoryLoaded:!1,loadingQuestion:!1,questionLoaded:!1}}case r.SET_CATEGORY:{const{categoryRow:s}=i.payload;return console.assert(Re(s)),{...t,loadingCategory:!1,categoryLoaded:!0,activeCategory:s,activeQuestion:null,selectedQuestionId:null}}case r.SET_ROW_EXPANDING:return{...t,rowExpanding:!0,rowExpanded:!1,loadingCategories:!0};case r.SET_ROW_EXPANDED:{const{categoryRow:s}=i.payload,{topId:a,id:u}=s,{keyExpanded:l}=t,f=l?l.questionId:null;return{...t,loadingCategories:!1,keyExpanded:{topId:a,categoryId:u,questionId:f},activeQuestion:null,selectedQuestionId:f,loadingQuestion:!1,questionLoaded:!1,rowExpanding:!1,rowExpanded:!0}}case r.SET_ROW_COLLAPSED:{const{categoryRow:s}=i.payload,{topId:a,parentId:u}=s;return{...t,loadingCategories:!1,keyExpanded:{topId:a,categoryId:u??"",questionId:null},rowExpanding:!1,rowExpanded:!0,activeCategory:null,activeQuestion:null,selectedQuestionId:null}}case r.SET_CATEGORY_TO_VIEW:{const{categoryRow:s}=i.payload;console.assert(Re(s));const u={...s,isExpanded:!1};return{...t,formMode:w.ViewingCategory,loadingCategory:!1,activeCategory:u,activeQuestion:null,selectedQuestionId:null,error:void 0}}case r.SET_CATEGORY_TO_ADD:{const{newCategoryRow:s}=i.payload,{parentId:a}=s;return{...t,loadingCategory:!1,categoryLoaded:!0,activeCategory:{...s,doc1:""},activeQuestion:null,selectedQuestionId:null,topRows:a?t.topRows:[s,...t.topRows],formMode:w.AddingCategory}}case r.SET_CATEGORY_ADDED:{const{categoryRow:s}=i.payload;console.assert(Re(s));const u={...s,isExpanded:!1},{topId:l,id:f}=u;return{...t,formMode:w.EditingCategory,loadingCategory:!1,categoryLoaded:!1,activeCategory:u,activeQuestion:null,selectedQuestionId:null,keyExpanded:{topId:l,categoryId:f,questionId:null}}}case r.SET_CATEGORY_TO_EDIT:case r.SET_CATEGORY_UPDATED:{const{categoryRow:s,category:a}=i.payload;console.assert(Re(s));const{topId:u,id:l}=a;return{...t,formMode:w.EditingCategory,loadingCategory:!1,categoryLoaded:!0,keyExpanded:{topId:u,categoryId:l,questionId:null},activeCategory:a,activeQuestion:null,selectedQuestionId:null,error:void 0}}case r.SET_CATEGORY_QUESTIONS_LOADING:return{...t,loadingQuestions:!0,questionLoaded:!1};case r.CATEGORY_QUESTIONS_LOADED:return{...t,loadingQuestions:!1};case r.CATEGORY_DELETED:{const{categoryRow:s,id:a}=i.payload,u=s?t.topRows:t.topRows.filter(l=>l.id!==a);return{...t,topRows:u,loadingCategories:!1,activeCategory:null,formMode:w.None,error:void 0,whichRowId:void 0,keyExpanded:{topId:s?s.topId:"",categoryId:s?s.parentId??"":"",questionId:""}}}case r.CANCEL_CATEGORY_FORM:case r.CLOSE_CATEGORY_FORM:return{...t,activeCategory:null,formMode:w.None};case r.CANCEL_ADD_CATEGORY:{const{topRows:s}=i.payload;return{...t,topRows:s,activeCategory:null,activeQuestion:null,selectedQuestionId:null,formMode:w.None}}case r.SET_LOADING_QUESTION:return{...t,loadingQuestion:!0,questionLoaded:!1};case r.CANCEL_ADD_QUESTION:return{...t,formMode:w.None,activeQuestion:null,selectedQuestionId:null};case r.SET_QUESTION_SELECTED:{const{questionKey:s}=i.payload,{topId:a,parentId:u,id:l}=s;return{...t,topRows:t.topRows.filter(f=>f.parentId===null),keyExpanded:{topId:a,categoryId:u,questionId:l},activeCategory:null,activeQuestion:null,selectedQuestionId:null}}case r.ADD_NEW_QUESTION_TO_ROW:{const{newQuestionRow:s}=i.payload;return{...t,selectedQuestionId:s.id}}case r.SET_QUESTION:{const{question:s,formMode:a}=i.payload;return console.log(r.SET_QUESTION,s),{...t,activeCategory:null,activeQuestion:s,formMode:a,error:void 0,loadingCategory:!1,loadingQuestion:!1,questionLoaded:!0}}case r.SET_QUESTION_AFTER_ASSIGN_ANSWER:{const{question:s}=i.payload;return{...t,activeQuestion:s,loadingQuestion:!1,questionLoaded:!0}}case r.SET_QUESTION_TO_VIEW:{const{question:s}=i.payload,{keyExpanded:a}=t;return{...t,formMode:w.ViewingQuestion,keyExpanded:a,activeQuestion:s,loadingQuestion:!1,questionLoaded:!0}}case r.SET_QUESTION_TO_EDIT:{const{question:s}=i.payload,{topId:a,id:u,parentId:l}=s;return{...t,keyExpanded:{topId:a,categoryId:l,questionId:u},activeQuestion:s,formMode:w.EditingQuestion,selectedQuestionId:s.id,loadingQuestion:!1,questionLoaded:!0}}case r.QUESTION_DELETED:return{...t,activeQuestion:null,selectedQuestionId:null,formMode:w.None,loadingQuestion:!1,questionLoaded:!0};case r.CANCEL_QUESTION_FORM:case r.CLOSE_QUESTION_FORM:return{...t,formMode:w.None,activeQuestion:null,selectedQuestionId:null};default:return alert(`Action ${i.type} not allowed`),{...t}}};class ee{static idToSet;static newCategoryRow;constructor(i){const{topId:g,id:s,parentId:a,title:u,link:l,kind:f,header:R,level:h,variations:S,numOfQuestions:o,hasSubCategories:T,categoryRows:N,created:Q,modified:q,questionRows:I,isExpanded:G}=i,P=N.map(C=>(console.log("DeepClone >>>>>>>>>>>>>>>",C.id),C.id===ee.idToSet?{...ee.newCategoryRow}:new ee(C).categoryRow));this.categoryRow={topId:g,parentId:a,id:s,kind:f,title:u,link:l,header:R,level:h,hasSubCategories:T,categoryRows:P,numOfQuestions:o,questionRows:I,variations:S??[],created:Q,modified:q,isExpanded:G}}categoryRow}const Je=m.createContext({}),Ze=m.createContext(()=>null),Wt={formMode:w.None,allCategoryRows:new Map,allCategoryRowsLoaded:void 0,allGroupRows:new Map,allGroupRowsLoaded:void 0,topRows:[],topRowsLoading:!1,topRowsLoaded:!1,nodeOpening:!1,nodeOpened:!1,keyExpanded:null,categoryId_questionId_done:void 0,activeCategory:null,activeQuestion:null,selectedQuestionId:null,loadingCategories:!1,loadingQuestions:!1,loadingCategory:!1,categoryLoaded:!1,loadingQuestion:!1,questionLoaded:!1,error:void 0,rowExpanding:!1,rowExpanded:!1},Ht=({children:t})=>{const{loadAllCategoryRowsGlobal:i,loadAllGroupRowsGlobal:g}=Ne(),s=le(),{KnowledgeAPI:a,isAuthenticated:u,workspace:l,authUser:f,canEdit:R}=s,{nickName:h}=f,[S,o]=m.useReducer(Yt,Wt),{formMode:T,activeCategory:N,activeQuestion:Q,keyExpanded:q,topRows:I,allCategoryRows:G,allCategoryRowsLoaded:P}=S;console.log("----->>> ----->>> ----->>> CategoryProvider",I),m.useEffect(()=>{let d=l==="DEMO"?{topId:"MTS",categoryId:"REMOTECTRLS",questionId:"qqqqqq111"}:null;if("localStorage"in window){let n=localStorage.getItem("CATEGORIES_STATE");if(console.log("CATEGORIES_STATE from localStorage",n),n!==null){const p=JSON.parse(n);p.keyExpanded!==null&&(d=p.keyExpanded)}}o({type:r.SET_KEY_EXPANDED,payload:{keyExpanded:d}})},[l]);const C=m.useCallback(async(d,n,p=null,y=void 0)=>{const c=localStorage.getItem("accessToken");if(c)try{console.log("------Execute endpoint:",n);let E=null;const x=new Headers,v=`Bearer ${c}`;x.append("Authorization",v),p&&x.append("Content-Type","application/json");let D={method:d,headers:x,body:p?JSON.stringify(p):null};if(E=await fetch(n,D),E.ok||E.status===404){if(E.status===200||E.status===201){let U=null;try{U=await E.json()}catch{o({type:r.SET_ERROR,payload:{error:new Error(`Response status: ${E.status}`),whichRowId:y}})}finally{return U}}}else{const{errors:U}=await E.json(),X=new Error(U?.map(ae=>ae.message).join(`
`)??"unknown");o({type:r.SET_ERROR,payload:{error:X,whichRowId:y}})}}catch(E){console.log("-------------->>> execute",d,n,E),o({type:r.SET_ERROR,payload:{error:new Error("fetch eror"),whichRowId:y}})}return null},[]),L=m.useCallback(async()=>new Promise(async d=>{const n=await i();o(n?{type:r.SET_ALL_CATEGORY_ROWS,payload:{allCategoryRows:n}}:{type:r.SET_ERROR,payload:{error:new Error("Zajeb allCategoryRows")}}),d(n)}),[i]),z=m.useCallback(async()=>new Promise(async d=>{const n=await g();o(n?{type:r.SET_ALL_GROUP_ROWS,payload:{allGroupRows:n}}:{type:r.SET_ERROR,payload:{error:new Error("Zajeb allGroupRows")}}),d(n)}),[g]),_=m.useCallback(async d=>{try{return G.get(d)}catch(n){console.log(n),o({type:r.SET_ERROR,payload:{error:n}})}},[G]);m.useEffect(()=>{(async()=>await L())()},[L]);const k=m.useCallback(async d=>{try{let n="";const p=[];return G.forEach((y,c)=>{c===d?n="":y.parentId===d&&p.push(y)}),{subCats:p,parentHeader:n}}catch(n){return console.log(n),o({type:r.SET_ERROR,payload:{error:n}}),{subCats:[],parentHeader:"Kiks subCats"}}},[G]),O=m.useCallback(async()=>new Promise(async d=>{try{o({type:r.SET_TOP_ROWS_LOADING,payload:{}});const n=`${a.endpointCategoryRow}/${l}/toprows`;console.log("CategoryProvider loadTopRows url:",n),console.log("loadTopRows AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"),console.time(),await C("GET",n).then(p=>{console.timeEnd(),console.log("loadTopRows CCCCCCCCCCCCCCCCCCCC");const y=p.map(c=>(c.IsExpanded=q?c.Id===q.categoryId:!1,new Ae(c).categoryRow));o({type:r.SET_TOP_ROWS,payload:{topRows:y}}),d(!0)})}catch(n){console.log(n),o({type:r.SET_ERROR,payload:{error:n}})}}),[C,a.endpointCategoryRow,q,l]),$=m.useCallback(async(d,n)=>{const{topId:p,id:y}=d;return console.log({categoryKey:d,includeQuestionId:n}),new Promise(async c=>{try{const E=`${a.endpointCategory}/${l}/${p}/${y}/${fe}/${n}`;console.time(),console.log("================ getCategory ======================="),await C("GET",E).then(x=>{console.timeEnd();const{categoryDto:v,msg:D}=x;c(v?new Te(v).category:new Error(D))})}catch(E){console.log(E),c(E)}})},[C,a.endpointCategory,l]),A=m.useCallback(async(d,n)=>{if(d.topId===n)return d;const{categoryRows:p}=d;let y=p.find(c=>c.id===n);if(!y)for(const c of p){const E=await A(c,n);if(E){y=E,console.log("findCategory Stop the loop for: "+n);break}}return y},[]),j=m.useCallback(async(d,n,p=!1)=>new Promise(async y=>{try{let{topId:c,parentId:E,id:x}=d;console.assert(x!==null,"id ne sme biti null u expandNodesUpToTheTree"),o({type:r.SET_NODE_EXPANDING_UP_THE_TREE,payload:{fromChatBotDlg:p,categoryId_questionId_done:`${x}_${n}`}}),console.time();const v={topId:c,id:x,parentId:null},D=new ce(v).toQuery(l),U=`${a.endpointCategoryRow}?${D}&pageSize=${fe}&includeQuestionId=${n??null}`;await C("GET",U).then(async X=>{const{categoryRowDto:ae}=X;if(console.timeEnd(),ae){let ge=null,ye=null;const Ce=new Ae(ae).categoryRow,pe=await A(Ce,x);if(E!==null&&(ge={...pe,doc1:""},n)){const qe=pe.questionRows.find(Fe=>Fe.id===n&&Fe.included);qe&&(ge=null,ye={...qe,assignedAnswers:[],numOfAssignedAnswers:0,numOfRelatedFilters:0,relatedFilters:[],source:0,status:0})}console.log(">>> expandNodeUpToTheTree categoryRow",{categoryRow:pe,questionId:"'"+(n??"jok")+"'"+(n??"JOK")});const Tt=n?R?w.EditingQuestion:w.ViewingQuestion:R?w.EditingCategory:w.ViewingCategory;o({type:r.SET_NODE_EXPANDED_UP_THE_TREE,payload:{catKey:d,categoryRow:Ce,category:ge,questionId:n??null,question:ye,formMode:Tt,fromChatBotDlg:p}}),y(!0)}else y(!1)})}catch(c){console.log(c),o({type:r.SET_ERROR,payload:{error:c}})}}),[l,a.endpointCategoryRow,C,G,A,R]),oe=m.useCallback(async(d,n=!1,p=null)=>{const y=new ce(d).toQuery(l);return new Promise(async c=>{try{const E=`${a.endpointCategoryRow}/${n}/${fe}/${p}?${y}`;console.time(),await C("GET",E).then(x=>{console.timeEnd();const{categoryRowDto:v,msg:D}=x;c(v?new Ae(v).categoryRow:new Error(D))})}catch(E){console.log(E),c(E)}})},[C,a.endpointCategoryRow,l]),V=m.useCallback(async({categoryKey:d,includeQuestionId:n,newQuestionRow:p,formMode:y})=>{try{o({type:r.SET_ROW_EXPANDING,payload:{}});const c=await oe(d,!0,n);if(c instanceof Error)o({type:r.SET_ERROR,payload:{error:c}}),console.error({cat:c});else{let E;return n&&c.questionRows.filter(x=>x.included).length>0&&(E=n),p&&(c.questionRows=[p,...c.questionRows]),c.isExpanded=!0,console.log("@@@@@@@@@@@@@@@@@ expandCategory:",y,n),y===w.None&&n&&(y=R?w.EditingQuestion:w.ViewingQuestion),o({type:r.SET_ROW_EXPANDED,payload:{categoryRow:c,formMode:y,selectedQuestionId:E}}),c}}catch(c){return console.log("error",c),o({type:r.SET_ERROR,payload:{error:c}}),null}},[R,oe]),M=m.useCallback(async d=>{const{topId:n,id:p}=d,y=I.find(E=>E.id===n),c=await A(y,p);c?(d={...c,isExpanded:!1,categoryRows:[],questionRows:[]},o({type:r.SET_ROW_COLLAPSED,payload:{categoryRow:d}})):o({type:r.SET_ERROR,payload:{error:new Error("findCategory sranje"),whichRowId:p}})},[A,I]),J=m.useCallback(async d=>{try{o({type:r.CLOSE_CATEGORY_FORM,payload:{}});const{topId:n,id:p,level:y}=d??{topId:de,id:de,level:0},c={...Xe,topId:n,parentId:d?p:null,id:de,level:y+1,title:"New Category",isExpanded:!1};if(d===null)o({type:r.SET_CATEGORY_TO_ADD,payload:{newCategoryRow:c}});else{const E={...d,level:y+1,categoryRows:[c,...d.categoryRows],hasSubCategories:!0,isExpanded:!0};o({type:r.SET_CATEGORY_TO_ADD,payload:{categoryRow:E,newCategoryRow:{...c}}})}}catch(n){console.log("error",n),o({type:r.SET_ERROR,payload:{error:n}})}},[]),H=m.useCallback(async()=>{try{const{parentId:d}=N;let n,p=[];I.forEach(async y=>{d===null?p=I.filter(c=>c.id!==de):(n=await A(y,d),n&&(n.categoryRows=n.categoryRows.filter(c=>c.id!==de)))}),o({type:r.CANCEL_ADD_CATEGORY,payload:{topRows:p.length>0?p:I}})}catch(d){console.log("error",d),o({type:r.SET_ERROR,payload:{error:d}})}},[N,V]),ue=m.useCallback(async d=>{const{id:n}=d;o({type:r.SET_LOADING_CATEGORY,payload:{}});try{const p=new Pe(d,l).categoryDto;console.log("categoryDto",{categoryDto:p});const y=`${a.endpointCategory}`;console.time(),await C("POST",y,p,n).then(async c=>{console.timeEnd();const{categoryDto:E}=c;if(E){const x=new Te(E).category;console.log("Category successfully created",{category:x}),o({type:r.CLOSE_CATEGORY_FORM,payload:{}}),G.set(x.id,{...x,isExpanded:!1});const v=de;x.parentId===null?o({type:r.SET_CATEGORY_ADDED,payload:{categoryRow:x,idToSet:v}}):o({type:r.SET_CATEGORY_ADDED,payload:{categoryRow:x,idToSet:v}})}})}catch(p){console.log(p),o({type:r.SET_ERROR,payload:{error:new Error("Server Error"),whichRowId:n}})}},[C,a.endpointCategory,L,O,l]),W=m.useCallback(async()=>{try{const{topId:d,parentId:n}=Q,y={categoryKey:{topId:d,parentId:n,id:n},formMode:w.None},c=await V(y);c&&o({type:r.CANCEL_ADD_QUESTION,payload:{categoryRow:c}})}catch(d){console.log("error",d),o({type:r.SET_ERROR,payload:{error:d}})}},[Q,V]),Y=m.useCallback(async(d,n)=>{T===w.AddingQuestion?await W():T===w.AddingCategory&&await H(),o({type:r.SET_LOADING_CATEGORY,payload:{categoryRow:d}});const p=new ce(d).categoryKey,y=await $(p,n);y instanceof Error?o({type:r.SET_ERROR,payload:{error:y}}):(y.topId=d.topId,o({type:r.SET_CATEGORY_TO_VIEW,payload:{categoryRow:y}}))},[H,W,T,$]),se=m.useCallback(async(d,n)=>{T===w.AddingQuestion?await W():T===w.AddingCategory&&await H(),o({type:r.SET_LOADING_CATEGORY,payload:{}});const p=new ce(d).categoryKey,y=await $(p,n);if(y instanceof Error)o({type:r.SET_ERROR,payload:{error:y}});else{const c={...y,isExpanded:!1,categoryRows:[],questionRows:[]};o({type:r.SET_CATEGORY_TO_EDIT,payload:{categoryRow:c,category:y}})}},[H,W,T,$]),Z=m.useCallback(async d=>{o({type:r.SET_LOADING_CATEGORY,payload:{}});try{const n=new Pe(d,l).categoryDto,p=`${a.endpointCategory}`;console.time(),await C("PUT",p,n).then(y=>{console.timeEnd();const{categoryDto:c,msg:E}=y;if(c){const x=new Te(c).category,{topId:v}=x;x.isExpanded=!1,x.topId=v,o({type:r.SET_CATEGORY_UPDATED,payload:{category:x}})}else o({type:r.SET_ERROR,payload:{error:new Error(`${E}`)}})})}catch(n){return console.log(n),o({type:r.SET_ERROR,payload:{error:new Error("Karambol")}}),n}},[C,a.endpointCategory,l]),ne=m.useCallback(async d=>{try{const{parentId:n,id:p}=d;d.modified={time:new Date,nickName:h};const y=new _t(d,l).categoryRowDto,c=`${a.endpointCategory}`;console.time(),o({type:r.SET_LOADING_CATEGORIES,payload:{}}),await C("DELETE",c,y).then(async E=>{console.timeEnd();const{categoryDto:x,msg:v}=E;if(v==="OK"){console.log("Category successfully deleted",{categoryRow:d});let D;if(n!==null){for await(const U of I)if(D=await A(U,n),D)break;D.hasSubCategories=x.HasSubCategories,D.hasSubCategories||(D.isExpanded=!1),D.categoryRows=D.categoryRows.filter(U=>U.id!==p)}o({type:r.CATEGORY_DELETED,payload:{categoryRow:D,id:p}})}else o(v==="HasSubCategories"?{type:r.SET_ERROR,payload:{error:new Error("First remove sub categories"),whichRowId:x.Id}}:v==="HasQuestions"?{type:r.SET_ERROR,payload:{error:new Error("First remove category questions"),whichRowId:x.Id}}:{type:r.SET_ERROR,payload:{error:new Error(v),whichRowId:x.Id}})})}catch(n){return console.log(n),n}},[C,a.endpointCategory,V,L,O,l]),ct=async(d,n)=>{try{console.log("Deleting Category Tag...",{categoryKey:d,variationName:n}),console.log("Category Tag successfully deleted")}catch(p){console.log("error",p),o({type:r.SET_ERROR,payload:{error:p}})}},fe=12,ut=m.useCallback(async({categoryKey:d,startCursor:n,includeQuestionId:p})=>{try{const{topId:y,id:c}=d;o({type:r.SET_CATEGORY_QUESTIONS_LOADING,payload:{}});try{const E=`${a.endpointQuestion}/${l}/${y}/${c}/${n}/${fe}/${p}`;console.time(),await C("GET",E).then(x=>{console.timeEnd();const{categoryDto:v}=x;if(v!==null){const D=new Te(v).category;o({type:r.CATEGORY_QUESTIONS_LOADED,payload:{categoryRow:D}})}})}catch(E){console.log(E),o({type:r.SET_ERROR,payload:{error:E}})}}catch(y){console.log(y),o({type:r.SET_ERROR,payload:y})}},[C,a.endpointQuestion,l]),gt=m.useCallback(async d=>{try{const{topId:n,id:p}=d;let y=await _(p);if(!y){alert(`Not found ${p}. Reload all Categories`);return}const c={topId:n,parentId:d.id,id:de,title:"question text",categoryTitle:y.title,numOfAssignedAnswers:0,included:!0},E={...be,...c,title:""},x=S.topRows.find(X=>X.id===n),v=await A(x,p),{numOfQuestions:D,questionRows:U}=v;o({type:r.ADD_NEW_QUESTION_TO_ROW,payload:{categoryRow:{...v,isExpanded:!0,numOfQuestions:D+1,questionRows:[c,...U]},newQuestionRow:c}}),o({type:r.SET_QUESTION,payload:{question:E,formMode:w.AddingQuestion}})}catch(n){console.log("error",n),o({type:r.SET_ERROR,payload:{error:n}})}},[V,A,_,S.topRows]),yt=m.useCallback(async d=>{const{topId:n,id:p,parentId:y}=d;o({type:r.SET_LOADING_CATEGORY,payload:{}});try{d.created.nickName=h;const c=new $e(d,l).questionDto,E=`${a.endpointQuestion}`;console.time(),console.log(">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> createQuestion",c),await C("POST",E,c).then(async x=>{if(console.timeEnd(),x){console.log("::::::::::::::::::::",{questionDtoEx:x});const{questionDto:v}=x;if(v){const D=new me(v).question;D.topId=n,console.log("Question successfully created"),await L().then(async()=>{const X={categoryKey:{topId:n,parentId:y,id:y},formMode:w.EditingQuestion};await V(X).then(()=>{o({type:r.SET_QUESTION,payload:{formMode:w.EditingQuestion,question:D}})})})}}})}catch(c){console.log(c),o({type:r.SET_ERROR,payload:{error:new Error("Server Error"),whichRowId:p}})}},[C,a.endpointQuestion,V,L,h,l]),pt=m.useCallback(async(d,n,p)=>{const{id:y}=n;try{n.modified.nickName=h;const c=new $e(n,l).questionDto,E=`${a.endpointQuestion}`;console.time(),c.oldParentId=d,console.log(">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> updateQuestion",c);let x=null;return await C("PUT",E,c).then(async v=>{console.timeEnd();const{questionDto:D,msg:U}=v;if(D){x=new me(D).question,console.log("Question successfully updated: ",x);const{topId:X,parentId:ae}=x;if(p){const{topId:ge,parentId:ye,id:Ce}=x,pe={topId:ge,categoryId:ye,questionId:Ce};o({type:r.FORCE_OPEN_NODE,payload:{keyExpanded:pe}})}else{const ye={categoryKey:{topId:X,parentId:ae,id:ae},formMode:w.EditingQuestion};await V(ye).then(()=>{o({type:r.SET_QUESTION,payload:{formMode:w.EditingQuestion,question:x}})})}}else o({type:r.SET_ERROR,payload:{error:new Error(U)}})}),x}catch(c){console.log(c),o({type:r.SET_ERROR,payload:{error:new Error("Server Error"),whichRowId:y}})}},[C,a.endpointQuestion,V,h,l]),mt=m.useCallback(async(d,n)=>{const{id:p,parentId:y,topId:c}=d;o({type:r.SET_LOADING_QUESTION,payload:{}});try{const E=new vt(d,l).questionRowDto,x=`${a.endpointQuestion}`;console.time(),await C("DELETE",x,E).then(async v=>{const{questionDto:D}=v;if(console.timeEnd(),D){const U=new me(D).question;console.log("Question successfully deleted"),n&&o({type:r.QUESTION_DELETED,payload:{question:U}});const ae={categoryKey:{topId:c,parentId:y,id:y},formMode:w.None};await V(ae).then(()=>{})}else console.error(v),o({type:r.SET_ERROR,payload:{error:new Error("Server Error"),whichRowId:p}})})}catch(E){console.log(E),o({type:r.SET_ERROR,payload:{error:new Error("Server Error"),whichRowId:p}})}},[C,a.endpointQuestion,V,l]),he=m.useCallback(async d=>new Promise(async n=>{try{const p=new je(d).toQuery(l),y=`${a.endpointQuestion}?${p}`;console.time(),console.log("getQuestion",d),await C("GET",y).then(c=>{console.timeEnd();const{questionDto:E,msg:x}=c;if(E){const v={question:new me(E).question,msg:x};n(v)}else n({question:null,msg:x})})}catch(p){console.log(p),n({question:null,msg:"Problemos"})}}),[C,a.endpointQuestion,l]),Et=m.useCallback(async d=>{const n=new je(d).questionKey;o({type:r.SET_LOADING_QUESTION,payload:{}});const p=await he(n);T===w.AddingQuestion?await W():T===w.AddingCategory&&await H();const{question:y,msg:c}=p;y?(y.topId=d.topId,o({type:r.SET_QUESTION_TO_VIEW,payload:{question:y}})):o({type:r.SET_ERROR,payload:{error:new Error(c)}})},[H,W,T,he]),wt=m.useCallback(async d=>{const n=new je(d).questionKey;T===w.AddingQuestion?await W():T===w.AddingCategory&&await H(),o({type:r.SET_LOADING_QUESTION,payload:{}}),console.log("editQuestion:",n);const p=await he(n),{question:y,msg:c}=p;y?(y.topId=d.topId,o({type:r.CLOSE_QUESTION_FORM,payload:{question:y}}),o({type:r.SET_QUESTION_TO_EDIT,payload:{question:y}})):o({type:r.SET_ERROR,payload:{error:new Error(c)}})},[H,W,T,he]),xt=m.useCallback(async()=>new Promise(async d=>{try{const n=`${a.endpointAnswer}/${l}`;await C("GET",n).then(p=>{d(p)})}catch(n){console.log("error",n),o({type:r.SET_ERROR,payload:{error:n}})}}),[C,a.endpointAnswer,l]),ft=m.useCallback(async(d,n,p)=>{try{var{topId:y,id:c}=p,E={topId:y,id:c,created:{time:new Date,nickName:h}};const x=new At(E).assignedAnswerDto;x.QuestionKeyDto=new It(n,l).dto;let v=null;const D=`${a.endpointQuestionAnswer}/${d}`;console.time(),await C("POST",D,x).then(async U=>{console.timeEnd();const{questionDto:X}=U;console.log("::::::::::::::::::::",{questionDtoEx:U}),X&&(v=new me(X).question,console.log("Question successfully modified"))}),v&&o({type:r.SET_QUESTION_AFTER_ASSIGN_ANSWER,payload:{question:v}})}catch(x){console.log("error",x),o({type:r.SET_ERROR,payload:{error:x}})}},[C,a.endpointQuestionAnswer,h,l]),ht=m.useCallback(async(d,n,p)=>{const y=I.find(E=>E.id===d);let c=await A(y,n);console.log("PROVIDER onCategoryTitleChanged::",c.title,p),c.title!==p&&(c.title=p===""?"New Category":p,o({type:r.RE_RENDER_TREE,payload:{}}))},[A,I]),Ct=m.useCallback(async(d,n,p,y)=>{const c=I.find(x=>x.id===d);let E=await A(c,n);if(E){const x=E.questionRows.find(v=>v.id===p);x.title!==y&&(x.title=y===""?"New Question":y,console.log("onQuestionTitleChanged+++>>>",p,E),o({type:r.QUESTION_TITLE_CHANGED,payload:{categoryRow:E}}))}},[A,I]),Rt={state:S,loadAllCategoryRows:L,getSubCats:k,getCat:_,loadAllGroupRows:z,expandNodesUpToTheTree:j,loadTopRows:O,addCategory:J,cancelAddCategory:H,createCategory:ue,viewCategory:Y,editCategory:se,updateCategory:Z,deleteCategory:ne,deleteCategoryVariation:ct,expandCategory:V,collapseCategory:M,onCategoryTitleChanged:ht,loadCategoryQuestions:ut,addQuestion:gt,cancelAddQuestion:W,createQuestion:yt,viewQuestion:Et,editQuestion:wt,updateQuestion:pt,deleteQuestion:mt,onQuestionTitleChanged:Ct,getAnswerCount:xt,assignQuestionAnswer:ft};return!u||!P?null:e.jsx(Je.Provider,{value:Rt,children:e.jsx(Ze.Provider,{value:o,children:t})})};function K(){return m.useContext(Je)}const et=()=>m.useContext(Ze),tt="/knowledge/assets/QPlus.png";var re=(t=>(t.SET_LOADING="SET_LOADING",t.SET_SUB_CATS="SET_SUB_CATS",t.SET_ERROR="SET_ERROR",t.SET_EXPANDED="SET_EXPANDED",t.SET_PARENT_CAT="SET_PARENT_CAT",t))(re||{});const Xt=({cat:t,dispatch:i,setParentCat:g,selId:s})=>{const{topId:a,parentId:u,id:l,title:f,level:R,isExpanded:h}=t,S={topId:a,parentId:u,id:l},o=Q=>{i({type:re.SET_EXPANDED,payload:{id:l,expanding:!h}})},T=Q=>{g(Q)},N=e.jsxs("div",{className:"d-flex justify-content-start align-items-center w-100 text-primary",children:[e.jsx(F,{variant:"link",size:"sm",className:"py-0 px-1",onClick:Q=>{o(),Q.stopPropagation(),Q.preventDefault()},title:"Expand",children:e.jsx(ie,{icon:h?Me:ze,size:"lg"})}),e.jsx(F,{variant:"link",size:"sm",className:"py-0 mx-0 text-decoration-none",title:l,onClick:()=>T(t),children:f})]});return e.jsxs(e.Fragment,{children:[e.jsx(te.Item,{variant:"primary",className:"py-0 px-1 w-100",as:"li",children:N}),h&&e.jsx(te.Item,{className:"py-0 px-0",variant:"primary",as:"li",children:e.jsx(st,{selId:s,level:R+1,categoryKey:S,setParentId:g})})]})},Jt={loading:!1,parentId:null,title:"",cats:[]},Zt=(t,i)=>{switch(i.type){case re.SET_LOADING:return{...t,loading:!0};case re.SET_SUB_CATS:{const{subCats:g}=i.payload;return{...t,cats:t.cats.concat(g),loading:!1}}case re.SET_ERROR:{const{error:g}=i.payload;return{...t,error:g,loading:!1}}case re.SET_EXPANDED:{const{id:g,expanding:s}=i.payload;let{cats:a}=t;if(!s){const u=ot(a,g);console.log("clean:",u),u.length>0&&(a=a.filter(l=>!u.includes(l.id)))}return{...t,cats:t.cats.map(u=>u.id===g?{...u,isExpanded:s}:u)}}case re.SET_PARENT_CAT:{const{cat:g}=i.payload,{id:s,title:a}=g;return{...t,parentId:s,title:a}}default:return t}};function ot(t,i){let g=t.filter(s=>s.parentId===i).map(s=>s.id);return g.forEach(s=>{const a=s?ot(t,s):[];g=g.concat(a)}),g}const st=({selId:t,categoryKey:i,level:g,setParentId:s})=>{const[a,u]=m.useReducer(Zt,Jt),{getSubCats:l}=K(),{id:f}=i??{id:null},[R]=m.useState(i);m.useEffect(()=>{(async()=>{const o=await l(f),{subCats:T}=o;u({type:re.SET_SUB_CATS,payload:{subCats:T}})})()},[l,R,f]);const h=a.cats.filter(o=>o.parentId===f),S=o=>{u({type:re.SET_PARENT_CAT,payload:{cat:o}}),s(o)};return e.jsxs("div",{className:g>1?"border  border-7 ms-4 h-25":"border border-7  h-25",style:{overflowY:"auto"},children:[e.jsx(te,{as:"ul",variant:"dark",className:"mb-0",children:h.filter(o=>o.id!==t).map(o=>e.jsx(Xt,{cat:o,selId:t,dispatch:u,setParentCat:S},o.id))}),a.error&&a.error.message]})},eo=({questionTitle:t,assignedAnswer:i,isDisabled:g,unAssignAnswer:s})=>{const{id:a,answerTitle:u,created:l}=i,{time:f,nickName:R}=l,h=localStorage.getItem("emailFromClient"),S=`Created by: ${R}, ${He(new Date(f))}`,{canEdit:o,isDarkMode:T}=le(),N=!1,Q=()=>{s(i)},q=O=>{console.log(`Selected Answer id=${O}`)},I=()=>{},[G,P]=m.useState(!1),C=()=>P(!1),L=O=>{navigator.clipboard&&navigator.clipboard.writeText(O).then(()=>{console.log("Copied to clipboard successfully."),alert("Answer copied to clipboard")},$=>{console.log("Failed to copy the text to clipboard.",$)})},[z,_]=xe(),k=e.jsxs("div",{ref:z,className:"d-flex justify-content-start align-items-center w-100 text-light bg-info",children:[e.jsx(F,{variant:"link",size:"sm",className:"py-0 px-0 text-info",onClick:()=>h?P(!0):L(u),children:e.jsx(ie,{icon:h?Lt:Gt,size:"sm",title:"Send this Answer in a reply on Question"})}),e.jsx(F,{variant:"link",size:"sm",className:"py-0 mx-1 text-decoration-none text-white text-wrap",title:S,onClick:()=>q(a),disabled:N,children:u}),o&&!N&&_&&!g&&e.jsx(F,{variant:"link",size:"sm",className:"ms-1 py-0 mx-1 text-secondary",onClick:Q,children:e.jsx(ie,{icon:_e,size:"lg"})})]});return e.jsxs(te.Item,{variant:"info",className:"py-0 px-0",as:"li",children:[k,e.jsxs(B,{show:G,onHide:C,animation:!0,centered:!0,size:"lg",className:`${T?"bg":""}`,contentClassName:`${T?"bg-info bg-gradient":""}`,children:[e.jsx(B.Header,{closeButton:!0,children:"Send Answer in a reply on Question"}),e.jsx(B.Body,{className:"py-0",children:e.jsx("table",{className:"table-info table-hover table-bordered w-100 h-100",children:e.jsxs("tbody",{children:[e.jsxs("tr",{className:"border-top-0",children:[e.jsx("td",{children:"To:"}),e.jsx("td",{children:h})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Subject:"}),e.jsx("td",{children:t})]}),e.jsxs("tr",{className:"border-bottom-0",children:[e.jsx("td",{children:"Body:"}),e.jsx("td",{children:u})]})]})})}),e.jsxs(B.Footer,{children:[e.jsx(F,{variant:"secondary",size:"sm",onClick:C,children:"Cancel"}),e.jsx(F,{variant:"primary",size:"sm",onClick:I,children:"Send E-Mail"})]})]})]},a)},to=({})=>e.jsx("span",{children:"Posle"}),oo=m.lazy(()=>Ot(()=>import("./AutoSuggestAnswers.js"),__vite__mapDeps([0,1,2,3,4,5])).then(t=>({default:t.AutoSuggestAnswers}))),so=({questionKey:t,questionTitle:i,assignedAnswers:g,isDisabled:s})=>{const{globalState:a,searchAnswers:u}=Ne(),{isDarkMode:l,variant:f}=a,[R,h]=m.useState(!1),S=()=>h(!1),o=()=>{S()},{state:T,assignQuestionAnswer:N,getAnswerCount:Q}=K(),{allGroupRows:q}=T,[I,G]=m.useState(!1),[P,C]=m.useState(""),L=async O=>{await N("Assign",t,O),G(!1)},z=async O=>{O&&await L({topId:O.topId,id:O.id}),S()},_=async O=>{await N("UnAssign",t,O)},k=async()=>{if(await Q()===0){C("No answer available to assign. Please navigate to Answers and create an answer first.");return}G(!0)};return e.jsxs("div",{className:"mx-0 my-0 px-1 py-1 border border-2 rounded-2 border-info bg-info",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-muted bg-info fs-6",children:"Assigned Answers"}),e.jsx(te,{as:"ul",variant:f,className:"my-1",children:g.map(O=>e.jsx(eo,{questionTitle:i,assignedAnswer:O,groupInAdding:!1,isDisabled:s,unAssignAnswer:_},O.id))}),T.error&&e.jsx("div",{children:"state.error"})]}),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"d-flex justify-content-start w-100 align-items-center py-1",children:[e.jsx(F,{size:"sm",className:"button-edit py-0 rounded-1",title:"Assign a new Answer",style:{border:"1px solid silver",fontSize:"12px"},variant:f,disabled:s,onClick:k,children:"Assign answer"}),e.jsx(F,{size:"sm",className:"button-edit py-0 rounded-1 mx-1",title:"Add and Assign a new Answer",style:{border:"1px solid silver",fontSize:"12px"},variant:f,disabled:s,onClick:async O=>{h(!0),O.preventDefault()},children:"Add a new answer"})]}),e.jsx("div",{className:"text-muted d-block",children:P&&e.jsx("span",{className:"text-danger",children:P})})]}),e.jsxs(B,{show:R,onHide:S,animation:!0,centered:!0,size:"lg",className:"",contentClassName:`${l?"bg-info bg-gradient":""}`,children:[e.jsx(B.Header,{closeButton:!0,children:e.jsx(B.Title,{children:i})}),e.jsx(B.Body,{children:e.jsx(to,{inLine:!0,closeModal:o,onAnswerCreated:z})})]}),e.jsxs(B,{show:I,onHide:()=>G(!1),animation:!0,size:"lg",centered:!0,className:`${l?"dark":""}`,contentClassName:`${l?"dark":""}`,children:[e.jsx(B.Header,{closeButton:!0,children:e.jsx(B.Title,{children:"Assign the answer"})}),e.jsx(B.Body,{style:{height:"40vh",width:"50vw"},className:"answers",children:e.jsx(m.Suspense,{fallback:e.jsx("div",{children:"Loading..."}),children:e.jsx(oo,{tekst:"tekst",onSelectAnswer:L,allGroupRows:q,searchAnswers:u})})})]})]})},no=({relatedFilter:t})=>{const{filter:i,numOfUsages:g,created:s,lastUsed:a}=t,{time:u,nickName:l}=s,f=`Created by: ${l}, ${He(new Date(u))}`,R=!1,h=N=>{console.log("RelatedFilter onSelectAnswer",{filter:N})},[S,o]=xe(),T=e.jsxs("div",{ref:S,className:"d-flex justify-content-start align-items-center w-100 text-light related-filter-row",children:[e.jsx(F,{variant:"link",size:"sm",className:"py-0 mx-0 title text-light text-wrap",title:f,onClick:()=>h(i),disabled:R,children:i}),e.jsxs(ve,{pill:!0,bg:"secondary",className:`text-light ${g===0?"d-none":"d-inline"}`,children:[g,g===1?" usage":" usages"]}),e.jsx("span",{className:"small ms-1",children:Vt(a.time)}),o]});return e.jsx(te.Item,{className:"py-0 px-0",as:"li",children:T},i)},ao=({relatedFilters:t})=>{const{globalState:i}=Ne(),{variant:g}=i,{state:s}=K(),a=async u=>{console.log("RelatedFilters unAssignFilter",{relatedFilter:u})};return e.jsx("div",{className:"mx-0 my-1 border rounded-2 px-1 py-1border-light fs-6 related-filters",children:e.jsxs("div",{children:[e.jsx("label",{className:"text-muted",children:"Most frequently selected Filters (for the next Question in ChatBot)"}),t.length>0?e.jsx(te,{as:"ul",variant:g,className:"my-1",children:t.map(u=>e.jsx(no,{relatedFilter:u,unAssignFilter:a},u.filter))}):e.jsx("div",{className:"border text-light",children:"No filters"}),s.error&&e.jsx("div",{children:"state.error"})]})})},ke=({question:t,submitForm:i,children:g,showCloseButton:s,source:a=0,closeModal:u})=>{const{state:l,onQuestionTitleChanged:f}=K();let{formMode:R}=l;const h=R===w.ViewingQuestion,S=R===w.EditingQuestion,o=R===w.AddingQuestion,T=h,{topId:N,parentId:Q,id:q,assignedAnswers:I,relatedFilters:G,title:P}=t,C=new je(t).questionKey,L=et(),z=()=>{u?u():L({type:r.CLOSE_QUESTION_FORM,payload:{question:t}})},_=()=>{u?u():L({type:r.CANCEL_QUESTION_FORM,payload:{question:t}})},[k,O]=m.useState(P),$=Ve(k,500),A=m.useRef(null),j=Ke({enableReinitialize:!0,initialValues:t,validationSchema:Ye().shape({title:Ie().required("Required"),parentId:Ie().required("Required").notOneOf(["000000000000000000000000"])}),onSubmit:M=>{i(M),O(M.title)}});m.useEffect(()=>{(async()=>j.values.title!==$&&f(N,Q,q,j.values.title))()},[$,j.values.title,f,N,q]),m.useEffect(()=>{A.current.focus(),a!==0&&j.setFieldValue("source",a)},[j,A,a]);const oe=M=>{j.handleChange(M);const J=M.target.value;O(J)},V=M=>{j.setFieldValue("parentId",M.id),j.setFieldValue("categoryTitle",M.title)};return e.jsxs("div",{className:"form-wrapper px-3 py-1 my-0 my-1 w-100 question-form",children:[s&&e.jsx(Ue,{onClick:z,className:"float-end"}),e.jsx(we,{className:"text-center",children:e.jsxs(b.Label,{children:["Question  ",h?"Viewing":S?"Editing":"Adding"]})}),e.jsxs(b,{onSubmit:j.handleSubmit,children:[e.jsxs(De,{direction:"horizontal",gap:0,className:"border",children:[e.jsx("div",{className:"p-0",children:e.jsx(b.Label,{children:"Category:"})}),e.jsx("div",{className:"p-1",children:e.jsxs(b.Group,{controlId:"parentId",className:"category-select form-select-sm w-90",children:[e.jsxs(Se,{children:[e.jsx(Se.Toggle,{variant:"light",id:"dropdown-basic",className:"px-2 py-0 text-primary border",disabled:T,children:e.jsx("span",{className:"text-wrap me-1",children:j.values.categoryTitle})}),e.jsx(Se.Menu,{className:"p-0 border",children:e.jsx(Se.Item,{className:"p-0 m-0 rounded-3",children:e.jsx(st,{selId:j.values.parentId,categoryKey:null,level:1,setParentId:V})})})]}),e.jsx(b.Control,{as:"input",name:"parentId",onChange:j.handleChange,value:j.values.parentId?j.values.parentId:"",placeholder:"Category",className:"text-primary w-100",disabled:T,hidden:!0}),e.jsx(b.Text,{className:"text-danger",children:j.touched.parentId&&j.errors.parentId?e.jsx("div",{className:"text-danger",children:j.errors.parentId?"required":""}):null})]})})]}),e.jsxs(b.Group,{controlId:"title",children:[e.jsx(b.Label,{children:"Title"}),e.jsx(b.Control,{as:"textarea",name:"title",placeholder:j.values.title==="new Question"?"new Question":"question text",ref:A,onChange:oe,value:j.values.title,rows:3,className:"text-primary w-100",disabled:T}),e.jsx(b.Text,{className:"text-danger",children:j.touched.title&&j.errors.title?e.jsx("div",{className:"text-danger",children:j.errors.title}):null})]}),e.jsxs(we,{children:[e.jsx(Ee,{children:e.jsxs(b.Group,{controlId:"source",children:[e.jsx(b.Label,{children:"Source"}),e.jsx(Oe,{id:"source",name:"source",options:qt,onChange:(M,J)=>{M.preventDefault(),j.setFieldValue("source",J)},value:j.values.source,disabled:T,classes:"text-primary"}),e.jsx(b.Text,{className:"text-danger",children:j.touched.source&&j.errors.source?e.jsx("div",{className:"text-danger",children:j.errors.source}):null})]})}),e.jsx(Ee,{children:e.jsxs(b.Group,{controlId:"status",children:[e.jsx(b.Label,{children:"Status"}),e.jsx(Oe,{id:"status",name:"status",options:Ft,onChange:(M,J)=>{M.preventDefault(),j.setFieldValue("status",J)},value:j.values.status,disabled:T,classes:"text-primary"}),e.jsx(b.Text,{className:"text-danger",children:j.touched.status&&j.errors.status?e.jsx("div",{className:"text-danger",children:j.errors.status}):null})]})})]}),(h||S)&&e.jsxs("div",{className:"my-1",children:[e.jsx(so,{questionKey:C,questionTitle:k,assignedAnswers:I,isDisabled:T}),e.jsx(ao,{questionKey:C,questionTitle:k,relatedFilters:G}),e.jsx(Be,{created:t.created,modified:t.modified,classes:"text-primary"})]}),(j.dirty&&S||o)&&e.jsx(We,{cancelForm:_,handleSubmit:j.handleSubmit,title:g}),l.error&&e.jsx("div",{className:"text-danger",children:l.error.message})]})]})},Le=({closeModal:t,showCloseButton:i,source:g,setError:s})=>{const{state:a,cancelAddQuestion:u,createQuestion:l}=K(),{activeQuestion:f}=a,R=f?f.topId:"",h=async()=>{await u()},S=async o=>{const T={...o,topId:R,created:{time:new Date,nickName:""},modified:void 0},N=await l(T,t!==void 0);N&&(N.message?s(N.message):t&&t())};return f?e.jsx(ke,{question:f,showCloseButton:i??!0,source:g??0,closeModal:h,submitForm:S,children:"Create Question"}):null},nt=({})=>{const{state:t,updateQuestion:i,loadAllGroupRows:g}=K(),{activeQuestion:s,allGroupRowsLoaded:a}=t;if(!s)return null;if(!s)return e.jsx("div",{children:"Loading question to edit..."});m.useEffect(()=>{(async()=>a===void 0&&await g())()},[a,g]);const u=async l=>{const f={...l,created:void 0,modified:{time:new Date,nickName:""}},{parentId:R}=s,h=R!==f.parentId;await i(R,f,h)};return e.jsx(ke,{question:s,showCloseButton:!0,source:0,submitForm:u,children:"Update Question"})},at=({inLine:t})=>{console.log(t?"ViewQuestion inLine":"ViewQuestion not inLine");const{state:i}=K(),{activeQuestion:g}=i,[s,a]=m.useState(null);return m.useEffect(()=>{console.log("#################################### ViewQuestion setQuestion ...",{activeQuestion:g}),a(g)},[g]),e.jsx(ke,{question:s,showCloseButton:!0,source:0,submitForm:()=>{},children:"View Question"})},ro=({questionRow:t,isSelected:i})=>{const{id:g,topId:s,parentId:a,title:u,numOfAssignedAnswers:l}=t,f={topId:s,parentId:a,id:a},{canEdit:R,authUser:h}=le(),{state:S,viewQuestion:o,addQuestion:T,editQuestion:N,deleteQuestion:Q}=K(),{activeQuestion:q,formMode:I,loadingQuestion:G,questionLoaded:P}=S,C=q!==null&&q.id===g,L=I===w.AddingQuestion,z=()=>{t.modified={time:new Date,nickName:h.nickName},Q(t,C)},_=async A=>{console.log("QuestionRow onSelectQuestion",{id:A}),R?await N(t):await o(t)},[k,O]=xe();m.useEffect(()=>{(async()=>{if(i&&!G&&!P){switch(I){case w.ViewingQuestion:await o(t);break;case w.EditingQuestion:console.log("Zovem from QuestionRow"),R?await N(t):await o(t);break}document.getElementById(`QuestionRow${g}`)?.scrollIntoView({behavior:"smooth",block:"end"})}})()},[R,N,I,g,i,G,P,t,o]);const $=e.jsxs("div",{id:`QuestionRow${g}`,className:`d-relative d-flex justify-content-start align-items-center w-100 mt-0 question-row${i?"-selected":""}`,style:{marginTop:"1px"},children:[e.jsx(F,{variant:"link",size:"sm",className:"d-flex align-items-center px-1 text-secondary",children:e.jsx("img",{width:"22",height:"18",src:bt,alt:"Question"})}),e.jsx(F,{variant:"link",size:"sm",className:`p-0 px-1 m-1 ms-0 question-row-title ${C?"fw-bold":""}`,title:`id:${g.toString()}`,onClick:()=>_(g),disabled:L,children:u}),e.jsxs(ve,{pill:!0,bg:"secondary",className:`text-info ${l===0?"d-none":"d-inline"}`,children:[l,"a"]}),R&&!L&&O&&e.jsxs("div",{className:"position-absolute text-nowrap d-flex align-items-center border border-0 border-warning p-0 end-0",children:[e.jsx(F,{variant:"link",size:"sm",className:"ms-1 p-0 text-secondary d-flex align-items-center",title:"Add Question",onClick:()=>{T(f,!0)},children:e.jsx("img",{width:"22",height:"18",src:tt,alt:"Add Question"})}),e.jsx(F,{variant:"link",size:"sm",className:"ms-0 p-0 text-secondary",onClick:z,children:e.jsx(ie,{icon:_e,size:"lg"})})]})]});return e.jsxs(te.Item,{className:"py-0 px-0 w-100",as:"li",children:[i&&I===w.AddingQuestion&&e.jsxs(e.Fragment,{children:[e.jsx("div",{id:"div-question",className:"ms-0 d-md-none w-100",children:e.jsx(Le,{showCloseButton:!0,source:0})}),e.jsx("div",{ref:k,className:"d-none d-md-block  border rounded-3",children:$})]}),i&&I===w.EditingQuestion&&e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:k,className:"",children:$}),e.jsx("div",{id:"div-question",className:"ms-0 d-md-none w-100",children:e.jsx(nt,{inLine:!0})})]}),i&&I===w.ViewingQuestion&&e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:k,className:"",children:$}),e.jsx("div",{ref:k,id:"div-question",className:"ms-0 d-md-none w-100",children:e.jsx(at,{inLine:!0})})]}),!i&&e.jsx("div",{ref:k,className:"",children:$})]})},rt=({categoryRow:t})=>{const{state:i,loadCategoryQuestions:g}=K(),{keyExpanded:s,loadingQuestion:a,error:u,selectedQuestionId:l}=i,{questionId:f}=s;t.level+=1;const{questionRows:R}=t;let h=!1;async function S(){try{const N={categoryKey:new ce(t).categoryKey,startCursor:R.length,includeQuestionId:f??null};console.log("^^^^^^^^^^^^^ loadMore"),console.log("^^^^^^^^^^^^^",{x:N}),console.log("^^^^^^^^^^^^^ loadMore"),await g(N)}catch{}}const[o,{rootRef:T}]=Pt({loading:a,hasNextPage:h,onLoadMore:S,disabled:!!u,rootMargin:"0px 0px 100px 0px"});return e.jsxs("div",{ref:T,className:"ms-0",style:{maxHeight:"400px",overflowY:"auto"},children:[e.jsxs($t,{children:[R.length===0&&e.jsx("label",{children:"No questions"}),R.map(N=>e.jsx(ro,{questionRow:N,isSelected:N.id===l},N.id)),h]}),u&&e.jsxs("p",{children:["Error: ",u.message]})]})},io=({categoryKey:t,tag:i,categoryInAdding:g})=>{const{name:s}=i,{canEdit:a}=le(),{state:u,deleteCategoryVariation:l}=K(),f=()=>{l(t,s)},[R,h]=xe(),S=e.jsxs("div",{ref:R,children:[e.jsx(ve,{pill:!0,bg:"secondary",children:s}),a&&!0&&h&&e.jsx(F,{variant:"link",size:"sm",className:"ms-0 py-0 mx-0 text-secondary",onClick:f,children:e.jsx(ie,{icon:_e,size:"sm"})}),!1]});return e.jsx("div",{className:"py-1 px-1",children:S})},lo=({categoryKey:t,variations:i})=>{const{state:g}=K(),{error:s}=g;return m.useEffect(()=>{},[]),e.jsxs("div",{className:"ms-2",children:[e.jsxs(De,{direction:"horizontal",gap:2,children:[i.length===0&&e.jsx("div",{children:"No"}),i.length>0&&i.map(a=>e.jsx(io,{categoryKey:t,tag:a,categoryInAdding:void 0}))]}),s&&e.jsxs("p",{children:["Error: ",s.message]})]})},Ge=({formMode:t,category:i,cancel:g,close:s,submitForm:a,children:u})=>{const{onCategoryTitleChanged:l}=K(),f=t===w.ViewingCategory,R=t===w.EditingCategory,h=t===w.AddingCategory,{topId:S,id:o,variations:T,questionRows:N,title:Q}=i;console.log("CategoryForm render: ",{topId:S,id:o,catTitle:Q,formMode:t,variations:T});const q=new ce(i).categoryKey;document.getElementById("div-details");const I=N&&N.length>0,G=()=>{s()},P=()=>{g()},[C,L]=m.useState(Q),z=Ve(C,300),_=Ke({enableReinitialize:!0,initialValues:i,validationSchema:Ye().shape({title:Ie().required("Required")}),onSubmit:A=>{console.log("CategoryForm.onSubmit",JSON.stringify(A,null,2)),a(A),L(A.title)}});m.useEffect(()=>{(async()=>(console.log("CategoryForm.useEffect - onCategoryTitleChanged",{debouncedSearchTerm:z,title:_.values.title}),_.values.title!==z&&l(S,o,_.values.title)))()},[z,_.values.title,l]);const k=A=>{_.handleChange(A);const j=A.target.value;L(j)},O=m.useRef(null),$=!1;return console.log("CategoryForm render return: ",C),e.jsxs("div",{className:"form-wrapper p-2 category-form",children:[e.jsx(Ue,{onClick:G,className:"float-end"}),e.jsx(we,{className:"text-center text-muted",children:e.jsxs(b.Label,{children:["Category ",f?"Viewing":R?"Editing":"Adding"]})}),e.jsxs(b,{onSubmit:()=>_.handleSubmit,children:[e.jsx(b.Group,{controlId:"Variations",children:e.jsxs(De,{direction:"horizontal",gap:1,children:[e.jsx("div",{className:"px-0",children:e.jsx(b.Label,{children:"Variations:"})}),e.jsx("div",{className:"px-1 border border-1 border-secondary rounded",children:e.jsx(lo,{categoryKey:q,variations:T?T.map(A=>({name:A})):[]})}),e.jsx("div",{className:"ps-2",children:e.jsx(b.Label,{children:"Kind:"})}),e.jsx("div",{className:"px-1 border border-1 border-secondary rounded",children:e.jsxs(b.Group,{controlId:"kind",children:[e.jsx(Oe,{id:"kind",name:"kind",options:Ut,onChange:(A,j)=>{A.preventDefault(),_.setFieldValue("kind",j)},value:_.values.kind,disabled:$,classes:"text-primary"}),e.jsx(b.Text,{className:"text-danger",children:_.touched.kind&&_.errors.kind?e.jsx("div",{className:"text-danger",children:_.errors.kind}):null})]})})]})}),e.jsxs(b.Group,{controlId:"title",children:[e.jsx(b.Label,{children:"Title"}),e.jsx(b.Control,{as:"textarea",name:"title",placeholder:"new Category",value:C,onChange:k,onFocus:A=>{t===w.AddingCategory&&A.target.select()},ref:O,rows:3,className:"text-primary w-100",disabled:f}),e.jsx(b.Text,{className:"text-danger",children:_.touched.title&&_.errors.title?e.jsx("div",{className:"text-danger",children:_.errors.title}):null})]}),e.jsxs(b.Group,{controlId:"link",children:[e.jsx(b.Label,{children:"Link"}),_.values.hasSubCategories?e.jsx(b.Control,{as:"input",placeholder:"/categories/...",name:"link",onChange:_.handleChange,className:"text-primary w-100",value:"Can't have link (has sub categories)",disabled:!0}):e.jsxs(e.Fragment,{children:[e.jsx(b.Control,{as:"input",placeholder:"/categories/...",name:"link",onChange:_.handleChange,className:"text-primary w-100",value:_.values.link??"",disabled:f}),e.jsx(b.Text,{className:"text-danger",children:_.touched.link&&_.errors.link?e.jsx("div",{className:"text-danger",children:_.errors.link}):null})]})]}),e.jsxs(b.Group,{children:[e.jsxs(b.Label,{className:"m-1 mb-0",children:["Questions (",`${_.values.numOfQuestions}`,") "]}),I&&e.jsx(rt,{categoryRow:i})]}),(f||R)&&e.jsx(Be,{created:i.created,modified:i.modified,classes:"text-primary"}),(_.dirty&&R||h)&&e.jsx(We,{cancelForm:P,handleSubmit:_.handleSubmit,title:u})]})]})},it=({inLine:t})=>{const i=le(),{nickName:g}=i.authUser,{state:s,cancelAddCategory:a,updateCategory:u}=K(),{activeCategory:l,keyExpanded:f}=s,{questionId:R}=f,h=async()=>{await a()},S=async()=>{await a()},o=async T=>{const N={...T,created:void 0,modified:{time:new Date,nickName:g}};await u(N,!0)};return e.jsx(Ge,{inLine:t,category:{...l},questionId:R,formMode:w.EditingCategory,cancel:h,close:S,submitForm:o,children:"Update Category"})},Qe=({inLine:t})=>{const{state:i,cancelAddCategory:g}=K(),{activeCategory:s,keyExpanded:a}=i,{questionId:u}=a,l=async()=>{await g()};return e.jsx(Ge,{inLine:t,category:{...s},questionId:u,formMode:w.ViewingCategory,close:l,cancel:l,submitForm:()=>{},children:"View Category"})},lt=({activeCategory:t})=>{const i=le(),{nickName:g}=i.authUser,{cancelAddCategory:s,createCategory:a}=K(),[u]=m.useState({...t}),l=async()=>{await s()},f=async()=>{await s()},R=async h=>{const S={...h,created:{time:new Date,nickName:g},modified:void 0};console.log("**********object",S),await a(S)};return!t===null?null:(console.log("AddCategory render >>>>>:",t),e.jsx(e.Fragment,{children:e.jsx(Ge,{inLine:!1,category:u,questionId:null,formMode:w.AddingCategory,cancel:l,close:f,submitForm:R,children:"Create Category"})}))},co=({categoryRow:t,questionId:i})=>{const{id:g,title:s,hasSubCategories:a,numOfQuestions:u,isExpanded:l,categoryRows:f}=t;t.level+=1;const R=new ce(t).categoryKey,{canEdit:h,authUser:S}=le(),{state:o,addCategory:T,viewCategory:N,editCategory:Q,deleteCategory:q,expandCategory:I,collapseCategory:G,addQuestion:P}=K();let{formMode:C,activeCategory:L,loadingCategory:z,categoryLoaded:_}=o;const k=L!==null&&L.id===g,O=C===w.AddingCategory,$=l&&u>0,A=()=>{t.modified={time:new Date,nickName:S.nickName},q(t)},j=async()=>{l?await G(t):await I({categoryKey:R})},[oe,V]=m.useState(!1);m.useEffect(()=>{V(!0)},[f]);const M=async()=>{h?await Q(t,i??"null"):await N(t,i??"null")},[J,H]=m.useState(!1);m.useEffect(()=>{J&&(T(t),H(!1))},[T,t,J]);const[ue,W]=m.useState(!1);m.useEffect(()=>{ue&&(P(R,l??!1),W(!1))},[P,R,l,ue]),m.useEffect(()=>{(async()=>{if(k&&!z&&!_&&!O)switch(console.log("CategoryRow formMode:",C),C){case w.ViewingCategory:await N(t,i??"null");break;case w.EditingCategory:h?await Q(t,i??"null"):await N(t,i??"null");break}})()},[h,R,_,t,Q,I,C,O,k,z,i,N]);const[Y,se]=xe(),Z=e.jsxs("div",{children:[e.jsxs("div",{id:`Row${g}`,className:`d-relative d-flex justify-content-start align-items-center w-100 mt-1 category-row  ${k?"selected":""}`,style:{marginTop:"1px"},children:[e.jsx(F,{variant:"link",size:"sm",className:"py-0 px-1","aria-controls":g+"-2","aria-expanded":oe,onClick:ne=>{j(),ne.stopPropagation()},title:"Expand",disabled:O||!a&&u===0,children:e.jsx(ie,{icon:l?Me:ze,size:"lg"})}),e.jsx(F,{variant:"link",size:"sm",className:"py-0 px-1 bg-light",title:"Expand",disabled:!0,children:e.jsx(ie,{icon:Mt,size:"sm"})}),e.jsx(F,{variant:"link",size:"sm",className:`py-0 ms-0 me-1 title ${k?"fw-bold text-white bg-transparent":""}`,title:g,onClick:M,disabled:O,children:s}),u>0&&e.jsxs(ve,{pill:!0,bg:"secondary",className:"d-inline bg-transparent",children:[u,"Q"]}),!O&&h&&se&&e.jsxs("div",{className:"position-absolute text-nowrap d-flex align-items-center border border-0 border-warning p-0 end-0",children:[u===0&&e.jsx("div",{className:"d-flex align-items-center",children:e.jsx(F,{variant:"link",size:"sm",className:"border-0 py-0 px-0 ms-0 text-success",title:"Add SubCategory",onClick:async()=>{!l&&(a||u>0)&&await j(),setTimeout(()=>H(!0),1e3)},children:e.jsx(ie,{icon:zt,size:"lg"})})}),!a&&e.jsxs("div",{className:"d-flex align-items-end",children:[e.jsx(F,{variant:"link",size:"sm",className:"d-flex align-items-end border border-0 border-warning p-0",title:"Add Question",onClick:async()=>{!l&&u>0&&await j(),setTimeout(()=>W(!0),500)},children:e.jsx("img",{width:"22",height:"18",src:tt,alt:"Add Question"})}),u===0&&e.jsx(F,{variant:"link",size:"sm",className:"d-flex align-items-end border border-0 border-warning p-0",disabled:a||u>0,onClick:A,children:e.jsx(ie,{icon:_e,size:"lg"})})]})]})]}),$&&e.jsx("div",{className:"ps-3",children:e.jsx(rt,{categoryRow:t})})]});return e.jsxs(e.Fragment,{children:[e.jsxs(te.Item,{className:"py-0 px-1 w-100 category-bg",as:"li",children:[k&&C===w.AddingCategory&&e.jsxs("div",{children:[e.jsx("div",{ref:Y,className:"",children:Z}),e.jsx("div",{className:"ms-0 d-md-none w-100",children:e.jsx(lt,{activeCategory:L})})]}),k&&C===w.EditingCategory&&e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:Y,children:Z}),e.jsx("div",{id:"divInLine",className:"ms-0 d-md-none w-100",children:e.jsx(it,{inLine:!1})})]}),k&&C===w.ViewingCategory&&e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:Y,children:Z}),e.jsx("div",{id:"divInLine",className:"ms-0 d-md-none w-100",children:e.jsx(Qe,{inLine:!1})})]}),k&&C===w.None&&e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:Y,children:Z}),e.jsx("div",{id:"divInLine",className:"ms-0 d-md-none w-100",children:e.jsx(Qe,{inLine:!1})})]}),!k&&e.jsx("div",{ref:Y,children:Z})]}),o.error&&o.whichRowId===g&&e.jsx("div",{className:"text-danger",children:o.error.message}),l&&e.jsx(te.Item,{className:"py-0 px-0 border-0 border-warning border-bottom-0 category-bg p-0 m-0",variant:"primary",as:"li",children:e.jsx("div",{className:"rambo",children:a&&e.jsx(Qt,{in:oe,children:e.jsx("div",{id:g+"-2",style:{marginTop:"1px"},children:e.jsx("div",{style:{border:"1px solid #ddd",borderRadius:"4px"},children:e.jsx(dt,{categoryRow:t,isExpanded:l})})})})})})]})},dt=({categoryRow:t})=>{const{level:i,categoryRows:g}=t,{state:s}=K();let{keyExpanded:a}=s;const{questionId:u}=a??{questionId:null};return e.jsx("div",{className:i>1?"ms-2":"",children:e.jsx(te,{as:"ul",variant:"dark",className:"mb-0 category-bg",children:g.map(l=>e.jsx(co,{categoryRow:l,questionId:u===""?null:u},l.id))})})},uo=t=>{const{isDarkMode:i}=le(),[g,s]=m.useState("");return m.useEffect(()=>{},[]),e.jsxs(B,{show:t.show,onHide:t.onHide,animation:!0,centered:!0,size:"lg",className:"modal show",contentClassName:`${i?"bg-secondary bg-gradient":"bg-info bg-gradient"}`,children:[e.jsx(B.Header,{closeButton:!0,children:"Store new Question to the Database"}),e.jsx(B.Body,{className:"py-0",children:e.jsx(Le,{closeModal:t.onHide,showCloseButton:!1,source:1,setError:a=>s(a)})}),e.jsx(B.Footer,{children:g})]})},go=({categoryId_questionId:t,fromChatBotDlg:i})=>{const{state:g,expandNodesUpToTheTree:s,loadTopRows:a,addCategory:u}=K(),{allCategoryRows:l,topRows:f,topRowsLoading:R,topRowsLoaded:h,keyExpanded:S,categoryId_questionId_done:o,nodeOpening:T,nodeOpened:N,activeCategory:Q,activeQuestion:q,formMode:I,loadingCategories:G,loadingCategory:P,loadingQuestions:C,loadingQuestion:L}=g,{searchQuestions:z,setLastRouteVisited:_,setChatBotDlgEnabled:k}=Ne(),{isDarkMode:O,chatBotDlgEnabled:$,lastRouteVisited:A}=le(),[j,oe]=m.useState(!1),[V,M]=m.useState({...be}),J=et(),H=async Y=>{J({type:r.SET_QUESTION_SELECTED,payload:{questionKey:Y}})};let ue="";m.useEffect(()=>{(async()=>!R&&!h&&(console.log("ZOVEM 111 loadTopRows()"),await a()))()},[R,h,a]),m.useEffect(()=>{(async()=>{if(!T&&h&&f.length>0){if(t){if(t==="add_question"){const Y=localStorage.getItem("New_Question");if(Y){const se=JSON.parse(Y);return M({...be,categoryTitle:"Select",...se}),oe(!0),localStorage.removeItem("New_Question"),null}}else if(t!==o){const Y=t.split("_"),se=Y[0],Z=Y[1],ne={topId:"",id:se,parentId:"ROOT"};console.log("zovem expandNodesUpToTheTree 1111111111111111111)",{categoryId_questionId:t},{categoryId_questionId_done:o}),await s(ne,Z!=="null"?Z:null,i==="from_chat"),console.log("zavrsio expandNodeUpToTheTree 1111111111111111111 DONE)",{categoryId_questionId:t})}}else if(S&&!N){const{topId:Y,categoryId:se,questionId:Z}=S;if(se!==""){const ne={topId:Y,id:se,parentId:"ROOT"};console.log("zovem expandNodeUpToTheTree 2222222222222)",{keyExpanded:S,catKey:ne}),await s(ne,Z),console.log("zavrsio expandNodeUpToTheTree 2222222222222 DONE)")}}$||k()}})()},[t,o,h,S,T,N,s,i,$,k]);const W="/knowledge/categories";return m.useEffect(()=>{A!==W&&_(W)},[A,_]),t!=="add_question"&&t&&t!==o?(console.log("zzzzzz loading...",{keyExpanded:S,categoryId_questionId:t,categoryId_questionId_done:o}),e.jsx("div",{children:"loading..."})):h?(console.log("===>>> Categories !!!!!!!!!!!!!!!!!",Q),e.jsxs(e.Fragment,{children:[e.jsxs(kt,{children:[e.jsxs("h5",{className:"text-warning mx-auto w-75 fw-bold",children:[e.jsx("span",{className:"categories",children:"Categories / "}),e.jsx("span",{className:"questions",children:"Questions"})]}),e.jsx(we,{className:`${O?"dark":""}`,children:e.jsx(Ee,{children:e.jsx("div",{className:"d-flex justify-content-start align-items-center",children:e.jsx("div",{className:"w-75 my-1 questions",children:e.jsx(Kt,{tekst:ue,onSelectQuestion:H,allCategoryRows:l,searchQuestions:z})})})})}),e.jsx(F,{variant:"secondary",size:"sm",type:"button",style:{padding:"1px 4px"},onClick:()=>u(null),children:"Add Category"}),e.jsxs(we,{className:"my-1 h-auto",children:[e.jsx(Ee,{xs:12,md:5,children:e.jsx("div",{className:"categories-border",style:{position:"relative"},children:e.jsx(dt,{categoryRow:{...Xe,categoryRows:f},isExpanded:!0})})}),e.jsx(Ee,{xs:0,md:7,children:e.jsxs("div",{id:"div-details",className:"d-none d-md-block",children:[Q&&I===w.ViewingCategory&&e.jsx(Qe,{inLine:!1}),Q&&I===w.EditingCategory&&e.jsx(it,{inLine:!1}),Q&&I===w.AddingCategory&&e.jsx(lt,{activeCategory:Q}),q&&I===w.ViewingQuestion&&e.jsx(at,{inLine:!1}),q&&I===w.EditingQuestion&&e.jsx(nt,{inLine:!1}),q&&I===w.AddingQuestion&&e.jsx(Le,{})]})})]})]}),j&&q&&e.jsx(uo,{show:j,onHide:()=>{oe(!1)},newQuestionRow:V}),(G||C)&&e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{position:"absolute",top:"40%",left:"20%"},children:e.jsx("div",{className:`spinner-border ${C?"question":"category"}-spinner`,role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})}),P&&e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{position:"absolute",top:"50%",left:"50%"},children:e.jsx("div",{className:"spinner-border category-spinner",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})}),L&&e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{position:"absolute",top:"50%",left:"50%"},children:e.jsx("div",{className:"spinner-border question-spinner",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})})]})):(console.log("===>>> Categories  VRATIO"),null)},xo=()=>{let{categoryId_questionId:t,fromChatBotDlg:i}=Dt();if(t&&t==="categories"&&(t=void 0),t){const g=t.split("_");console.assert(g.length===2,"expected 'categoryId_questionId'")}return e.jsx(Ht,{children:e.jsx(go,{categoryId_questionId:t,fromChatBotDlg:i})})};export{xo as default};
//# sourceMappingURL=Categories.js.map
