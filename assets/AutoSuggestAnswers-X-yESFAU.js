import{ap as S,n as r,S as p}from"./index-DHfea8iM.js";import{l as w,d as f,A as m,e as A,b as x,c as R}from"./lib-CmU9hHt-.js";const b=m;class y extends S.Component{state;isMob;allGroupRows;searchAnswers;debouncedLoadSuggestions;constructor(e){console.log("AutoSuggestAnswers CONSTRUCTOR"),super(e),this.state={value:e.tekst||"",suggestions:[],noSuggestions:!1,highlighted:""},this.allGroupRows=e.allGroupRows,this.searchAnswers=e.searchAnswers,this.isMob=w.isMobile,this.loadSuggestions=this.loadSuggestions.bind(this),this.debouncedLoadSuggestions=f(this.loadSuggestions,300)}async loadSuggestions(e){this.setState({isLoading:!0}),console.time();const t=await this.getSuggestions(e);console.timeEnd(),e===this.state.value?this.setState({isLoading:!1,suggestions:t,noSuggestions:t.length===0}):this.setState({isLoading:!1})}componentDidMount(){setTimeout(()=>{window.focus()},300)}render(){const{value:e,suggestions:t,noSuggestions:n}=this.state;return r.jsxs("div",{children:[r.jsx(b,{onSuggestionsClearRequested:this.onSuggestionsClearRequested,multiSection:!0,suggestions:t,onSuggestionsFetchRequested:this.onSuggestionsFetchRequested.bind(this),onSuggestionSelected:this.onSuggestionSelected.bind(this),getSuggestionValue:this.getSuggestionValue,renderSuggestion:this.renderSuggestion,renderSectionTitle:this.renderSectionTitle,getSectionSuggestions:this.getSectionSuggestions,onSuggestionHighlighted:this.onSuggestionHighlighted.bind(this),highlightFirstSuggestion:!1,renderInputComponent:this.renderInputComponent,focusInputOnSuggestionClick:!this.isMob,inputProps:{placeholder:"Type 'remote'",value:e,onChange:(o,g)=>this.onChange(o,g),autoFocus:!0}}),n&&r.jsx("div",{className:"no-suggestions",children:"No answers to suggest"})]})}async getSuggestions(e){const t=A(e.trim());if(t==="")return[];if(e.length<3)return[];const n=new Map,o=[];try{console.log("--------->>>>> getSuggestions");var g=await this.searchAnswers(t,10);g.forEach(s=>{const{topId:l,parentId:i,id:u,title:a,included:c}=s,h=new p(s).answerKey;if(!o.includes(h)){o.push(h);const d={topId:l,parentId:i,id:u,title:a,groupTitle:"",included:c};n.has(i)?n.get(i).push(d):n.set(i,[d])}})}catch(s){console.debug(s)}if(o.length===0)return[];try{let s=[];return n.forEach((l,i)=>{const u={id:i,groupTitle:"",groupParentTitle:"kuro",parentGroupUp:"",answerRows:[]};if(i!==null){const a=this.allGroupRows.get(i);if(a){const{title:c,titlesUpTheTree:h}=a;u.groupTitle=c,u.parentGroupUp=h}else alert(`${i} Not found in allGrps`)}l.forEach(a=>{u.answerRows.push(a)}),s.push(u)}),s}catch(s){console.log(s)}return[]}onSuggestionsClearRequested=()=>{this.setState({suggestions:[],noSuggestions:!1})};onSuggestionSelected(e,t){e.preventDefault();const n=t.suggestion,{topId:o,parentId:g,id:s}=n;this.props.onSelectAnswer({topId:o,parentId:g,id:s},this.state.value)}renderSuggestion(e,t){const n=x(e.title,t.query),o=R(e.title,n);return r.jsx("span",{className:"d-inline-block text-trunGrpe",style:{textAlign:"left"},children:o.map((g,s)=>{const l=g.highlight?"react-autosuggest__suggestion-match":void 0;return r.jsx("span",{className:`${l??""}`,children:g.text},s)})})}renderSectionTitle(e){const{parentGroupUp:t}=e;return r.jsx("span",{children:t})}renderInputComponent(e){const{ref:t,...n}=e;return r.jsx("div",{children:r.jsx("input",{ref:t,autoFocus:!0,...n})})}onChange(e,{newValue:t}){e.preventDefault(),this.setState({value:t})}async onSuggestionsFetchRequested({value:e}){return this.debouncedLoadSuggestions(e)}getSuggestionValue(e){return e.title}getSectionSuggestions(e){return e.answerRows}onSuggestionHighlighted(e){this.setState({highlighted:e.suggestion})}}export{y as A};
//# sourceMappingURL=AutoSuggestAnswers-X-yESFAU.js.map
