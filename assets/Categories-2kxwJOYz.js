const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AssignedAnswers-F4_gXOpU.js","assets/index-5dDZY0eH.js","assets/index-CykrPP6v.css","assets/Options-Bfy4OEtG.js","assets/lib-DU7tqqxx.js","assets/AutoSuggestAnswers-DaJa3pDe.js","assets/AutoSuggestAnswers-vl2QUoNQ.css","assets/AutoSuggestQuestions-BWP189F4.js","assets/AutoSuggestQuestions-DN6HBK-e.css"])))=>i.map(i=>d[i]);
import{A as s,d as wt,a as ht,b as Ct,F as x,I as xe,u as Oe,c as ae,r as E,C as _e,e as fe,f as le,g as Pe,h as Rt,Q as Ue,i as ye,j as Tt,k as Ce,l as St,m as _t,n as e,B as z,_ as Nt,o as Me,R as Ee,D as we,p as pe,q as jt,s as vt,t as It,v as Ot}from"./index-5dDZY0eH.js";import{L as oe,F as de,f as $e,a as Be,u as Re,B as Te,b as Ve,c as Ke,d as ze,e as Ne,g as v,S as Qe,h as je,s as Qt,i as At,C as Ye,j as We,Q as He,k as Ae,l as bt,m as Dt,n as kt,o as Lt,p as qt,M as he}from"./Options-Bfy4OEtG.js";import{f as Gt,a as Ft}from"./lib-DU7tqqxx.js";import{A as Pt}from"./AutoSuggestQuestions-BWP189F4.js";const ve={topId:"",parentId:"null",id:"generateId",categoryTitle:"",title:"",assignedAnswers:[],numOfAssignedAnswers:0,relatedFilters:[],numOfRelatedFilters:0,source:0,status:0,included:!1},Xe={topId:"null",parentId:"null",id:"define at BackEnd",kind:0,title:"",link:"",header:"",level:0,variations:[],hasSubCategories:!1,categoryRows:[],questionRows:[],numOfQuestions:0,hasMoreQuestions:!1,isExpanded:!1,doc1:""},Ut=(t,r)=>{console.log("------------------------------->"),console.log("------------------------------->",r.type),console.log("------------------------------->");const{categoryRow:u}=r.payload;if(r.type===s.SET_KEY_EXPANDED){const{keyExpanded:p}=r.payload;return{...t,keyExpanded:p,nodeOpened:p===null?!0:t.nodeOpened}}let o=u?!wt.includes(r.type):!1;const{topRows:c}=t,a=ht.includes(r.type)?{...t}:Mt(t,r);if(o&&u){let p;const{topId:h,id:C}=u;if(C===h)p=c.map(R=>R.id===h?new J(u).categoryRow:new J(R).categoryRow);else{const R=c.find(f=>f.id===h);J.idToSet=r.type==="SET_CATEGORY_ADDED"?"generateId":C,J.newCategoryRow=u;const i=new J(R).categoryRow;p=c.map(f=>f.id===h?i:new J(f).categoryRow),J.idToSet=""}a.topRows=p}if(Ct.includes(r.type)){const{keyExpanded:p}=a,h={keyExpanded:p};localStorage.setItem("CATEGORIES_STATE",JSON.stringify(h))}return console.log("CategoryReducer newState",a),a},Mt=(t,r)=>{switch(r.type){case s.SET_TOP_ROWS_LOADING:return{...t,loadingCategories:!0,topRowsLoading:!0,topRowsLoaded:!1};case s.SET_TOP_ROWS:{const{topRows:o}=r.payload;return console.log("=> CategoriesReducer ActionTypes.SET_TOP_ROWS",t.topRows,o),{...t,topRows:o,topRowsLoading:!1,topRowsLoaded:!0,loadingCategories:!1}}case s.SET_ALL_CATEGORY_ROWS:{const{allCategoryRows:o}=r.payload;return{...t,allCategoryRows:o,allCategoryRowsLoaded:Date.now()}}case s.SET_NODE_EXPANDING_UP_THE_TREE:{const{categoryId_questionId_done:o}=r.payload;return{...t,categoryId_questionId_done:o,nodeOpening:!0,loadingCategories:!0,nodeOpened:!1,activeCategory:null,activeQuestion:null}}case s.SET_NODE_EXPANDED_UP_THE_TREE:{const{category:o,questionId:c,question:a}=r.payload;return{...t,activeCategory:o,activeQuestion:a,selectedQuestionId:c,nodeOpening:!1,nodeOpened:!0,loadingCategories:!1}}case s.SET_LOADING_CATEGORY:return{...t,loadingCategory:!0,categoryLoaded:!1};case s.FORCE_OPEN_NODE:const{keyExpanded:u}=r.payload;return alert("FORCE_OPEN_NODE is deprecated, use SET_QUESTION_SELECTED instead"),{...t,topRows:t.topRows.filter(o=>o.parentId===null),keyExpanded:u,nodeOpened:!1,activeCategory:null,activeQuestion:null,selectedQuestionId:null};case s.SET_SUB_CATEGORIES:return{...t,loadingCategory:!1};case s.SET_ERROR:{const{error:o,whichRowId:c}=r.payload;return{...t,error:o,whichRowId:c,loadingCategories:!1,loadingQuestions:!1,loadingCategory:!1,categoryLoaded:!1,loadingQuestion:!1,questionLoaded:!1}}case s.SET_CATEGORY:{const{categoryRow:o}=r.payload;return console.assert(xe(o)),{...t,loadingCategory:!1,categoryLoaded:!0,activeCategory:o,activeQuestion:null,selectedQuestionId:null}}case s.SET_ROW_EXPANDING:return{...t,rowExpanding:!0,rowExpanded:!1,loadingCategories:!0};case s.SET_ROW_EXPANDED:{const{categoryRow:o}=r.payload,{topId:c,id:a}=o,{keyExpanded:p}=t,h=p?p.questionId:null;return{...t,loadingCategories:!1,keyExpanded:{topId:c,categoryId:a,questionId:h},activeQuestion:null,selectedQuestionId:h,loadingQuestion:!1,questionLoaded:!1,rowExpanding:!1,rowExpanded:!0}}case s.SET_ROW_COLLAPSED:{const{categoryRow:o}=r.payload,{topId:c,parentId:a}=o;return{...t,loadingCategories:!1,keyExpanded:{topId:c,categoryId:a??"",questionId:null},rowExpanding:!1,rowExpanded:!0,activeCategory:null,activeQuestion:null,selectedQuestionId:null}}case s.SET_CATEGORY_TO_VIEW:{const{categoryRow:o}=r.payload;console.assert(xe(o));const a={...o,isExpanded:!1};return{...t,formMode:x.ViewingCategory,loadingCategory:!1,activeCategory:a,activeQuestion:null,selectedQuestionId:null,error:void 0}}case s.SET_CATEGORY_TO_ADD_TOP:{const{newCategoryRow:o}=r.payload;return{...t,loadingCategory:!1,categoryLoaded:!0,activeCategory:{...o,doc1:""},activeQuestion:null,selectedQuestionId:null,topRows:[o,...t.topRows],formMode:x.AddingCategory}}case s.SET_CATEGORY_TO_ADD:{const{newCategoryRow:o}=r.payload;return{...t,loadingCategory:!1,categoryLoaded:!0,activeCategory:{...o,doc1:""},activeQuestion:null,selectedQuestionId:null,formMode:x.AddingCategory}}case s.SET_CATEGORY_ADDED:{const{categoryRow:o}=r.payload;console.assert(xe(o));const a={...o,isExpanded:!1},{topId:p,id:h}=a;return{...t,formMode:x.EditingCategory,loadingCategory:!1,categoryLoaded:!1,activeCategory:a,activeQuestion:null,selectedQuestionId:null,keyExpanded:{topId:p,categoryId:h,questionId:null}}}case s.SET_CATEGORY_TO_EDIT:case s.SET_CATEGORY_UPDATED:{const{categoryRow:o,category:c}=r.payload;console.assert(xe(o));const{topId:a,id:p}=c;return{...t,formMode:x.EditingCategory,loadingCategory:!1,categoryLoaded:!0,keyExpanded:{topId:a,categoryId:p,questionId:null},activeCategory:c,activeQuestion:null,selectedQuestionId:null,error:void 0}}case s.SET_CATEGORY_QUESTIONS_LOADING:return{...t,loadingQuestions:!0,questionLoaded:!1};case s.CATEGORY_QUESTIONS_LOADED:return{...t,loadingQuestions:!1};case s.DELETE_CATEGORY:return{...t,activeCategory:null,formMode:x.None,error:void 0,whichRowId:void 0};case s.CANCEL_CATEGORY_FORM:case s.CLOSE_CATEGORY_FORM:return{...t,activeCategory:null,formMode:x.None};case s.CANCEL_ADD_SUB_CATEGORY:return{...t,activeCategory:null,activeQuestion:null,selectedQuestionId:null,formMode:x.None};case s.SET_LOADING_QUESTION:return{...t,loadingQuestion:!0,questionLoaded:!1};case s.CANCEL_ADD_QUESTION:return{...t,formMode:x.None,activeQuestion:null,selectedQuestionId:null};case s.SET_QUESTION_SELECTED:{const{questionKey:o}=r.payload,{topId:c,parentId:a,id:p}=o;return{...t,topRows:t.topRows.filter(h=>h.parentId===null),keyExpanded:{topId:c,categoryId:a,questionId:p},activeCategory:null,activeQuestion:null,selectedQuestionId:null}}case s.ADD_NEW_QUESTION_TO_ROW:{const{newQuestionRow:o}=r.payload;return{...t,selectedQuestionId:o.id}}case s.SET_QUESTION:{const{question:o,formMode:c}=r.payload;return console.log(s.SET_QUESTION,o),{...t,activeCategory:null,activeQuestion:o,formMode:c,error:void 0,loadingCategory:!1,loadingQuestion:!1,questionLoaded:!0}}case s.SET_QUESTION_AFTER_ASSIGN_ANSWER:{const{question:o}=r.payload;return{...t,activeQuestion:o,loadingQuestion:!1,questionLoaded:!0}}case s.SET_QUESTION_TO_VIEW:{const{question:o}=r.payload,{keyExpanded:c}=t;return{...t,formMode:x.ViewingQuestion,keyExpanded:c,activeQuestion:o,loadingQuestion:!1,questionLoaded:!0}}case s.SET_QUESTION_TO_EDIT:{const{question:o}=r.payload,{topId:c,id:a,parentId:p}=o;return{...t,keyExpanded:{topId:c,categoryId:p,questionId:a},activeQuestion:o,formMode:x.EditingQuestion,selectedQuestionId:o.id,loadingQuestion:!1,questionLoaded:!0}}case s.QUESTION_DELETED:return{...t,activeQuestion:null,selectedQuestionId:null,formMode:x.None,loadingQuestion:!1,questionLoaded:!0};case s.CANCEL_QUESTION_FORM:case s.CLOSE_QUESTION_FORM:return{...t,formMode:x.None,activeQuestion:null,selectedQuestionId:null};default:return alert(`Action ${r.type} not allowed`),{...t}}};class J{static idToSet;static newCategoryRow;constructor(r){const{topId:u,id:o,parentId:c,title:a,link:p,kind:h,header:C,level:R,variations:i,numOfQuestions:f,hasSubCategories:D,categoryRows:j,created:Q,modified:P,questionRows:A,isExpanded:Y}=r,T=j.map(I=>(console.log("DeepClone >>>>>>>>>>>>>>>",I.id),I.id===J.idToSet?{...J.newCategoryRow}:new J(I).categoryRow));this.categoryRow={topId:u,parentId:c,id:o,kind:h,title:a,link:p,header:C,level:R,hasSubCategories:D,categoryRows:T,numOfQuestions:f,questionRows:A,variations:i??[],created:Q,modified:P,isExpanded:Y}}categoryRow}const Je=E.createContext({}),Ze=E.createContext(()=>null),$t={formMode:x.None,allCategoryRows:new Map,allCategoryRowsLoaded:void 0,topRows:[],topRowsLoading:!1,topRowsLoaded:!1,nodeOpening:!1,nodeOpened:!1,keyExpanded:null,categoryId_questionId_done:void 0,activeCategory:null,activeQuestion:null,selectedQuestionId:null,loadingCategories:!1,loadingQuestions:!1,loadingCategory:!1,categoryLoaded:!1,loadingQuestion:!1,questionLoaded:!1,error:void 0,rowExpanding:!1,rowExpanded:!1},Bt=({children:t})=>{const{loadAllCategoryRowsGlobal:r}=Oe(),u=ae(),{KnowledgeAPI:o,isAuthenticated:c,workspace:a,authUser:p,canEdit:h}=u,{nickName:C}=p,[R,i]=E.useReducer(Ut,$t),{formMode:f,activeCategory:D,activeQuestion:j,keyExpanded:Q,topRows:P,allCategoryRows:A,allCategoryRowsLoaded:Y}=R;console.log("----->>> ----->>> ----->>> CategoryProvider",P),E.useEffect(()=>{let l=a==="DEMO"?{topId:"MTS",categoryId:"REMOTECTRLS",questionId:"qqqqqq111"}:null;if("localStorage"in window){let n=localStorage.getItem("CATEGORIES_STATE");if(console.log("CATEGORIES_STATE loaded before signIn",n),n!==null){const y=JSON.parse(n);y.keyExpanded!==null&&(l=y.keyExpanded)}}i({type:s.SET_KEY_EXPANDED,payload:{keyExpanded:l}})},[a]);const T=E.useCallback(async(l,n,y=null,g=void 0)=>{const d=localStorage.getItem("accessToken");if(d)try{console.log("------Execute endpoint:",n);let m=null;const w=new Headers,_=`Bearer ${d}`;w.append("Authorization",_),y&&w.append("Content-Type","application/json");let q={method:l,headers:w,body:y?JSON.stringify(y):null};if(m=await fetch(n,q),m.ok){if(m.status===200||m.status===201){let H=null;try{H=await m.json()}catch{i({type:s.SET_ERROR,payload:{error:new Error(`Response status: ${m.status}`),whichRowId:g}})}finally{return H}}}else{const{errors:H}=await m.json(),B=new Error(H?.map(ee=>ee.message).join(`
`)??"unknown");i({type:s.SET_ERROR,payload:{error:B,whichRowId:g}})}}catch(m){console.log("-------------->>> execute",l,n,m),i({type:s.SET_ERROR,payload:{error:new Error("fetch eror"),whichRowId:g}})}return null},[]),I=E.useCallback(async()=>new Promise(async l=>{const n=await r();i(n?{type:s.SET_ALL_CATEGORY_ROWS,payload:{allCategoryRows:n}}:{type:s.SET_ERROR,payload:{error:new Error("Zajeb allCategoryRows")}}),l(n)}),[r]),U=E.useCallback(async l=>{try{return A.get(l)}catch(n){console.log(n),i({type:s.SET_ERROR,payload:{error:n}})}},[A]);E.useEffect(()=>{(async()=>await I())()},[I]);const N=E.useCallback(async l=>{try{let n="";const y=[];return A.forEach((g,d)=>{d===l?n="":g.parentId===l&&y.push(g)}),{subCats:y,parentHeader:n}}catch(n){return console.log(n),i({type:s.SET_ERROR,payload:{error:n}}),{subCats:[],parentHeader:"Kiks subCats"}}},[A]),V=E.useCallback(async()=>new Promise(async l=>{try{i({type:s.SET_TOP_ROWS_LOADING,payload:{}});const n=`${o.endpointCategoryRow}/${a}/toprows`;console.log("CategoryProvider loadTopRows url:",n),console.log("loadTopRows AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"),console.time(),await T("GET",n).then(y=>{console.timeEnd(),console.log("loadTopRows BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB");const g=y.map(d=>(d.IsExpanded=Q?d.Id===Q.categoryId:!1,new _e(d).categoryRow));i({type:s.SET_TOP_ROWS,payload:{topRows:g}}),l(!0)})}catch(n){console.log(n),i({type:s.SET_ERROR,payload:{error:n}})}}),[T,o.endpointCategoryRow,Q,a]),k=E.useCallback(async(l,n)=>{const{topId:y,id:g}=l;return console.log({categoryKey:l,includeQuestionId:n}),new Promise(async d=>{try{const m=`${o.endpointCategory}/${a}/${y}/${g}/${ie}/${n}`;console.time(),console.log("================ getCategory ======================="),await T("GET",m).then(w=>{console.timeEnd();const{categoryDto:_,msg:q}=w;d(_?new fe(_).category:new Error(q))})}catch(m){console.log(m),d(m)}})},[T,o.endpointCategory,a]),b=E.useCallback(async(l,n)=>{if(l.topId===n)return l;const{categoryRows:y}=l;let g=y.find(d=>d.id===n);if(!g)for(const d of y){const m=await b(d,n);if(m){g=m,console.log("findCategory Stop the loop for: "+n);break}}return g},[]),L=E.useCallback(async(l,n,y=!1)=>new Promise(async g=>{try{let{topId:d,parentId:m,id:w}=l;if(console.assert(w!==null,"id ne sme biti null u expandNodesUpToTheTree"),w){const B=A.get(w);B?(d=B.topId,m=B.parentId):alert("reload all categoryRow:"+w)}i({type:s.SET_NODE_EXPANDING_UP_THE_TREE,payload:{fromChatBotDlg:y,categoryId_questionId_done:`${w}_${n}`}}),console.time();const _={topId:d,id:w,parentId:null},q=new le(_).toQuery(a),H=`${o.endpointCategoryRow}?${q}&pageSize=${ie}&includeQuestionId=${n??null}`;await T("GET",H).then(async B=>{const{categoryRowDto:ee}=B;if(console.timeEnd(),ee){let ce=null,ue=null,ge=new _e(ee).categoryRow;if(m!==null){const qe=await b(ge,w);if(ce={...qe,doc1:""},n){const Ge=qe.questionRows.find(Fe=>Fe.id===n&&Fe.included);Ge&&(ce=null,ue={...Ge,assignedAnswers:[],numOfAssignedAnswers:0,numOfRelatedFilters:0,relatedFilters:[],source:0,status:0})}}console.log(">>> expandNodeUpToTheTree categoryRow",{categoryRow:ge,questionId:"'"+(n??"jok")+"'"+(n??"JOK")});const Se=n?h?x.EditingQuestion:x.ViewingQuestion:h?x.EditingCategory:x.ViewingCategory;i({type:s.SET_NODE_EXPANDED_UP_THE_TREE,payload:{catKey:l,categoryRow:ge,category:ce,questionId:n??null,question:ue,formMode:Se,fromChatBotDlg:y}}),g(!0)}else g(!1)})}catch(d){console.log(d),i({type:s.SET_ERROR,payload:{error:d}})}}),[a,o.endpointCategoryRow,T,A,b,h]),M=E.useCallback(async(l,n=!1,y=null)=>{const g=new le(l).toQuery(a);return new Promise(async d=>{try{const m=`${o.endpointCategoryRow}/${n}/${ie}/${y}?${g}`;console.time(),await T("GET",m).then(w=>{console.timeEnd();const{categoryRowDto:_,msg:q}=w;d(_?new _e(_).categoryRow:new Error(q))})}catch(m){console.log(m),d(m)}})},[T,o.endpointCategoryRow,a]),G=E.useCallback(async({categoryKey:l,includeQuestionId:n,newQuestionRow:y,formMode:g})=>{try{i({type:s.SET_ROW_EXPANDING,payload:{}});const d=await M(l,!0,n);if(d instanceof Error)i({type:s.SET_ERROR,payload:{error:d}}),console.error({cat:d});else{let m;return n&&d.questionRows.filter(w=>w.included).length>0&&(m=n),y&&(d.questionRows=[y,...d.questionRows]),d.isExpanded=!0,console.log("@@@@@@@@@@@@@@@@@ expandCategory:",g,n),g===x.None&&n&&(g=h?x.EditingQuestion:x.ViewingQuestion),i({type:s.SET_ROW_EXPANDED,payload:{categoryRow:d,formMode:g,selectedQuestionId:m}}),d}}catch(d){return console.log("error",d),i({type:s.SET_ERROR,payload:{error:d}}),null}},[h,M]),Z=E.useCallback(async l=>{const{topId:n,id:y}=l,g=P.find(m=>m.id===n),d=await b(g,y);d?(l={...d,isExpanded:!1,categoryRows:[],questionRows:[]},i({type:s.SET_ROW_COLLAPSED,payload:{categoryRow:l}})):i({type:s.SET_ERROR,payload:{error:new Error("findCategory sranje"),whichRowId:y}})},[b,P]),S=E.useCallback(async l=>{try{i({type:s.CLOSE_CATEGORY_FORM,payload:{}});const{topId:n,id:y,level:g}=l??{topId:"generateId",id:"generateId",level:0},d={...Xe,topId:n,parentId:l?y:null,id:"generateId",level:g+1,title:"New Category",isExpanded:!1};if(l===null)i({type:s.SET_CATEGORY_TO_ADD_TOP,payload:{newCategoryRow:d}});else{const m={...l,level:g+1,categoryRows:[d,...l.categoryRows],hasSubCategories:!0,isExpanded:!0};i({type:s.SET_CATEGORY_TO_ADD,payload:{categoryRow:m,newCategoryRow:{...d,title:""}}})}}catch(n){console.log("error",n),i({type:s.SET_ERROR,payload:{error:n}})}},[]),K=E.useCallback(async()=>{try{const l=D;l&&i({type:s.CANCEL_ADD_SUB_CATEGORY,payload:{categoryRow:l}})}catch(l){console.log("error",l),i({type:s.SET_ERROR,payload:{error:l}})}},[D,G]),se=E.useCallback(async l=>{const{id:n}=l;i({type:s.SET_LOADING_CATEGORY,payload:{}});try{const y=new Pe(l,a).categoryDto;console.log("categoryDto",{categoryDto:y});const g=`${o.endpointCategory}`;console.time(),await T("POST",g,y,n).then(async d=>{console.timeEnd();const{categoryDto:m}=d;if(m){const w=new fe(m).category;console.log("Category successfully created",{category:w}),i({type:s.CLOSE_CATEGORY_FORM,payload:{}}),A.set(w.id,{...w,isExpanded:!1}),w.parentId===null?i({type:s.SET_CATEGORY_ADDED,payload:{categoryRow:w}}):i({type:s.SET_CATEGORY_ADDED,payload:{categoryRow:w}})}})}catch(y){console.log(y),i({type:s.SET_ERROR,payload:{error:new Error("Server Error"),whichRowId:n}})}},[T,o.endpointCategory,I,V,a]),O=E.useCallback(async()=>{try{const{topId:l,parentId:n}=j,g={categoryKey:{topId:l,parentId:n,id:n},formMode:x.None},d=await G(g);d&&i({type:s.CANCEL_ADD_QUESTION,payload:{categoryRow:d}})}catch(l){console.log("error",l),i({type:s.SET_ERROR,payload:{error:l}})}},[j,G]),F=E.useCallback(async(l,n)=>{f===x.AddingQuestion?await O():f===x.AddingCategory&&await K(),i({type:s.SET_LOADING_CATEGORY,payload:{categoryRow:l}});const y=new le(l).categoryKey,g=await k(y,n);g instanceof Error?i({type:s.SET_ERROR,payload:{error:g}}):(g.topId=l.topId,i({type:s.SET_CATEGORY_TO_VIEW,payload:{categoryRow:g}}))},[K,O,f,k]),X=E.useCallback(async(l,n)=>{f===x.AddingQuestion?await O():f===x.AddingCategory&&await K(),i({type:s.SET_LOADING_CATEGORY,payload:{}});const y=new le(l).categoryKey,g=await k(y,n);if(g instanceof Error)i({type:s.SET_ERROR,payload:{error:g}});else{const d={...g,isExpanded:!1,categoryRows:[],questionRows:[]};i({type:s.SET_CATEGORY_TO_EDIT,payload:{categoryRow:d,category:g}})}},[K,O,f,k]),W=E.useCallback(async l=>{i({type:s.SET_LOADING_CATEGORY,payload:{}});try{const n=new Pe(l,a).categoryDto,y=`${o.endpointCategory}`;console.time(),await T("PUT",y,n).then(g=>{console.timeEnd();const{categoryDto:d,msg:m}=g;if(d){const w=new fe(d).category,{topId:_}=w;w.isExpanded=!1,w.topId=_,i({type:s.SET_CATEGORY_UPDATED,payload:{category:w}})}else i({type:s.SET_ERROR,payload:{error:new Error(`${m}`)}})})}catch(n){return console.log(n),i({type:s.SET_ERROR,payload:{error:new Error("Karambol")}}),n}},[T,o.endpointCategory,a]),ne=E.useCallback(async l=>{try{const{topId:n,parentId:y}=l,g=new Rt(l,a).categoryRowDto,d=`${o.endpointCategory}`;console.time(),await T("DELETE",d,g).then(async m=>{console.timeEnd();const{categoryDto:w,msg:_}=m;_==="OK"?(console.log("Category successfully deleted",{categoryRow:l}),await I().then(async()=>{const q={categoryKey:{topId:n,parentId:"",id:y},formMode:x.None};y?await V():await G(q).then(()=>{})})):i(_==="HasSubCategories"?{type:s.SET_ERROR,payload:{error:new Error("First remove sub categories"),whichRowId:w.Id}}:_==="HasQuestions"?{type:s.SET_ERROR,payload:{error:new Error("First remove category questions"),whichRowId:w.Id}}:{type:s.SET_ERROR,payload:{error:new Error(_),whichRowId:w.Id}})})}catch(n){return console.log(n),n}},[T,o.endpointCategory,G,I,V,a]),re=async(l,n)=>{try{console.log("Deleting Category Tag...",{categoryKey:l,variationName:n}),console.log("Category Tag successfully deleted")}catch(y){console.log("error",y),i({type:s.SET_ERROR,payload:{error:y}})}},ie=12,lt=E.useCallback(async({categoryKey:l,startCursor:n,includeQuestionId:y})=>{try{const{topId:g,id:d}=l;i({type:s.SET_CATEGORY_QUESTIONS_LOADING,payload:{}});try{const m=`${o.endpointQuestion}/${a}/${g}/${d}/${n}/${ie}/${y}`;console.time(),await T("GET",m).then(w=>{console.timeEnd();const{categoryDto:_}=w;if(_!==null){const q=new fe(_).category;i({type:s.CATEGORY_QUESTIONS_LOADED,payload:{categoryRow:q}})}})}catch(m){console.log(m),i({type:s.SET_ERROR,payload:{error:m}})}}catch(g){console.log(g),i({type:s.SET_ERROR,payload:g})}},[T,o.endpointQuestion,a]),dt=E.useCallback(async l=>{try{const{topId:n,id:y}=l;let g=await U(y);if(!g){alert(`Not found ${y}. Reload all Categories`);return}const d={topId:n,parentId:l.id,id:"generateId",title:"question text",categoryTitle:g.title,numOfAssignedAnswers:0,included:!0},m={...ve,...d,title:""},w=R.topRows.find(q=>q.id===n),_=await b(w,y);i({type:s.ADD_NEW_QUESTION_TO_ROW,payload:{categoryRow:{..._,questionRows:[d,..._.questionRows]},newQuestionRow:d}}),i({type:s.SET_QUESTION,payload:{question:m,formMode:x.AddingQuestion}})}catch(n){console.log("error",n),i({type:s.SET_ERROR,payload:{error:n}})}},[G,b,U,R.topRows]),ct=E.useCallback(async l=>{const{topId:n,id:y,parentId:g}=l;i({type:s.SET_LOADING_CATEGORY,payload:{}});try{l.created.nickName=C;const d=new Ue(l,a).questionDto,m=`${o.endpointQuestion}`;console.time(),console.log(">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> createQuestion",d),await T("POST",m,d).then(async w=>{if(console.timeEnd(),w){console.log("::::::::::::::::::::",{questionDtoEx:w});const{questionDto:_}=w;if(_){const q=new ye(_).question;q.topId=n,console.log("Question successfully created"),await I().then(async()=>{const B={categoryKey:{topId:n,parentId:g,id:g},formMode:x.EditingQuestion};await G(B).then(()=>{i({type:s.SET_QUESTION,payload:{formMode:x.EditingQuestion,question:q}})})})}}})}catch(d){console.log(d),i({type:s.SET_ERROR,payload:{error:new Error("Server Error"),whichRowId:y}})}},[T,o.endpointQuestion,G,I,C,a]),ut=E.useCallback(async(l,n,y)=>{const{id:g}=n;try{n.modified.nickName=C;const d=new Ue(n,a).questionDto,m=`${o.endpointQuestion}`;console.time(),d.oldParentId=l,console.log(">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> updateQuestion",d);let w=null;return await T("PUT",m,d).then(async _=>{console.timeEnd();const{questionDto:q,msg:H}=_;if(q){w=new ye(q).question,console.log("Question successfully updated: ",w);const{topId:B,parentId:ee}=w;if(y){const{topId:ce,parentId:ue,id:ge}=w,Se={topId:ce,categoryId:ue,questionId:ge};i({type:s.FORCE_OPEN_NODE,payload:{keyExpanded:Se}})}else{const ue={categoryKey:{topId:B,parentId:ee,id:ee},formMode:x.EditingQuestion};await G(ue).then(()=>{i({type:s.SET_QUESTION,payload:{formMode:x.EditingQuestion,question:w}})})}}else i({type:s.SET_ERROR,payload:{error:new Error(H)}})}),w}catch(d){console.log(d),i({type:s.SET_ERROR,payload:{error:new Error("Server Error"),whichRowId:g}})}},[T,o.endpointQuestion,G,C,a]),gt=E.useCallback(async(l,n)=>{const{id:y,parentId:g,topId:d}=l;i({type:s.SET_LOADING_QUESTION,payload:{}});try{const m=new Tt(l,a).questionRowDto,w=`${o.endpointQuestion}`;console.time(),await T("DELETE",w,m).then(async _=>{const{questionDto:q}=_;if(console.timeEnd(),q){const H=new ye(q).question;console.log("Question successfully deleted"),n&&i({type:s.QUESTION_DELETED,payload:{question:H}});const ee={categoryKey:{topId:d,parentId:g,id:g},formMode:x.None};await G(ee).then(()=>{})}else console.error(_),i({type:s.SET_ERROR,payload:{error:new Error("Server Error"),whichRowId:y}})})}catch(m){console.log(m),i({type:s.SET_ERROR,payload:{error:new Error("Server Error"),whichRowId:y}})}},[T,o.endpointQuestion,G,a]),me=E.useCallback(async l=>new Promise(async n=>{try{const y=new Ce(l).toQuery(a),g=`${o.endpointQuestion}?${y}`;console.time(),console.log("getQuestion",l),await T("GET",g).then(d=>{console.timeEnd();const{questionDto:m,msg:w}=d;if(m){const _={question:new ye(m).question,msg:w};n(_)}else n({question:null,msg:w})})}catch(y){console.log(y),n({question:null,msg:"Problemos"})}}),[T,o.endpointQuestion,a]),yt=E.useCallback(async l=>{const n=new Ce(l).questionKey;i({type:s.SET_LOADING_QUESTION,payload:{}});const y=await me(n);f===x.AddingQuestion?await O():f===x.AddingCategory&&await K();const{question:g,msg:d}=y;g?(g.topId=l.topId,i({type:s.SET_QUESTION_TO_VIEW,payload:{question:g}})):i({type:s.SET_ERROR,payload:{error:new Error(d)}})},[K,O,f,me]),pt=E.useCallback(async l=>{const n=new Ce(l).questionKey;f===x.AddingQuestion?await O():f===x.AddingCategory&&await K(),i({type:s.SET_LOADING_QUESTION,payload:{}}),console.log("editQuestion:",n);const y=await me(n),{question:g,msg:d}=y;g?(g.topId=l.topId,i({type:s.CLOSE_QUESTION_FORM,payload:{question:g}}),i({type:s.SET_QUESTION_TO_EDIT,payload:{question:g}})):i({type:s.SET_ERROR,payload:{error:new Error(d)}})},[K,O,f,me]),Et=E.useCallback(async(l,n,y)=>{try{var{topId:g,id:d}=y,m={topId:g,id:d,created:{time:new Date,nickName:C}};const w=new St(m).assignedAnswerDto;w.QuestionKeyDto=new _t(n,a).dto;let _=null;const q=`${o.endpointQuestionAnswer}/${l}`;console.time(),await T("POST",q,w).then(async H=>{console.timeEnd();const{questionDto:B}=H;console.log("::::::::::::::::::::",{questionDtoEx:H}),B&&(_=new ye(B).question,console.log("Question successfully modified"))}),_&&i({type:s.SET_QUESTION_AFTER_ASSIGN_ANSWER,payload:{question:_}})}catch(w){console.log("error",w),i({type:s.SET_ERROR,payload:{error:w}})}},[T,o.endpointQuestionAnswer,C,a]),mt=E.useCallback(async(l,n,y)=>{const g=P.find(m=>m.id===l);let d=await b(g,n);console.log("PROVIDER onCategoryTitleChanged::",d.title,y),d.title!==y&&(d.title=y===""?"New Category":y,i({type:s.RE_RENDER_TREE,payload:{categoryRow:d}}))},[b,P]),xt=E.useCallback(async(l,n,y)=>{const{parentId:g,id:d}=n,m=await b(l,g);if(m){const w=m.questionRows.find(_=>_.id===d);w.title=y,console.log("onQuestionTitleChanged+++>>>",d,m),i({type:s.QUESTION_TITLE_CHANGED,payload:{categoryRow:m}})}},[b]),ft={state:R,loadAllCategoryRows:I,getSubCats:N,getCat:U,expandNodesUpToTheTree:L,loadTopRows:V,addSubCategory:S,cancelAddCategory:K,createCategory:se,viewCategory:F,editCategory:X,updateCategory:W,deleteCategory:ne,deleteCategoryVariation:re,expandCategory:G,collapseCategory:Z,onCategoryTitleChanged:mt,loadCategoryQuestions:lt,addQuestion:dt,cancelAddQuestion:O,createQuestion:ct,viewQuestion:yt,editQuestion:pt,updateQuestion:ut,deleteQuestion:gt,onQuestionTitleChanged:xt,assignQuestionAnswer:Et};return!c||!Y?null:e.jsx(Je.Provider,{value:ft,children:e.jsx(Ze.Provider,{value:i,children:t})})};function $(){return E.useContext(Je)}const be=()=>E.useContext(Ze);var te=(t=>(t.SET_LOADING="SET_LOADING",t.SET_SUB_CATS="SET_SUB_CATS",t.SET_ERROR="SET_ERROR",t.SET_EXPANDED="SET_EXPANDED",t.SET_PARENT_CAT="SET_PARENT_CAT",t))(te||{});const Vt=({cat:t,dispatch:r,setParentCat:u,selId:o})=>{const{topId:c,parentId:a,id:p,title:h,level:C,isExpanded:R}=t,i={topId:c,parentId:a,id:p},f=Q=>{r({type:te.SET_EXPANDED,payload:{id:p,expanding:!R}})},D=Q=>{u(Q)},j=e.jsxs("div",{className:"d-flex justify-content-start align-items-center w-100 text-primary",children:[e.jsx(z,{variant:"link",size:"sm",className:"py-0 px-1",onClick:Q=>{f(),Q.stopPropagation(),Q.preventDefault()},title:"Expand",children:e.jsx(de,{icon:R?$e:Be,size:"lg"})}),e.jsx(z,{variant:"link",size:"sm",className:"py-0 mx-0 text-decoration-none",title:p,onClick:()=>D(t),children:h})]});return e.jsxs(e.Fragment,{children:[e.jsx(oe.Item,{variant:"primary",className:"py-0 px-1 w-100",as:"li",children:j}),R&&e.jsx(oe.Item,{className:"py-0 px-0",variant:"primary",as:"li",children:e.jsx(tt,{selId:o,level:C+1,categoryKey:i,setParentId:u})})]})},Kt={loading:!1,parentId:null,title:"",cats:[]},zt=(t,r)=>{switch(r.type){case te.SET_LOADING:return{...t,loading:!0};case te.SET_SUB_CATS:{const{subCats:u}=r.payload;return{...t,cats:t.cats.concat(u),loading:!1}}case te.SET_ERROR:{const{error:u}=r.payload;return{...t,error:u,loading:!1}}case te.SET_EXPANDED:{const{id:u,expanding:o}=r.payload;let{cats:c}=t;if(!o){const a=et(c,u);console.log("clean:",a),a.length>0&&(c=c.filter(p=>!a.includes(p.id)))}return{...t,cats:t.cats.map(a=>a.id===u?{...a,isExpanded:o}:a)}}case te.SET_PARENT_CAT:{const{cat:u}=r.payload,{id:o,title:c}=u;return{...t,parentId:o,title:c}}default:return t}};function et(t,r){let u=t.filter(o=>o.parentId===r).map(o=>o.id);return u.forEach(o=>{const c=o?et(t,o):[];u=u.concat(c)}),u}const tt=({selId:t,categoryKey:r,level:u,setParentId:o})=>{const[c,a]=E.useReducer(zt,Kt),{getSubCats:p}=$(),{id:h}=r??{id:null},[C]=E.useState(r);E.useEffect(()=>{(async()=>{const f=await p(h),{subCats:D}=f;a({type:te.SET_SUB_CATS,payload:{subCats:D}})})()},[p,C,h]);const R=c.cats.filter(f=>f.parentId===h),i=f=>{a({type:te.SET_PARENT_CAT,payload:{cat:f}}),o(f)};return e.jsxs("div",{className:u>1?"border  border-7 ms-4 h-25":"border border-7  h-25",style:{overflowY:"auto"},children:[e.jsx(oe,{as:"ul",variant:"dark",className:"mb-0",children:R.filter(f=>f.id!==t).map(f=>e.jsx(Vt,{cat:f,selId:t,dispatch:a,setParentCat:i},f.id))}),c.error&&c.error.message]})},Yt=({relatedFilter:t})=>{const{filter:r,numOfUsages:u,created:o,lastUsed:c}=t,{time:a,nickName:p}=o,h=`Created by: ${p}, ${Gt(new Date(a))}`,C=!1,R=j=>{console.log("RelatedFilter onSelectAnswer",{filter:j})},[i,f]=Re(),D=e.jsxs("div",{ref:i,className:"d-flex justify-content-start align-items-center w-100 text-light related-filter-row",children:[e.jsx(z,{variant:"link",size:"sm",className:"py-0 mx-0 title text-light text-wrap",title:h,onClick:()=>R(r),disabled:C,children:r}),e.jsxs(Te,{pill:!0,bg:"secondary",className:`text-light ${u===0?"d-none":"d-inline"}`,children:[u,u===1?" usage":" usages"]}),e.jsx("span",{className:"small ms-1",children:Ft(c.time)}),f]});return e.jsx(oe.Item,{className:"py-0 px-0",as:"li",children:D},r)},Wt=({relatedFilters:t})=>{const{globalState:r}=Oe(),{variant:u}=r,{state:o}=$(),c=async a=>{console.log("RelatedFilters unAssignFilter",{relatedFilter:a})};return e.jsx("div",{className:"mx-0 my-1 border rounded-2 px-1 py-1border-light fs-6 related-filters",children:e.jsxs("div",{children:[e.jsx("label",{className:"text-muted",children:"Most frequently selected Filters (for the next Question in ChatBot)"}),t.length>0?e.jsx(oe,{as:"ul",variant:u,className:"my-1",children:t.map(a=>e.jsx(Yt,{relatedFilter:a,unAssignFilter:c},a.filter))}):e.jsx("div",{className:"border text-light",children:"No filters"}),o.error&&e.jsx("div",{children:"state.error"})]})})},De=({question:t,submitForm:r,children:u,showCloseButton:o,source:c=0,closeModal:a})=>{const{state:p,onQuestionTitleChanged:h}=$();let{formMode:C,topRows:R}=p;const i=E.lazy(()=>Nt(()=>import("./AssignedAnswers-F4_gXOpU.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8])).then(O=>({default:O.default}))),f=C===x.ViewingQuestion,D=C===x.EditingQuestion,j=C===x.AddingQuestion,Q=f,{topId:P,id:A,assignedAnswers:Y,relatedFilters:T,title:I}=t,U=new Ce(t).questionKey,N=be(),V=()=>{a?a():N({type:s.CLOSE_QUESTION_FORM,payload:{question:t}})},k=()=>{a?a():N({type:s.CANCEL_QUESTION_FORM,payload:{question:t}})},[b,L]=E.useState(A+"/"+I),M=Ve(b,500),[G]=E.useState(R.find(O=>O.id===P)),Z=E.useRef(null),S=Ke({enableReinitialize:!0,initialValues:t,validationSchema:ze().shape({title:Ne().required("Required"),parentId:Ne().required("Required").notOneOf(["000000000000000000000000"])}),onSubmit:O=>{r(O),L(O.id+"/"+O.title)}});E.useEffect(()=>{(async()=>{const F=M.split("/"),X=F[0];if(S.values.id===X){console.log("QuestionForm.useEffect - onQuestioTitleChanged",{debouncedSearchTerm:M,searchTerm:b,title:S.values.title});const W=F[1];await h(G,S.values,W)}})()},[M,S.values,h,b,G]),E.useEffect(()=>{Z.current.focus(),c!==0&&S.setFieldValue("source",c)},[S,Z,c]);const K=O=>{S.handleChange(O);const F=O.target.value;L(A+"/"+F)},se=O=>{S.setFieldValue("parentId",O.id),S.setFieldValue("categoryTitle",O.title)};return console.log("@@@@@@@@@@@@@@@@@@@@@ QuestionForm.render: ",{searchTerm:b,qTitle:I,debouncedSearchTerm:M}),e.jsxs("div",{className:"form-wrapper px-3 py-1 my-0 my-1 w-100 question-form",children:[o&&e.jsx(Me,{onClick:V,className:"float-end"}),e.jsx(Ee,{className:"text-center",children:e.jsxs(v.Label,{children:["Question  ",f?"Viewing":D?"Editing":"Adding"]})}),e.jsxs(v,{onSubmit:S.handleSubmit,children:[e.jsxs(Qe,{direction:"horizontal",gap:0,className:"border",children:[e.jsx("div",{className:"p-0",children:e.jsx(v.Label,{children:"Category:"})}),e.jsx("div",{className:"p-1",children:e.jsxs(v.Group,{controlId:"parentId",className:"category-select form-select-sm w-90",children:[e.jsxs(we,{children:[e.jsx(we.Toggle,{variant:"light",id:"dropdown-basic",className:"px-2 py-0 text-primary border",disabled:Q,children:e.jsx("span",{className:"text-wrap me-1",children:S.values.categoryTitle})}),e.jsx(we.Menu,{className:"p-0 border",children:e.jsx(we.Item,{className:"p-0 m-0 rounded-3",children:e.jsx(tt,{selId:S.values.parentId,categoryKey:null,level:1,setParentId:se})})})]}),e.jsx(v.Control,{as:"input",name:"parentId",onChange:S.handleChange,value:S.values.parentId?S.values.parentId:"",placeholder:"Category",className:"text-primary w-100",disabled:Q,hidden:!0}),e.jsx(v.Text,{className:"text-danger",children:S.touched.parentId&&S.errors.parentId?e.jsx("div",{className:"text-danger",children:S.errors.parentId?"required":""}):null})]})})]}),e.jsxs(v.Group,{controlId:"title",children:[e.jsx(v.Label,{children:"Title"}),e.jsx(v.Control,{as:"textarea",name:"title",placeholder:S.values.title==="new Question"?"new Question":"question text",ref:Z,onChange:K,value:S.values.title,rows:3,className:"text-primary w-100",disabled:Q}),e.jsx(v.Text,{className:"text-danger",children:S.touched.title&&S.errors.title?e.jsx("div",{className:"text-danger",children:S.errors.title}):null})]}),e.jsxs(Ee,{children:[e.jsx(pe,{children:e.jsxs(v.Group,{controlId:"source",children:[e.jsx(v.Label,{children:"Source"}),e.jsx(je,{id:"source",name:"source",options:Qt,onChange:(O,F)=>{O.preventDefault(),S.setFieldValue("source",F)},value:S.values.source,disabled:Q,classes:"text-primary"}),e.jsx(v.Text,{className:"text-danger",children:S.touched.source&&S.errors.source?e.jsx("div",{className:"text-danger",children:S.errors.source}):null})]})}),e.jsx(pe,{children:e.jsxs(v.Group,{controlId:"status",children:[e.jsx(v.Label,{children:"Status"}),e.jsx(je,{id:"status",name:"status",options:At,onChange:(O,F)=>{O.preventDefault(),S.setFieldValue("status",F)},value:S.values.status,disabled:Q,classes:"text-primary"}),e.jsx(v.Text,{className:"text-danger",children:S.touched.status&&S.errors.status?e.jsx("div",{className:"text-danger",children:S.errors.status}):null})]})})]}),(f||D)&&e.jsxs("div",{className:"my-1",children:[e.jsx(E.Suspense,{fallback:e.jsx("div",{children:"Loading..."}),children:e.jsx(i,{questionKey:U,questionTitle:b,assignedAnswers:Y,isDisabled:Q})}),e.jsx(Wt,{questionKey:U,questionTitle:b,relatedFilters:T}),e.jsx(Ye,{created:t.created,modified:t.modified,classes:"text-primary"})]}),(S.dirty&&D||j)&&e.jsx(We,{cancelForm:k,handleSubmit:S.handleSubmit,title:u}),p.error&&e.jsx("div",{className:"text-danger",children:p.error.message})]})]})},ke=({closeModal:t,showCloseButton:r,source:u,setError:o})=>{const{state:c,cancelAddQuestion:a,createQuestion:p}=$(),{activeQuestion:h}=c,C=h?h.topId:"",R=async()=>{await a()},i=async f=>{const D={...f,topId:C,created:{time:new Date,nickName:""},modified:void 0},j=await p(D,t!==void 0);j&&(j.message?o(j.message):t&&t())};return h?e.jsx(De,{question:h,showCloseButton:r??!0,source:u??0,closeModal:R,submitForm:i,children:"Create Question"}):null},ot=({})=>{const{state:t,updateQuestion:r}=$(),{activeQuestion:u}=t;if(!u)return null;if(!u)return e.jsx("div",{children:"Loading question to edit..."});const o=async c=>{const a={...c,created:void 0,modified:{time:new Date,nickName:""}},{parentId:p}=u,h=p!==a.parentId;await r(p,a,h)};return e.jsx(De,{question:u,showCloseButton:!0,source:0,submitForm:o,children:"Update Question"})},st=({inLine:t})=>{console.log(t?"ViewQuestion inLine":"ViewQuestion not inLine");const{state:r}=$(),{activeQuestion:u}=r,[o,c]=E.useState(null);return E.useEffect(()=>{console.log("#################################### ViewQuestion setQuestion ...",{activeQuestion:u}),c(u)},[u]),e.jsx(De,{question:o,showCloseButton:!0,source:0,submitForm:()=>{},children:"View Question"})},Ht=({questionRow:t,isSelected:r})=>{const{id:u,topId:o,parentId:c,title:a,numOfAssignedAnswers:p}=t,h={topId:o,parentId:c,id:c},{canEdit:C,authUser:R}=ae(),{state:i,viewQuestion:f,addQuestion:D,editQuestion:j,deleteQuestion:Q}=$(),{activeQuestion:P,formMode:A,loadingQuestion:Y,questionLoaded:T}=i,I=P!==null&&P.id===u,U=A===x.AddingQuestion,N=()=>{t.modified={time:new Date,nickName:R.nickName},Q(t,I)},V=async M=>{console.log("QuestionRow onSelectQuestion",{id:M}),C?await j(t):await f(t)},[k,b]=Re();E.useEffect(()=>{(async()=>{if(r&&!Y&&!T){switch(A){case x.ViewingQuestion:await f(t);break;case x.EditingQuestion:console.log("Zovem from QuestionRow"),C?await j(t):await f(t);break}document.getElementById(`QuestionRow${u}`)?.scrollIntoView({behavior:"smooth",block:"end"})}})()},[C,j,A,u,r,Y,T,t,f]);const L=e.jsxs("div",{id:`QuestionRow${u}`,className:`d-relative d-flex justify-content-start align-items-center w-100 mt-0 question-row${r?"-selected":""}`,style:{marginTop:"1px"},children:[e.jsx(z,{variant:"link",size:"sm",className:"d-flex align-items-center px-1 text-secondary",children:e.jsx("img",{width:"22",height:"18",src:jt,alt:"Question"})}),e.jsx(z,{variant:"link",size:"sm",className:`p-0 px-1 m-1 ms-0 question-row-title ${I?"fw-bold":""}`,title:`id:${u.toString()}`,onClick:()=>V(u),disabled:U,children:a}),e.jsxs(Te,{pill:!0,bg:"secondary",className:`text-info ${p===0?"d-none":"d-inline"}`,children:[p,"a"]}),C&&!U&&b&&e.jsxs("div",{className:"position-absolute text-nowrap d-flex align-items-center border border-0 border-warning p-0 end-0",children:[e.jsx(z,{variant:"link",size:"sm",className:"ms-1 p-0 text-secondary d-flex align-items-center",title:"Add Question",onClick:()=>{D(h,!0)},children:e.jsx("img",{width:"22",height:"18",src:He,alt:"Add Question"})}),e.jsx(z,{variant:"link",size:"sm",className:"ms-0 p-0 text-secondary",onClick:N,children:e.jsx(de,{icon:Ae,size:"lg"})})]})]});return e.jsxs(oe.Item,{className:"py-0 px-0 w-100",as:"li",children:[r&&A===x.AddingQuestion&&e.jsxs(e.Fragment,{children:[e.jsx("div",{id:"div-question",className:"ms-0 d-md-none w-100",children:e.jsx(ke,{showCloseButton:!0,source:0})}),e.jsx("div",{ref:k,className:"d-none d-md-block  border rounded-3",children:L})]}),r&&A===x.EditingQuestion&&e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:k,className:"",children:L}),e.jsx("div",{id:"div-question",className:"ms-0 d-md-none w-100",children:e.jsx(ot,{inLine:!0})})]}),r&&A===x.ViewingQuestion&&e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:k,className:"",children:L}),e.jsx("div",{ref:k,id:"div-question",className:"ms-0 d-md-none w-100",children:e.jsx(st,{inLine:!0})})]}),!r&&e.jsx("div",{ref:k,className:"",children:L})]})},nt=({categoryRow:t})=>{const{state:r,loadCategoryQuestions:u}=$(),{keyExpanded:o,loadingQuestion:c,error:a,selectedQuestionId:p}=r,{questionId:h}=o;t.level+=1;const{questionRows:C}=t;let R=!1;async function i(){try{const j={categoryKey:new le(t).categoryKey,startCursor:C.length,includeQuestionId:h??null};console.log("^^^^^^^^^^^^^ loadMore"),console.log("^^^^^^^^^^^^^",{x:j}),console.log("^^^^^^^^^^^^^ loadMore"),await u(j)}catch{}}const[f,{rootRef:D}]=bt({loading:c,hasNextPage:R,onLoadMore:i,disabled:!!a,rootMargin:"0px 0px 100px 0px"});return e.jsxs("div",{ref:D,className:"ms-0",style:{maxHeight:"400px",overflowY:"auto"},children:[e.jsxs(Dt,{children:[C.length===0&&e.jsx("label",{children:"No questions"}),C.map(j=>e.jsx(Ht,{questionRow:j,isSelected:j.id===p},j.id)),R]}),a&&e.jsxs("p",{children:["Error: ",a.message]})]})},Xt=({categoryKey:t,tag:r,categoryInAdding:u})=>{const{name:o}=r,{canEdit:c}=ae(),{state:a,deleteCategoryVariation:p}=$(),h=()=>{p(t,o)},[C,R]=Re(),i=e.jsxs("div",{ref:C,children:[e.jsx(Te,{pill:!0,bg:"secondary",children:o}),c&&!0&&R&&e.jsx(z,{variant:"link",size:"sm",className:"ms-0 py-0 mx-0 text-secondary",onClick:h,children:e.jsx(de,{icon:Ae,size:"sm"})}),!1]});return e.jsx("div",{className:"py-1 px-1",children:i})},Jt=({categoryKey:t,variations:r})=>{const{state:u}=$(),{error:o}=u;return E.useEffect(()=>{},[]),e.jsxs("div",{className:"ms-2",children:[e.jsxs(Qe,{direction:"horizontal",gap:2,children:[r.length===0&&e.jsx("div",{children:"No variations"}),r.length>0&&r.map(c=>e.jsx(Xt,{categoryKey:t,tag:c,categoryInAdding:void 0}))]}),o&&e.jsxs("p",{children:["Error: ",o.message]})]})},Le=({formMode:t,category:r,submitForm:u,children:o})=>{const{onCategoryTitleChanged:c}=$(),a=t===x.ViewingCategory,p=t===x.EditingCategory,h=t===x.AddingCategory,{topId:C,id:R,variations:i,questionRows:f,title:D}=r;console.log("CategoryForm render: ",{topId:C,id:R,catTitle:D,formMode:t,variations:i});const j=new le(r).categoryKey;document.getElementById("div-details");const Q=f&&f.length>0,P=be(),A=()=>{P({type:s.CLOSE_CATEGORY_FORM,payload:{}})},Y=()=>{P({type:s.CANCEL_CATEGORY_FORM,payload:{}})},[T,I]=E.useState(D),U=Ve(T,300),N=Ke({enableReinitialize:!0,initialValues:r,validationSchema:ze().shape({title:Ne().required("Required")}),onSubmit:L=>{console.log("CategoryForm.onSubmit",JSON.stringify(L,null,2)),u(L),I(L.title)}});E.useEffect(()=>{(async()=>(console.log("CategoryForm.useEffect - onCategoryTitleChanged",{debouncedSearchTerm:U,title:N.values.title}),N.values.title!==U&&c(C,R,N.values.title)))()},[U,N.values.title,c]);const V=L=>{N.handleChange(L);const M=L.target.value;I(M)},k=E.useRef(null);E.useEffect(()=>{k.current.focus()},[r.title,k]);const b=!1;return console.log("CategoryForm render return: ",T),e.jsxs("div",{className:"form-wrapper p-2 category-form",children:[e.jsx(Me,{onClick:A,className:"float-end"}),e.jsx(Ee,{className:"text-center text-muted",children:e.jsxs(v.Label,{children:["Category ",a?"Viewing":p?"Editing":"Adding"]})}),e.jsxs(v,{onSubmit:()=>N.handleSubmit,children:[e.jsx(v.Group,{controlId:"Variations",children:e.jsxs(Qe,{direction:"horizontal",gap:1,children:[e.jsx("div",{className:"px-0",children:e.jsx(v.Label,{children:"Variations:"})}),e.jsx("div",{className:"px-1 border border-1 border-secondary rounded",children:e.jsx(Jt,{categoryKey:j,variations:i?i.map(L=>({name:L})):[]})}),e.jsx("div",{className:"ps-2",children:e.jsx(v.Label,{children:"Kind:"})}),e.jsx("div",{className:"px-1 border border-1 border-secondary rounded",children:e.jsxs(v.Group,{controlId:"kind",children:[e.jsx(je,{id:"kind",name:"kind",options:kt,onChange:(L,M)=>{L.preventDefault(),N.setFieldValue("kind",M)},value:N.values.kind,disabled:b,classes:"text-primary"}),e.jsx(v.Text,{className:"text-danger",children:N.touched.kind&&N.errors.kind?e.jsx("div",{className:"text-danger",children:N.errors.kind}):null})]})})]})}),e.jsxs(v.Group,{controlId:"title",children:[e.jsx(v.Label,{children:"Title"}),e.jsx(v.Control,{as:"textarea",name:"title",placeholder:N.values.title==="new Category"?"new Category":"category text",value:T,onChange:V,ref:k,rows:3,className:"text-primary w-100",disabled:a}),e.jsx(v.Text,{className:"text-danger",children:N.touched.title&&N.errors.title?e.jsx("div",{className:"text-danger",children:N.errors.title}):null})]}),e.jsxs(v.Group,{controlId:"link",children:[e.jsx(v.Label,{children:"Link"}),N.values.hasSubCategories?e.jsx(v.Control,{as:"input",placeholder:"/categories/...",name:"link",onChange:N.handleChange,className:"text-primary w-100",value:"Can't have link (has sub categories)",disabled:!0}):e.jsxs(e.Fragment,{children:[e.jsx(v.Control,{as:"input",placeholder:"/categories/...",name:"link",onChange:N.handleChange,className:"text-primary w-100",value:N.values.link??"",disabled:a}),e.jsx(v.Text,{className:"text-danger",children:N.touched.link&&N.errors.link?e.jsx("div",{className:"text-danger",children:N.errors.link}):null})]})]}),e.jsxs(v.Group,{children:[e.jsxs(v.Label,{className:"m-1 mb-0",children:["Questions (",`${N.values.numOfQuestions}`,") "]}),Q&&e.jsx(nt,{categoryRow:r})]}),(a||p)&&e.jsx(Ye,{created:r.created,modified:r.modified,classes:"text-primary"}),(N.dirty&&p||h)&&e.jsx(We,{cancelForm:Y,handleSubmit:N.handleSubmit,title:o})]})]})},at=({inLine:t})=>{const r=ae(),{nickName:u}=r.authUser,{state:o,updateCategory:c}=$(),{activeCategory:a,keyExpanded:p}=o,{questionId:h}=p,C=async R=>{const i={...R,created:void 0,modified:{time:new Date,nickName:u}};await c(i,!0)};return e.jsx(Le,{inLine:t,category:{...a},questionId:h,formMode:x.EditingCategory,submitForm:C,children:"Update Category"})},Ie=({inLine:t})=>{const{state:r}=$(),{activeCategory:u,keyExpanded:o}=r,{questionId:c}=o;return e.jsx(Le,{inLine:t,category:{...u},questionId:c,formMode:x.ViewingCategory,submitForm:()=>{},children:"View Category"})},rt=({activeCategory:t})=>{const r=ae(),{nickName:u}=r.authUser,{createCategory:o}=$(),[c]=E.useState({...t}),a=async p=>{const h={...p,created:{time:new Date,nickName:u},modified:void 0};console.log("**********object",h),await o(h)};return!t===null?null:(console.log("AddCategory render >>>>>:",t),e.jsx(e.Fragment,{children:e.jsx(Le,{inLine:!1,category:c,questionId:null,formMode:x.AddingCategory,submitForm:a,children:"Create Category"})}))},Zt=({categoryRow:t,questionId:r})=>{const{id:u,title:o,hasSubCategories:c,numOfQuestions:a,isExpanded:p,categoryRows:h}=t;t.level+=1;const C=new le(t).categoryKey,{canEdit:R,authUser:i}=ae(),{state:f,addSubCategory:D,viewCategory:j,editCategory:Q,deleteCategory:P,expandCategory:A,collapseCategory:Y,addQuestion:T}=$();let{formMode:I,activeCategory:U,loadingCategory:N,categoryLoaded:V}=f;const k=U!==null&&U.id===u,b=I===x.AddingCategory,L=p&&a>0,M=()=>{t.modified={time:new Date,nickName:i.nickName},P(t)},G=async()=>{p?await Y(t):await A({categoryKey:C})},[Z,S]=E.useState(!1);E.useEffect(()=>{S(!0)},[h]);const K=async()=>{R?await Q(t,r??"null"):await j(t,r??"null")},[se,O]=E.useState(!1);E.useEffect(()=>{se&&(D(t),O(!1))},[D,t,se]);const[F,X]=E.useState(!1);E.useEffect(()=>{F&&(T(C,p??!1),X(!1))},[T,C,p,F]),E.useEffect(()=>{(async()=>{if(k&&!N&&!V&&!b)switch(console.log("CategoryRow formMode:",I),I){case x.ViewingCategory:await j(t,r??"null");break;case x.EditingCategory:R?await Q(t,r??"null"):await j(t,r??"null");break}})()},[R,C,V,t,Q,A,I,b,k,N,r,j]);const[W,ne]=Re(),re=e.jsxs("div",{children:[e.jsxs("div",{id:`Row${u}`,className:`d-relative d-flex justify-content-start align-items-center w-100 mt-1 category-row${k?"-selected":""}`,style:{marginTop:"1px"},children:[e.jsx(z,{variant:"link",size:"sm",className:"py-0 px-1","aria-controls":u+"-2","aria-expanded":Z,onClick:ie=>{G(),ie.stopPropagation()},title:"Expand",disabled:b||!c&&a===0,children:e.jsx(de,{icon:p?$e:Be,size:"lg"})}),e.jsx(z,{variant:"link",size:"sm",className:"py-0 px-1 bg-light",title:"Expand",disabled:!0,children:e.jsx(de,{icon:Lt,size:"sm"})}),e.jsx(z,{variant:"link",size:"sm",className:`py-0 ms-0 me-1 category-row-title ${k?"fw-bold text-white bg-transparent":""}`,title:u,onClick:K,disabled:b,children:o}),a>0&&e.jsxs(Te,{pill:!0,bg:"secondary",className:"d-inline bg-transparent",children:[a,"Q"]}),R&&ne&&e.jsxs("div",{className:"position-absolute text-nowrap d-flex align-items-center border border-0 border-warning p-0 end-0",children:[e.jsx("div",{className:"d-flex align-items-center",children:e.jsx(z,{variant:"link",size:"sm",className:"border-0 py-0 px-0 ms-0 text-success",title:"Add SubCategory",onClick:async()=>{!p&&(c||a>0)&&await G(),setTimeout(()=>O(!0),1e3)},children:e.jsx(de,{icon:qt,size:"lg"})})}),!b&&!c&&e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(z,{variant:"link",size:"sm",className:"p-0 mx-0 text-secondary d-flex align-items-center border border-0 border-warning1",title:"Add Question",onClick:async()=>{!p&&(c||a>0)&&await G(),setTimeout(()=>X(!0),500)},children:e.jsx("img",{width:"22",height:"18",src:He,alt:"Add Question"})}),e.jsx(z,{variant:"link",size:"sm",className:"d-flex align-items-center border border-0 border-warning p-0",disabled:c||a>0,onClick:M,children:e.jsx(de,{icon:Ae,size:"lg"})})]})]})]}),L&&e.jsx("div",{className:"ps-3",children:e.jsx(nt,{categoryRow:t})})]});return e.jsxs(e.Fragment,{children:[e.jsxs(oe.Item,{className:"py-0 px-1 w-100 category-bg",as:"li",children:[k&&I===x.AddingCategory&&e.jsxs("div",{children:[e.jsx("div",{ref:W,className:"",children:re}),e.jsx("div",{className:"ms-0 d-md-none w-100",children:e.jsx(rt,{activeCategory:U})})]}),k&&I===x.EditingCategory&&e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:W,children:re}),e.jsx("div",{id:"divInLine",className:"ms-0 d-md-none w-100",children:e.jsx(at,{inLine:!1})})]}),k&&I===x.ViewingCategory&&e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:W,children:re}),e.jsx("div",{id:"divInLine",className:"ms-0 d-md-none w-100",children:e.jsx(Ie,{inLine:!1})})]}),k&&I===x.None&&e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:W,children:re}),e.jsx("div",{id:"divInLine",className:"ms-0 d-md-none w-100",children:e.jsx(Ie,{inLine:!1})})]}),!k&&e.jsx("div",{ref:W,children:re})]}),f.error&&f.whichRowId===u&&e.jsx("div",{className:"text-danger",children:f.error.message}),p&&e.jsx(oe.Item,{className:"py-0 px-0 border-0 border-warning border-bottom-0 category-bg p-0 m-0",variant:"primary",as:"li",children:e.jsx("div",{className:"rambo",children:c&&e.jsx(vt,{in:Z,children:e.jsx("div",{id:u+"-2",style:{marginTop:"1px"},children:e.jsx("div",{style:{border:"1px solid #ddd",borderRadius:"4px"},children:e.jsx(it,{categoryRow:t,isExpanded:p})})})})})})]})},it=({categoryRow:t})=>{const{level:r,categoryRows:u}=t,{state:o}=$();let{keyExpanded:c}=o;const{questionId:a}=c??{questionId:null};return e.jsx("div",{className:r>1?"ms-2":"",children:e.jsx(oe,{as:"ul",variant:"dark",className:"mb-0 category-bg",children:u.map(p=>e.jsx(Zt,{categoryRow:p,questionId:a===""?null:a},p.id))})})},eo=t=>{const{isDarkMode:r}=ae(),[u,o]=E.useState("");return E.useEffect(()=>{},[]),e.jsxs(he,{show:t.show,onHide:t.onHide,animation:!0,centered:!0,size:"lg",className:"modal show",contentClassName:`${r?"bg-secondary bg-gradient":"bg-info bg-gradient"}`,children:[e.jsx(he.Header,{closeButton:!0,children:"Store new Question to the Database"}),e.jsx(he.Body,{className:"py-0",children:e.jsx(ke,{closeModal:t.onHide,showCloseButton:!1,source:1,setError:c=>o(c)})}),e.jsx(he.Footer,{children:u})]})},to=({categoryId_questionId:t,fromChatBotDlg:r})=>{const{state:u,expandNodesUpToTheTree:o,loadTopRows:c,addSubCategory:a}=$(),{allCategoryRows:p,topRows:h,topRowsLoading:C,topRowsLoaded:R,keyExpanded:i,categoryId_questionId_done:f,nodeOpening:D,nodeOpened:j,activeCategory:Q,activeQuestion:P,formMode:A,loadingCategories:Y,loadingCategory:T,loadingQuestions:I,loadingQuestion:U}=u,{searchQuestions:N,setLastRouteVisited:V,setChatBotDlgEnabled:k}=Oe(),{isDarkMode:b,chatBotDlgEnabled:L}=ae(),[M,G]=E.useState(!1),[Z,S]=E.useState({...ve}),K=be(),se=async F=>{K({type:s.SET_QUESTION_SELECTED,payload:{questionKey:F}})};let O="";return E.useEffect(()=>{(async()=>!C&&!R&&(console.log("ZOVEM 111 loadTopRows()"),await c()))()},[C,R,c,r]),E.useEffect(()=>{(async()=>{if(!D&&R&&h.length>0){if(t){if(t==="add_question"){const F=localStorage.getItem("New_Question");if(F){const X=JSON.parse(F);return S({...ve,categoryTitle:"Select",...X}),G(!0),localStorage.removeItem("New_Question"),null}}else if(t!==f){const F=t.split("_"),X=F[0],W=F[1],ne={topId:"",id:X,parentId:"ROOT"};console.log("zovem expandNodesUpToTheTree 1111111111111111111)",{categoryId_questionId:t},{categoryId_questionId_done:f}),await o(ne,W!=="null"?W:null,r==="from_chat"),console.log("zavrsio expandNodeUpToTheTree 1111111111111111111 DONE)",{categoryId_questionId:t})}}else if(i&&!j){const{topId:F,categoryId:X,questionId:W}=i;if(X!==""){const ne={topId:F,id:X,parentId:"ROOT"};console.log("zovem expandNodeUpToTheTree 2222222222222)",{keyExpanded:i,catKey:ne}),await o(ne,W),console.log("zavrsio expandNodeUpToTheTree 2222222222222 DONE)")}}L||k()}})()},[t,f,R,i,D,j,o,r,L,k]),E.useEffect(()=>{},[V]),t!=="add_question"&&t&&t!==f?(console.log("zzzzzz loading...",{keyExpanded:i,categoryId_questionId:t,categoryId_questionId_done:f}),e.jsx("div",{children:"loading..."})):R?(console.log("===>>> Categories !!!!!!!!!!!!!!!!!",Q),e.jsxs(e.Fragment,{children:[e.jsxs(Ot,{children:[e.jsxs("h5",{className:"text-warning mx-auto w-75 fw-bold",children:[e.jsx("span",{className:"categories",children:"Categories / "}),e.jsx("span",{className:"questions",children:"Questions"})]}),e.jsx(Ee,{className:`${b?"dark":""}`,children:e.jsx(pe,{children:e.jsx("div",{className:"d-flex justify-content-start align-items-center",children:e.jsx("div",{className:"w-75 my-1 questions",children:e.jsx(Pt,{tekst:O,onSelectQuestion:se,allCategoryRows:p,searchQuestions:N})})})})}),e.jsx(z,{variant:"secondary",size:"sm",type:"button",style:{padding:"1px 4px"},onClick:()=>a(null),children:"Add Category"}),e.jsxs(Ee,{className:"my-1 h-auto",children:[e.jsx(pe,{xs:12,md:5,children:e.jsx("div",{className:"categories-border",style:{position:"relative"},children:e.jsx(it,{categoryRow:{...Xe,categoryRows:h},isExpanded:!0})})}),e.jsx(pe,{xs:0,md:7,children:e.jsxs("div",{id:"div-details",className:"d-none d-md-block",children:[Q&&A===x.ViewingCategory&&e.jsx(Ie,{inLine:!1}),Q&&A===x.EditingCategory&&e.jsx(at,{inLine:!1}),Q&&A===x.AddingCategory&&e.jsx(rt,{activeCategory:Q}),P&&A===x.ViewingQuestion&&e.jsx(st,{inLine:!1}),P&&A===x.EditingQuestion&&e.jsx(ot,{inLine:!1}),P&&A===x.AddingQuestion&&e.jsx(ke,{})]})})]})]}),M&&P&&e.jsx(eo,{show:M,onHide:()=>{G(!1)},newQuestionRow:Z}),(Y||I)&&e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{position:"absolute",top:"40%",left:"20%"},children:e.jsx("div",{className:`spinner-border ${I?"question":"category"}-spinner`,role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})}),T&&e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{position:"absolute",top:"50%",left:"50%"},children:e.jsx("div",{className:"spinner-border category-spinner",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})}),U&&e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{position:"absolute",top:"50%",left:"50%"},children:e.jsx("div",{className:"spinner-border question-spinner",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})})]})):(console.log("===>>> Categories  VRATIO"),null)},oo=()=>{let{categoryId_questionId:t,fromChatBotDlg:r}=It();if(t&&t==="categories"&&(t=void 0),t){const u=t.split("_");console.assert(u.length===2,"expected 'categoryId_questionId'")}return e.jsx(Bt,{children:e.jsx(to,{categoryId_questionId:t,fromChatBotDlg:r})})},io=Object.freeze(Object.defineProperty({__proto__:null,default:oo},Symbol.toStringTag,{value:"Module"}));export{io as C,$ as u};
//# sourceMappingURL=Categories-2kxwJOYz.js.map
