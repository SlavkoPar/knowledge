{"version":3,"file":"Groups-7NhgJS3S.js","sources":["../../src/groups/GroupReducer.tsx","../../src/groups/GroupProvider.tsx","../../src/global/Components/SelectGroup/types.ts","../../src/global/Components/SelectGroup/GrpRow.tsx","../../src/global/Components/SelectGroup/GrpReducer.tsx","../../src/global/Components/SelectGroup/GrpList.tsx","../../src/groups/components/answers/AnswerForm.tsx","../../src/groups/components/answers/AddAnswer.tsx","../../src/groups/components/answers/EditAnswer.tsx","../../src/groups/components/answers/ViewAnswer.tsx","../../src/groups/components/answers/AnswerRow.tsx","../../src/groups/components/answers/AnswerList.tsx","../../src/groups/VariationRow.tsx","../../src/groups/VariationList.tsx","../../src/groups/components/GroupForm.tsx","../../src/groups/components/EditGroup.tsx","../../src/groups/components/ViewGroup.tsx","../../src/groups/components/AddGroup.tsx","../../src/groups/components/GroupRow.tsx","../../src/groups/components/GroupList.tsx","../../src/groups/ModalAddAnswer.tsx","../../src/groups/Groups.tsx"],"sourcesContent":["import { type Reducer } from 'react'\r\nimport {\r\n  ActionTypes, type Actions, type ILocStorage, IsGroup,\r\n  type IGroupsState, type IGroup, type IGroupRow, type IAnswer,\r\n  actionStoringToLocalStorage, FormMode, doNotModifyTree, doNotCallInnerReducerActions\r\n} from \"@/groups/types\";\r\n\r\nexport const subCatRow: IGroupRow = {\r\n  topId: 'generateId', // for top rows: topId = ToUpperCase(id)\r\n  id: 'generateId',\r\n  parentId: null,\r\n  level: 1,\r\n  isExpanded: false,\r\n  groupRows: [],\r\n  kind: 0,\r\n  title: '',\r\n  link: null,\r\n  header: '',\r\n  hasSubGroups: false,\r\n  variations: [],\r\n  numOfAnswers: 0,\r\n  answerRows: []\r\n}\r\n\r\nexport const initialAnswer: IAnswer = {\r\n  topId: '',\r\n  parentId: 'null',\r\n  id: 'generateId', //  keep 'generateId', it is expected at BackEnd\r\n  groupTitle: '',\r\n  title: '',\r\n  source: 0,\r\n  status: 0,\r\n  included: false\r\n}\r\n\r\nexport const initialGroup: IGroup = {\r\n  topId: 'null',\r\n  parentId: 'null',\r\n  id: 'define at BackEnd',\r\n  kind: 0,\r\n  title: '',\r\n  link: '',\r\n  header: '',\r\n  level: 0,\r\n  variations: [],\r\n  hasSubGroups: false,\r\n  groupRows: [],\r\n  answerRows: [],\r\n  numOfAnswers: 0,\r\n  hasMoreAnswers: false,\r\n  isExpanded: false,\r\n  doc1: ''\r\n}\r\n\r\nexport const GroupReducer: Reducer<IGroupsState, Actions> = (state, action) => {\r\n\r\n  console.log('------------------------------->')\r\n  console.log('------------------------------->', action.type)\r\n  console.log('------------------------------->')\r\n  // ----------------------------------------------------------------------\r\n  // Rubljov: \"By giving the right name, you reveal the essence of things\"\r\n  // ----------------------------------------------------------------------\r\n  //\r\n  // - firstLevelGroupRow AAA\r\n  // ------> groupRow AAA.1\r\n  // --------- > groupRow AAA 1.1\r\n  // --------- > ...\r\n  //\r\n  // ------> groupRow AAA.2\r\n  // --------- > groupRow AAA 2.1\r\n  // --------- > groupRow AAA 2.2\r\n  // ------------ > Group Row AAA 2.2.1\r\n  // ------------ > groupRow AAA 2.2.2\r\n  // --------------- > groupRow AAA 2.2.2.1\r\n  // --------------- > groupRow AAA 2.2.2.2\r\n  //\r\n  // --------- > groupRow AAA 2.3\r\n  //\r\n  // - firstLevelGroupRow BBB\r\n  // - ...\r\n\r\n  const { groupRow } = action.payload;\r\n  // const isGroup = IsGroup(groupRow); // IGroup rather than IGroupRow\r\n\r\n  if (action.type === ActionTypes.SET_KEY_EXPANDED) {\r\n    const { keyExpanded } = action.payload;\r\n    return {\r\n      ...state,\r\n      keyExpanded,\r\n      nodeOpened: keyExpanded === null ? true : state.nodeOpened\r\n    }\r\n  }\r\n\r\n  let modifyTree = groupRow\r\n    ? doNotModifyTree.includes(action.type) ? false : true\r\n    : false;\r\n\r\n  const { topRows } = state;\r\n\r\n  const newState = doNotCallInnerReducerActions.includes(action.type)\r\n    ? { ...state }\r\n    : innerReducer(state, action);\r\n\r\n  // return { ...state } // calling this, state would be destroyed, because of shallow copy\r\n  // Action that modify Tree\r\n  // Actually part topRows of state\r\n  if (modifyTree && groupRow) { //} && groupRow.topId !== 'ROOT') {\r\n    let newTopRows: IGroupRow[];\r\n    const { topId, id } = groupRow!;\r\n    if (id === topId) {\r\n      // actually topRows is from previous state\r\n      newTopRows = topRows.map(c => c.id === topId\r\n        ? new DeepClone(groupRow!).groupRow\r\n        : new DeepClone(c).groupRow\r\n      );\r\n    }\r\n    else {\r\n      // actually topRows is from previous state\r\n      const topRow: IGroupRow = topRows.find(c => c.id === topId)!;\r\n      DeepClone.idToSet = action.type === 'SET_GROUP_ADDED' ? 'generateId' : id;\r\n      DeepClone.newGroupRow = groupRow!;\r\n      const newTopRow = new DeepClone(topRow).groupRow;\r\n      newTopRows = topRows.map(c => c.id === topId\r\n        ? newTopRow\r\n        : new DeepClone(c).groupRow\r\n      );\r\n      DeepClone.idToSet = '';\r\n    }\r\n    newState.topRows = newTopRows;\r\n  }\r\n  else {\r\n    // just clone to enable time-travel debugging\r\n  }\r\n\r\n  if (actionStoringToLocalStorage.includes(action.type)) {\r\n    const { keyExpanded } = newState;\r\n    const locStorage: ILocStorage = {\r\n      keyExpanded\r\n    }\r\n    localStorage.setItem('GROUPS_STATE', JSON.stringify(locStorage));\r\n  }\r\n\r\n  console.log('GroupReducer newState', newState)\r\n  return newState;\r\n}\r\n\r\nconst innerReducer = (state: IGroupsState, action: Actions): IGroupsState => {\r\n  switch (action.type) {\r\n\r\n    //////////////////////////////////////////////////\r\n    // Rows Level: 1\r\n\r\n    case ActionTypes.SET_TOP_ROWS_LOADING:\r\n      return {\r\n        ...state,\r\n        loadingGroups: true,\r\n        topRowsLoading: true,\r\n        topRowsLoaded: false\r\n      }\r\n\r\n    case ActionTypes.SET_TOP_ROWS: {\r\n      const { topRows } = action.payload;\r\n      console.log('=> GroupsReducer ActionTypes.SET_TOP_ROWS', state.topRows, topRows)\r\n      return {\r\n        ...state,\r\n        topRows,\r\n        topRowsLoading: false,\r\n        topRowsLoaded: true,\r\n        loadingGroups: false\r\n      };\r\n    }\r\n\r\n    case ActionTypes.SET_ALL_GROUP_ROWS: {\r\n      const { allGroupRows } = action.payload;\r\n      return {\r\n        ...state,\r\n        allGroupRows,\r\n        allGroupRowsLoaded: Date.now()\r\n      };\r\n    }\r\n\r\n    case ActionTypes.SET_ALL_GROUP_ROWS: {\r\n      const { allGroupRows } = action.payload;\r\n      return {\r\n        ...state,\r\n        allGroupRows,\r\n        allGroupRowsLoaded: Date.now()\r\n      };\r\n    }\r\n\r\n    case ActionTypes.SET_NODE_EXPANDING_UP_THE_TREE: {\r\n      const { groupId_answerId_done } = action.payload;\r\n      //const { keyExpanded /*, activeGroup, activeAnswer */ } = state;\r\n      return {\r\n        ...state,\r\n        groupId_answerId_done,\r\n        nodeOpening: true,\r\n        loadingGroups: true,\r\n        nodeOpened: false,\r\n        //keyExpanded: fromChatBotDlg ? null : { ...keyExpanded! },\r\n        activeGroup: null, //fromChatBotDlg ? null : activeGroup,\r\n        activeAnswer: null //fromChatBotDlg ? null : activeAnswer\r\n      }\r\n    }\r\n\r\n    case ActionTypes.SET_NODE_EXPANDED_UP_THE_TREE: {\r\n      const { group, answerId, answer } = action.payload;\r\n      return {\r\n        ...state,\r\n        activeGroup: group,\r\n        activeAnswer: answer,\r\n        selectedAnswerId: answerId,\r\n        //formMode,\r\n        nodeOpening: false,\r\n        nodeOpened: true,\r\n        loadingGroups: false\r\n      };\r\n    }\r\n\r\n    case ActionTypes.SET_LOADING_GROUP:\r\n      return {\r\n        ...state,\r\n        //activeGroup: null,\r\n        loadingGroup: true,\r\n        groupLoaded: false\r\n      }\r\n\r\n\r\n    // case ActionTypes.FORCE_OPEN_NODE:\r\n    //   const { keyExpanded } = action.payload;\r\n    //   return {\r\n    //     ...state,\r\n    //     nodeOpening: false,\r\n    //     nodeOpened: false,\r\n    //     topRows: [],\r\n    //     topRowsLoaded: false,\r\n    //     keyExpanded\r\n    //   }\r\n\r\n    case ActionTypes.FORCE_OPEN_NODE:\r\n      const { keyExpanded } = action.payload;\r\n      alert('FORCE_OPEN_NODE is deprecated, use SET_ANSWER_SELECTED instead')\r\n      return {\r\n        ...state,\r\n        topRows: state.topRows.filter(row => row.parentId === null),\r\n        keyExpanded,\r\n        nodeOpened: false, // keep topRows, and openNode\r\n        activeGroup: null,\r\n        activeAnswer: null,\r\n        selectedAnswerId: null\r\n      }\r\n\r\n    // case ActionTypes.RESET_GROUP_ANSWER_DONE: {\r\n    //   return {\r\n    //     ...state,\r\n    //     groupId_answerId_done: undefined,\r\n    //     groupNodeLoaded: false\r\n    //   };\r\n    // }\r\n\r\n    case ActionTypes.SET_SUB_GROUPS: {\r\n      //const { groupRows } = action.payload;\r\n      //const { topRows } = state;\r\n      //groupRows.forEach((groupRow: IGroupRow) => {\r\n      //const { id, hasSubGroups, numOfAnswers } = groupRow;\r\n      //})\r\n      return {\r\n        ...state,\r\n        loadingGroup: false,\r\n        //groupLoaded: false proveri\r\n      };\r\n    }\r\n\r\n\r\n    case ActionTypes.SET_ERROR: {\r\n      const { error, whichRowId } = action.payload; // group.id or answer.id\r\n      return {\r\n        ...state,\r\n        error,\r\n        whichRowId,\r\n        loadingGroups: false,\r\n        loadingAnswers: false,\r\n        loadingGroup: false, groupLoaded: false,\r\n        loadingAnswer: false, answerLoaded: false\r\n      };\r\n    }\r\n\r\n\r\n    // case ActionTypes.SET_GROUP_ROW: {\r\n    //   const { groupRow } = action.payload; // group doesn't contain  inAdding \r\n    //   console.assert(IsGroup(groupRow));\r\n    //   const groupKey = new GroupKey(groupRow).groupKey!;\r\n    //   return {\r\n    //     ...state,\r\n    //     // keep mode\r\n    //     loadingGroup: false,\r\n    //     //keyExpanded: { ...groupKey },\r\n    //     activeGroup: groupRow,\r\n    //     activeAnswer: null\r\n    //   }\r\n    // }\r\n\r\n    case ActionTypes.SET_GROUP: {\r\n      const { groupRow } = action.payload; // group doesn't contain  inAdding \r\n      console.assert(IsGroup(groupRow));\r\n      //const groupKey = new GroupKey(groupRow).groupKey!;\r\n      return {\r\n        ...state,\r\n        // keep mode\r\n        loadingGroup: false,\r\n        groupLoaded: true,\r\n        //keyExpanded: { ...groupKey },\r\n        activeGroup: groupRow,\r\n        activeAnswer: null,\r\n        selectedAnswerId: null,\r\n\r\n      }\r\n    }\r\n\r\n    case ActionTypes.SET_ROW_EXPANDING: {\r\n      return {\r\n        ...state,\r\n        rowExpanding: true,\r\n        rowExpanded: false,\r\n        loadingGroups: true\r\n      }\r\n    }\r\n\r\n    case ActionTypes.SET_ROW_EXPANDED: {\r\n      const { groupRow } = action.payload; // , selectedAnswerId\r\n      const { topId, id } = groupRow;\r\n      const { keyExpanded } = state;\r\n      const answerId = keyExpanded ? keyExpanded.answerId : null; // (topId === keyExpanded?.topId && id === keyExpanded.groupId)\r\n      //? keyExpanded.answerId\r\n      //: null;\r\n      // Do not work with groupRow, \r\n      // groupRow will be proccesed in GroupReducer, rather than in innerReducer\r\n      return {\r\n        ...state,\r\n        // keep mode\r\n        loadingGroups: false,\r\n        keyExpanded: {\r\n          topId,\r\n          groupId: id,\r\n          answerId\r\n        },\r\n        //activeGroup: null,\r\n        activeAnswer: null,\r\n        selectedAnswerId: answerId, //selectedAnswerId ?? null,\r\n        loadingAnswer: false,\r\n        answerLoaded: false,\r\n        rowExpanding: false,\r\n        rowExpanded: true\r\n        //formMode\r\n      }\r\n    }\r\n\r\n    // case ActionTypes.SET_ROW_COLLAPSING: {\r\n    //   return {\r\n    //     ...state,\r\n    //     // keep mode\r\n    //     loadingGroups: true, \r\n    //     rowExpanding: true, // actually collapsing\r\n    //     rowExpanded: false\r\n    //   }\r\n    // }\r\n\r\n\r\n    case ActionTypes.SET_ROW_COLLAPSED: {\r\n      const { groupRow } = action.payload; // group doesn't contain  inAdding \r\n      const { topId, parentId } = groupRow;\r\n      //const groupKey = new GroupKey(groupRow).groupKey\r\n      return {\r\n        ...state,\r\n        // keep mode\r\n        loadingGroups: false,\r\n        keyExpanded: { topId, groupId: parentId ?? '', answerId: null },\r\n        rowExpanding: false, // actually collapsing\r\n        rowExpanded: true,\r\n        activeGroup: null,\r\n        activeAnswer: null,\r\n        selectedAnswerId: null\r\n      }\r\n    }\r\n\r\n\r\n    case ActionTypes.SET_GROUP_TO_VIEW: {\r\n      const { groupRow } = action.payload;\r\n      console.assert(IsGroup(groupRow))\r\n      const group: IGroup = groupRow as IGroup;\r\n      const activeGroup: IGroup = { ...group, isExpanded: false }\r\n      //const { topId, id, parentId } = group;\r\n      return {\r\n        ...state,\r\n        formMode: FormMode.ViewingGroup,\r\n        loadingGroup: false,\r\n        //keyExpanded: { ...state.keyExpanded, answerId: null },\r\n        activeGroup,\r\n        activeAnswer: null,\r\n        selectedAnswerId: null,\r\n        error: undefined\r\n      };\r\n    }\r\n\r\n    case ActionTypes.SET_GROUP_TO_ADD_TOP: {\r\n      const { newGroupRow } = action.payload; // IGroup extends IGroupRow\r\n      //const { topId } = group;\r\n      //console.assert(IsGroup(groupRow))\r\n      // TODO what about instanceof?\r\n      return {\r\n        ...state,\r\n        loadingGroup: false,\r\n        groupLoaded: true,\r\n        activeGroup: { ...newGroupRow, doc1: '' },\r\n        activeAnswer: null,\r\n        selectedAnswerId: null,\r\n        topRows: [newGroupRow!, ...state.topRows],\r\n        formMode: FormMode.AddingGroup\r\n      };\r\n    }\r\n\r\n    case ActionTypes.SET_GROUP_TO_ADD: {\r\n      const { newGroupRow } = action.payload; // IGroup extends IGroupRow\r\n      //const { topId } = group;\r\n      //console.assert(IsGroup(groupRow))\r\n      // TODO what about instanceof?\r\n      return {\r\n        ...state,\r\n        loadingGroup: false,\r\n        groupLoaded: true,\r\n        activeGroup: { ...newGroupRow!, doc1: '' },\r\n        activeAnswer: null,\r\n        selectedAnswerId: null,\r\n        formMode: FormMode.AddingGroup\r\n      };\r\n    }\r\n\r\n    case ActionTypes.SET_GROUP_ADDED: {\r\n      const { groupRow } = action.payload; // IGroup extends IGroupRow\r\n      console.assert(IsGroup(groupRow))\r\n      // TODO what about instanceof?\r\n      const group: IGroup = groupRow as IGroup;\r\n      const activeGroup: IGroup = { ...group, isExpanded: false }\r\n      const { topId, id } = activeGroup;\r\n      //const { parentId } = group;\r\n      //const topRowsLoaded = parentId ? true : false;\r\n      return {\r\n        ...state,\r\n        formMode: FormMode.EditingGroup, // none\r\n        loadingGroup: false,\r\n        groupLoaded: false,\r\n        // topRowsLoaded,\r\n        //groupKeyExpanded: state.groupKeyExpanded ? { ...state.groupKeyExpanded, answerId: null } : null,\r\n        activeGroup,\r\n        activeAnswer: null,\r\n        selectedAnswerId: null,\r\n        keyExpanded: { topId, groupId: id, answerId: null }, // set id to call openNode from groups\r\n      };\r\n    }\r\n\r\n    case ActionTypes.SET_GROUP_TO_EDIT:   // doesn't modify Tree\r\n    case ActionTypes.SET_GROUP_UPDATED: { // modifies Tree\r\n      const { groupRow, group } = action.payload; // IGroup extends IGroupRow\r\n      console.assert(IsGroup(groupRow))\r\n      // TODO what about instanceof?\r\n      //const activeGroup: IGroup = { ...group, isExpanded: false }\r\n      const { topId, id } = group;\r\n      return {\r\n        ...state,\r\n        formMode: FormMode.EditingGroup,\r\n        loadingGroup: false,\r\n        groupLoaded: true,\r\n        keyExpanded: { topId, groupId: id, answerId: null },\r\n        //keyExpanded: null, //{ topId, groupId: parentId!, answerId: null },\r\n        //groupKeyExpanded: state.groupKeyExpanded ? { ...state.groupKeyExpanded, answerId: null } : null,\r\n        activeGroup: group,\r\n        activeAnswer: null,\r\n        selectedAnswerId: null,\r\n        error: undefined\r\n      };\r\n    }\r\n\r\n    case ActionTypes.SET_ANSWERS_LOADING:\r\n      //const { loadingAnswer } = action.payload; // group doesn't contain inAdding \r\n      return {\r\n        ...state,\r\n        loadingAnswers: true,\r\n        answerLoaded: false\r\n      }\r\n\r\n    case ActionTypes.GROUP_ANSWERS_LOADED: {\r\n      // const { groupRow } = action.payload;\r\n      //const { id, topId: topId, answerRows, hasMoreAnswers } = groupRow;\r\n      return {\r\n        ...state,\r\n        //loadingAnswer: false,\r\n        loadingAnswers: false\r\n      }\r\n    }\r\n\r\n    case ActionTypes.DELETE_GROUP: {\r\n      //const { id } = action.payload;\r\n      // TODO Popravi\r\n      return {\r\n        ...state,\r\n        activeGroup: null,\r\n        formMode: FormMode.None,\r\n        error: undefined,\r\n        whichRowId: undefined\r\n      };\r\n    }\r\n\r\n    case ActionTypes.CANCEL_GROUP_FORM:\r\n    case ActionTypes.CLOSE_GROUP_FORM: {\r\n      return {\r\n        ...state,\r\n        activeGroup: null,\r\n        formMode: FormMode.None\r\n      };\r\n    }\r\n\r\n\r\n    // First we add a new answer to the group.guestions\r\n    // After user clicks Save, we call createAnswer \r\n    /*\r\n    case ActionTypes.ADD_ANSWER: {\r\n      const { groupInfo } = action.payload;\r\n      const { groupKey, level } = groupInfo;\r\n      const { topId, id } = groupKey;\r\n      const answer: IAnswer = {\r\n        ...initialAnswer,\r\n        topId: id ?? '',\r\n        parentId: id,\r\n        inAdding: true\r\n      }\r\n      return {\r\n        ...state,\r\n        mode: Mode.AddingAnswer,\r\n        activeAnswer: answer\r\n      };\r\n    }\r\n    */\r\n\r\n    case ActionTypes.CANCEL_ADD_SUB_GROUP: {\r\n      return {\r\n        ...state,\r\n        activeGroup: null,\r\n        activeAnswer: null,\r\n        selectedAnswerId: null,\r\n        formMode: FormMode.None\r\n      };\r\n    }\r\n\r\n    case ActionTypes.SET_LOADING_ANSWER:\r\n      return {\r\n        ...state,\r\n        loadingAnswer: true,\r\n        answerLoaded: false\r\n      }\r\n\r\n    case ActionTypes.CANCEL_ADD_ANSWER: {\r\n      return {\r\n        ...state,\r\n        formMode: FormMode.None,\r\n        activeAnswer: null,\r\n        selectedAnswerId: null\r\n      };\r\n    }\r\n\r\n    case ActionTypes.SET_ANSWER_SELECTED: { // from Groups / AutoSuggestAnswer\r\n      const { answerKey } = action.payload;\r\n      const { topId, parentId: groupId, id: answerId } = answerKey;\r\n      return {\r\n        ...state,\r\n        topRows: state.topRows.filter(row => row.parentId === null),\r\n        keyExpanded: {\r\n          topId,\r\n          groupId: groupId,\r\n          answerId\r\n        },\r\n        /////nodeOpened: false, // keep topRows, and openNode\r\n        activeGroup: null,\r\n        activeAnswer: null,\r\n        selectedAnswerId: null\r\n      };\r\n    }\r\n\r\n\r\n    case ActionTypes.ADD_NEW_ANSWER_TO_ROW: {\r\n      const { newAnswerRow } = action.payload;\r\n      return {\r\n        ...state,\r\n        selectedAnswerId: newAnswerRow.id\r\n      };\r\n    }\r\n\r\n\r\n    case ActionTypes.SET_ANSWER: {\r\n      const { answer, formMode } = action.payload;\r\n      console.log(ActionTypes.SET_ANSWER, answer)\r\n      return {\r\n        ...state,\r\n        activeGroup: null,\r\n        activeAnswer: answer,\r\n        formMode,\r\n        error: undefined,\r\n        loadingGroup: false,\r\n        loadingAnswer: false,\r\n        answerLoaded: true\r\n      };\r\n    }\r\n\r\n    case ActionTypes.SET_ANSWER_AFTER_ASSIGN_ANSWER: {\r\n      const { answer } = action.payload;\r\n      //const { parentId, id } = answer;\r\n      //const inAdding = state.formMode === FormMode.AddingAnswer;\r\n\r\n      // for inAdding, _id is IDBValidKey('000000000000000000000000')\r\n      // thats why we look for q.inAdding instead of q._id === _id\r\n      // const x = state.groups.filter(c => c.id === parentId).filter(q=>q.id === id);\r\n      // console.error('SET_ANSWER_AFTER_ASSIGN_ANSWER', {x})\r\n\r\n      // TODO Popravi\r\n      // const rootRows = newTopRows.map((c: IGroup) => c.id === parentId\r\n      //   ? {\r\n      //     ...c,\r\n      //     answerRows: inAdding\r\n      //       ? c.answerRows.map(q => q.inAdding ? { ...answer, inAdding: q.inAdding } : q)\r\n      //       : c.answerRows.map(q => q.id === id ? { ...answer } : q), // TODO sta, ako je inViewing\r\n      //     inAdding: c.inAdding\r\n      //   }\r\n      //   : c\r\n      // );\r\n      return {\r\n        ...state,\r\n        //formMode: state.formMode, // keep mode\r\n        activeAnswer: answer,\r\n        loadingAnswer: false,\r\n        answerLoaded: true\r\n      };\r\n    }\r\n\r\n\r\n    case ActionTypes.SET_ANSWER_TO_VIEW: {\r\n      const { answer } = action.payload;\r\n      //const { topId, id, parentId } = answer;\r\n      const { keyExpanded } = state;\r\n      return {\r\n        ...state,\r\n        formMode: FormMode.ViewingAnswer,\r\n        keyExpanded,\r\n        activeAnswer: answer,\r\n        loadingAnswer: false,\r\n        answerLoaded: true\r\n      }\r\n    }\r\n\r\n    case ActionTypes.SET_ANSWER_TO_EDIT: {\r\n      const { answer } = action.payload;\r\n      const { topId, id, parentId } = answer;\r\n      //const { keyExpanded } = state;\r\n      return {\r\n        ...state,\r\n        // groupKeyExpanded: groupKeyExpanded\r\n        //   ? { ...groupKeyExpanded, answerId: groupKeyExpanded.id === parentId ? id : null }\r\n        //   : null,\r\n        keyExpanded: { topId, groupId: parentId, answerId: id },\r\n        activeAnswer: answer,\r\n        formMode: FormMode.EditingAnswer,\r\n        selectedAnswerId: answer.id,\r\n        loadingAnswer: false,\r\n        answerLoaded: true\r\n      }\r\n    }\r\n\r\n    case ActionTypes.ANSWER_DELETED: {\r\n      //const { answer } = action.payload;\r\n      //const { parentId, id } = answer;\r\n      return {\r\n        ...state, // Popravi\r\n        activeAnswer: null,\r\n        selectedAnswerId: null,\r\n        formMode: FormMode.None,\r\n        loadingAnswer: false,\r\n        answerLoaded: true\r\n      }\r\n    }\r\n\r\n    case ActionTypes.CANCEL_ANSWER_FORM:\r\n    case ActionTypes.CLOSE_ANSWER_FORM: {\r\n      //const { answer } = action.payload;\r\n      return {\r\n        ...state,\r\n        formMode: FormMode.None,\r\n        activeAnswer: null,\r\n        selectedAnswerId: null\r\n      };\r\n    }\r\n\r\n    default:\r\n      alert(`Action ${action.type} not allowed`)\r\n      return {\r\n        ...state\r\n      }\r\n  }\r\n};\r\n\r\n\r\n\r\n/* -----------------------------\r\n   Deep Clone\r\n----------------------------- */\r\nexport class DeepClone {\r\n  static idToSet: string;\r\n  static newGroupRow: IGroupRow;\r\n  constructor(groupRow: IGroupRow) {\r\n    const { topId, id, parentId, title, link, kind, header, level, variations, numOfAnswers,\r\n      hasSubGroups, groupRows, created, modified, answerRows, isExpanded } = groupRow;\r\n\r\n    const subCatRows = groupRows.map((grpRow: IGroupRow) => {\r\n      console.log('DeepClone >>>>>>>>>>>>>>>', grpRow.id)\r\n      if (grpRow.id === DeepClone.idToSet) {\r\n        return { ...DeepClone.newGroupRow }\r\n      }\r\n      else {\r\n        return new DeepClone(grpRow).groupRow\r\n      }\r\n    });\r\n\r\n    this.groupRow = {\r\n      topId,\r\n      parentId,\r\n      id,\r\n      kind,\r\n      title,\r\n      link,\r\n      header,\r\n      level,\r\n      hasSubGroups,\r\n      groupRows: subCatRows,\r\n      numOfAnswers,\r\n      answerRows,\r\n      variations: variations ?? [],\r\n      created,\r\n      modified,\r\n      isExpanded\r\n    }\r\n  }\r\n  groupRow: IGroupRow;\r\n}\r\n\r\n\r\n","import { useGlobalState, useGlobalContext } from '@/global/GlobalProvider'\r\nimport React, { createContext, useContext, useReducer, useCallback, type Dispatch, useEffect } from 'react';\r\n\r\nimport type {\r\n  IGroup, IAnswer, IGroupsContext,\r\n  IGroupDtoEx, IGroupKey,\r\n  IAnswerDtoEx, IAnswerEx, IAnswerKey, IAnswerRow,\r\n  IGroupRow,\r\n  IGroupRowDtoEx,\r\n  IGroupRowDto,\r\n  ILoadGroupAnswers,\r\n  IExpandInfo,\r\n  IKeyExpanded,\r\n  IGroupsState,\r\n  ILocStorage\r\n} from '@/groups/types';\r\n\r\n\r\nimport {\r\n  ActionTypes,\r\n  GroupKey, Group, GroupDto,\r\n  Answer,\r\n  AnswerDto,\r\n  AnswerRowDto,\r\n  GroupRow,\r\n  AnswerKey,\r\n  FormMode,\r\n  GroupRowDto\r\n} from '@/groups/types';\r\n\r\nimport { GroupReducer, initialAnswer, initialGroup } from '@/groups/GroupReducer';\r\n\r\nconst GroupsContext = createContext<IGroupsContext>({} as any);\r\nconst GroupDispatchContext = createContext<Dispatch<any>>(() => null);\r\n\r\ntype IProps = {\r\n  children: React.ReactNode\r\n}\r\n\r\nexport const initialState: IGroupsState = {\r\n  formMode: FormMode.None,\r\n\r\n  allGroupRows: new Map<string, IGroupRow>(),\r\n  allGroupRowsLoaded: undefined,\r\n\r\n  topRows: [],\r\n  topRowsLoading: false,\r\n  topRowsLoaded: false,\r\n\r\n  nodeOpening: false,\r\n  nodeOpened: false,\r\n\r\n  keyExpanded: null,\r\n\r\n  groupId_answerId_done: undefined,\r\n\r\n  activeGroup: null,\r\n  activeAnswer: null,\r\n  selectedAnswerId: null,\r\n\r\n  loadingGroups: false,\r\n  loadingAnswers: false,\r\n  loadingGroup: false, groupLoaded: false,\r\n  loadingAnswer: false, answerLoaded: false,\r\n\r\n  error: undefined,\r\n\r\n  rowExpanding: false,\r\n  rowExpanded: false\r\n}\r\n\r\nexport const GroupProvider: React.FC<IProps> = ({ children }) => {\r\n\r\n  const { loadAllGroupRowsGlobal } = useGlobalContext();\r\n  const globalState = useGlobalState();\r\n  const { KnowledgeAPI, isAuthenticated, workspace, authUser, canEdit } = globalState;\r\n  const { nickName } = authUser;\r\n\r\n  const [state, dispatch] = useReducer(GroupReducer, initialState);\r\n\r\n  const { formMode, activeGroup, activeAnswer, keyExpanded, topRows, allGroupRows, allGroupRowsLoaded } = state;\r\n\r\n  console.log('----->>> ----->>> ----->>> GroupProvider', topRows)\r\n\r\n  useEffect(() => {\r\n\r\n    let keyExpanded: IKeyExpanded | null = workspace === 'DEMO'\r\n      ? { topId: \"MTS\", groupId: \"REMOTECTRLS\", answerId: \"qqqqqq111\" }\r\n      : null;\r\n\r\n    if ('localStorage' in window) {\r\n      let s = localStorage.getItem('GROUPS_STATE');\r\n      console.log('GROUPS_STATE from localStorage', s)\r\n      if (s !== null) {\r\n        const locStorage: ILocStorage = JSON.parse(s);\r\n        if (locStorage.keyExpanded !== null)\r\n          keyExpanded = locStorage.keyExpanded!;\r\n      }\r\n    }\r\n    /**/\r\n    dispatch({ type: ActionTypes.SET_KEY_EXPANDED, payload: { keyExpanded } });\r\n  }, [workspace]);\r\n\r\n\r\n  const Execute = useCallback(\r\n    async (\r\n      method: string,\r\n      endpoint: string,\r\n      data: Object | null = null,\r\n      whichRowId: string | undefined = undefined\r\n    ): Promise<any> => {\r\n      const accessToken = localStorage.getItem(\"accessToken\");\r\n      if (accessToken) {\r\n        try {\r\n          console.log(\"------Execute endpoint:\", endpoint)\r\n          let response = null;\r\n\r\n          const headers = new Headers();\r\n          const bearer = `Bearer ${accessToken}`;\r\n          headers.append(\"Authorization\", bearer);\r\n\r\n          if (data) headers.append('Content-Type', 'application/json');\r\n\r\n          let options = {\r\n            method: method,\r\n            headers: headers,\r\n            body: data ? JSON.stringify(data) : null,\r\n          };\r\n\r\n          response = (await fetch(endpoint, options));\r\n          if (response.ok) {\r\n            if ((response.status === 200 || response.status === 201)) {\r\n              let responseData = null; //response;\r\n              try {\r\n                responseData = await response.json();\r\n              }\r\n              catch (error) {\r\n                dispatch({\r\n                  type: ActionTypes.SET_ERROR, payload: {\r\n                    error: new Error(`Response status: ${response.status}`),\r\n                    whichRowId\r\n                  }\r\n                });\r\n              }\r\n              finally {\r\n                return responseData;\r\n              }\r\n            }\r\n          }\r\n          else {\r\n            const { errors } = await response.json();\r\n            const error = new Error(\r\n              errors?.map((e: { message: any; }) => e.message).join('\\n') ?? 'unknown',\r\n            )\r\n            dispatch({ type: ActionTypes.SET_ERROR, payload: { error, whichRowId } });\r\n          }\r\n        }\r\n        catch (e) {\r\n          console.log('-------------->>> execute', method, endpoint, e)\r\n          dispatch({ type: ActionTypes.SET_ERROR, payload: { error: new Error(`fetch eror`), whichRowId } });\r\n        }\r\n      }\r\n      return null;\r\n    }, []);\r\n\r\n\r\n  // ---------------------------\r\n  // load all groupRows\r\n  // ---------------------------\r\n  const loadAllGroupRows = useCallback(async (): Promise<Map<string, IGroupRow> | null> => {\r\n    return new Promise(async (resolve) => {\r\n      const allGroupRows = await loadAllGroupRowsGlobal();\r\n      if (allGroupRows) {\r\n        dispatch({ type: ActionTypes.SET_ALL_GROUP_ROWS, payload: { allGroupRows } });\r\n      }\r\n      else {\r\n        dispatch({ type: ActionTypes.SET_ERROR, payload: { error: new Error('Zajeb allGroupRows') } });\r\n      }\r\n      resolve(allGroupRows);\r\n    })\r\n  }, [loadAllGroupRowsGlobal]);\r\n\r\n \r\n  const getGrp = useCallback(async (id: string): Promise<IGroupRow | undefined> => {\r\n    try {\r\n      const grp: IGroupRow | undefined = allGroupRows.get(id);  // globalState.cats is Map<string, ICat>\r\n      return grp;\r\n    }\r\n    catch (error: any) {\r\n      console.log(error)\r\n      dispatch({ type: ActionTypes.SET_ERROR, payload: { error } });\r\n    }\r\n    return undefined;\r\n  }, [allGroupRows]);\r\n\r\n  useEffect(() => {\r\n    (async () => {\r\n      //if (allGroupRowsLoaded === undefined) {\r\n      await loadAllGroupRows();\r\n      //}\r\n    })()\r\n  }, [loadAllGroupRows]);\r\n\r\n  const getSubGrps = useCallback(async (groupId: string | null) => {\r\n    try {\r\n      let parentHeader = \"\";\r\n      const subGrps: IGroupRow[] = [];\r\n      allGroupRows.forEach((cat, id) => {  // globalState.cats is Map<string, ICat>\r\n        if (id === groupId) {\r\n          parentHeader = \"\"; //cat.header!;\r\n        }\r\n        else if (cat.parentId === groupId) {\r\n          subGrps.push(cat);\r\n        }\r\n      })\r\n      return { subGrps, parentHeader };\r\n    }\r\n    catch (error: any) {\r\n      console.log(error)\r\n      dispatch({ type: ActionTypes.SET_ERROR, payload: { error } });\r\n      return { subGrps: [], parentHeader: 'Kiks subGrps' }\r\n    }\r\n  }, [allGroupRows]);\r\n\r\n  const loadTopRows = useCallback(async () => {\r\n    return new Promise(async (resolve) => {\r\n      //const { keyExpanded } = state;\r\n      try {\r\n        dispatch({ type: ActionTypes.SET_TOP_ROWS_LOADING, payload: {} });\r\n        const url = `${KnowledgeAPI.endpointGroupRow}/${workspace}/toprows`;\r\n        console.log('GroupProvider loadTopRows url:', url)\r\n        console.log('loadTopRows AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA')\r\n        console.time();\r\n        await Execute(\"GET\", url)\r\n          .then((dtos: IGroupRowDto[]) => {\r\n            console.timeEnd();\r\n            console.log('loadTopRows CCCCCCCCCCCCCCCCCCCC')\r\n            const topRows: IGroupRow[] = dtos!.map((dto: IGroupRowDto) => {\r\n              dto.IsExpanded = keyExpanded\r\n                ? dto.Id === keyExpanded.groupId\r\n                : false;\r\n              //dto.TopId = dto.AnswerId;\r\n              return new GroupRow(dto).groupRow;\r\n            })\r\n            dispatch({ type: ActionTypes.SET_TOP_ROWS, payload: { topRows } });\r\n            resolve(true);\r\n          });\r\n      }\r\n      catch (error: any) {\r\n        console.log(error)\r\n        dispatch({ type: ActionTypes.SET_ERROR, payload: { error } });\r\n      }\r\n    })\r\n  }, [Execute, KnowledgeAPI.endpointGroupRow, keyExpanded, workspace]); // state, \r\n\r\n\r\n  // get group With subgroupRows and answerRows\r\n  const getGroup = useCallback(\r\n    async (groupKey: IGroupKey, includeAnswerId: string | null): Promise<any> => {\r\n      const { topId, id } = groupKey;\r\n      console.log({ groupKey, includeAnswerId })\r\n      return new Promise(async (resolve) => {\r\n        try {\r\n          const url = `${KnowledgeAPI.endpointGroup}/${workspace}/${topId}/${id}/${PAGE_SIZE}/${includeAnswerId}`;\r\n          console.time()\r\n          console.log('================ getGroup =======================')\r\n          await Execute(\"GET\", url)\r\n            .then((groupDtoEx: IGroupDtoEx) => {\r\n              console.timeEnd();\r\n              const { groupDto, msg } = groupDtoEx;\r\n              if (groupDto) {\r\n                resolve(new Group(groupDto).group);\r\n              }\r\n              else {\r\n                resolve(new Error(msg));\r\n              }\r\n            });\r\n        }\r\n        catch (error: any) {\r\n          console.log(error)\r\n          resolve(error);\r\n        }\r\n      })\r\n    }, [Execute, KnowledgeAPI.endpointGroup, workspace]);\r\n\r\n  const findGroupRow = useCallback(\r\n    async (groupRow: IGroupRow, id: string): Promise<IGroupRow | undefined> => {\r\n      if (groupRow.topId === id)\r\n        return groupRow;\r\n      const { groupRows } = groupRow;\r\n      let grp: IGroupRow | undefined = groupRows.find(c => c.id === id);\r\n      if (!grp) {\r\n        for (const c of groupRows) {\r\n          const grpRow = await findGroupRow(c, id);\r\n          if (grpRow) {\r\n            grp = grpRow;\r\n            console.log(\"findGroup Stop the loop for: \" + id);\r\n            break;\r\n          }\r\n        }\r\n      }\r\n      return grp;\r\n    }, []);\r\n\r\n\r\n  const expandNodesUpToTheTree = useCallback(\r\n    async (grpKey: IGroupKey, answerId: string | null, fromChatBotDlg = false): Promise<boolean> => {\r\n      return new Promise(async (resolve) => {\r\n        try {\r\n          let { topId, parentId, id } = grpKey;\r\n          console.assert(id !== null, 'id ne sme biti null u expandNodesUpToTheTree');\r\n          if (id) {\r\n            const groupRow: IGroupRow | undefined = allGroupRows.get(id);\r\n            if (groupRow) {\r\n              topId = groupRow.topId;\r\n              parentId = groupRow.parentId;\r\n            }\r\n            else {\r\n              alert('reload all groupRow:' + id)\r\n              //return\r\n            }\r\n          }\r\n          dispatch({\r\n            type: ActionTypes.SET_NODE_EXPANDING_UP_THE_TREE, payload: {\r\n              groupId_answerId_done: `${id}_${answerId}`\r\n            }\r\n          })\r\n          // ---------------------------------------------------------------------------\r\n          console.time();\r\n          const groupKey: IGroupKey = { topId, id, parentId: null }; // proveri ROOT\r\n          const query = new GroupKey(groupKey).toQuery(workspace);\r\n          const url = `${KnowledgeAPI.endpointGroupRow}?${query}&pageSize=${PAGE_SIZE}&includeAnswerId=${answerId ?? null}`;\r\n          await Execute(\"GET\", url)\r\n            .then(async (groupRowDtoEx: IGroupRowDtoEx) => {\r\n              //dispatch({ type: ActionTypes.CLEAN_SUB_TREE, payload: { groupKey: groupKey! } });\r\n              const { groupRowDto } = groupRowDtoEx;\r\n              console.timeEnd();\r\n              if (groupRowDto) {\r\n                let group: IGroup | null = null;\r\n                let answer: IAnswer | null = null;\r\n                let groupRow: IGroupRow | null = new GroupRow(groupRowDto).groupRow;\r\n                if (parentId !== null) {\r\n                  const row = await findGroupRow(groupRow, id!);\r\n                  group = { ...row!, doc1: '' };\r\n                  if (answerId) {\r\n                    const answerRow = row!.answerRows!.find(q => q.id === answerId && q.included)!;\r\n                    if (answerRow) {\r\n                      group = null;\r\n                      answer = {\r\n                        ...answerRow,\r\n                        source: 0,\r\n                        status: 0\r\n                      }\r\n                    }\r\n                  }\r\n                }\r\n                console.log('>>> expandNodeUpToTheTree groupRow', { groupRow, answerId: \"'\" + (answerId ?? 'jok') + \"'\" + (answerId ?? \"JOK\") })\r\n                const formMode = answerId\r\n                  ? canEdit\r\n                    ? FormMode.EditingAnswer\r\n                    : FormMode.ViewingAnswer\r\n                  : canEdit\r\n                    ? FormMode.EditingGroup\r\n                    : FormMode.ViewingGroup;\r\n\r\n                dispatch({\r\n                  type: ActionTypes.SET_NODE_EXPANDED_UP_THE_TREE, payload: {\r\n                    grpKey,\r\n                    groupRow,\r\n                    group: group!,\r\n                    answerId: answerId ?? null,\r\n                    answer,\r\n                    formMode,\r\n                    fromChatBotDlg //: fromChatBotDlg === 'true'\r\n                  }\r\n                })\r\n                resolve(true);\r\n              }\r\n              else {\r\n                resolve(false);\r\n              }\r\n            });\r\n        }\r\n        catch (error: any) {\r\n          console.log(error)\r\n          dispatch({ type: ActionTypes.SET_ERROR, payload: { error } });\r\n        }\r\n      })\r\n    }, [workspace, KnowledgeAPI.endpointGroupRow, Execute, allGroupRows, findGroupRow, canEdit]);\r\n\r\n\r\n  const getGroupRow = useCallback(\r\n    async (groupKey: IGroupKey, hidrate: boolean = false, includeAnswerId: string | null = null): Promise<any> => {\r\n      const query = new GroupKey(groupKey).toQuery(workspace);\r\n      return new Promise(async (resolve) => {\r\n        try {\r\n          const url = `${KnowledgeAPI.endpointGroupRow}/${hidrate}/${PAGE_SIZE}/${includeAnswerId}?${query}`;\r\n          console.time()\r\n          await Execute(\"GET\", url)\r\n            .then((groupRowDtoEx: IGroupRowDtoEx) => {\r\n              console.timeEnd();\r\n              const { groupRowDto, msg } = groupRowDtoEx;\r\n              if (groupRowDto) {\r\n                //groupRowDto.TopId = topId;\r\n                resolve(new GroupRow(groupRowDto).groupRow);\r\n              }\r\n              else {\r\n                resolve(new Error(msg));\r\n              }\r\n            });\r\n        }\r\n        catch (error: any) {\r\n          console.log(error)\r\n          resolve(error);\r\n        }\r\n      })\r\n    }, [Execute, KnowledgeAPI.endpointGroupRow, workspace]);\r\n\r\n\r\n  const expandGroup = useCallback(\r\n    async ({ groupKey, includeAnswerId, newAnswerRow, formMode }: IExpandInfo): Promise<any> => {\r\n      try {\r\n        //const { keyExpanded } = state;\r\n        dispatch({ type: ActionTypes.SET_ROW_EXPANDING, payload: {} });\r\n        const groupRow: IGroupRow = await getGroupRow(groupKey, true, includeAnswerId); // to reload Group\r\n        if (groupRow instanceof Error) {\r\n          dispatch({ type: ActionTypes.SET_ERROR, payload: { error: groupRow } });\r\n          console.error({ groupRow })\r\n        }\r\n        else {\r\n          let selectedAnswerId: string | undefined = undefined;\r\n          if (includeAnswerId && groupRow.answerRows!.filter((row: IAnswerRow) => row.included).length > 0) {\r\n            selectedAnswerId = includeAnswerId;\r\n          }\r\n          // if (newGroupRow) {\r\n          //   groupRow.groupRows = [newGroupRow, ...groupRow.groupRows];\r\n          // }\r\n          if (newAnswerRow) {\r\n            groupRow.answerRows = [newAnswerRow, ...groupRow.answerRows!];\r\n          }\r\n          groupRow.isExpanded = true;\r\n          console.log('@@@@@@@@@@@@@@@@@ expandGroup:', formMode, includeAnswerId)\r\n          if (formMode === FormMode.None && includeAnswerId) {\r\n            formMode = canEdit ? FormMode.EditingAnswer : FormMode.ViewingAnswer\r\n          }\r\n          dispatch({ type: ActionTypes.SET_ROW_EXPANDED, payload: { groupRow, formMode: formMode!, selectedAnswerId } });\r\n          return groupRow;\r\n        }\r\n      }\r\n      catch (error: any) {\r\n        console.log('error', error);\r\n        dispatch({ type: ActionTypes.SET_ERROR, payload: { error } });\r\n        return null;\r\n      }\r\n    }, [canEdit, getGroupRow]);\r\n\r\n\r\n  const collapseGroup = useCallback(\r\n    async (groupRow: IGroupRow) => {\r\n      const { topId, id } = groupRow;\r\n      //const { topRows } = state;\r\n      const topRow: IGroupRow = topRows.find(c => c.id === topId)!;\r\n      const grpRow: IGroupRow | undefined = await findGroupRow(topRow, id);\r\n      /*\r\n      const catRow: IGroupRow = (topRow.id === id)\r\n        ? topRow\r\n        : (await findGroupRow(topRow, id))!;\r\n      */\r\n      if (grpRow) {\r\n        groupRow = { ...grpRow, isExpanded: false, groupRows: [], answerRows: [] }\r\n        // rerender\r\n        dispatch({ type: ActionTypes.SET_ROW_COLLAPSED, payload: { groupRow } })\r\n      }\r\n      else {\r\n        dispatch({ type: ActionTypes.SET_ERROR, payload: { error: new Error('findGroup sranje'), whichRowId: id } });\r\n      }\r\n    }, [findGroupRow, topRows]);\r\n\r\n\r\n  const addSubGroup = useCallback(\r\n    async (parentGroupRow: IGroupRow | null) => {\r\n      try {\r\n        //if (formMode !== FormMode.None) {\r\n        dispatch({ type: ActionTypes.CLOSE_GROUP_FORM, payload: {} })\r\n        //}\r\n        //const id = 'generateId';\r\n        const { topId, id, level } = parentGroupRow ?? { topId: 'generateId', id: 'generateId', level: 0 };\r\n        const newGroupRow: IGroupRow = {\r\n          ...initialGroup,\r\n          topId,\r\n          parentId: parentGroupRow ? id : null,\r\n          id: 'generateId',\r\n          level: level + 1,\r\n          title: 'New Group',\r\n          isExpanded: false\r\n        }\r\n        if (parentGroupRow === null) { // add topRow\r\n          dispatch({\r\n            type: ActionTypes.SET_GROUP_TO_ADD_TOP, payload: {\r\n              //groupRow: { groupRow, groupRows: [newGroupRow, ...groupRow.groupRows]\r\n              newGroupRow\r\n            }\r\n          });\r\n        }\r\n        else {\r\n          // if (id !== null) {\r\n          //   const topRow: IGroupRow = state.topRows.find(c => c.id === topId)!;\r\n          //   parentGroupRow = findGroupRow(topRow, id)!;\r\n          // }\r\n          const groupRow: IGroupRow = {\r\n            ...parentGroupRow,\r\n            level: level + 1,\r\n            groupRows: [newGroupRow, ...parentGroupRow.groupRows],\r\n            hasSubGroups: true,\r\n            isExpanded: true\r\n          }\r\n          dispatch({\r\n            type: ActionTypes.SET_GROUP_TO_ADD, payload: {\r\n              groupRow,\r\n              newGroupRow: { ...newGroupRow } // , title: ''\r\n            }\r\n          })\r\n          // dispatch({\r\n          //   type: ActionTypes.SET_GROUP, payload: {\r\n          //     groupRow: { ...newGroupRow, doc1: ''}\r\n          //   }\r\n          // })\r\n          //const groupKey: IGroupKey = { topId, parentId, id };\r\n          // const newGroupRow: IGroupRow = {\r\n          //   ...initialGroup,\r\n          //   topId,\r\n          //   parentId,\r\n          //   id: 'generateId',\r\n          //   level,\r\n          //   title: '' // new Group\r\n          // }\r\n          /*\r\n          if (isExpanded) {\r\n            groupRows.map(g => g.isExpanded = false);\r\n            const groupRow2: IGroupRow = {\r\n              ...groupRow,\r\n              groupRows: [newGroupRow, ...groupRows],\r\n            }\r\n            dispatch({ type: ActionTypes.SET_ROW_EXPANDED, payload: { groupRow: groupRow2, formMode: FormMode.AddingGroup } });\r\n            dispatch({ type: ActionTypes.SET_GROUP, payload: { groupRow: { ...newGroupRow, doc1: '' } } });\r\n          }\r\n          else {\r\n            const expandInfo: IExpandInfo = {\r\n              groupKey,\r\n              formMode: FormMode.AddingGroup,\r\n              newGroupRow\r\n            }\r\n            const row: IGroupRow | null = await expandGroup(expandInfo);\r\n            if (row) {\r\n              const group: IGroup = {\r\n                ...newGroupRow,\r\n                doc1: ''\r\n              }\r\n              dispatch({ type: ActionTypes.SET_GROUP, payload: { groupRow: group } });\r\n            }\r\n          }\r\n            */\r\n        }\r\n      }\r\n      catch (error: any) {\r\n        console.log('error', error);\r\n        dispatch({ type: ActionTypes.SET_ERROR, payload: { error } });\r\n      }\r\n    }, []);\r\n\r\n\r\n  const cancelAddGroup = useCallback(\r\n    async () => {\r\n      try {\r\n        //const { topId, id, parentId } = activeGroup!;\r\n        //const groupKey: IGroupKey = { topId, parentId, id }; // TODO proveri\r\n\r\n        // const expandInfo: IExpandInfo = {\r\n        //   groupKey,\r\n        //   formMode: FormMode.None\r\n        // }\r\n        // const groupRow: IGroupRow | null = await expandGroup(expandInfo);\r\n        const groupRow: IGroupRow = activeGroup!;\r\n        if (groupRow) {\r\n          dispatch({ type: ActionTypes.CANCEL_ADD_SUB_GROUP, payload: { groupRow } });\r\n        }\r\n      }\r\n      catch (error: any) {\r\n        console.log('error', error);\r\n        dispatch({ type: ActionTypes.SET_ERROR, payload: { error } });\r\n      }\r\n    }, [activeGroup, expandGroup]);\r\n\r\n\r\n  const createGroup = useCallback(\r\n    async (group: IGroup) => {\r\n      const { id } = group;\r\n      dispatch({ type: ActionTypes.SET_LOADING_GROUP, payload: {} });\r\n      try {\r\n        const groupDto = new GroupDto(group, workspace).groupDto;\r\n        console.log(\"groupDto\", { groupDto })\r\n        const url = `${KnowledgeAPI.endpointGroup}`; //\r\n        console.time()\r\n        await Execute(\"POST\", url, groupDto, id)\r\n          .then(async (groupDtoEx: IGroupDtoEx) => {   //  | null\r\n            console.timeEnd();\r\n            const { groupDto } = groupDtoEx;\r\n            if (groupDto) {\r\n              //groupDto.TopId = topId!;\r\n              const group = new Group(groupDto).group;\r\n              console.log('Group successfully created', { group })\r\n              dispatch({ type: ActionTypes.CLOSE_GROUP_FORM, payload: {} })\r\n              // await loadAllGroupRows()\r\n              allGroupRows.set(group.id, { // TODO check it\r\n                ...group,\r\n                isExpanded: false\r\n              });\r\n              //.then(async () => { // done: boolean\r\n              //await loadTopRows();\r\n              //await onGroupIdChanged(topId, group.id); // replace 'generateId' with id, inside of tree\r\n              if (group.parentId === null) {\r\n                dispatch({ type: ActionTypes.SET_GROUP_ADDED, payload: { groupRow: group } }); // IGroup extends IGroup Row\r\n              }\r\n              else {\r\n                // const parentGroupKey: IGroupKey = {\r\n                //   topId: group.topId,\r\n                //   parentId: \"doesn't matter\",\r\n                //   id: group.parentId!\r\n                // };\r\n                // const expandInfo: IExpandInfo = {\r\n                //   groupKey: parentGroupKey,\r\n                //   formMode: FormMode.AddingGroup\r\n                // }\r\n                // alert('zovem expa')\r\n                // await expandGroup(expandInfo).then(() => {\r\n                //   dispatch({ type: ActionTypes.SET_GROUP_ADDED, payload: { groupRow: group } }); // IGroup extends IGroup Row\r\n                // });\r\n                dispatch({ type: ActionTypes.SET_GROUP_ADDED, payload: { groupRow: group } }); // IGroup extends IGroup Row\r\n              }\r\n              //})\r\n            }\r\n          });\r\n      }\r\n      catch (error: any) {\r\n        console.log(error)\r\n        dispatch({ type: ActionTypes.SET_ERROR, payload: { error: new Error('Server Error'), whichRowId: id } });\r\n      }\r\n    }, [Execute, KnowledgeAPI.endpointGroup, loadAllGroupRows, loadTopRows, workspace]);\r\n\r\n\r\n  const cancelAddAnswer = useCallback(\r\n    async () => {\r\n      try {\r\n        const { topId, parentId } = activeAnswer!;\r\n        const groupKey: IGroupKey = { topId, parentId, id: parentId! };\r\n        const expandInfo: IExpandInfo = {\r\n          groupKey,\r\n          formMode: FormMode.None\r\n        }\r\n        const groupRow: IGroupRow | null = await expandGroup(expandInfo);\r\n        if (groupRow) {\r\n          dispatch({ type: ActionTypes.CANCEL_ADD_ANSWER, payload: { groupRow } });\r\n        }\r\n      }\r\n      catch (error: any) {\r\n        console.log('error', error);\r\n        dispatch({ type: ActionTypes.SET_ERROR, payload: { error } });\r\n      }\r\n    }, [activeAnswer, expandGroup]);\r\n\r\n  const viewGroup = useCallback(async (groupRow: IGroupRow, includeAnswerId: string | null) => {\r\n    if (formMode === FormMode.AddingAnswer) {\r\n      await cancelAddAnswer();\r\n    }\r\n    else if (formMode === FormMode.AddingGroup) {\r\n      await cancelAddGroup();\r\n    }\r\n    dispatch({ type: ActionTypes.SET_LOADING_GROUP, payload: { groupRow } });\r\n    const groupKey = new GroupKey(groupRow).groupKey!;\r\n    const group: IGroup = await getGroup(groupKey, includeAnswerId);\r\n    if (group instanceof Error)\r\n      dispatch({ type: ActionTypes.SET_ERROR, payload: { error: group } });\r\n    else {\r\n      group.topId = groupRow.topId;\r\n      dispatch({ type: ActionTypes.SET_GROUP_TO_VIEW, payload: { groupRow: group } });\r\n    }\r\n  }, [cancelAddGroup, cancelAddAnswer, formMode, getGroup]);\r\n\r\n\r\n  const editGroup = useCallback(async (groupRow: IGroupRow, includeAnswerId: string | null) => {\r\n    // includeAnswerId = null;\r\n    //const { topId, parentId } = groupRow;\r\n    if (formMode === FormMode.AddingAnswer) {\r\n      await cancelAddAnswer();\r\n    }\r\n    else if (formMode === FormMode.AddingGroup) {\r\n      await cancelAddGroup();\r\n    }\r\n    dispatch({ type: ActionTypes.SET_LOADING_GROUP, payload: {} });\r\n    const groupKey = new GroupKey(groupRow).groupKey!;\r\n    const group: IGroup = await getGroup(groupKey, includeAnswerId);\r\n    if (group instanceof Error)\r\n      dispatch({ type: ActionTypes.SET_ERROR, payload: { error: group } });\r\n    else {\r\n      const grpRow: IGroupRow = { ...group, isExpanded: false, groupRows: [], answerRows: [] }\r\n      dispatch({ type: ActionTypes.SET_GROUP_TO_EDIT, payload: { groupRow: grpRow, group } });\r\n      /*\r\n      if (parentId === null) { // topRow\r\n        group.topId = groupRow.topId;\r\n        dispatch({ type: ActionTypes.SET_GROUP_TO_EDIT, payload: { groupRow: group } });\r\n      }\r\n      else {\r\n        const parentKey: IGroupKey = { topId, parentId, id: parentId }\r\n        // get acurate info from server (children will be collapsed)\r\n        const expandInfo: IExpandInfo = {\r\n          groupKey: parentKey,\r\n          formMode: FormMode.EditingGroup\r\n        }\r\n        await expandGroup(expandInfo).then(() => {\r\n          group.topId = groupRow.topId;\r\n          dispatch({ type: ActionTypes.SET_GROUP_TO_EDIT, payload: { groupRow: group } });\r\n        })\r\n      }\r\n        */\r\n    }\r\n  }, [cancelAddGroup, cancelAddAnswer, formMode, getGroup]);\r\n\r\n\r\n  const updateGroup = useCallback(\r\n    async (group: IGroup) => { // , closeForm: boolean\r\n      //const { topId, id, variations, title, kind, modified } = group;\r\n      dispatch({ type: ActionTypes.SET_LOADING_GROUP, payload: {} });\r\n      try {\r\n        const groupDto = new GroupDto(group, workspace).groupDto;\r\n        const url = `${KnowledgeAPI.endpointGroup}`;\r\n        console.time()\r\n        await Execute(\"PUT\", url, groupDto)\r\n          .then((groupDtoEx: IGroupDtoEx) => {\r\n            console.timeEnd();\r\n            const { groupDto, msg } = groupDtoEx;\r\n            if (groupDto) {\r\n              const group = new Group(groupDto).group;\r\n              const { topId } = group;\r\n              group.isExpanded = false;\r\n              group.topId = topId;\r\n              dispatch({ type: ActionTypes.SET_GROUP_UPDATED, payload: { /*groupRow: group, */group } });\r\n              // if (closeForm) {\r\n              //   dispatch({ type: ActionTypes.CLOSE_GROUP_FORM, payload: {} })\r\n              // }\r\n            }\r\n            else {\r\n              dispatch({ type: ActionTypes.SET_ERROR, payload: { error: new Error(`${msg}`) } });\r\n            }\r\n          });\r\n      }\r\n      catch (error: any) {\r\n        console.log(error)\r\n        dispatch({ type: ActionTypes.SET_ERROR, payload: { error: new Error(\"Karambol\") } });\r\n        return error;\r\n      }\r\n    }, [Execute, KnowledgeAPI.endpointGroup, workspace]);\r\n\r\n\r\n  const deleteGroup = useCallback(async (groupRow: IGroupRow) => {\r\n    //dispatch({ type: ActionTypes.SET_GROUP_LOADING, payload: { id, loading: false } });\r\n    try {\r\n      const { topId, parentId } = groupRow;\r\n      const groupDto = new GroupRowDto(groupRow, workspace).groupRowDto;\r\n      const url = `${KnowledgeAPI.endpointGroup}`;\r\n      console.time()\r\n      await Execute(\"DELETE\", url, groupDto)    //Modified: {  Time: new Date(), NickName: globalState.authUser.nickName }\r\n        .then(async (groupDtoEx: IGroupDtoEx) => {\r\n          console.timeEnd();\r\n          const { groupDto, msg } = groupDtoEx;\r\n          if (msg === \"OK\") {\r\n            // await loadAndCacheAllGroupRows(); // reload\r\n            console.log('Group successfully deleted', { groupRow })\r\n            await loadAllGroupRows()\r\n              .then(async () => {\r\n                const expandInfo: IExpandInfo = {\r\n                  groupKey: { topId, parentId: '', id: parentId! },\r\n                  formMode: FormMode.None\r\n                }\r\n                if (parentId) {\r\n                  await loadTopRows();\r\n                }\r\n                else {\r\n                  await expandGroup(expandInfo).then(() => {\r\n                    // dispatch({ type: ActionTypes.DELETE_GROUP, payload: { id: groupDto!.Id } });\r\n                    // dispatch({ type: ActionTypes.SET_GROUP, payload: { groupRow: group } }); // IGroup extends IGroup Row\r\n                  });\r\n                }\r\n              })\r\n          }\r\n          else if (msg === \"HasSubGroups\") {\r\n            dispatch({ type: ActionTypes.SET_ERROR, payload: { error: new Error(\"First remove sub groups\"), whichRowId: groupDto!.Id } });\r\n          }\r\n          else if (msg === \"HasAnswers\") {\r\n            dispatch({ type: ActionTypes.SET_ERROR, payload: { error: new Error(\"First remove group answers\"), whichRowId: groupDto!.Id } });\r\n          }\r\n          else {\r\n            dispatch({ type: ActionTypes.SET_ERROR, payload: { error: new Error(msg), whichRowId: groupDto!.Id } });\r\n          }\r\n        })\r\n    }\r\n    catch (error: any) {\r\n      console.log(error)\r\n      return error;\r\n    }\r\n  }, [Execute, KnowledgeAPI.endpointGroup, expandGroup, loadAllGroupRows, loadTopRows, workspace]);\r\n\r\n\r\n  const deleteGroupVariation = async (groupKey: IGroupKey, variationName: string) => {\r\n    try {\r\n      console.log(\"Deleting Group Tag...\", { groupKey, variationName });\r\n      // const group = await dbp!.get('Groups', id);\r\n      // const obj: IGroup = {\r\n      //   ...group,\r\n      //   variations: group.variations.filter((variation: string) => variation !== variationName),\r\n      //   modified: {\r\n      //     Time: new Date(),\r\n      //     by: {\r\n      //       nickName: globalState.authUser.nickName\r\n      //     }\r\n      //   }\r\n      // }\r\n      // POPRAVI TODO\r\n      //updateGroup(obj, false);\r\n      console.log(\"Group Tag successfully deleted\");\r\n    }\r\n    catch (error: any) {\r\n      console.log('error', error);\r\n      dispatch({ type: ActionTypes.SET_ERROR, payload: { error } });\r\n    }\r\n  };\r\n\r\n\r\n  ////////////////////////////////////\r\n  // Answers\r\n  //\r\n\r\n  const PAGE_SIZE = 12;\r\n  const loadGroupAnswers = useCallback(async ({ groupKey, startCursor, includeAnswerId }: ILoadGroupAnswers): Promise<any> => {\r\n    try {\r\n      const { topId, id } = groupKey;\r\n      dispatch({ type: ActionTypes.SET_ANSWERS_LOADING, payload: {} })\r\n      try {\r\n        const url = `${KnowledgeAPI.endpointAnswer}/${workspace}/${topId}/${id}/${startCursor}/${PAGE_SIZE}/${includeAnswerId}`;\r\n        console.time()\r\n        await Execute!(\"GET\", url).then((groupDtoEx: IGroupDtoEx) => {\r\n          console.timeEnd();\r\n          const { groupDto } = groupDtoEx;\r\n          if (groupDto !== null) {\r\n            const group = new Group(groupDto).group;\r\n            // const { Title, AnswerRowDtos, HasMoreAnswers } = groupDto;\r\n            // AnswerRowDtos!.forEach((answerRowDto: IAnswerRowDto) => {\r\n            //   if (includeAnswerId && answerRowDto.Id === includeAnswerId) {\r\n            //     answerRowDto.Included = true;\r\n            //   }\r\n            //   answerRowDto.GroupTitle = Title; // TODO treba li\r\n            //   answerRowDtos.push(answerRowDto);\r\n            // })\r\n            // const answerRows: IAnswerRow[] = answerRowDtos.map(dto => new AnswerRow(dto).answerRow);\r\n            // dispatch({\r\n            //   type: ActionTypes.GROUP_ANSWERS_LOADED,\r\n            //   payload: { id, answerRows, hasMoreAnswers: HasMoreAnswers! }\r\n            // });\r\n            dispatch({\r\n              type: ActionTypes.GROUP_ANSWERS_LOADED,\r\n              payload: { groupRow: group }\r\n            });\r\n          }\r\n        });\r\n      }\r\n      catch (error: any) {\r\n        console.log(error)\r\n        dispatch({ type: ActionTypes.SET_ERROR, payload: { error } });\r\n      }\r\n    }\r\n    catch (error: any) {\r\n      console.log(error);\r\n      dispatch({ type: ActionTypes.SET_ERROR, payload: error });\r\n    }\r\n  }, [Execute, KnowledgeAPI.endpointAnswer, workspace]);\r\n\r\n\r\n  const addAnswer = useCallback(\r\n    async (groupKey: IGroupKey) => {\r\n      try {\r\n        const { topId, id } = groupKey;\r\n        let groupRow = await getGrp(id!);\r\n        if (!groupRow) {\r\n          alert(`Not found ${id}. Reload all Groups`)\r\n          return;\r\n        }\r\n        const newAnswerRow: IAnswerRow = {\r\n          topId,\r\n          parentId: groupKey.id,\r\n          id: 'generateId', // do not change\r\n          title: 'answer text',\r\n          groupTitle: groupRow.title,\r\n          included: true\r\n        }\r\n        const answer: IAnswer = {\r\n          ...initialAnswer,\r\n          ...newAnswerRow,\r\n          title: ''\r\n        }\r\n        // console.assert(isExpanded);\r\n        // if (isExpanded) {\r\n        const topRow: IGroupRow = state.topRows.find(c => c.id === topId)!;\r\n        const grpRow: IGroupRow | undefined = await findGroupRow(topRow, id)!;\r\n        dispatch({\r\n          type: ActionTypes.ADD_NEW_ANSWER_TO_ROW, payload: {\r\n            groupRow: { ...grpRow!, answerRows: [newAnswerRow, ...grpRow!.answerRows!] },\r\n            newAnswerRow\r\n          }\r\n        });\r\n        dispatch({ type: ActionTypes.SET_ANSWER, payload: { answer, formMode: FormMode.AddingAnswer } });\r\n        //}\r\n        // else {\r\n        //   const expandInfo: IExpandInfo = {\r\n        //     groupKey,\r\n        //     formMode: FormMode.AddingAnswer,\r\n        //     newAnswerRow\r\n        //   }\r\n        //   await expandGroup(expandInfo);\r\n        //   dispatch({ type: ActionTypes.SET_ANSWER, payload: { answer, formMode: FormMode.AddingAnswer } });\r\n        // }\r\n\r\n      }\r\n      catch (error: any) {\r\n        console.log('error', error);\r\n        dispatch({ type: ActionTypes.SET_ERROR, payload: { error } });\r\n      }\r\n    }, [expandGroup, findGroupRow, getGrp, state.topRows]);\r\n\r\n\r\n  const createAnswer = useCallback(\r\n    async (answer: IAnswer) => {\r\n      const { topId, id, parentId } = answer; // title, modified, \r\n      // TODO\r\n      dispatch({ type: ActionTypes.SET_LOADING_GROUP, payload: {} });\r\n      try {\r\n        answer.created!.nickName = nickName;\r\n        const answerDto = new AnswerDto(answer, workspace).answerDto;\r\n        const url = `${KnowledgeAPI.endpointAnswer}`;\r\n        console.time()\r\n        console.log('>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> createAnswer', answerDto)\r\n        await Execute(\"POST\", url, answerDto)\r\n          .then(async (answerDtoEx: IAnswerDtoEx | null) => {\r\n            console.timeEnd();\r\n            if (answerDtoEx) {\r\n              console.log(\"::::::::::::::::::::\", { answerDtoEx });\r\n              const { answerDto } = answerDtoEx;\r\n              if (answerDto) {\r\n                const answer = new Answer(answerDto).answer;\r\n                answer.topId = topId;\r\n                console.log('Answer successfully created')\r\n                //dispatch({ type: ActionTypes.CLOSE_ANSWER_FORM })\r\n                await loadAllGroupRows() // numOfAnswers changed\r\n                  .then(async () => {\r\n                    const parentGroupKey: IGroupKey = { topId, parentId, id: parentId! };\r\n                    const expandInfo: IExpandInfo = {\r\n                      groupKey: parentGroupKey,\r\n                      formMode: FormMode.EditingAnswer\r\n                    }\r\n                    await expandGroup(expandInfo).then(() => {\r\n                      dispatch({ type: ActionTypes.SET_ANSWER, payload: { formMode: FormMode.EditingAnswer, answer } });\r\n                    });\r\n                  })\r\n              }\r\n            }\r\n          });\r\n      }\r\n      catch (error: any) {\r\n        console.log(error)\r\n        dispatch({ type: ActionTypes.SET_ERROR, payload: { error: new Error('Server Error'), whichRowId: id } });\r\n      }\r\n    }, [Execute, KnowledgeAPI.endpointAnswer, expandGroup, loadAllGroupRows, nickName, workspace]);\r\n\r\n\r\n  const updateAnswer = useCallback(\r\n    async (oldParentId: string, answer: IAnswer, groupChanged: boolean) => {\r\n      const { id } = answer; // , title, modified, parentId\r\n      // dispatch({ type: ActionTypes.SET_GROUP_LOADING, payload: { id: parentId!, loading: false } });\r\n      try {\r\n        answer.modified!.nickName = nickName;\r\n        const answerDto = new AnswerDto(answer, workspace).answerDto;\r\n        const url = `${KnowledgeAPI.endpointAnswer}`;\r\n        console.time()\r\n        answerDto.oldParentId = oldParentId;\r\n        console.log('>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> updateAnswer', answerDto)\r\n        let answerRet: IAnswer | null = null;\r\n        await Execute(\"PUT\", url, answerDto)\r\n          .then(async (answerDtoEx: IAnswerDtoEx) => {\r\n            console.timeEnd();\r\n            const { answerDto, msg } = answerDtoEx;\r\n            if (answerDto) {\r\n              answerRet = new Answer(answerDto).answer!;\r\n              console.log('Answer successfully updated: ', answerRet)\r\n              const { topId, parentId } = answerRet;\r\n              if (groupChanged) {\r\n                // nema koristi\r\n                // dispatch({ type: ActionTypes.SET_ANSWER, payload: { answer: answerRet } })\r\n                const { topId, parentId, id } = answerRet;\r\n                const keyExpanded: IKeyExpanded = {\r\n                  topId,\r\n                  groupId: parentId!,\r\n                  answerId: id\r\n                }\r\n                dispatch({ type: ActionTypes.FORCE_OPEN_NODE, payload: { keyExpanded } })\r\n              }\r\n              else {\r\n                const parentGroupKey: IGroupKey = { topId, parentId, id: parentId! }; // proveri\r\n                const expandInfo: IExpandInfo = {\r\n                  groupKey: parentGroupKey,\r\n                  formMode: FormMode.EditingAnswer\r\n                }\r\n                await expandGroup(expandInfo).then(() => {\r\n                  dispatch({ type: ActionTypes.SET_ANSWER, payload: { formMode: FormMode.EditingAnswer, answer: answerRet! } });\r\n                });\r\n              }\r\n            }\r\n            else {\r\n              dispatch({ type: ActionTypes.SET_ERROR, payload: { error: new Error(msg) } });\r\n            }\r\n          });\r\n        return answerRet;\r\n      }\r\n      catch (error: any) {\r\n        console.log(error)\r\n        dispatch({ type: ActionTypes.SET_ERROR, payload: { error: new Error('Server Error'), whichRowId: id } });\r\n      }\r\n    }, [Execute, KnowledgeAPI.endpointAnswer, expandGroup, nickName, workspace]);\r\n\r\n\r\n  const deleteAnswer = useCallback(\r\n    async (answerRow: IAnswerRow, isActive: boolean) => {\r\n      const { id, parentId, topId } = answerRow;\r\n      dispatch({ type: ActionTypes.SET_LOADING_ANSWER, payload: {} });\r\n      try {\r\n        const answerDto = new AnswerRowDto(answerRow, workspace).answerRowDto;\r\n        const url = `${KnowledgeAPI.endpointAnswer}`;\r\n        console.time()\r\n        await Execute(\"DELETE\", url, answerDto)\r\n          .then(async (answerDtoEx: IAnswerDtoEx) => {\r\n            const { answerDto } = answerDtoEx;\r\n            console.timeEnd();\r\n            if (answerDto) {\r\n              const answer = new Answer(answerDto).answer;\r\n              console.log('Answer successfully deleted')\r\n              if (isActive) {\r\n                dispatch({ type: ActionTypes.ANSWER_DELETED, payload: { answer } });\r\n              }\r\n              /*\r\n              //dispatch({ type: ActionTypes.CLOSE_ANSWER_FORM })\r\n              await loadAndCacheAllGroupRows(); // reload\r\n              */\r\n              const parentGroupKey: IGroupKey = { topId, parentId, id: parentId! }; // proveri\r\n              const expandInfo: IExpandInfo = {\r\n                groupKey: parentGroupKey,\r\n                formMode: FormMode.None\r\n              }\r\n              await expandGroup(expandInfo).then(() => {\r\n                // dispatch({ type: ActionTypes.SET_GROUP, payload: { groupRow: group } }); // IGroup extends IGroup Row\r\n              })\r\n            }\r\n            else {\r\n              console.error(answerDtoEx);\r\n              dispatch({ type: ActionTypes.SET_ERROR, payload: { error: new Error('Server Error'), whichRowId: id } });\r\n            }\r\n          });\r\n      }\r\n      catch (error: any) {\r\n        console.log(error)\r\n        dispatch({ type: ActionTypes.SET_ERROR, payload: { error: new Error('Server Error'), whichRowId: id } });\r\n      }\r\n    }, [Execute, KnowledgeAPI.endpointAnswer, expandGroup, workspace]);\r\n\r\n\r\n  const getAnswer = useCallback(\r\n    async (answerKey: IAnswerKey): Promise<any> => {\r\n      return new Promise(async (resolve) => {\r\n        try {\r\n          const query = new AnswerKey(answerKey).toQuery(workspace);\r\n          const url = `${KnowledgeAPI.endpointAnswer}?${query}`;\r\n          console.time()\r\n          console.log('getAnswer', answerKey)\r\n          await Execute(\"GET\", url)\r\n            .then((answerDtoEx: IAnswerDtoEx) => {\r\n              console.timeEnd();\r\n              const { answerDto, msg } = answerDtoEx;\r\n              if (answerDto) {\r\n                const answerEx: IAnswerEx = {\r\n                  answer: new Answer(answerDto).answer,\r\n                  msg\r\n                }\r\n                resolve(answerEx);\r\n              }\r\n              else {\r\n                const answerEx: IAnswerEx = {\r\n                  answer: null,\r\n                  msg\r\n                }\r\n                resolve(answerEx);\r\n              }\r\n              //}\r\n            });\r\n        }\r\n        catch (error: any) {\r\n          console.log(error);\r\n          const answerEx: IAnswerEx = {\r\n            answer: null,\r\n            msg: \"Problemos\"\r\n          }\r\n          resolve(answerEx);\r\n        }\r\n      })\r\n    }, [Execute, KnowledgeAPI.endpointAnswer, workspace]);\r\n\r\n\r\n  const viewAnswer = useCallback(async (answerRow: IAnswerRow) => {\r\n    const answerKey = new AnswerKey(answerRow).answerKey;\r\n    dispatch({ type: ActionTypes.SET_LOADING_ANSWER, payload: {} });\r\n    const answerEx: IAnswerEx = await getAnswer(answerKey!);\r\n    if (formMode === FormMode.AddingAnswer) {\r\n      await cancelAddAnswer();\r\n    }\r\n    else if (formMode === FormMode.AddingGroup) {\r\n      await cancelAddGroup();\r\n    }\r\n    const { answer, msg } = answerEx;\r\n    if (answer) {\r\n      answer.topId = answerRow.topId;\r\n      dispatch({ type: ActionTypes.SET_ANSWER_TO_VIEW, payload: { answer } });\r\n    }\r\n    else\r\n      dispatch({ type: ActionTypes.SET_ERROR, payload: { error: new Error(msg) } });\r\n  }, [cancelAddGroup, cancelAddAnswer, formMode, getAnswer]);\r\n\r\n\r\n  // const editAnswer = useCallback(async (answerRow: IAnswerRow) => {\r\n  //   const answerKey: IAnswerKey = new AnswerKey(answerRow).answerKey!;\r\n  //   if (formMode === FormMode.AddingAnswer) {\r\n  //     await cancelAddAnswer();\r\n  //   }\r\n  //   else if (formMode === FormMode.AddingGroup) {\r\n  //     await cancelAddGroup();\r\n  //   }\r\n  //   dispatch({ type: ActionTypes.SET_LOADING_ANSWER, payload: {} });\r\n  //   console.log(\"editAnswer:\", answerKey)\r\n  //   const answer = initialAnswer;\r\n  //   if (answer) {\r\n  //     // we don't reload groupRows, just use isSelected from activeAnswer\r\n  //     answer.topId = answerRow.topId;\r\n  //     dispatch({ type: ActionTypes.SET_ANSWER_TO_EDIT, payload: { answer } });\r\n  //   }\r\n  // }, [cancelAddGroup, cancelAddAnswer, formMode]);\r\n\r\n\r\n  const editAnswer = useCallback(async (answerRow: IAnswerRow) => {\r\n    const answerKey: IAnswerKey = new AnswerKey(answerRow).answerKey!;\r\n    if (formMode === FormMode.AddingAnswer) {\r\n      await cancelAddAnswer();\r\n    }\r\n    else if (formMode === FormMode.AddingGroup) {\r\n      await cancelAddGroup();\r\n    }\r\n    dispatch({ type: ActionTypes.SET_LOADING_ANSWER, payload: {} });\r\n    console.log(\"editAnswer:\", answerKey)\r\n    const answerEx: IAnswerEx = await getAnswer(answerKey!);\r\n    const { answer, msg } = answerEx;\r\n    if (answer) {\r\n      // we don't reload groupRows, just use isSelected from activeAnswer\r\n      answer.topId = answerRow.topId;\r\n\r\n      // const topRow: IGroupRow = state.topRows.find(c => c.id === answerRow.topId)!;\r\n      // const groupRow: IGroupRow = findGroupRow(topRow, answerRow.parentId)!;\r\n      //dispatch({ type: ActionTypes.SET_ANSWER_TO_EDIT, payload: { groupRow, answer } });\r\n      dispatch({ type: ActionTypes.CLOSE_ANSWER_FORM, payload: { answer } }); // to reset AnswerForm\r\n      dispatch({ type: ActionTypes.SET_ANSWER_TO_EDIT, payload: { answer } });\r\n    }\r\n    else\r\n      dispatch({ type: ActionTypes.SET_ERROR, payload: { error: new Error(msg) } });\r\n  }, [cancelAddGroup, cancelAddAnswer, formMode, getAnswer]);\r\n\r\n\r\n\r\n  // const onGroupIdChanged = useCallback(\r\n  //   async (topId: string, id: string): Promise<void> => {\r\n  //     const topRow: IGroupRow = topRows.find(c => c.id === topId)!;\r\n  //     console.log('Provider onGroupIdChanged >>>>>>:', topRow)\r\n  //     const groupRow: IGroupRow | undefined = await findGroupRow(topRow, 'generateId');\r\n  //     console.log('Provider onGroupIdChanged >>>>>>:', groupRow, id)\r\n  //     groupRow!.id = id;\r\n  //     dispatch({ type: ActionTypes.RE_RENDER_TREE, payload: { groupRow: groupRow! } });\r\n  //   }, [findGroupRow, topRows]);\r\n\r\n  const onGroupTitleChanged = useCallback(\r\n    async (topId: string, id: string, title: string): Promise<void> => {\r\n      //const { topRows } = state;\r\n      //const topRow: IGroupRow = topRows.find(c => c.id === group.topId)!;\r\n      const topRow: IGroupRow = topRows.find(c => c.id === topId)!;\r\n      //const groupRow: IGroupRow = findGroupRow(topRow.groupRows, id)!;\r\n      // if (!activeGroup || loadingGroup) { // just in case\r\n      //   console.log('Provider>>>>>>00000')\r\n      //   return;\r\n      // }\r\n      // const groupRow: IGroupRow = (topRow.id === id)\r\n      //   ? topRow\r\n      //   : findGroupRow(topRow.groupRows, id)!;\r\n      let groupRow: IGroupRow | undefined = await findGroupRow(topRow, id);\r\n      // console.log('Provider onGroupTitleChanged >>>>>>:', group)\r\n      //console.log('Provider onGroupTitleChanged:', title)\r\n      //group.title = title;\r\n      console.log('PROVIDER onGroupTitleChanged::', groupRow!.title, title)\r\n      if (groupRow!.title !== title) {\r\n        groupRow!.title = title === '' ? 'New Group' : title; // to avoid empty title\r\n        dispatch({\r\n          type: ActionTypes.RE_RENDER_TREE, payload: { groupRow: groupRow! }\r\n        });\r\n      }\r\n      return;\r\n    }, [findGroupRow, topRows]);\r\n\r\n  const onAnswerTitleChanged = useCallback(\r\n    async (topRow: IGroupRow, answer: IAnswer, title: string): Promise<void> => {\r\n      const { parentId, id } = answer;\r\n      const groupRow: IGroupRow | undefined = await findGroupRow(topRow, parentId);\r\n      if (groupRow) {\r\n        const answerRow = groupRow.answerRows!.find(q => q.id === id)!;\r\n        answerRow.title = title;\r\n        // rerender\r\n        console.log('onAnswerTitleChanged+++>>>', id, groupRow)\r\n        dispatch({ type: ActionTypes.ANSWER_TITLE_CHANGED, payload: { groupRow } })\r\n      }\r\n    }, [findGroupRow]);\r\n\r\n\r\n  const contextValue: IGroupsContext = {\r\n    state, getSubGrps, getGrp,\r\n    loadAllGroupRows,\r\n    expandNodesUpToTheTree,\r\n    loadTopRows,\r\n    addSubGroup, cancelAddGroup, createGroup,\r\n    viewGroup, editGroup, updateGroup, deleteGroup, deleteGroupVariation,\r\n    expandGroup, collapseGroup, onGroupTitleChanged,\r\n    loadGroupAnswers,\r\n    addAnswer, cancelAddAnswer, createAnswer,\r\n    viewAnswer, editAnswer, updateAnswer, deleteAnswer, onAnswerTitleChanged\r\n  }\r\n\r\n  if (!isAuthenticated || !allGroupRowsLoaded)  // removed keyExpanded === null\r\n    return null;\r\n\r\n  return (\r\n    <GroupsContext.Provider value={contextValue}>\r\n      <GroupDispatchContext.Provider value={dispatch}>\r\n        {children}\r\n      </GroupDispatchContext.Provider>\r\n    </GroupsContext.Provider>\r\n  );\r\n}\r\n\r\nexport function useGroupContext() {\r\n  return useContext(GroupsContext);\r\n}\r\n\r\nexport const useGroupDispatch = () => {\r\n  return useContext(GroupDispatchContext)\r\n};\r\n\r\n","import type { IGroupKey, IGroupRow } from '@/groups/types';\r\n\r\nimport type { ActionMap } from \"@/global/types\";\r\n\r\n/////////////////////////////////////////////////////////////////////////\r\n// DropDown Select Group\r\n\r\nexport interface IGrpState {\r\n\tloading: boolean,\r\n\tparentId: string | null,\r\n\ttitle: string,\r\n\tcats: IGroupRow[], // drop down groups\r\n\terror?: Error;\r\n}\r\n\r\nexport interface IGrpInfo {\r\n\tselId: string | null;\r\n\tgroupKey: IGroupKey | null,\r\n\tlevel: number,\r\n\tsetParentId: (cat: IGroupRow) => void;\r\n}\r\n\r\nexport enum GrpActionTypes {\r\n\tSET_LOADING = 'SET_LOADING',\r\n\tSET_SUB_CATS = 'SET_SUB_CATS',\r\n\tSET_ERROR = 'SET_ERROR',\r\n\tSET_EXPANDED = 'SET_EXPANDED',\r\n\tSET_PARENT_CAT = 'SET_PARENT_CAT'\r\n}\r\n\r\nexport type GrpsPayload = {\r\n\t[GrpActionTypes.SET_LOADING]: false;\r\n\r\n\t[GrpActionTypes.SET_SUB_CATS]: {\r\n\t\tsubGrps: IGroupRow[];\r\n\t};\r\n\r\n\t[GrpActionTypes.SET_EXPANDED]: {\r\n\t\tid: string;\r\n\t\texpanding: boolean;\r\n\t}\r\n\r\n\t[GrpActionTypes.SET_ERROR]: {\r\n\t\terror: Error;\r\n\t};\r\n\r\n\t[GrpActionTypes.SET_PARENT_CAT]: {\r\n\t\tcat: IGroupRow;\r\n\t};\r\n\r\n};\r\n\r\nexport type GrpsActions =\r\n\tActionMap<GrpsPayload>[keyof ActionMap<GrpsPayload>];\r\n\r\n\r\n\r\nexport type GrpActions = ActionMap<GrpsPayload>[keyof ActionMap<GrpsPayload>];","import React from 'react';\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\nimport { faCaretRight, faCaretDown } from '@fortawesome/free-solid-svg-icons'\r\n\r\nimport { ListGroup, Button } from \"react-bootstrap\";\r\n\r\nimport { type IGroupRow } from \"@/groups/types\";\r\n\r\nimport GrpList from \"@/global/Components/SelectGroup/GrpList\";\r\nimport { type GrpsActions, GrpActionTypes } from './types';\r\n\r\ninterface IGrpRow {\r\n    cat: IGroupRow;\r\n    selId: string | null;\r\n    dispatch: React.Dispatch<GrpsActions>;\r\n    setParentGrp: (cat: IGroupRow) => void;\r\n}\r\n\r\nconst GrpRow = ({ cat, dispatch, setParentGrp, selId }: IGrpRow) => {\r\n    const { topId, parentId, id, title, level, isExpanded } = cat;\r\n    const groupKey = { topId, parentId, id };\r\n\r\n    //const { isDarkMode, variant, bg } = useGlobalState();\r\n\r\n    const expand = (_id: IDBValidKey) => {\r\n        dispatch({ type: GrpActionTypes.SET_EXPANDED, payload: { id, expanding: !isExpanded } });\r\n    }\r\n\r\n    const onSelectGrp = (cat: IGroupRow) => {\r\n        // Load data from server and reinitialize group\r\n        // viewGroup(id);\r\n        setParentGrp(cat);\r\n    }\r\n\r\n    const Row1 =\r\n        <div className=\"d-flex justify-content-start align-items-center w-100 text-primary\">\r\n            <Button\r\n                variant='link'\r\n                size=\"sm\"\r\n                className=\"py-0 px-1\"\r\n                onClick={(e) => {\r\n                    expand(id!);\r\n                    e.stopPropagation();\r\n                    e.preventDefault();\r\n                }}\r\n                title=\"Expand\"\r\n            >\r\n                <FontAwesomeIcon icon={isExpanded ? faCaretDown : faCaretRight} size='lg' />\r\n            </Button>\r\n            <Button\r\n                variant='link'\r\n                size=\"sm\"\r\n                className={`py-0 mx-0 text-decoration-none`}\r\n                title={id}\r\n                onClick={() => onSelectGrp(cat)}\r\n            >\r\n                {title}\r\n            </Button>\r\n        </div>\r\n\r\n    return (\r\n        <>\r\n            <ListGroup.Item\r\n                variant={\"primary\"}\r\n                className=\"py-0 px-1 w-100\"\r\n                as=\"li\"\r\n            >\r\n                {Row1}\r\n            </ListGroup.Item>\r\n\r\n            {isExpanded && // Row2\r\n                <ListGroup.Item\r\n                    className=\"py-0 px-0\"\r\n                    variant={\"primary\"}\r\n                    as=\"li\"\r\n                >\r\n                    <GrpList\r\n                        selId={selId}\r\n                        level={level + 1}\r\n                        groupKey={groupKey}\r\n                        setParentId={setParentGrp}\r\n                    />\r\n                </ListGroup.Item>\r\n            }\r\n\r\n        </>\r\n    );\r\n};\r\n\r\nexport default GrpRow;\r\n","import { type Reducer } from 'react'\r\nimport { type IGroupRow } from \"@/groups/types\";\r\nimport  { type GrpsActions, GrpActionTypes, type IGrpState } from './types';\r\n\r\nexport const initialState: IGrpState = {\r\n  loading: false,\r\n  parentId: null,\r\n  title: '',\r\n  cats: []\r\n}\r\n\r\nexport const GrpReducer: Reducer<IGrpState, GrpsActions> = (state, action) => {\r\n\r\n  switch (action.type) {\r\n    case GrpActionTypes.SET_LOADING:\r\n      return {\r\n        ...state,\r\n        loading: true\r\n      }\r\n\r\n    case GrpActionTypes.SET_SUB_CATS: {\r\n      const { subGrps } = action.payload;\r\n      return {\r\n        ...state,\r\n        cats: state.cats.concat(subGrps),\r\n        loading: false\r\n      }\r\n    }\r\n\r\n    case GrpActionTypes.SET_ERROR: {\r\n      const { error } = action.payload;\r\n      return { ...state, error, loading: false };\r\n    }\r\n\r\n    case GrpActionTypes.SET_EXPANDED: {\r\n      const { id, expanding } = action.payload;\r\n      let { cats } = state;\r\n      if (!expanding) {\r\n        const ids = markForClean(cats, id!)\r\n        console.log('clean:', ids)\r\n        if (ids.length > 0) {\r\n          cats = cats.filter(c => !ids.includes(c.id))\r\n        }\r\n      }\r\n      return {\r\n        ...state,\r\n        cats: state.cats.map(c => c.id === id\r\n          ? { ...c, isExpanded: expanding }\r\n          : c\r\n        )\r\n      };\r\n    }\r\n\r\n    case GrpActionTypes.SET_PARENT_CAT: {\r\n      const { cat } = action.payload;\r\n      const { id, title } = cat;\r\n      return {\r\n        ...state,\r\n        parentId: id!,\r\n        title\r\n      };\r\n    }\r\n\r\n    default:\r\n      return state;  // TODO throw error\r\n  }\r\n};\r\n\r\n\r\nfunction markForClean(cats: IGroupRow[], id: string | null) {\r\n  let deca = cats\r\n    .filter(c => c.parentId === id)\r\n    .map(c => c.id)\r\n\r\n  deca.forEach(id => {\r\n    const unuci = id ? markForClean(cats, id) : [];\r\n    deca = deca.concat(unuci);\r\n  })\r\n  return deca\r\n}","import { useEffect, useReducer, useState } from \"react\";\r\nimport { ListGroup } from \"react-bootstrap\";\r\nimport GrpRow from \"@/global/Components/SelectGroup/GrpRow\";\r\nimport { GrpReducer, initialState } from \"@/global/Components/SelectGroup/GrpReducer\";\r\n//import { useGlobalContext } from \"@/global/GlobalProvider\";\r\nimport { GrpActionTypes, type IGrpInfo } from \"./types\";\r\nimport type { IGroupKey, IGroupRow } from \"@/groups/types\";\r\nimport { useGroupContext } from \"@/groups/GroupProvider\";\r\n\r\nconst GrpList = ({ selId, groupKey, level, setParentId }: IGrpInfo) => {\r\n    const [state, dispatch] = useReducer(GrpReducer, initialState);\r\n    const { getSubGrps } = useGroupContext();\r\n\r\n    const { id } = groupKey ?? { id: null };\r\n    const [catKey] = useState<IGroupKey | null>(groupKey)\r\n\r\n    useEffect(() => {\r\n        (async () => {\r\n            const res = await getSubGrps(id);\r\n            const { subGrps } = res;\r\n            dispatch({ type: GrpActionTypes.SET_SUB_CATS, payload: { subGrps } });\r\n        })()\r\n    }, [getSubGrps, catKey, id]);\r\n\r\n    const mySubGrps = state.cats.filter(c => c.parentId === id);\r\n\r\n    const setParentGrp = (cat: IGroupRow) => {\r\n        dispatch({ type: GrpActionTypes.SET_PARENT_CAT, payload: { cat } })\r\n        setParentId!(cat);\r\n    }\r\n\r\n    return (\r\n        <div className={level > 1 ? 'border  border-7 ms-4 h-25' : 'border border-7  h-25'} style={{ overflowY: 'auto' }}>\r\n            <ListGroup as=\"ul\" variant='dark' className=\"mb-0\">\r\n                {mySubGrps.filter(c => c.id !== selId).map((cat: IGroupRow) =>\r\n                    <GrpRow\r\n                        cat={cat}\r\n                        selId={selId}\r\n                        dispatch={dispatch}\r\n                        setParentGrp={setParentGrp}\r\n                        key={cat.id}\r\n                    />\r\n                )\r\n                }\r\n            </ListGroup>\r\n\r\n            {state.error && state.error.message}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default GrpList;\r\n","import { type ChangeEvent, type FormEvent, useState, useEffect, useRef } from \"react\";\r\nimport { useDebounce } from \"@uidotdev/usehooks\";\r\nimport * as Yup from \"yup\";\r\nimport { useFormik } from \"formik\";\r\nimport { Form, CloseButton, Row, Col, Stack } from \"react-bootstrap\";\r\nimport { CreatedModifiedForm } from \"@/common/CreateModifiedForm\"\r\nimport { FormButtons } from \"@/common/FormButtons\"\r\nimport type { IGroupRow, IAnswer, IAnswerFormProps } from \"@/groups/types\";\r\nimport { ActionTypes } from \"@/groups/types\";\r\nimport { FormMode } from \"@/groups/types\";\r\n\r\nimport { Select } from '@/common/components/Select';\r\nimport { sourceOptions, statusOptions } from '@/common/Options';\r\nimport GrpList from '@/global/Components/SelectGroup/GrpList'\r\n\r\nimport { useGroupContext, useGroupDispatch } from \"@/groups/GroupProvider\";\r\nimport Dropdown from 'react-bootstrap/Dropdown';\r\n\r\nconst AnswerForm = ({ answer, submitForm, children, showCloseButton, source = 0, closeModal }: IAnswerFormProps) => {\r\n\r\n  // const { globalState } = useGlobalContext();\r\n  // const { isDarkMode, variant, bg } = globalState;\r\n\r\n  const { state, onAnswerTitleChanged } = useGroupContext();\r\n  let { formMode, topRows } = state;\r\n\r\n  const viewing = formMode === FormMode.ViewingAnswer;\r\n  const editing = formMode === FormMode.EditingAnswer;\r\n  const adding = formMode === FormMode.AddingAnswer;\r\n\r\n  const isDisabled = viewing;\r\n\r\n  const { topId, id, title: qTitle } = answer;\r\n  //const answerKey = new AnswerKey(answer).answerKey;\r\n  // const groupKey: IGroupKey = { topId, parentId, id: parentId! }; // proveri\r\n\r\n  const dispatch = useGroupDispatch();\r\n\r\n  const closeForm = () => {\r\n    if (closeModal) {\r\n      closeModal();\r\n    }\r\n    else {\r\n      dispatch({ type: ActionTypes.CLOSE_ANSWER_FORM, payload: { answer } })\r\n    }\r\n  }\r\n\r\n  const cancelForm = () => {\r\n    if (closeModal) {\r\n      closeModal();\r\n    }\r\n    else {\r\n      dispatch({ type: ActionTypes.CANCEL_ANSWER_FORM, payload: { answer } })\r\n    }\r\n  }\r\n\r\n  const [searchTerm, setSearchTerm] = useState(id + '/' + qTitle);\r\n  const debouncedSearchTerm = useDebounce(searchTerm, 500);\r\n\r\n  const [topRow] = useState<IGroupRow>(topRows.find(c => c.id === topId)!);\r\n\r\n  // eslint-disable-next-line no-self-compare\r\n  const nameRef = useRef<HTMLTextAreaElement>(null);\r\n\r\n  const formik = useFormik({\r\n    enableReinitialize: true,\r\n    initialValues: answer,\r\n    validationSchema: Yup.object().shape({\r\n      title: Yup.string().required(\"Required\"),\r\n      parentId: Yup.string().required(\"Required\").notOneOf(['000000000000000000000000'])\r\n    }),\r\n    onSubmit: (values: IAnswer) => {\r\n      // console.log('AnswerForm.onSubmit', JSON.stringify(values, null, 2))\r\n      submitForm(values)\r\n      //props.handleClose(false);\r\n      setSearchTerm(values.id + '/' + values.title);\r\n    }\r\n  });\r\n\r\n  useEffect(() => {\r\n    const goBre = async () => {\r\n      //if (debouncedSearchTerm && formik.values.title !== debouncedSearchTerm) {\r\n      //if (debouncedSearchTerm && searchTerm !== debouncedSearchTerm) {\r\n      const old = debouncedSearchTerm.split('/');\r\n      const Id = old[0];\r\n      if (formik.values.id === Id) {\r\n        console.log('AnswerForm.useEffect - onQuestioTitleChanged', { debouncedSearchTerm, searchTerm, title: formik.values.title });\r\n        const Title = old[1]\r\n        await onAnswerTitleChanged(topRow, formik.values, Title);\r\n      }\r\n    };\r\n    goBre();\r\n  }, [debouncedSearchTerm, formik.values, onAnswerTitleChanged, searchTerm, topRow]);\r\n\r\n  useEffect(() => {\r\n    nameRef.current!.focus();\r\n    if (source !== 0) {\r\n      formik.setFieldValue('source', source)\r\n    }\r\n  }, [formik, nameRef, source])\r\n\r\n\r\n  const handleChangeTitle = (event: ChangeEvent<HTMLTextAreaElement>) => {\r\n    formik.handleChange(event);\r\n    const value = event.target.value;\r\n    //if (value !== debouncedTitle)\r\n    //setTitle(value);\r\n    setSearchTerm(id + '/' + value);\r\n  };\r\n  \r\n  const setParentId = (cat: IGroupRow) => {\r\n    formik.setFieldValue('parentId', cat.id);\r\n    formik.setFieldValue('groupTitle', cat.title);\r\n  }\r\n\r\n  console.log('@@@@@@@@@@@@@@@@@@@@@ AnswerForm.render: ', { searchTerm, qTitle, debouncedSearchTerm });\r\n  //useEffect(() => {\r\n  //  setSearchTerm(qTitle);\r\n  //}, [qTitle]);\r\n\r\n  return (\r\n    <div className=\"form-wrapper px-3 py-1 my-0 my-1 w-100 answer-form\" >\r\n      {/* data-bs-theme={`${isDarkMode ? 'dark' : 'light'}`} */}\r\n      {showCloseButton && <CloseButton onClick={closeForm} className=\"float-end\" />}\r\n      <Row className='text-center'>\r\n        <Form.Label>Answer  {viewing ? 'Viewing' : editing ? 'Editing' : 'Adding'}</Form.Label>\r\n      </Row>\r\n      <Form onSubmit={formik.handleSubmit}>\r\n\r\n        <Stack direction=\"horizontal\" gap={0} className=\"border\">\r\n          <div className=\"p-0\"><Form.Label>Group:</Form.Label></div>\r\n          <div className=\"p-1\">\r\n            <Form.Group controlId=\"parentId\" className=\"group-select form-select-sm w-90\">\r\n              <Dropdown>\r\n                <Dropdown.Toggle variant=\"light\" id=\"dropdown-basic\" className=\"px-2 py-0 text-primary border\" disabled={isDisabled}>\r\n                  <span className=\"text-wrap me-1\">{formik.values.groupTitle}</span>\r\n                </Dropdown.Toggle>\r\n                <Dropdown.Menu className=\"p-0 border\" >\r\n                  <Dropdown.Item className=\"p-0 m-0 rounded-3\">\r\n                    <GrpList\r\n                      selId={formik.values.parentId}\r\n                      groupKey={null}  // TODO {groupKey}\r\n                      level={1}\r\n                      setParentId={setParentId}\r\n                    />\r\n                  </Dropdown.Item>\r\n                </Dropdown.Menu>\r\n              </Dropdown>\r\n\r\n              <Form.Control\r\n                as=\"input\"\r\n                name=\"parentId\"\r\n                onChange={formik.handleChange}\r\n                //onBlur={formik.handleBlur}\r\n                // onBlur={(e: React.FocusEvent<HTMLTextAreaElement>): void => {\r\n                //   if (isEdit && formik.initialValues.title !== formik.values.title)\r\n                //     formik.submitForm();\r\n                // }}\r\n                value={formik.values.parentId ? formik.values.parentId : ''}\r\n                placeholder='Group'\r\n                className=\"text-primary w-100\"\r\n                disabled={isDisabled}\r\n                hidden={true}\r\n              />\r\n              <Form.Text className=\"text-danger\">\r\n                {formik.touched.parentId && formik.errors.parentId ? (\r\n                  <div className=\"text-danger\">{formik.errors.parentId ? 'required' : ''}</div>\r\n                ) : null}\r\n              </Form.Text>\r\n            </Form.Group>\r\n          </div>\r\n        </Stack>\r\n\r\n        <Form.Group controlId=\"title\">\r\n          <Form.Label>Title</Form.Label>\r\n          <Form.Control\r\n            as=\"textarea\"\r\n            name=\"title\"\r\n            placeholder={formik.values.title === \"new Answer\" ? \"new Answer\" : \"answer text\"}\r\n            ref={nameRef}\r\n            onChange={handleChangeTitle}\r\n            // onBlur={formik.handleBlur}\r\n            // onBlur={(e: React.FocusEvent<HTMLTextAreaElement>): void => {\r\n            //   if (isEdit && formik.initialValues.title !== formik.values.title)\r\n            //     formik.submitForm();\r\n            // }}\r\n            value={formik.values.title}\r\n            rows={3}\r\n            className=\"text-primary w-100\"\r\n            disabled={isDisabled}\r\n          />\r\n          <Form.Text className=\"text-danger\">\r\n            {formik.touched.title && formik.errors.title ? (\r\n              <div className=\"text-danger\">{formik.errors.title}</div>\r\n            ) : null}\r\n          </Form.Text>\r\n        </Form.Group>\r\n\r\n        <Row>\r\n          <Col>\r\n            <Form.Group controlId=\"source\">\r\n              <Form.Label>Source</Form.Label>\r\n              <Select\r\n                id=\"source\"\r\n                name=\"source\"\r\n                options={sourceOptions}\r\n                onChange={(e: FormEvent<HTMLSelectElement>, value: any) => {\r\n                  e.preventDefault(); // ?\r\n                  formik.setFieldValue('source', value)\r\n                  // .then(() => { if (editing) formik.submitForm() })\r\n                }}\r\n                value={formik.values.source}\r\n                disabled={isDisabled}\r\n                classes=\"text-primary\"\r\n              />\r\n              <Form.Text className=\"text-danger\">\r\n                {formik.touched.source && formik.errors.source ? (\r\n                  <div className=\"text-danger\">{formik.errors.source}</div>\r\n                ) : null}\r\n              </Form.Text>\r\n            </Form.Group>\r\n          </Col>\r\n          <Col>\r\n            <Form.Group controlId=\"status\">\r\n              <Form.Label>Status</Form.Label>\r\n              <Select\r\n                id=\"status\"\r\n                name=\"status\"\r\n                options={statusOptions}\r\n                //onChange={formik.handleChange}\r\n                onChange={(e: FormEvent<HTMLSelectElement>, value: any) => {\r\n                  e.preventDefault(); // ?\r\n                  formik.setFieldValue('status', value)\r\n                  //.then(() => { if (editing) formik.submitForm() })\r\n                }}\r\n                value={formik.values.status}\r\n                disabled={isDisabled}\r\n                classes=\"text-primary\"\r\n              />\r\n              <Form.Text className=\"text-danger\">\r\n                {formik.touched.status && formik.errors.status ? (\r\n                  <div className=\"text-danger\">{formik.errors.status}</div>\r\n                ) : null}\r\n              </Form.Text>\r\n            </Form.Group>\r\n          </Col>\r\n        </Row>\r\n\r\n        {(viewing || editing) &&\r\n          <div className=\"my-1\">\r\n\r\n            <CreatedModifiedForm\r\n              created={answer.created}\r\n              modified={answer.modified}\r\n              classes=\"text-primary\"\r\n            />\r\n          </div>\r\n        }\r\n        {((formik.dirty && editing) || adding) &&\r\n          <FormButtons\r\n            cancelForm={cancelForm}\r\n            handleSubmit={formik.handleSubmit}\r\n            title={children}\r\n          />\r\n        }\r\n\r\n        {state.error && <div className=\"text-danger\">{state.error.message}</div>}\r\n\r\n      </Form>\r\n    </div >\r\n  );\r\n};\r\n\r\nexport default AnswerForm;","import { useGroupContext } from '@/groups/GroupProvider'\r\n\r\nimport AnswerForm from \"@/groups/components/answers/AnswerForm\";\r\nimport { type IAnswer } from \"@/groups/types\";\r\n\r\ninterface IProps {\r\n    closeModal?: () => void;\r\n    showCloseButton?: boolean;\r\n    source?: number;\r\n    setError?: (msg: string) => void;\r\n}\r\n\r\nconst AddAnswer = ({ closeModal, showCloseButton, source, setError }: IProps) => {\r\n\r\n    const { state, cancelAddAnswer, createAnswer } = useGroupContext();\r\n    const { activeAnswer } = state;\r\n    const topId = activeAnswer\r\n        ? activeAnswer.topId\r\n        : '';\r\n\r\n    if (!closeModal) {\r\n        // const cat = state.topGroupRows.find(c => c.id === answerRow.parentId)\r\n        // answerRow.groupTitle = cat ? cat.title : '';\r\n    }\r\n\r\n    const cancelAdd = async () => {\r\n        await cancelAddAnswer();\r\n    }\r\n\r\n\r\n    const submitForm = async (answerObject: IAnswer) => {\r\n        const newAnswer: IAnswer = {\r\n            ...answerObject,\r\n            topId: topId!,\r\n            created: {\r\n                time: new Date(),\r\n                nickName: ''\r\n            },\r\n            modified: undefined\r\n        }\r\n        const q = await createAnswer(newAnswer, closeModal !== undefined);\r\n        if (q) {\r\n            if (q.message) {\r\n                setError!(q.message)\r\n            }\r\n            else if (closeModal) {\r\n                closeModal();\r\n                //dispatch({ type: ActionTypes.CLEAN_TREE, payload: { id: q.parentId } })\r\n                //await openNode({ topId: '', id: q.parentId, answerId: q.id });\r\n            }\r\n        }\r\n    }\r\n\r\n    if (!activeAnswer)\r\n        return null;\r\n\r\n    // activeAnswer.title += odakle\r\n    return (\r\n        <AnswerForm\r\n            answer={activeAnswer!}\r\n            showCloseButton={showCloseButton ?? true}\r\n            source={source ?? 0}\r\n            closeModal={cancelAdd}\r\n            //formMode={FormMode.AddingAnswer}\r\n            submitForm={submitForm}\r\n        >\r\n            Create Answer\r\n        </AnswerForm >\r\n    )\r\n}\r\n\r\nexport default AddAnswer\r\n\r\n\r\n","import { useGroupContext } from '@/groups/GroupProvider'\r\n//import { useGlobalContext, useGlobalState } from '@/global/GlobalProvider'\r\n\r\nimport AnswerForm from \"@/groups/components/answers/AnswerForm\";\r\nimport { type IAnswer } from \"@/groups/types\";\r\n\r\nconst EditAnswer = ({ /*inLine*/ }: { inLine: boolean }) => {\r\n    const { state, updateAnswer } = useGroupContext();\r\n    const { activeAnswer } = state;  // loadingAnswer: answerLoading, \r\n    if (!activeAnswer)\r\n        return null;\r\n\r\n    //const { topId } = activeAnswer!;\r\n\r\n\r\n    if (!activeAnswer) {\r\n        return <div>Loading answer to edit...</div>\r\n    }\r\n\r\n    const submitForm = async (answerObject: IAnswer) => {\r\n        const newAnswer: IAnswer = {\r\n            ...answerObject,\r\n            created: undefined,\r\n            modified: {\r\n                time: new Date(),\r\n                nickName: ''\r\n            }\r\n        }\r\n\r\n        const { parentId } = activeAnswer;\r\n        const groupChanged = parentId !== newAnswer.parentId;\r\n        //const answerKey = new AnswerKey(activeAnswer).answerKey;\r\n        /*const answer =*/ await updateAnswer(parentId!, newAnswer, groupChanged);\r\n        /*\r\n        if (activeAnswer.parentId !== answer.parentId) {\r\n             await loadAndCacheAllGroupRows(); // reload, group could have been changed\r\n             await openNode({ topId: '', id: q.parentId, answerId: q.id });\r\n        }\r\n        */\r\n\r\n        // if (groupChanged) {\r\n        //     setTimeout(() => dispatch({ type: ActionTypes.CLOSE_ANSWER_FORM, payload: { answer: answer } }), 1000);\r\n        // }\r\n    };\r\n\r\n    return (\r\n        <AnswerForm\r\n            answer={activeAnswer!}\r\n            showCloseButton={true}\r\n            source={0}\r\n            submitForm={submitForm}\r\n        >\r\n            Update Answer\r\n        </AnswerForm>\r\n    );\r\n};\r\n\r\nexport default EditAnswer;\r\n","import { useEffect, useState } from 'react';\r\nimport { useGroupContext } from '@/groups/GroupProvider'\r\nimport type { IAnswer } from \"@/groups/types\";\r\nimport AnswerForm from \"@/groups/components/answers/AnswerForm\";\r\n\r\nconst ViewAnswer = ({ inLine }: { inLine: boolean }) => {\r\n    console.log(inLine ? \"ViewAnswer inLine\" : \"ViewAnswer not inLine\");\r\n    const { state } = useGroupContext();\r\n    const { activeAnswer } = state;\r\n    //const { topId, id, parentId } = activeAnswer!;\r\n\r\n    const [answer, setAnswer] = useState<IAnswer | null>(null);\r\n\r\n    useEffect(() => {\r\n        //const q = group!.answers.find(q => q.inEditing)\r\n        //if (group) {\r\n        //const q = group!.answers.find(q => q.id === id)\r\n        console.log(\"#################################### ViewAnswer setAnswer ...\", { activeAnswer })\r\n        //if (q) {\r\n        setAnswer(activeAnswer);\r\n        //}\r\n        //}\r\n    }, [activeAnswer]) // answerLoading\r\n    // if (answerLoading)\r\n    //     return <div>Loading answer...</div>\r\n    return (\r\n        <AnswerForm\r\n            answer={answer!}\r\n            showCloseButton={true}\r\n            source={0}\r\n            submitForm={() => { }}\r\n        >\r\n            View Answer\r\n        </AnswerForm>\r\n    );\r\n}\r\n\r\nexport default ViewAnswer;\r\n","import { useEffect } from 'react';\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\nimport { faRemove } from '@fortawesome/free-solid-svg-icons'\r\n\r\nimport { ListGroup, Button } from \"react-bootstrap\";\r\n\r\nimport { useGlobalState } from '@/global/GlobalProvider'\r\nimport { FormMode, type IGroupKey, type IAnswerRow } from \"@/groups/types\";\r\nimport { useGroupContext } from '@/groups/GroupProvider'\r\nimport { useHover } from \"@uidotdev/usehooks\";\r\n\r\nimport AddAnswer from \"@/groups/components/answers/AddAnswer\";\r\nimport EditAnswer from \"@/groups/components/answers/EditAnswer\";\r\nimport ViewAnswer from \"@/groups/components/answers/ViewAnswer\";\r\nimport Q from '@/assets/Q.png';\r\nimport QPlus from '@/assets/QPlus.png';\r\n\r\n\r\n//const AnswerRow = ({ answer, categoryInAdding }: { ref: React.ForwardedRef<HTMLLIElement>, answer: IAnswer, categoryInAdding: boolean | undefined }) => {\r\nconst AnswerRow = ({ answerRow, isSelected }: { answerRow: IAnswerRow, isSelected: boolean }) => {\r\n    const { id, topId, parentId, title } = answerRow; // , isSelected\r\n    //const answerKey: IAnswerKey = new AnswerKey(answerRow).answerKey!;\r\n    const categoryKey: IGroupKey = { topId, parentId, id: parentId! } // proveri\r\n\r\n    const { canEdit, authUser } = useGlobalState();\r\n    const { state, viewAnswer, addAnswer, editAnswer, deleteAnswer } = useGroupContext();\r\n\r\n    const { activeAnswer, formMode, loadingAnswer, answerLoaded } = state;\r\n    //const isSelected = useState(id === selectedAnswerId);\r\n\r\n    const showForm = activeAnswer !== null && activeAnswer.id === id;\r\n\r\n    //const [alreadyAdding] = useState(formMode === FormMode.AddingAnswer);\r\n    const alreadyAdding = formMode === FormMode.AddingAnswer;\r\n\r\n    const del = () => {\r\n        answerRow.modified = {\r\n            time: new Date(),\r\n            nickName: authUser.nickName\r\n        }\r\n        deleteAnswer(answerRow, showForm /* isActive */);\r\n    };\r\n\r\n    // const edit = async (Id: string) => {\r\n    //     // Load data from server and reinitialize answer\r\n    //     await editAnswer(answerRow);\r\n    // }\r\n\r\n    const onSelectAnswer = async (id: string) => {\r\n        console.log('AnswerRow onSelectAnswer', { id });\r\n        if (canEdit)\r\n            await editAnswer(answerRow);\r\n        else\r\n            await viewAnswer(answerRow);\r\n    }\r\n\r\n    const [hoverRef, hovering] = useHover();\r\n\r\n    useEffect(() => {\r\n        (async () => {\r\n            if (isSelected && !loadingAnswer && !answerLoaded) {\r\n                switch (formMode) {\r\n                    case FormMode.ViewingAnswer:\r\n                        await viewAnswer(answerRow);\r\n                        break;\r\n                    case FormMode.EditingAnswer:\r\n                        console.log('Zovem from AnswerRow')\r\n                        canEdit\r\n                            ? await editAnswer(answerRow)\r\n                            : await viewAnswer(answerRow);\r\n                        break;\r\n                }\r\n                // hoverRef!.current?\r\n                const el = document.getElementById(`AnswerRow${id}`);\r\n                el?.scrollIntoView({ behavior: 'smooth', block: 'end' });\r\n            }\r\n        })()\r\n        // after using new Answer() in getAnswer() editAnswer gets modified // viewAnswer, editAnswer\r\n    }, [canEdit, editAnswer, formMode, id, isSelected, loadingAnswer, answerLoaded, answerRow, viewAnswer]);\r\n\r\n    const Row1 =\r\n\r\n        <div id={`AnswerRow${id}`} className={`d-relative d-flex justify-content-start align-items-center w-100 mt-0 answer-row${isSelected ? '-selected' : ''}`} style={{ marginTop: '1px' }} >\r\n            <Button\r\n                variant='link'\r\n                size=\"sm\"\r\n                className=\"d-flex align-items-center px-1 text-secondary\"\r\n            >\r\n                <img width=\"22\" height=\"18\" src={Q} alt=\"Answer\" />\r\n            </Button>\r\n            <Button\r\n                variant='link'\r\n                size=\"sm\"\r\n                className={`p-0 px-1 m-1 ms-0 answer-row-title ${showForm ? 'fw-bold' : ''}`}\r\n                title={`id:${id!.toString()}`}\r\n                onClick={() => onSelectAnswer(id!)}\r\n                disabled={alreadyAdding}\r\n            >\r\n                {title}\r\n            </Button>\r\n            \r\n            {/* {canEdit && !alreadyAdding && hovering &&\r\n                <Button variant='link' size=\"sm\" className=\"ms-1 py-0 px-1 text-secondary\"\r\n                    //onClick={() => { dispatch({ type: ActionTypes.EDIT, answer }) }}>\r\n                    onClick={() => edit(_id!)}\r\n                >\r\n                    <FontAwesomeIcon icon={faEdit} size='lg' />\r\n                </Button>\r\n            } */}\r\n\r\n            {canEdit && !alreadyAdding && hovering &&\r\n                <div className=\"position-absolute text-nowrap d-flex align-items-center border border-0 border-warning p-0 end-0\">\r\n                    <Button\r\n                        variant='link'\r\n                        size=\"sm\"\r\n                        className=\"ms-1 p-0 text-secondary d-flex align-items-center\"\r\n                        title=\"Add Answer\"\r\n                        onClick={() => {\r\n                            //const categoryInfo: IGroupInfo = { categoryKey, level: 0 }\r\n                            addAnswer(categoryKey, true);\r\n                        }}\r\n                    >\r\n                        <img width=\"22\" height=\"18\" src={QPlus} alt=\"Add Answer\" />\r\n                    </Button>\r\n                    <Button variant='link' size=\"sm\" className=\"ms-0 p-0 text-secondary\"\r\n                        onClick={del}\r\n                    >\r\n                        <FontAwesomeIcon icon={faRemove} size='lg' />\r\n                    </Button>\r\n\r\n                </div>\r\n            }\r\n        </div>\r\n\r\n    // console.log('---@@@@@@@@@@@@@ AnswerRow', { id, isSelected, formMode, answerLoaded })\r\n    return (\r\n        // border border-3 border-danger\"\r\n        // <div className=\"py-0 px-0 w-100 list-group-item border\">\r\n        <ListGroup.Item\r\n            // variant={\"primary\"}\r\n            className=\"py-0 px-0 w-100\"\r\n            as=\"li\"\r\n        >\r\n            {isSelected && formMode === FormMode.AddingAnswer &&\r\n                <>\r\n                    <div id='div-answer' className=\"ms-0 d-md-none w-100\">\r\n                        <AddAnswer\r\n                            showCloseButton={true}\r\n                            source={0} />\r\n                    </div>\r\n                    <div ref={hoverRef} className=\"d-none d-md-block  border rounded-3\">\r\n                        {Row1}\r\n                    </div>\r\n                </>\r\n            }\r\n\r\n            {isSelected && formMode === FormMode.EditingAnswer &&\r\n                <>\r\n                    <div ref={hoverRef} className=\"\">\r\n                        {/* d-none d-md-block */}\r\n                        {Row1}\r\n                    </div>\r\n                    {/* <div class=\"d-lg-none\">hide on lg and wider screens</div> */}\r\n                    {/* <div id='div-answer' className=\"ms-0 d-md-none w-100\"> */}\r\n                    <div id='div-answer' className=\"ms-0 d-md-none w-100\">\r\n                        <EditAnswer inLine={true} />\r\n                    </div>\r\n                </>\r\n            }\r\n\r\n            {isSelected && formMode === FormMode.ViewingAnswer &&\r\n                <>\r\n                    <div ref={hoverRef} className=\"\">\r\n                        {/* d-none d-md-block */}\r\n                        {Row1}\r\n                    </div>\r\n                    {/* <div class=\"d-lg-none\">hide on lg and wider screens</div> */}\r\n                    <div ref={hoverRef} id='div-answer' className=\"ms-0 d-md-none w-100\">\r\n                        <ViewAnswer inLine={true} />\r\n                    </div>\r\n                </>\r\n            }\r\n\r\n            {!isSelected &&\r\n                // d-none d-md-block\r\n                <div ref={hoverRef} className=\"\">\r\n                    {Row1}\r\n                </div>\r\n            }\r\n\r\n        </ListGroup.Item>\r\n    );\r\n};\r\n\r\nexport default AnswerRow;\r\n","import { GroupKey, type IGroupRow, type ILoadGroupAnswers, type IAnswerRow } from \"@/groups/types\";\r\nimport { useGroupContext } from \"@/groups/GroupProvider\";\r\nimport useInfiniteScroll from \"react-infinite-scroll-hook\";\r\nimport { List, ListItem, Loading } from \"@/common/components/InfiniteList\";\r\nimport AnswerRow from \"@/groups/components/answers/AnswerRow\";\r\n\r\n//const AnswerList = ({ title, groupRow, level }: IParentInfo) => {\r\nconst AnswerList = ({ groupRow }: { groupRow: IGroupRow }) => {\r\n  const { state, loadGroupAnswers } = useGroupContext();\r\n  const { keyExpanded, loadingAnswer, error, selectedAnswerId } = state;\r\n  const { answerId } = keyExpanded!;\r\n  //? keyExpanded\r\n\r\n  groupRow.level += 1;\r\n  const { answerRows } = groupRow;\r\n  // console.log('@@@@@@@@@@@@@ AnswerList', { answerRows })\r\n\r\n  let hasMoreAnswers = false;\r\n\r\n  async function loadMore() {\r\n    try {\r\n      // const parentInfo: IParentInfo = {\r\n      //   groupRow,\r\n      //   startCursor: answerRows.length,\r\n      //   includeAnswerId: answerId ?? null\r\n      // }\r\n\r\n      const x: ILoadGroupAnswers = {\r\n        groupKey: new GroupKey(groupRow).groupKey!,\r\n        startCursor: answerRows!.length,\r\n        includeAnswerId: answerId ?? null\r\n      }\r\n      console.log('^^^^^^^^^^^^^ loadMore')\r\n      console.log('^^^^^^^^^^^^^', { x })\r\n      console.log('^^^^^^^^^^^^^ loadMore')\r\n      await loadGroupAnswers(x);\r\n    }\r\n    catch (error) {\r\n    }\r\n    finally {\r\n    }\r\n  }\r\n\r\n  // useEffect(() => {\r\n  //   //if (numOfAnswers > 0 && answerRows.length === 0) { // TODO\r\n  //   if (answerRows.length === 0) { // TODO\r\n  //     loadMore();\r\n  //   }\r\n  // }, [numOfAnswers, answerRows])\r\n\r\n\r\n  const [infiniteRef, { rootRef }] = useInfiniteScroll({\r\n    loading: loadingAnswer,\r\n    hasNextPage: hasMoreAnswers!,\r\n    onLoadMore: loadMore,\r\n    disabled: Boolean(error),\r\n    rootMargin: '0px 0px 100px 0px',\r\n  });\r\n\r\n  // console.log(\"QQQQQQQQQQQQQQQQQQQQQQQQQQQQQ AnswerList\", answerRows)\r\n  // if (loadingAnswer)\r\n  //   return <div> ... loading</div>\r\n\r\n  return (\r\n    <div\r\n      ref={rootRef}\r\n      className=\"ms-0\" // border border-1 border-info rounded-2\"\r\n      // className=\"max-h-[500px] max-w-[500px] overflow-auto bg-slate-100\"\r\n      style={{ maxHeight: '400px', overflowY: 'auto' }}\r\n    >\r\n      <List>\r\n        {answerRows!.length === 0 &&\r\n          <label>No answers</label>\r\n        }\r\n        {answerRows!.map((answerRow: IAnswerRow) => {\r\n          return <AnswerRow key={answerRow.id} answerRow={answerRow} isSelected={answerRow.id === selectedAnswerId} />\r\n        })}\r\n        {hasMoreAnswers && (\r\n          <ListItem ref={infiniteRef}>\r\n            <Loading />\r\n          </ListItem>\r\n        )}\r\n      </List>\r\n      {error && <p>Error: {error.message}</p>}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AnswerList;\r\n","import { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\nimport { faRemove, faThumbsUp, faPlus } from '@fortawesome/free-solid-svg-icons'\r\n\r\nimport { Button, Badge } from \"react-bootstrap\";\r\n\r\nimport { useGlobalState } from '@/global/GlobalProvider'\r\nimport { type IGroupKey, FormMode } from \"@/groups/types\";\r\nimport { useGroupContext } from '@/groups/GroupProvider'\r\nimport { type IVariation } from '@/groups/types'\r\nimport { useHover } from \"@uidotdev/usehooks\";\r\n\r\n// import AddTag from \"groups/components/tags/AddTag\";\r\n// import EditTag from \"groups/components/tags/EditTag\";\r\n// import ViewTag from \"groups/components/tags/ViewTag\";\r\n\r\n//const TagRow = ({ tag, groupInAdding }: { ref: React.ForwardedRef<HTMLLIElement>, tag: IVariation, groupInAdding: boolean | undefined }) => {\r\nconst VariationRow = ({ groupKey, tag, groupInAdding }: { groupKey: IGroupKey, tag: IVariation, groupInAdding: boolean | undefined }) => {\r\n    //const { topId, id } = groupKey;\r\n    const { name } = tag;\r\n    const { inViewing, inEditing, inAdding } = {\r\n        //parentId: '',\r\n        //level: 0,\r\n        inViewing: false,\r\n        inEditing: false,\r\n        inAdding: false,\r\n        //numOfTags: 4\r\n    };\r\n\r\n    const { canEdit } = useGlobalState();\r\n\r\n    // const { state, viewTag, editTag, deleteTag } = useGroupContext();\r\n    const { state, deleteGroupVariation } = useGroupContext();\r\n    //const dispatch = useGroupDispatch();\r\n\r\n    const alreadyAdding = false //state.mode === Mode.AddingTag;\r\n\r\n    const del = () => {\r\n        deleteGroupVariation(groupKey, name);\r\n    };\r\n\r\n    //const edit = (id: number) => {\r\n    // Load data from server and reinitialize tag\r\n    //editTag(id);\r\n    //}\r\n\r\n    //const onSelectTag = (id: number) => {\r\n    // Load data from server and reinitialize tag\r\n    //if (canEdit)\r\n    //editTag(id);\r\n    //else\r\n    //viewTag(id);\r\n    //}\r\n\r\n    const [hoverRef, hovering] = useHover();\r\n\r\n    const Row1 =\r\n        // <div ref={hoverRef} className=\"d-flex justify-content-start align-items-center text-secondary\">\r\n        <div ref={hoverRef} >\r\n\r\n            <Badge pill bg=\"secondary\">\r\n                {/* className={`text-info ${numOfTags === 0 ? 'd-none' : 'd-inline'}`} */}\r\n                {name}\r\n            </Badge>\r\n\r\n            {/* <Button\r\n                variant='link'\r\n                size=\"sm\"\r\n                className={`py-0 mx-0 text-decoration-none text-secondary ${(inViewing || inEditing) ? 'fw-bold' : ''}`}\r\n                title={`id:${id!.toString()}`}\r\n                onClick={() => onSelectTag(id!)}\r\n                disabled={alreadyAdding}\r\n            >\r\n                {name}\r\n            </Button> */}\r\n\r\n            {/* {canEdit && !alreadyAdding && hovering &&\r\n                <Button variant='link' size=\"sm\" className=\"ms-1 py-0 px-1 text-secondary\"\r\n                    //onClick={() => { dispatch({ type: ActionTypes.EDIT, tag }) }}>\r\n                    onClick={() => edit(_id!)}\r\n                >\r\n                    <FontAwesomeIcon icon={faEdit} size='lg' />\r\n                </Button>\r\n            } */}\r\n\r\n            {canEdit && !alreadyAdding && hovering &&\r\n                <Button variant='link' size=\"sm\" className=\"ms-0 py-0 mx-0 text-secondary\"\r\n                    onClick={del}\r\n                >\r\n                    <FontAwesomeIcon icon={faRemove} size='sm' />\r\n                </Button>\r\n            }\r\n\r\n            {false && canEdit && !alreadyAdding && hovering &&\r\n                <Button\r\n                    variant='link'\r\n                    size=\"sm\"\r\n                    className=\"ms-2 py-0 mx-1 text-secondary\"\r\n                    title=\"Add Tag\"\r\n                    onClick={() => {\r\n                        console.log('click q')\r\n                        //const groupInfo: IGroupInfo = { groupKey: { topId, parentId, id }, level }\r\n                        //dispatch({ type: ActionTypes.ADD_ANSWER, payload: { groupInfo } })\r\n                    }}\r\n                >\r\n                    <FontAwesomeIcon icon={faPlus} size='lg' />\r\n                    <FontAwesomeIcon icon={faThumbsUp} size='lg' style={{ marginLeft: '-5px' }} />\r\n                </Button>\r\n            }\r\n        </div>\r\n\r\n    return (\r\n\r\n        <div className=\"py-1 px-1\">\r\n            {inAdding && groupInAdding && state.formMode === FormMode.AddingVariation\r\n                ? (\r\n                    // <AddTag tag={tag} inLine={true} showCloseButton={true} />\r\n                    <span>add tag</span>\r\n                )\r\n                : ((inEditing && state.formMode === FormMode.EditingVariation) ||\r\n                    (inViewing && state.formMode === FormMode.ViewingVariation)) ? (\r\n                    <>\r\n                        {/* <div class=\"d-lg-none\">hide on lg and wider screens</div> */}\r\n                        <div id='div-tag' className=\"ms-0 d-md-none w-100\">\r\n                            {/* {inEditing && <EditTag inLine={true} />}\r\n                            {inViewing && <ViewTag inLine={true} />} */}\r\n                        </div>\r\n                        <div className=\"d-none d-md-block\">\r\n                            {Row1}\r\n                        </div>\r\n                    </>\r\n                )\r\n                    : (\r\n                        Row1\r\n                    )\r\n            }\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default VariationRow;\r\n","import { useEffect } from \"react\";\r\nimport type { IGroupKey, IVariation } from \"@/groups/types\";\r\nimport { useGroupContext } from \"@/groups/GroupProvider\";\r\n// import { useGlobalState } from \"@/global/GlobalProvider\";\r\n//import { List, ListItem, Loading } from \"common/components/InfiniteList\";\r\nimport VariationRow from \"@/groups/VariationRow\";\r\nimport { Stack } from \"react-bootstrap\";\r\n\r\nconst VariationList = ({ groupKey, variations }: { groupKey: IGroupKey, variations: IVariation[] }) => {\r\n\r\n  //const { canEdit } = useGlobalState();\r\n\r\n  const { state } = useGroupContext();\r\n  const { error } = state; // topRows: groups,\r\n\r\n\r\n  //const group = groups.find(c => c.id === parentId)!\r\n  // const { tags, numOfTags, hasMore } = group;\r\n\r\n  useEffect(() => {\r\n  }, [])\r\n\r\n\r\n  // useEffect(() => {\r\n  //   if (groupId != null) {\r\n  //     if (groupId === parentId!.toString() && tagId) {\r\n  //       setTimeout(() => {\r\n  //         if (canEdit)\r\n  //           editTag(parseInt(tagId))\r\n  //         else\r\n  //           viewTag(parseInt(tagId))\r\n  //       }, 3000)\r\n  //     }\r\n  //   }\r\n  // }, [viewTag, parentId, groupId, tagId, canEdit]);\r\n\r\n  // console.log('TagList render', tags, level)\r\n\r\n  return (\r\n    <div\r\n      className=\"ms-2\"\r\n    // className=\"max-h-[500px] max-w-[500px] overflow-auto bg-slate-100\"\r\n    // style={{ overflowX: 'auto' }}\r\n    >\r\n      <Stack direction=\"horizontal\" gap={2}>\r\n        {variations.length === 0 &&\r\n          <div>No variations</div>\r\n        }\r\n        {variations.length > 0 &&\r\n          variations.map((tag: IVariation) => {\r\n            return <VariationRow\r\n              groupKey={groupKey}\r\n              tag={tag}\r\n              groupInAdding={undefined}\r\n            />\r\n          })}\r\n      </Stack>\r\n      {error && <p>Error: {error.message}</p>}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default VariationList;\r\n","import { useEffect, useRef, type ChangeEvent, type FormEvent, useState } from \"react\";\r\nimport * as Yup from \"yup\";\r\nimport { useFormik } from \"formik\";\r\nimport { Form, CloseButton, Row, Stack } from \"react-bootstrap\";\r\nimport { CreatedModifiedForm } from \"@/common/CreateModifiedForm\"\r\nimport { FormButtons } from \"@/common/FormButtons\"\r\nimport type { IGroupFormProps, IGroup, IVariation, IGroupKey } from \"@/groups/types\";\r\nimport { FormMode, ActionTypes, GroupKey } from \"@/groups/types\";\r\n\r\nimport { useGroupContext, useGroupDispatch } from \"@/groups/GroupProvider\";\r\nimport AnswerList from \"@/groups/components/answers/AnswerList\";\r\nimport VariationList from \"@/groups/VariationList\";\r\nimport { Select } from \"@/common/components/Select\";\r\nimport { kindOptions } from \"@/common/Options\";\r\nimport { useDebounce } from \"@uidotdev/usehooks\";\r\n\r\nconst GroupForm = ({ formMode, group, submitForm, children }: IGroupFormProps) => {\r\n\r\n  //const { globalState } = useGlobalContext();\r\n  //const { isDarkMode, variant, bg } = globalState;\r\n\r\n  const { onGroupTitleChanged } = useGroupContext();\r\n\r\n  const viewing = formMode === FormMode.ViewingGroup;\r\n  const editing = formMode === FormMode.EditingGroup;\r\n  const adding = formMode === FormMode.AddingGroup;\r\n\r\n  const { topId, id, variations, answerRows, title: catTitle } = group;\r\n  console.log('GroupForm render: ', { topId, id, catTitle, formMode })\r\n  const groupKey: IGroupKey = new GroupKey(group).groupKey!;\r\n  //const groupKeyExpanded: IAnswerKey = { topId, id, answerId };\r\n\r\n  if (!document.getElementById('div-details')) {\r\n\r\n  }\r\n  const showAnswers = answerRows && answerRows.length > 0 //!answers.find(q => q.inAdding);\r\n  /* \r\n  We have, at two places:\r\n    <EditGroup inLine={true} />\r\n    <EditGroup inLine={false} />\r\n    so we execute loadGroupAnswers() twice in AnswerList, but OK\r\n  */\r\n\r\n  const dispatch = useGroupDispatch();\r\n\r\n  const closeForm = () => {\r\n    dispatch({ type: ActionTypes.CLOSE_GROUP_FORM, payload: {} })\r\n  }\r\n\r\n  const cancelForm = () => {\r\n    dispatch({ type: ActionTypes.CANCEL_GROUP_FORM, payload: {} })\r\n  }\r\n\r\n  const [searchTerm, setSearchTerm] = useState(catTitle);\r\n  const debouncedSearchTerm = useDebounce(searchTerm, 300);\r\n\r\n  const formik = useFormik({\r\n    enableReinitialize: true,\r\n    initialValues: group,\r\n    validationSchema: Yup.object().shape({\r\n      title: Yup.string().required(\"Required\"),\r\n      // email: Yup.string()\r\n      //   .email(\"You have enter an invalid email address\")\r\n      //   .required(\"Required\"),\r\n      // rollno: Yup.number()\r\n      //   .positive(\"Invalid roll number\")\r\n      //   .integer(\"Invalid roll number\")\r\n      //   .required(\"Required\"),\r\n    }),\r\n    onSubmit: (values: IGroup) => {\r\n      //alert(JSON.stringify(values, null, 2));\r\n      console.log('GroupForm.onSubmit', JSON.stringify(values, null, 2))\r\n      submitForm(values);\r\n      //props.handleClose(false);\r\n      setSearchTerm(values.title);\r\n    }\r\n  });\r\n\r\n  useEffect(() => {\r\n    const goBre = async () => {\r\n      console.log('GroupForm.useEffect - onGroupTitleChanged', { debouncedSearchTerm, title: formik.values.title });\r\n      //if (debouncedSearchTerm && formik.values.title !== debouncedSearchTerm) {\r\n      /*await*/ onGroupTitleChanged(topId, id, formik.values.title);\r\n      //}\r\n    };\r\n    goBre();\r\n  }, [debouncedSearchTerm, formik.values.title, onGroupTitleChanged]);\r\n\r\n  const handleChangeTitle = (event: ChangeEvent<HTMLTextAreaElement>) => {\r\n    formik.handleChange(event);\r\n    const value = event.target.value;\r\n    //if (value !== debouncedTitle)\r\n    //setTitle(value);\r\n    setSearchTerm(value);\r\n  };\r\n\r\n  // eslint-disable-next-line no-self-compare\r\n  // const nameRef = useRef<HTMLAreaElement | null>(null);\r\n  const nameRef = useRef<HTMLTextAreaElement>(null);\r\n\r\n\r\n  useEffect(() => {\r\n    //setTitle(group.title);\r\n    nameRef.current?.focus()\r\n    //nameRef.current?.select()\r\n  }, [nameRef])\r\n\r\n  const isDisabled = false;\r\n\r\n  console.log('GroupForm render return: ', searchTerm);\r\n\r\n  return (\r\n    // data-bs-theme={`${isDarkMode ? 'dark' : 'light'}`}\r\n    <div className=\"form-wrapper p-2 group-form\" >\r\n      <CloseButton onClick={closeForm} className=\"float-end\" />\r\n      <Row className='text-center text-muted'>\r\n        <Form.Label>Group {viewing ? 'Viewing' : editing ? 'Editing' : 'Adding'}</Form.Label>\r\n      </Row>\r\n      <Form onSubmit={() => formik.handleSubmit}>\r\n\r\n        <Form.Group controlId=\"Variations\">\r\n          <Stack direction=\"horizontal\" gap={1}>\r\n            <div className=\"px-0\"><Form.Label>Variations:</Form.Label></div>\r\n            <div className=\"px-1 border border-1 border-secondary rounded\">\r\n              <VariationList\r\n                groupKey={groupKey}\r\n                variations={variations\r\n                  ? variations.map(variation => ({ name: variation } as IVariation))\r\n                  : []\r\n                }\r\n              />\r\n            </div>\r\n            <div className=\"ps-2\"><Form.Label>Kind:</Form.Label></div>\r\n            <div className=\"px-1 border border-1 border-secondary rounded\">\r\n              <Form.Group controlId=\"kind\">\r\n                {/* <Form.Label>Kind</Form.Label> */}\r\n                <Select\r\n                  id=\"kind\"\r\n                  name=\"kind\"\r\n                  options={kindOptions}\r\n                  onChange={(e: FormEvent<HTMLSelectElement>, value: any) => {\r\n                    e.preventDefault(); // ?\r\n                    formik.setFieldValue('kind', value)\r\n                    // .then(() => { if (editing) formik.submitForm() })\r\n                  }}\r\n                  value={formik.values.kind}\r\n                  disabled={isDisabled}\r\n                  classes=\"text-primary\"\r\n                />\r\n                <Form.Text className=\"text-danger\">\r\n                  {formik.touched.kind && formik.errors.kind ? (\r\n                    <div className=\"text-danger\">{formik.errors.kind}</div>\r\n                  ) : null}\r\n                </Form.Text>\r\n              </Form.Group>\r\n            </div>\r\n          </Stack>\r\n        </Form.Group>\r\n\r\n        <Form.Group controlId=\"title\">\r\n          <Form.Label>Title</Form.Label>\r\n          <Form.Control\r\n            as=\"textarea\"\r\n            name=\"title\"\r\n            placeholder={\"new Group\"}\r\n            value={searchTerm}\r\n            onFocus={(e) => {\r\n              if (formMode === FormMode.AddingGroup) {\r\n                e.target.select();\r\n              }\r\n            }}\r\n            onChange={handleChangeTitle}\r\n            ref={nameRef}\r\n            //onChange={handleChangeTitle}\r\n            // onChange={(e: any, value: any): {e: ChangeEvent<HTMLTextAreaElement>, value: string} => {\r\n            //         formik.handleChange(e, value);\r\n            //         console.log(value)\r\n            //       }}\r\n            //onBlur={formik.handleBlur}\r\n            // onBlur={(e: React.FocusEvent<HTMLTextAreaElement>): void => {\r\n            //   if (isEdit && formik.initialValues.title !== formik.values.title)\r\n            //     formik.submitForm();\r\n            // }}\r\n            rows={3}\r\n            className=\"text-primary w-100\"\r\n            disabled={viewing}\r\n          />\r\n          <Form.Text className=\"text-danger\">\r\n            {formik.touched.title && formik.errors.title ? (\r\n              <div className=\"text-danger\">{formik.errors.title}</div>\r\n            ) : null}\r\n          </Form.Text>\r\n        </Form.Group>\r\n\r\n\r\n        <Form.Group controlId=\"link\">\r\n          <Form.Label>Link</Form.Label>\r\n          {formik.values.hasSubGroups\r\n            ? <Form.Control\r\n              as=\"input\"\r\n              placeholder=\"/groups/...\"\r\n              name=\"link\"\r\n              onChange={formik.handleChange}\r\n              //onBlur={formik.handleBlur}\r\n              // onBlur={(e: React.FocusEvent<HTMLTextAreaElement>): void => {\r\n              //   if (isEdit && formik.initialValues.title !== formik.values.title)\r\n              //     formik.submitForm();\r\n              // }}\r\n              className=\"text-primary w-100\"\r\n              value={\"Can't have link (has sub groups)\"}\r\n              disabled={true}\r\n            />\r\n            : <>\r\n              <Form.Control\r\n                as=\"input\"\r\n                placeholder=\"/groups/...\"\r\n                name=\"link\"\r\n                onChange={formik.handleChange}\r\n                //onBlur={formik.handleBlur}\r\n                // onBlur={(e: React.FocusEvent<HTMLTextAreaElement>): void => {\r\n                //   if (isEdit && formik.initialValues.title !== formik.values.title)\r\n                //     formik.submitForm();\r\n                // }}\r\n                className=\"text-primary w-100\"\r\n                value={formik.values.link ?? ''}\r\n                disabled={viewing}\r\n              />\r\n              <Form.Text className=\"text-danger\">\r\n                {formik.touched.link && formik.errors.link ? (\r\n                  <div className=\"text-danger\">{formik.errors.link}</div>\r\n                ) : null}\r\n              </Form.Text>\r\n            </>\r\n          }\r\n        </Form.Group>\r\n\r\n        {/* <Form.Group>\r\n          <Form.Label>Number of Answers </Form.Label>\r\n          <div className=\"text-secondary\">{formik.values.numOfAnswers}</div>\r\n          // <div className=\"p-1 bg-dark text-white\">{createdBy}, {formatDate(created.date)}</div> \r\n        </Form.Group> */}\r\n\r\n        <Form.Group>\r\n          <Form.Label className=\"m-1 mb-0\">Answers ({`${formik.values.numOfAnswers}`}) </Form.Label>\r\n          {showAnswers &&\r\n            <AnswerList groupRow={group} />  // IGroup extends IGroupRow\r\n          }\r\n        </Form.Group>\r\n\r\n        {(viewing || editing) &&\r\n          <CreatedModifiedForm\r\n            created={group.created}\r\n            modified={group.modified}\r\n            classes=\"text-primary\"\r\n          />\r\n        }\r\n\r\n        {((formik.dirty && editing) || adding) &&\r\n          <FormButtons\r\n            cancelForm={cancelForm}\r\n            handleSubmit={formik.handleSubmit}\r\n            title={children}\r\n          />\r\n        }\r\n      </Form>\r\n    </div >\r\n  );\r\n};\r\n\r\nexport default GroupForm;","import { useGroupContext } from '@/groups/GroupProvider'\r\nimport { useGlobalState } from '@/global/GlobalProvider'\r\n\r\nimport GroupForm from \"@/groups/components/GroupForm\";\r\nimport { FormMode, type IGroup } from \"@/groups/types\";\r\n\r\nconst EditGroup = ({ inLine }: { inLine: boolean }) => {\r\n    const globalState = useGlobalState();\r\n    const { nickName } = globalState.authUser;\r\n\r\n    const { state, updateGroup } = useGroupContext();\r\n\r\n    const { activeGroup, keyExpanded } = state;\r\n    const { answerId } = keyExpanded!;\r\n\r\n    const submitForm = async (groupObject: IGroup) => {\r\n        const object: IGroup = {\r\n            ...groupObject,\r\n            created: undefined,\r\n            modified: {\r\n                time: new Date(),\r\n                nickName: nickName\r\n            }\r\n        }\r\n        await updateGroup(object, true /* closeForm */)\r\n    };\r\n\r\n    return (\r\n        <GroupForm\r\n            inLine={inLine}\r\n            group={{ ...activeGroup! }}\r\n            answerId={answerId}\r\n            formMode={FormMode.EditingGroup}\r\n            submitForm={submitForm}\r\n        >\r\n            Update Group\r\n        </GroupForm>\r\n    );\r\n};\r\n\r\nexport default EditGroup;\r\n","\r\nimport { useGroupContext } from '@/groups/GroupProvider'\r\n\r\nimport { FormMode } from \"@/groups/types\";\r\nimport GroupForm from \"@/groups/components/GroupForm\";\r\n\r\nconst ViewGroup = ({ inLine }: { inLine: boolean }) => {\r\n    const { state } = useGroupContext();\r\n    const { activeGroup, keyExpanded } = state;\r\n    const { answerId } = keyExpanded!;\r\n    return (\r\n        <GroupForm\r\n            inLine={inLine}\r\n            group={{ ...activeGroup! }}\r\n            answerId={answerId}\r\n            formMode={FormMode.ViewingGroup}\r\n            submitForm={() => { }}\r\n        >\r\n            View Group\r\n        </GroupForm>\r\n    );\r\n}\r\n\r\nexport default ViewGroup;\r\n","import { useState } from \"react\";\r\nimport { useGroupContext } from '@/groups/GroupProvider'\r\nimport { useGlobalState } from '@/global/GlobalProvider'\r\n\r\nimport GroupForm from \"@/groups/components/GroupForm\";\r\nimport { FormMode, type IGroup } from \"@/groups/types\";\r\n\r\nconst AddGroup = ({ activeGroup }: { activeGroup: IGroup | null }) => {\r\n    const globalState = useGlobalState();\r\n    const { nickName } = globalState.authUser;\r\n    const { createGroup } = useGroupContext();\r\n    //const { activeGroup } = state;\r\n\r\n    const [formValues] = useState<IGroup>({ ...activeGroup! });\r\n\r\n    const submitForm = async (group: IGroup) => {\r\n        const cat: IGroup = {\r\n            ...group,\r\n            created: {\r\n                time: new Date(),\r\n                nickName: nickName\r\n            },\r\n            modified: undefined\r\n        }\r\n        console.log(\"**********object\", cat)\r\n        await createGroup(cat);\r\n    }\r\n    if (!activeGroup === null)\r\n        return null;\r\n\r\n    console.log('AddGroup render >>>>>:', activeGroup);\r\n    return (\r\n        <>\r\n            {/* {inLine ?\r\n                <InLineGroupForm\r\n                    inLine={true}\r\n                    group={formValues}\r\n                    mode={FormMode.adding}\r\n                    submitForm={submitForm}\r\n                >\r\n                    Create\r\n                </InLineGroupForm>\r\n                : */}\r\n            <GroupForm\r\n                inLine={false}\r\n                group={formValues}\r\n                answerId={null}\r\n                formMode={FormMode.AddingGroup}\r\n                submitForm={submitForm}\r\n            >\r\n                Create Group\r\n            </GroupForm >\r\n            {/* } */}\r\n        </>\r\n    )\r\n}\r\n\r\nexport default AddGroup\r\n","import { useEffect, useState } from 'react';\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\nimport { faRemove, faCaretRight, faCaretDown, faPlus, faFolder } from '@fortawesome/free-solid-svg-icons'\r\nimport QPlus from '@/assets/QPlus.png';\r\n\r\nimport { ListGroup, Button, Badge, Collapse } from \"react-bootstrap\";\r\n\r\nimport { useGlobalState } from '@/global/GlobalProvider'\r\nimport { type IGroupKey, type IGroupRow, FormMode, type IExpandInfo, GroupKey } from \"@/groups/types\";\r\nimport { useGroupContext, } from '@/groups/GroupProvider'\r\n\r\nimport { useHover } from \"@uidotdev/usehooks\";\r\n\r\nimport GroupList from \"@/groups/components/GroupList\";\r\nimport EditGroup from \"@/groups/components/EditGroup\";\r\nimport ViewGroup from \"@/groups/components/ViewGroup\";\r\nimport AnswerList from './answers/AnswerList';\r\nimport AddGroup from './AddGroup';\r\n\r\nconst GroupRow = ({ groupRow, answerId }: { groupRow: IGroupRow, answerId: string | null }) => {\r\n\r\n    const { id, title, hasSubGroups, numOfAnswers, isExpanded, groupRows } = groupRow;\r\n    groupRow.level += 1;\r\n\r\n    const groupKey: IGroupKey = new GroupKey(groupRow).groupKey!;\r\n\r\n    // const [groupKey] = useState<IGroupKey>({ topId, id }); // otherwise reloads\r\n    // const [catKeyExpanded] = useState<IAnswerKey>({ topId, id, answerId }); // otherwise reloads\r\n\r\n    const { canEdit, authUser } = useGlobalState();\r\n\r\n    const { state, addSubGroup, viewGroup, editGroup, deleteGroup, expandGroup, collapseGroup, addAnswer } = useGroupContext();\r\n    //const dispatch = useGroupDispatch();\r\n\r\n    let { formMode, activeGroup, loadingGroup, groupLoaded } = state;\r\n    const isSelected = activeGroup !== null && (activeGroup.id === id);\r\n\r\n    const inAdding = formMode === FormMode.AddingGroup;\r\n    // TODO proveri ovo\r\n    const showAnswers = isExpanded && numOfAnswers > 0 // || answers.find(q => q.inAdding) // && !answers.find(q => q.inAdding); // We don't have answers loaded\r\n\r\n    const deleteGroupRow = () => {\r\n        groupRow.modified = {\r\n            time: new Date(),\r\n            nickName: authUser.nickName\r\n        }\r\n        deleteGroup(groupRow);\r\n    };\r\n\r\n    const handleExpandClick = async () => {\r\n        if (isExpanded) {\r\n            await collapseGroup(groupRow);\r\n        }\r\n        else {\r\n            const expandInfo: IExpandInfo = {\r\n                groupKey\r\n            }\r\n            await expandGroup(expandInfo);\r\n        }\r\n    }\r\n\r\n    // const edit = async () => {\r\n    //     // Load data from server and reinitialize group\r\n    //     await editGroup(groupRow, answerId ?? 'null');\r\n    // }\r\n\r\n    const [open, setOpen] = useState<boolean>(false);\r\n    useEffect(() => {\r\n        //if (groupRows.length > 0) \r\n            setOpen(true);\r\n    }, [groupRows]);\r\n\r\n    const onSelectGroup = async (): Promise<any> => {\r\n        if (canEdit)\r\n            await editGroup(groupRow, answerId ?? 'null');\r\n        else\r\n            await viewGroup(groupRow, answerId ?? 'null');\r\n    }\r\n\r\n    const [queue, setQueue] = useState<boolean>(false);\r\n\r\n    useEffect(() => {\r\n        if (queue) {// && groupRow.id === 'generateId') {\r\n            addSubGroup(groupRow);\r\n            setQueue(false);\r\n        }\r\n    }, [addSubGroup, groupRow, queue]);\r\n\r\n\r\n    const [queue2, setQueue2] = useState<boolean>(false);\r\n    useEffect(() => {\r\n        if (queue2) {// && groupRow.id === 'generateId') {\r\n            // actegoryRow is after reducer update\r\n            addAnswer(groupKey, isExpanded ?? false);\r\n            setQueue2(false);\r\n        }\r\n    }, [addAnswer, groupKey, isExpanded, queue2]);\r\n\r\n\r\n    useEffect(() => {\r\n        (async () => {\r\n            if (isSelected && !loadingGroup && !groupLoaded && !inAdding) {\r\n                console.log('GroupRow formMode:', formMode)\r\n                switch (formMode) {\r\n                    case FormMode.ViewingGroup:\r\n                        await viewGroup(groupRow, answerId ?? 'null');\r\n                        break;\r\n                    case FormMode.EditingGroup:\r\n                        canEdit\r\n                            ? await editGroup(groupRow, answerId ?? 'null')\r\n                            : await viewGroup(groupRow, answerId ?? 'null');\r\n                        break;\r\n                }\r\n            }\r\n        })()\r\n    }, [canEdit, groupKey, groupLoaded, groupRow, editGroup, expandGroup, formMode, inAdding, isSelected, loadingGroup, answerId, viewGroup]);\r\n\r\n    const [hoverRef, hovering] = useHover();\r\n    //console.log(\"..........................: \", document.querySelectorAll(`#Row${id}`)!.length);\r\n\r\n    const Row1 =\r\n        <div>\r\n            <div id={`Row${id}`} \r\n                className={`d-relative d-flex justify-content-start align-items-center w-100 mt-1 group-row${isSelected ? '-selected' : ''}`} \r\n                style={{ marginTop: '1px' }} >\r\n                <Button\r\n                    variant='link'\r\n                    size=\"sm\"\r\n                    className=\"py-0 px-1\" //  bg-light\"\r\n                    aria-controls={id+'-2'}\r\n                    aria-expanded={open}\r\n                    onClick={(e) => { handleExpandClick(); e.stopPropagation() }}\r\n                    title=\"Expand\"\r\n                    disabled={inAdding || (!hasSubGroups && numOfAnswers === 0)}\r\n                >\r\n                    <FontAwesomeIcon icon={isExpanded ? faCaretDown : faCaretRight} size='lg' />\r\n                </Button>\r\n                <Button\r\n                    variant='link'\r\n                    size=\"sm\"\r\n                    className=\"py-0 px-1 bg-light\"\r\n                    // onClick={expand}\r\n                    title=\"Expand\"\r\n                    disabled={true} //{alreadyAdding || (!hasSubGroups && numOfAnswers === 0)}\r\n                >\r\n                    <FontAwesomeIcon icon={faFolder} size='sm' />\r\n                </Button>\r\n                <Button\r\n                    variant='link'\r\n                    size=\"sm\"\r\n                    className={`py-0 ms-0 me-1 group-row-title ${isSelected ? 'fw-bold text-white bg-transparent' : ''}`}\r\n                    title={id}\r\n                    onClick={onSelectGroup}\r\n                    disabled={inAdding}\r\n                >\r\n                    {title}\r\n                    {/* &nbsp;<span>{formMode.substring(0, 3)}</span>&nbsp;<span>{hovering?'hov':'jok'}</span> */}\r\n                </Button>\r\n\r\n                {numOfAnswers > 0 &&\r\n                    <Badge pill bg=\"secondary\" className={'d-inline bg-transparent'}>\r\n                        {numOfAnswers}Q\r\n                        {/* <FontAwesomeIcon icon={faAnswer} size='sm' /> */}\r\n                        {/* <img width=\"22\" height=\"18\" src={Q} alt=\"Answer\" /> */}\r\n                    </Badge>\r\n                }\r\n\r\n                {canEdit && hovering && // && !alreadyAdding\r\n                    <div className=\"position-absolute text-nowrap d-flex align-items-center border border-0 border-warning p-0 end-0\">\r\n                        <div className=\"d-flex align-items-center\">\r\n                            <Button\r\n                                variant='link'\r\n                                size=\"sm\"\r\n                                className=\"border-0 py-0 px-0 ms-0 text-success\"\r\n                                title=\"Add SubGroup\"\r\n                                onClick={async () => {\r\n                                    //dispatch({ type: ActionTypes.CLOSE_CATEGORY_FORM, payload: {} })\r\n                                    if (!isExpanded && (hasSubGroups || numOfAnswers > 0)) {\r\n                                        await handleExpandClick();\r\n                                    }\r\n                                    setTimeout(() => setQueue(true), 1000);\r\n                                }}\r\n                            >\r\n                                <FontAwesomeIcon icon={faPlus} size='lg' />\r\n                            </Button>\r\n                        </div>\r\n\r\n                        {!inAdding && !hasSubGroups &&\r\n                            // top-0 end-0\r\n                            <div className=\"d-flex align-items-center\">\r\n                                <Button\r\n                                    variant='link'\r\n                                    size=\"sm\"\r\n                                    className=\"p-0 mx-0 text-secondary d-flex align-items-center border border-0 border-warning1\"\r\n                                    title=\"Add Answer\"\r\n                                    onClick={async () => {\r\n                                        //const groupInfo: IGroupInfo = { groupKey: { workspace: topId, id: groupRow.id }, level: groupRow.level }\r\n                                        if (!isExpanded && (hasSubGroups || numOfAnswers > 0)) {\r\n                                            await handleExpandClick();\r\n                                        }\r\n                                        setTimeout(() => setQueue2(true), 500);\r\n                                    }}\r\n                                >\r\n                                    <img width=\"22\" height=\"18\" src={QPlus} alt=\"Add Answer\" />\r\n                                </Button>\r\n                                <Button variant='link' size=\"sm\"\r\n                                    className=\"d-flex align-items-center border border-0 border-warning p-0\"\r\n                                    disabled={hasSubGroups || numOfAnswers > 0}\r\n                                    onClick={deleteGroupRow}\r\n                                >\r\n                                    <FontAwesomeIcon icon={faRemove} size='lg' />\r\n                                </Button>\r\n                            </div>\r\n                        }\r\n\r\n                    </div>\r\n                }\r\n\r\n                {/* TODO what about archive answers  numOfAnswers === 0 &&*/}\r\n\r\n            </div>\r\n            {showAnswers &&\r\n                <div className='ps-3'>\r\n                    <AnswerList groupRow={groupRow} />\r\n                </div>\r\n            }\r\n        </div>\r\n\r\n    // console.log({ title, isExpanded })\r\n\r\n    // if (group.level !== 1)\r\n    //     return (<div>GroupRow {group.id}</div>)\r\n\r\n    // console.log('groupRow:', { isSelected, formMode, id})\r\n    return (\r\n        <>\r\n            <ListGroup.Item\r\n                // variant={\"primary\"}\r\n                className=\"py-0 px-1 w-100 group-bg\"\r\n                as=\"li\"\r\n            >\r\n                {isSelected && formMode === FormMode.AddingGroup &&\r\n                    <div>\r\n                        <div ref={hoverRef} className=\"\">\r\n                            {Row1}\r\n                        </div>\r\n                        {/* ms-0 d-md-none w-100 */}\r\n                        <div className=\"ms-0 d-md-none w-100\">\r\n                            <AddGroup activeGroup={activeGroup} />\r\n                        </div>\r\n                    </div>\r\n                }\r\n\r\n                {isSelected && formMode === FormMode.EditingGroup &&\r\n                    <>\r\n                        {/* <div class=\"d-none d-md-block\">\r\n                            This content will be hidden on small screens and below, \r\n                            but visible on medium screens and above.</div> */}\r\n                        <div ref={hoverRef}>\r\n                            {Row1}\r\n                        </div>\r\n                        {/* <div id='divInLine' className=\"ms-0 d-md-none w-100\"> */}\r\n                        <div id='divInLine' className=\"ms-0 d-md-none w-100\">\r\n                            <EditGroup inLine={false} />\r\n                        </div>\r\n                    </>\r\n                }\r\n\r\n                {isSelected && formMode === FormMode.ViewingGroup &&\r\n                    <>\r\n                        {/* <div class=\"d-lg-none\">hide on lg and wider screens</div> */}\r\n                        <div ref={hoverRef}>\r\n                            {Row1}\r\n                        </div>\r\n                        {/* <div id='divInLine' className=\"ms-0 d-md-none w-100\"> */}\r\n                        <div id='divInLine' className=\"ms-0 d-md-none w-100\">\r\n                            <ViewGroup inLine={false} />\r\n                        </div>\r\n                    </>\r\n                }\r\n\r\n                {isSelected && formMode === FormMode.None &&\r\n                    <>\r\n                        {/* <div class=\"d-lg-none\">hide on lg and wider screens</div> */}\r\n                        <div ref={hoverRef}>\r\n                            {Row1}\r\n                        </div>\r\n                        {/* <div id='divInLine' className=\"ms-0 d-md-none w-100\"> */}\r\n                        <div id='divInLine' className=\"ms-0 d-md-none w-100\">\r\n                            <ViewGroup inLine={false} />\r\n                        </div>\r\n                    </>\r\n                }\r\n\r\n                {!isSelected &&\r\n                    <div ref={hoverRef}>\r\n                        {Row1}\r\n                    </div>\r\n                }\r\n\r\n                {/* {isSelected &&\r\n                    <div className=\"d-none d-md-block\">\r\n                        {Row1}\r\n                    </div>\r\n                } */}\r\n\r\n\r\n            </ListGroup.Item>\r\n\r\n            {state.error && state.whichRowId === id && <div className=\"text-danger\">{state.error.message}</div>}\r\n\r\n            {/* !inAdding && */}\r\n            {(isExpanded) && // Row2   //  || inAdding\r\n                <ListGroup.Item\r\n                    className=\"py-0 px-0 border-0 border-warning border-bottom-0 group-bg p-0 m-0\" // border border-3 \"\r\n                    variant={\"primary\"}\r\n                    as=\"li\"\r\n                >\r\n                    <div className=\"rambo\">\r\n                        {hasSubGroups &&\r\n                            <Collapse in={open}>\r\n                                <div id={id+'-2'} style={{ marginTop: '1px' }}>\r\n                                    {/* Wrap content in a div to prevent choppy animations caused by margins/padding */}\r\n                                    <div style={{ border: '1px solid #ddd', borderRadius: '4px' }}>\r\n                                        <GroupList groupRow={groupRow} isExpanded={isExpanded} />\r\n                                    </div>\r\n                                </div>\r\n                            </Collapse>\r\n                        }\r\n                        {/* {showAnswers &&\r\n                                <AnswerList groupRow={groupRow} />\r\n                            } */}\r\n                    </div>\r\n                </ListGroup.Item>\r\n            }\r\n        </>\r\n    );\r\n};\r\n\r\nexport default GroupRow;\r\n","import { ListGroup } from \"react-bootstrap\";\r\nimport GroupRow from \"@/groups/components/GroupRow\";\r\nimport type { IGroupRow, IParentInfo } from \"@/groups/types\";\r\nimport { useGroupContext } from \"@/groups/GroupProvider\";\r\n\r\nconst GroupList = ({ groupRow }: IParentInfo) => {\r\n\r\n    const { level, groupRows } = groupRow;\r\n\r\n    const { state } = useGroupContext();\r\n    let { keyExpanded } = state;\r\n    const { answerId } = keyExpanded ?? { topId: '', groupId: '', answerId: null };\r\n\r\n    return (\r\n        <div className={level! > 1 ? 'ms-2' : ''} >\r\n            <ListGroup as=\"ul\" variant='dark' className=\"mb-0 group-bg\">\r\n                {groupRows!.map((c: IGroupRow) =>\r\n                    <GroupRow\r\n                        //groupRow={{ ...c, isSelected: c.id === id }}\r\n                        groupRow={c}\r\n                        answerId={answerId === '' ? null : answerId}\r\n                        // {c.topId === topId && c.id === id ?answerId : null}\r\n                        key={c.id}\r\n                    />\r\n                )}\r\n            </ListGroup>\r\n            {/* {state.error && state.error} */}\r\n            {/* {state.loading && <div>...loading</div>} */}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default GroupList;\r\n","import { useEffect, useState } from 'react'\r\nimport { Modal } from \"react-bootstrap\";\r\n\r\nimport { type IAnswerRow } from \"./types\";\r\n\r\nimport { useGlobalState } from \"@/global/GlobalProvider\";\r\n//import { useGroupDispatch } from \"./GroupProvider\";\r\n\r\nimport AddAnswer from './components/answers/AddAnswer';\r\n\r\ninterface IProps {\r\n    show: boolean,\r\n    onHide: () => void;\r\n    newAnswerRow: IAnswerRow\r\n}\r\n\r\nconst ModalAddAnswer = (props: IProps) => {\r\n\r\n    const { isDarkMode } = useGlobalState();\r\n\r\n    // const handleClose = () => {\r\n    //     setShowAddAnswer(false);\r\n    // }\r\n\r\n    const [createAnswerError, setCreateAnswerError] = useState(\"\");\r\n\r\n    //const dispatch = useGroupDispatch();\r\n\r\n    useEffect(() => {\r\n        (async () => {\r\n\r\n        })()\r\n    }, [])\r\n\r\n    return (\r\n        <Modal\r\n            show={props.show}\r\n            onHide={props.onHide}\r\n            animation={true}\r\n            centered\r\n            size=\"lg\"\r\n            className=\"modal show\"\r\n            contentClassName={`${isDarkMode ? \"bg-secondary bg-gradient\" : \"bg-info bg-gradient\"}`}\r\n        >\r\n            <Modal.Header closeButton>\r\n                Store new Answer to the Database\r\n            </Modal.Header>\r\n            <Modal.Body className=\"py-0\">\r\n                <AddAnswer\r\n                    closeModal={props.onHide}\r\n                    showCloseButton={false}\r\n                    source={1} /*gmail*/\r\n                    setError={(msg) => setCreateAnswerError(msg)}\r\n                />\r\n            </Modal.Body>\r\n            <Modal.Footer>\r\n                {createAnswerError}\r\n            </Modal.Footer>\r\n        </Modal>\r\n    );\r\n};\r\n\r\nexport default ModalAddAnswer;","import { useEffect, useState } from 'react'\r\nimport { Container, Row, Col, Button } from \"react-bootstrap\";\r\n\r\nimport { useParams } from 'react-router-dom';\r\n\r\nimport { ActionTypes, type IGroupKey, type IAnswerKey, FormMode } from \"./types\";\r\n\r\nimport { useGlobalContext, useGlobalState } from '@/global/GlobalProvider';\r\n\r\nimport { GroupProvider, useGroupContext, useGroupDispatch } from \"./GroupProvider\";\r\n\r\nimport GroupList from \"@/groups/components/GroupList\";\r\nimport ViewGroup from \"@/groups/components/ViewGroup\";\r\nimport EditGroup from \"@/groups/components/EditGroup\";\r\nimport ViewAnswer from \"@/groups/components/answers/ViewAnswer\";\r\nimport EditAnswer from \"@/groups/components/answers/EditAnswer\";\r\n\r\nimport { initialGroup, initialAnswer } from \"@/groups/GroupReducer\";\r\nimport ModalAddAnswer from './ModalAddAnswer';\r\nimport AddGroup from './components/AddGroup';\r\nimport { AutoSuggestAnswers } from './AutoSuggestAnswers';\r\nimport AddAnswer from './components/answers/AddAnswer';\r\n\r\ninterface IProps {\r\n    groupId_answerId?: string;\r\n    fromChatBotDlg?: string;\r\n}\r\n\r\n// const AutoSuggestAnswers = lazy(() =>\r\n//     import(\"@/groups/AutoSuggestAnswers\").then((module) => ({ default: module.AutoSuggestAnswers }))\r\n// );\r\n\r\nconst Providered = ({ groupId_answerId, fromChatBotDlg }: IProps) => {\r\n    const { state, expandNodesUpToTheTree, loadTopRows, addSubGroup } = useGroupContext();\r\n    const {\r\n        allGroupRows, //allGroupRowsLoaded,\r\n        topRows, topRowsLoading, topRowsLoaded,\r\n        keyExpanded,\r\n        groupId_answerId_done,\r\n        nodeOpening, nodeOpened,\r\n        activeGroup,\r\n        activeAnswer,\r\n        formMode,\r\n        loadingGroups, loadingGroup,\r\n        loadingAnswers, loadingAnswer\r\n    } = state;\r\n\r\n    const { searchAnswers, setLastRouteVisited, setChatBotDlgEnabled } = useGlobalContext();\r\n    const { isDarkMode, chatBotDlgEnabled, lastRouteVisited } = useGlobalState();\r\n\r\n    const [modalShow, setModalShow] = useState(false);\r\n    // const handleClose = () => {\r\n    //     setModalShow(false);\r\n    // }\r\n\r\n    const [newAnswer, setNewAnswer] = useState({ ...initialAnswer });\r\n\r\n    const dispatch = useGroupDispatch();\r\n\r\n    const onSelectAnswer = async (answerKey: IAnswerKey) => {\r\n        //navigate(`/groups/${answerKey.topId}_${answerKey.id}`)\r\n        dispatch({ type: ActionTypes.SET_ANSWER_SELECTED, payload: { answerKey } })\r\n    }\r\n\r\n\r\n    let tekst = '';\r\n\r\n    useEffect(() => {\r\n        (async () => {\r\n            if (!topRowsLoading && !topRowsLoaded) {\r\n                console.log('ZOVEM 111 loadTopRows()')\r\n                await loadTopRows();\r\n            }\r\n        })()\r\n    }, [topRowsLoading, topRowsLoaded, loadTopRows]);\r\n\r\n\r\n    useEffect(() => {\r\n        (async () => {\r\n            if (!nodeOpening && topRowsLoaded && topRows.length > 0) {\r\n                if (groupId_answerId) {\r\n                    if (groupId_answerId === 'add_answer') {\r\n                        const sNewAnswer = localStorage.getItem('New_Answer');\r\n                        if (sNewAnswer) {\r\n                            const q = JSON.parse(sNewAnswer);\r\n                            setNewAnswer({ ...initialAnswer, groupTitle: 'Select', ...q })\r\n                            setModalShow(true);\r\n                            localStorage.removeItem('New_Answer');\r\n                            return null;\r\n                        }\r\n                    }\r\n                    else if (groupId_answerId !== groupId_answerId_done) { //} && !nodeOpened) {\r\n                        const arr = groupId_answerId.split('_');\r\n                        const groupId = arr[0];\r\n                        const answerId = arr[1];\r\n                        const grpKey: IGroupKey = { topId: '', id: groupId, parentId: 'ROOT' };\r\n                        console.log('zovem expandNodesUpToTheTree 1111111111111111111)', { groupId_answerId }, { groupId_answerId_done })\r\n                        await expandNodesUpToTheTree(grpKey, answerId !== 'null' ? answerId : null)\r\n                        console.log('zavrsio expandNodeUpToTheTree 1111111111111111111 DONE)', { groupId_answerId })\r\n                    }\r\n                }\r\n                else if (keyExpanded && !nodeOpened) {\r\n                    const { topId, groupId, answerId } = keyExpanded;\r\n                    if (groupId !== '') {\r\n                        const grpKey: IGroupKey = { topId, id: groupId, parentId: 'ROOT' }\r\n                        console.log('zovem expandNodeUpToTheTree 2222222222222)', { keyExpanded, grpKey })\r\n                        await expandNodesUpToTheTree(grpKey, answerId);\r\n                        console.log('zavrsio expandNodeUpToTheTree 2222222222222 DONE)')\r\n                    }\r\n                }\r\n\r\n                if (!chatBotDlgEnabled) // show ChatBotDlg button\r\n                    setChatBotDlgEnabled();\r\n            }\r\n        })()\r\n    }, [groupId_answerId, groupId_answerId_done, topRowsLoaded, keyExpanded, nodeOpening, nodeOpened, expandNodesUpToTheTree, fromChatBotDlg, chatBotDlgEnabled, setChatBotDlgEnabled]);\r\n\r\n    const route = `/knowledge/groups`;\r\n    useEffect(() => {\r\n        if (lastRouteVisited !== route)\r\n            setLastRouteVisited(route);\r\n    }, [ lastRouteVisited, setLastRouteVisited ]);\r\n\r\n    if (groupId_answerId !== 'add_answer') {\r\n        if (/*keyExpanded ||*/ (groupId_answerId && groupId_answerId !== groupId_answerId_done)) {\r\n            console.log(\"zzzzzz loading...\", { keyExpanded, groupId_answerId, groupId_answerId_done })\r\n            return <div>loading...</div>\r\n        }\r\n    }\r\n\r\n    //if (!nodeOpened)\r\n    //if (!allGroupRowsLoaded || !topRowsLoaded || topRows.length === 0) {\r\n    if (!topRowsLoaded) {// || topRows.length === 0) {\r\n        console.log('===>>> Groups  VRATIO')\r\n        return null\r\n    }\r\n\r\n    console.log('===>>> Groups !!!!!!!!!!!!!!!!!', activeGroup)\r\n\r\n    return (\r\n        <>\r\n            <Container>\r\n                <h5 className=\"text-warning mx-auto w-75 fw-bold\"><span className='groups'>Groups / </span><span className='answers'>Answers</span></h5>\r\n\r\n                <Row className={`${isDarkMode ? \"dark\" : \"\"}`}>\r\n                    <Col>\r\n                        <div className=\"d-flex justify-content-start align-items-center\">\r\n                            <div className=\"w-75 my-1 answers\">\r\n                                <AutoSuggestAnswers\r\n                                    tekst={tekst}\r\n                                    onSelectAnswer={onSelectAnswer}\r\n                                    allGroupRows={allGroupRows}\r\n                                    searchAnswers={searchAnswers}\r\n                                />\r\n                            </div>\r\n                        </div>\r\n                    </Col>\r\n                </Row>\r\n\r\n                <Button variant=\"secondary\" size=\"sm\" type=\"button\" style={{ padding: '1px 4px' }}\r\n                    onClick={\r\n                        () => addSubGroup(null)\r\n                    }\r\n                >\r\n                    Add Group\r\n                </Button>\r\n\r\n                <Row className=\"my-1 h-auto\">\r\n                    <Col xs={12} md={5}>\r\n                        <div className=\"groups-border\" style={{ position: 'relative' }}>\r\n                            <GroupList groupRow={{...initialGroup, groupRows: topRows }}  isExpanded={true} />\r\n                        </div>\r\n                    </Col>\r\n                    <Col xs={0} md={7}>\r\n                        {/* visible on medium screens and above. */}\r\n                        <div id='div-details' className=\"d-none d-md-block\">\r\n                            {activeGroup && formMode === FormMode.ViewingGroup && <ViewGroup inLine={false} />}\r\n                            {activeGroup && formMode === FormMode.EditingGroup &&\r\n                                <EditGroup inLine={false} />\r\n                            }\r\n                            {activeGroup && formMode === FormMode.AddingGroup && <AddGroup activeGroup={activeGroup} />}\r\n\r\n                            {activeAnswer && formMode === FormMode.ViewingAnswer && <ViewAnswer inLine={false} />}\r\n                            {activeAnswer && formMode === FormMode.EditingAnswer &&\r\n                                <EditAnswer inLine={false} />\r\n                            }\r\n                            {activeAnswer && formMode === FormMode.AddingAnswer && <AddAnswer />}\r\n                        </div>\r\n                    </Col>\r\n                </Row>\r\n            </Container>\r\n            {modalShow && activeAnswer &&\r\n                <ModalAddAnswer\r\n                    show={modalShow}\r\n                    onHide={() => { setModalShow(false) }}\r\n                    newAnswerRow={newAnswer}\r\n                />\r\n            }\r\n\r\n\r\n            {(loadingGroups || loadingAnswers) &&\r\n                <div className=\"d-flex justify-content-center align-items-center\" style={{ position: 'absolute', top: '40%', left: '20%' }}>\r\n                    <div className={`spinner-border ${loadingAnswers ? 'answer' : 'group'}-spinner`} role=\"status\">\r\n                        <span className=\"visually-hidden\">Loading...</span>\r\n                    </div>\r\n                </div>\r\n            }\r\n\r\n            {loadingGroup &&\r\n                <div className=\"d-flex justify-content-center align-items-center\" style={{ position: 'absolute', top: '50%', left: '50%' }}>\r\n                    <div className=\"spinner-border group-spinner\" role=\"status\">\r\n                        <span className=\"visually-hidden\">Loading...</span>\r\n                    </div>\r\n                </div>\r\n            }\r\n\r\n            {loadingAnswer &&\r\n                <div className=\"d-flex justify-content-center align-items-center\" style={{ position: 'absolute', top: '50%', left: '50%' }}>\r\n                    <div className=\"spinner-border answer-spinner\" role=\"status\">\r\n                        <span className=\"visually-hidden\">Loading...</span>\r\n                    </div>\r\n                </div>\r\n            }\r\n        </>\r\n    );\r\n};\r\n\r\ntype Params = {\r\n    groupId_answerId?: string;\r\n    fromChatBotDlg?: string;\r\n};\r\n\r\nconst Groups = () => {\r\n\r\n    let { groupId_answerId, fromChatBotDlg } = useParams<Params>();\r\n\r\n    if (groupId_answerId && groupId_answerId === 'groups')\r\n        groupId_answerId = undefined;\r\n\r\n    if (groupId_answerId) {\r\n        const arr = groupId_answerId!.split('_');\r\n        console.assert(arr.length === 2, \"expected 'groupId_answerId'\")\r\n    }\r\n    // const globalState = useGlobalState();\r\n    // const { isAuthenticated } = globalState;\r\n\r\n    // if (!isAuthenticated)\r\n    //     return <div>groups loading...</div>;\r\n\r\n    return (\r\n        <GroupProvider>\r\n            <Providered groupId_answerId={groupId_answerId} fromChatBotDlg={fromChatBotDlg} />\r\n        </GroupProvider>\r\n    )\r\n}\r\n\r\nexport default Groups;\r\n\r\n"],"names":["initialAnswer","initialGroup","GroupReducer","state","action","groupRow","ActionTypes","keyExpanded","modifyTree","doNotModifyTree","topRows","newState","doNotCallInnerReducerActions","innerReducer","newTopRows","topId","id","c","DeepClone","topRow","newTopRow","actionStoringToLocalStorage","locStorage","allGroupRows","groupId_answerId_done","group","answerId","answer","row","error","whichRowId","IsGroup","parentId","activeGroup","FormMode","newGroupRow","answerKey","groupId","newAnswerRow","formMode","title","link","kind","header","level","variations","numOfAnswers","hasSubGroups","groupRows","created","modified","answerRows","isExpanded","subCatRows","grpRow","GroupsContext","createContext","GroupDispatchContext","initialState","GroupProvider","children","loadAllGroupRowsGlobal","useGlobalContext","globalState","useGlobalState","KnowledgeAPI","isAuthenticated","workspace","authUser","canEdit","nickName","dispatch","useReducer","activeAnswer","allGroupRowsLoaded","useEffect","s","Execute","useCallback","method","endpoint","data","accessToken","response","headers","bearer","options","responseData","errors","e","loadAllGroupRows","resolve","getGrp","getSubGrps","parentHeader","subGrps","cat","loadTopRows","url","dtos","dto","GroupRow","getGroup","groupKey","includeAnswerId","PAGE_SIZE","groupDtoEx","groupDto","msg","Group","findGroupRow","grp","expandNodesUpToTheTree","grpKey","fromChatBotDlg","query","GroupKey","groupRowDtoEx","groupRowDto","answerRow","q","getGroupRow","hidrate","expandGroup","selectedAnswerId","collapseGroup","addSubGroup","parentGroupRow","cancelAddGroup","createGroup","GroupDto","cancelAddAnswer","expandInfo","viewGroup","editGroup","updateGroup","deleteGroup","GroupRowDto","deleteGroupVariation","variationName","loadGroupAnswers","startCursor","addAnswer","createAnswer","answerDto","AnswerDto","answerDtoEx","Answer","updateAnswer","oldParentId","groupChanged","answerRet","deleteAnswer","isActive","AnswerRowDto","getAnswer","AnswerKey","answerEx","viewAnswer","editAnswer","onGroupTitleChanged","onAnswerTitleChanged","contextValue","jsx","useGroupContext","useContext","useGroupDispatch","GrpActionTypes","GrpRow","setParentGrp","selId","expand","_id","onSelectGrp","Row1","jsxs","Button","FontAwesomeIcon","faCaretDown","faCaretRight","Fragment","ListGroup","GrpList","GrpReducer","expanding","cats","ids","markForClean","deca","unuci","setParentId","catKey","useState","res","mySubGrps","AnswerForm","submitForm","showCloseButton","source","closeModal","viewing","editing","adding","isDisabled","qTitle","closeForm","cancelForm","searchTerm","setSearchTerm","debouncedSearchTerm","useDebounce","nameRef","useRef","formik","useFormik","Yup.object","Yup.string","values","old","Id","Title","handleChangeTitle","event","value","CloseButton","Row","Form","Stack","Dropdown","Col","Select","sourceOptions","statusOptions","CreatedModifiedForm","FormButtons","AddAnswer","setError","cancelAdd","answerObject","newAnswer","EditAnswer","ViewAnswer","inLine","setAnswer","AnswerRow","isSelected","categoryKey","loadingAnswer","answerLoaded","showForm","alreadyAdding","del","onSelectAnswer","hoverRef","hovering","useHover","Q","QPlus","faRemove","AnswerList","hasMoreAnswers","loadMore","x","infiniteRef","rootRef","useInfiniteScroll","List","VariationRow","tag","groupInAdding","name","Badge","VariationList","GroupForm","catTitle","showAnswers","variation","kindOptions","EditGroup","groupObject","object","ViewGroup","AddGroup","formValues","loadingGroup","groupLoaded","inAdding","deleteGroupRow","handleExpandClick","open","setOpen","onSelectGroup","queue","setQueue","queue2","setQueue2","faFolder","faPlus","Collapse","GroupList","ModalAddAnswer","props","isDarkMode","createAnswerError","setCreateAnswerError","Modal","Providered","groupId_answerId","topRowsLoading","topRowsLoaded","nodeOpening","nodeOpened","loadingGroups","loadingAnswers","searchAnswers","setLastRouteVisited","setChatBotDlgEnabled","chatBotDlgEnabled","lastRouteVisited","modalShow","setModalShow","setNewAnswer","tekst","sNewAnswer","arr","route","Container","AutoSuggestAnswers","Groups","useParams"],"mappings":"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"}