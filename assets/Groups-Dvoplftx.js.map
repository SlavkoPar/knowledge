{"version":3,"mappings":"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","names":["initialAnswer","_generateId","initialGroup","GroupReducer","state","action","groupRow","ActionTypes","keyExpanded","modifyTree","doNotModifyTree","topRows","newState","doNotCallInnerReducerActions","innerReducer","newTopRows","topId","id","c","DeepClone","topRow","newTopRow","actionStoringToLocalStorage","locStorage","allGroupRows","groupId_answerId_done","group","answerId","answer","formMode","row","error","whichRowId","IsGroup","parentId","activeGroup","FormMode","newGroupRow","catRow","answerKey","groupId","newAnswerRow","title","link","kind","header","level","variations","numOfAnswers","hasSubGroups","groupRows","created","modified","answerRows","isExpanded","subCatRows","grpRow","GroupsContext","createContext","GroupDispatchContext","initialState","GroupProvider","children","loadAllGroupRowsGlobal","useGlobalContext","globalState","useGlobalState","KnowledgeAPI","isAuthenticated","workspace","authUser","canEdit","nickName","dispatch","useReducer","activeAnswer","allGroupRowsLoaded","useEffect","s","Execute","useCallback","method","endpoint","data","accessToken","response","headers","bearer","options","responseData","errors","e","loadAllGroupRows","resolve","getGrp","getSubGrps","parentHeader","subGrps","cat","loadTopRows","url","dtos","dto","GroupRow","getGroup","groupKey","includeAnswerId","PAGE_SIZE","groupDtoEx","groupDto","msg","Group","findGroupRow","grp","expandNodesUpToTheTree","grpKey","fromChatBotDlg","query","GroupKey","groupRowDtoEx","groupRowDto","topRowNew","bottomRow","answerRow","q","getGroupRow","hidrate","expandGroup","selectedAnswerId","collapseGroup","addGroup","parentGroupRow","cancelAddGroup","parentRow","rows","createGroup","GroupDto","cancelAddAnswer","expandInfo","viewGroup","editGroup","updateGroup","deleteGroup","GroupRowDto","deleteGroupVariation","variationName","loadGroupAnswers","startCursor","addAnswer","createAnswer","answerDto","AnswerDto","answerDtoEx","Answer","updateAnswer","oldParentId","groupChanged","answerRet","deleteAnswer","isActive","AnswerRowDto","getAnswer","AnswerKey","answerEx","viewAnswer","editAnswer","onGroupTitleChanged","onAnswerTitleChanged","a","contextValue","jsx","useGroupContext","useContext","useGroupDispatch","GrpActionTypes","GrpRow","setParentGrp","selId","expand","_id","onSelectGrp","Row1","jsxs","Button","FontAwesomeIcon","faCaretDown","faCaretRight","Fragment","ListGroup","GrpList","GrpReducer","expanding","cats","ids","markForClean","deca","unuci","setParentId","catKey","useState","res","mySubGrps","AnswerForm","submitForm","showCloseButton","source","closeModal","viewing","editing","adding","isDisabled","qTitle","closeForm","cancelForm","searchTerm","setSearchTerm","debouncedSearchTerm","useDebounce","nameRef","useRef","formik","useFormik","Yup.object","Yup.string","values","handleChangeTitle","event","value","CloseButton","Row","Form","Stack","Dropdown","Col","Select","sourceOptions","statusOptions","CreatedModifiedForm","FormButtons","AddAnswer","setError","cancelAdd","answerObject","newAnswer","EditAnswer","ViewAnswer","inLine","setAnswer","AnswerRow","isSelected","categoryKey","loadingAnswer","answerLoaded","showForm","alreadyAdding","del","onSelectAnswer","hoverRef","hovering","useHover","Q","QPlus","faRemove","AnswerList","hasMoreAnswers","loadMore","x","infiniteRef","rootRef","useInfiniteScroll","List","VariationRow","tag","groupInAdding","name","Badge","VariationList","GroupForm","catTitle","showAnswers","variation","kindOptions","EditGroup","cancel","close","groupObject","object","ViewGroup","AddGroup","formValues","loadingGroup","groupLoaded","inAdding","deleteGroupRow","handleExpandClick","open","setOpen","onSelectGroup","queue","setQueue","queue2","setQueue2","faFolder","faPlus","Collapse","GroupList","ModalAddAnswer","props","isDarkMode","createAnswerError","setCreateAnswerError","Modal","AutoSuggestAnswers","lazy","module","Providered","groupId_answerId","topRowsLoading","topRowsLoaded","nodeOpening","nodeOpened","loadingGroups","loadingAnswers","searchAnswers","setLastRouteVisited","setChatBotDlgEnabled","chatBotDlgEnabled","lastRouteVisited","modalShow","setModalShow","setNewAnswer","tekst","sNewAnswer","arr","route","Container","Suspense","Groups","useParams"],"ignoreList":[],"sources":["../../src/groups/GroupReducer.tsx","../../src/groups/GroupProvider.tsx","../../src/global/Components/SelectGroup/types.ts","../../src/global/Components/SelectGroup/GrpRow.tsx","../../src/global/Components/SelectGroup/GrpReducer.tsx","../../src/global/Components/SelectGroup/GrpList.tsx","../../src/groups/components/answers/AnswerForm.tsx","../../src/groups/components/answers/AddAnswer.tsx","../../src/groups/components/answers/EditAnswer.tsx","../../src/groups/components/answers/ViewAnswer.tsx","../../src/groups/components/answers/AnswerRow.tsx","../../src/groups/components/answers/AnswerList.tsx","../../src/groups/VariationRow.tsx","../../src/groups/VariationList.tsx","../../src/groups/components/GroupForm.tsx","../../src/groups/components/EditGroup.tsx","../../src/groups/components/ViewGroup.tsx","../../src/groups/components/AddGroup.tsx","../../src/groups/components/GroupRow.tsx","../../src/groups/components/GroupList.tsx","../../src/groups/ModalAddAnswer.tsx","../../src/groups/Groups.tsx"],"sourcesContent":["import { type Reducer } from 'react'\r\nimport {\r\n  ActionTypes, type Actions, type ILocStorage, IsGroup,\r\n  type IGroupsState, type IGroup, type IGroupRow, type IAnswer,\r\n  actionStoringToLocalStorage, FormMode, doNotModifyTree, doNotCallInnerReducerActions,\r\n  _generateId\r\n} from \"@/groups/types\";\r\n\r\nexport const subCatRow: IGroupRow = {\r\n  topId: _generateId, // for top rows: topId = ToUpperCase(id)\r\n  id: _generateId,\r\n  parentId: null,\r\n  level: 1,\r\n  isExpanded: false,\r\n  groupRows: [],\r\n  kind: 0,\r\n  title: '',\r\n  link: null,\r\n  header: '',\r\n  hasSubGroups: false,\r\n  variations: [],\r\n  numOfAnswers: 0,\r\n  answerRows: []\r\n}\r\n\r\nexport const initialAnswer: IAnswer = {\r\n  topId: '',\r\n  parentId: 'null',\r\n  id: _generateId, //  keep _generateId, it is expected at BackEnd\r\n  groupTitle: '',\r\n  title: '',\r\n  source: 0,\r\n  status: 0,\r\n  included: false\r\n}\r\n\r\nexport const initialGroup: IGroup = {\r\n  topId: 'null',\r\n  parentId: 'null',\r\n  id: 'define at BackEnd',\r\n  kind: 0,\r\n  title: '',\r\n  link: '',\r\n  header: '',\r\n  level: 0,\r\n  variations: [],\r\n  hasSubGroups: false,\r\n  groupRows: [],\r\n  answerRows: [],\r\n  numOfAnswers: 0,\r\n  hasMoreAnswers: false,\r\n  isExpanded: false,\r\n  doc1: ''\r\n}\r\n\r\nexport const GroupReducer: Reducer<IGroupsState, Actions> = (state, action) => {\r\n\r\n  console.log('------------------------------->')\r\n  console.log('------------------------------->', action.type)\r\n  console.log('------------------------------->')\r\n  // ----------------------------------------------------------------------\r\n  // Rubljov: \"By giving the right name, you reveal the essence of things\"\r\n  // ----------------------------------------------------------------------\r\n  //\r\n  // - firstLevelGroupRow AAA\r\n  // ------> groupRow AAA.1\r\n  // --------- > groupRow AAA 1.1\r\n  // --------- > ...\r\n  //\r\n  // ------> groupRow AAA.2\r\n  // --------- > groupRow AAA 2.1\r\n  // --------- > groupRow AAA 2.2\r\n  // ------------ > Group Row AAA 2.2.1\r\n  // ------------ > groupRow AAA 2.2.2\r\n  // --------------- > groupRow AAA 2.2.2.1\r\n  // --------------- > groupRow AAA 2.2.2.2\r\n  //\r\n  // --------- > groupRow AAA 2.3\r\n  //\r\n  // - firstLevelGroupRow BBB\r\n  // - ...\r\n\r\n  const { groupRow } = action.payload;\r\n  // const isGroup = IsGroup(groupRow); // IGroup rather than IGroupRow\r\n\r\n  if (action.type === ActionTypes.SET_KEY_EXPANDED) {\r\n    const { keyExpanded } = action.payload;\r\n    return {\r\n      ...state,\r\n      keyExpanded,\r\n      nodeOpened: keyExpanded === null ? true : state.nodeOpened\r\n    }\r\n  }\r\n\r\n  let modifyTree = groupRow\r\n    ? doNotModifyTree.includes(action.type) ? false : true\r\n    : false;\r\n\r\n  const { topRows } = state;\r\n\r\n  const newState = doNotCallInnerReducerActions.includes(action.type)\r\n    ? { ...state }\r\n    : innerReducer(state, action);\r\n\r\n  // return { ...state } // calling this, state would be destroyed, because of shallow copy\r\n  // Action that modify Tree\r\n  // Actually part topRows of state\r\n  if (modifyTree && groupRow) { //} && groupRow.topId !== 'ROOT') {\r\n    let newTopRows: IGroupRow[];\r\n    const { topId, id } = groupRow!;\r\n    if (id === topId) {\r\n      // actually topRows is from previous state\r\n      newTopRows = topRows.map(c => c.id === topId\r\n        ? new DeepClone(groupRow!).groupRow\r\n        : new DeepClone(c).groupRow\r\n      );\r\n    }\r\n    else {\r\n      // actually topRows is from previous state\r\n      const topRow: IGroupRow = topRows.find(c => c.id === topId)!;\r\n      DeepClone.idToSet = action.type === 'SET_GROUP_ADDED' ? _generateId : id;\r\n      DeepClone.newGroupRow = groupRow!;\r\n      const newTopRow = new DeepClone(topRow).groupRow;\r\n      newTopRows = topRows.map(c => c.id === topId\r\n        ? newTopRow\r\n        : new DeepClone(c).groupRow\r\n      );\r\n      DeepClone.idToSet = '';\r\n    }\r\n    newState.topRows = newTopRows;\r\n  }\r\n  else {\r\n    // just clone to enable time-travel debugging\r\n  }\r\n\r\n  if (actionStoringToLocalStorage.includes(action.type)) {\r\n    const { keyExpanded } = newState;\r\n    const locStorage: ILocStorage = {\r\n      keyExpanded\r\n    }\r\n    localStorage.setItem('GROUPS_STATE', JSON.stringify(locStorage));\r\n  }\r\n\r\n  console.log('GroupReducer newState', newState)\r\n  return newState;\r\n}\r\n\r\nconst innerReducer = (state: IGroupsState, action: Actions): IGroupsState => {\r\n  switch (action.type) {\r\n\r\n    //////////////////////////////////////////////////\r\n    // Rows Level: 1\r\n\r\n    case ActionTypes.SET_TOP_ROWS_LOADING:\r\n      return {\r\n        ...state,\r\n        loadingGroups: true,\r\n        topRowsLoading: true,\r\n        topRowsLoaded: false\r\n      }\r\n\r\n    case ActionTypes.SET_TOP_ROWS: {\r\n      const { topRows } = action.payload;\r\n      console.log('=> GroupsReducer ActionTypes.SET_TOP_ROWS', state.topRows, topRows)\r\n      return {\r\n        ...state,\r\n        topRows,\r\n        topRowsLoading: false,\r\n        topRowsLoaded: true,\r\n        loadingGroups: false\r\n      };\r\n    }\r\n\r\n    case ActionTypes.SET_ALL_GROUP_ROWS: {\r\n      const { allGroupRows } = action.payload;\r\n      return {\r\n        ...state,\r\n        allGroupRows,\r\n        allGroupRowsLoaded: Date.now()\r\n      };\r\n    }\r\n\r\n    case ActionTypes.SET_ALL_GROUP_ROWS: {\r\n      const { allGroupRows } = action.payload;\r\n      return {\r\n        ...state,\r\n        allGroupRows,\r\n        allGroupRowsLoaded: Date.now()\r\n      };\r\n    }\r\n\r\n    case ActionTypes.SET_NODE_EXPANDING_UP_THE_TREE: {\r\n      const { groupId_answerId_done } = action.payload;\r\n      //const { keyExpanded /*, activeGroup, activeAnswer */ } = state;\r\n      return {\r\n        ...state,\r\n        groupId_answerId_done,\r\n        nodeOpening: true,\r\n        loadingGroups: true,\r\n        nodeOpened: false,\r\n        //keyExpanded: fromChatBotDlg ? null : { ...keyExpanded! },\r\n        activeGroup: null, //fromChatBotDlg ? null : activeGroup,\r\n        activeAnswer: null //fromChatBotDlg ? null : activeAnswer\r\n      }\r\n    }\r\n\r\n    case ActionTypes.SET_NODE_EXPANDED_UP_THE_TREE: {\r\n      const { group, answerId, answer, formMode } = action.payload;\r\n      return {\r\n        ...state,\r\n        activeGroup: group,\r\n        activeAnswer: answer,\r\n        selectedAnswerId: answerId,\r\n        formMode,\r\n        nodeOpening: false,\r\n        nodeOpened: true,\r\n        loadingGroups: false\r\n      };\r\n    }\r\n\r\n    case ActionTypes.SET_LOADING_GROUPS:\r\n      return {\r\n        ...state,\r\n        //activeGroup: null,\r\n        loadingGroups: true,\r\n      }\r\n\r\n    case ActionTypes.SET_LOADING_GROUP:\r\n      return {\r\n        ...state,\r\n        //activeGroup: null,\r\n        loadingGroup: true,\r\n        groupLoaded: false\r\n      }\r\n\r\n\r\n    // case ActionTypes.FORCE_OPEN_NODE:\r\n    //   const { keyExpanded } = action.payload;\r\n    //   return {\r\n    //     ...state,\r\n    //     nodeOpening: false,\r\n    //     nodeOpened: false,\r\n    //     topRows: [],\r\n    //     topRowsLoaded: false,\r\n    //     keyExpanded\r\n    //   }\r\n\r\n    case ActionTypes.FORCE_OPEN_NODE:\r\n      const { keyExpanded } = action.payload;\r\n      alert('FORCE_OPEN_NODE is deprecated, use SET_ANSWER_SELECTED instead')\r\n      return {\r\n        ...state,\r\n        topRows: state.topRows.filter(row => row.parentId === null),\r\n        keyExpanded,\r\n        nodeOpened: false, // keep topRows, and openNode\r\n        activeGroup: null,\r\n        activeAnswer: null,\r\n        selectedAnswerId: null\r\n      }\r\n\r\n    // case ActionTypes.RESET_GROUP_ANSWER_DONE: {\r\n    //   return {\r\n    //     ...state,\r\n    //     groupId_answerId_done: undefined,\r\n    //     groupNodeLoaded: false\r\n    //   };\r\n    // }\r\n\r\n    case ActionTypes.SET_SUB_GROUPS: {\r\n      //const { groupRows } = action.payload;\r\n      //const { topRows } = state;\r\n      //groupRows.forEach((groupRow: IGroupRow) => {\r\n      //const { id, hasSubGroups, numOfAnswers } = groupRow;\r\n      //})\r\n      return {\r\n        ...state,\r\n        loadingGroup: false,\r\n        //groupLoaded: false proveri\r\n      };\r\n    }\r\n\r\n\r\n    case ActionTypes.SET_ERROR: {\r\n      const { error, whichRowId } = action.payload; // group.id or answer.id\r\n      return {\r\n        ...state,\r\n        error,\r\n        whichRowId,\r\n        loadingGroups: false,\r\n        loadingAnswers: false,\r\n        loadingGroup: false, groupLoaded: false,\r\n        loadingAnswer: false, answerLoaded: false\r\n      };\r\n    }\r\n\r\n\r\n    // case ActionTypes.SET_GROUP_ROW: {\r\n    //   const { groupRow } = action.payload; // group doesn't contain  inAdding \r\n    //   console.assert(IsGroup(groupRow));\r\n    //   const groupKey = new GroupKey(groupRow).groupKey!;\r\n    //   return {\r\n    //     ...state,\r\n    //     // keep mode\r\n    //     loadingGroup: false,\r\n    //     //keyExpanded: { ...groupKey },\r\n    //     activeGroup: groupRow,\r\n    //     activeAnswer: null\r\n    //   }\r\n    // }\r\n\r\n    case ActionTypes.SET_GROUP: {\r\n      const { groupRow } = action.payload; // group doesn't contain  inAdding \r\n      console.assert(IsGroup(groupRow));\r\n      //const groupKey = new GroupKey(groupRow).groupKey!;\r\n      return {\r\n        ...state,\r\n        // keep mode\r\n        loadingGroup: false,\r\n        groupLoaded: true,\r\n        //keyExpanded: { ...groupKey },\r\n        activeGroup: groupRow,\r\n        activeAnswer: null,\r\n        selectedAnswerId: null,\r\n\r\n      }\r\n    }\r\n\r\n    case ActionTypes.SET_ROW_EXPANDING: {\r\n      return {\r\n        ...state,\r\n        rowExpanding: true,\r\n        rowExpanded: false,\r\n        loadingGroups: true\r\n      }\r\n    }\r\n\r\n    case ActionTypes.SET_ROW_EXPANDED: {\r\n      const { groupRow } = action.payload; // , selectedAnswerId\r\n      const { topId, id } = groupRow;\r\n      const { keyExpanded } = state;\r\n      const answerId = keyExpanded ? keyExpanded.answerId : null; // (topId === keyExpanded?.topId && id === keyExpanded.groupId)\r\n      //? keyExpanded.answerId\r\n      //: null;\r\n      // Do not work with groupRow, \r\n      // groupRow will be proccesed in GroupReducer, rather than in innerReducer\r\n      return {\r\n        ...state,\r\n        // keep mode\r\n        loadingGroups: false,\r\n        keyExpanded: {\r\n          topId,\r\n          groupId: id,\r\n          answerId\r\n        },\r\n        //activeGroup: null,\r\n        activeAnswer: null,\r\n        selectedAnswerId: answerId, //selectedAnswerId ?? null,\r\n        loadingAnswer: false,\r\n        answerLoaded: false,\r\n        rowExpanding: false,\r\n        rowExpanded: true\r\n        //formMode\r\n      }\r\n    }\r\n\r\n    // case ActionTypes.SET_ROW_COLLAPSING: {\r\n    //   return {\r\n    //     ...state,\r\n    //     // keep mode\r\n    //     loadingGroups: true, \r\n    //     rowExpanding: true, // actually collapsing\r\n    //     rowExpanded: false\r\n    //   }\r\n    // }\r\n\r\n\r\n    case ActionTypes.SET_ROW_COLLAPSED: {\r\n      const { groupRow } = action.payload; // group doesn't contain  inAdding \r\n      const { topId, parentId } = groupRow;\r\n      //const groupKey = new GroupKey(groupRow).groupKey\r\n      return {\r\n        ...state,\r\n        // keep mode\r\n        loadingGroups: false,\r\n        keyExpanded: { topId, groupId: parentId ?? '', answerId: null },\r\n        rowExpanding: false, // actually collapsing\r\n        rowExpanded: true,\r\n        activeGroup: null,\r\n        activeAnswer: null,\r\n        selectedAnswerId: null\r\n      }\r\n    }\r\n\r\n\r\n    case ActionTypes.SET_GROUP_TO_VIEW: {\r\n      const { groupRow } = action.payload;\r\n      console.assert(IsGroup(groupRow))\r\n      const group: IGroup = groupRow as IGroup;\r\n      const activeGroup: IGroup = { ...group, isExpanded: false }\r\n      //const { topId, id, parentId } = group;\r\n      return {\r\n        ...state,\r\n        formMode: FormMode.ViewingGroup,\r\n        loadingGroup: false,\r\n        //keyExpanded: { ...state.keyExpanded, answerId: null },\r\n        activeGroup,\r\n        activeAnswer: null,\r\n        selectedAnswerId: null,\r\n        error: undefined\r\n      };\r\n    }\r\n\r\n    case ActionTypes.SET_GROUP_TO_ADD_TOP: {\r\n      const { newGroupRow } = action.payload; // IGroup extends IGroupRow\r\n      //const { topId } = group;\r\n      //console.assert(IsGroup(groupRow))\r\n      // TODO what about instanceof?\r\n      return {\r\n        ...state,\r\n        loadingGroup: false,\r\n        groupLoaded: true,\r\n        activeGroup: { ...newGroupRow, doc1: '' },\r\n        activeAnswer: null,\r\n        selectedAnswerId: null,\r\n        topRows: [newGroupRow!, ...state.topRows],\r\n        formMode: FormMode.AddingGroup\r\n      };\r\n    }\r\n\r\n    case ActionTypes.SET_GROUP_TO_ADD: {\r\n      const { newGroupRow } = action.payload; // IGroup extends IGroupRow\r\n      //const { topId } = group;\r\n      //console.assert(IsGroup(groupRow))\r\n      // TODO what about instanceof?\r\n      return {\r\n        ...state,\r\n        loadingGroup: false,\r\n        groupLoaded: true,\r\n        activeGroup: { ...newGroupRow!, doc1: '' },\r\n        activeAnswer: null,\r\n        selectedAnswerId: null,\r\n        formMode: FormMode.AddingGroup\r\n      };\r\n    }\r\n\r\n    case ActionTypes.SET_GROUP_ADDED: {\r\n      const { groupRow } = action.payload; // IGroup extends IGroupRow\r\n      console.assert(IsGroup(groupRow))\r\n      // TODO what about instanceof?\r\n      const group: IGroup = groupRow as IGroup;\r\n      const activeGroup: IGroup = { ...group, isExpanded: false }\r\n      const { topId, id } = activeGroup;\r\n      //const { parentId } = group;\r\n      //const topRowsLoaded = parentId ? true : false;\r\n      return {\r\n        ...state,\r\n        formMode: FormMode.EditingGroup, // none\r\n        loadingGroup: false,\r\n        groupLoaded: false,\r\n        // topRowsLoaded,\r\n        //groupKeyExpanded: state.groupKeyExpanded ? { ...state.groupKeyExpanded, answerId: null } : null,\r\n        activeGroup,\r\n        activeAnswer: null,\r\n        selectedAnswerId: null,\r\n        keyExpanded: { topId, groupId: id, answerId: null }, // set id to call openNode from groups\r\n      };\r\n    }\r\n\r\n    case ActionTypes.SET_GROUP_TO_EDIT:   // doesn't modify Tree\r\n    case ActionTypes.SET_GROUP_UPDATED: { // modifies Tree\r\n      const { groupRow, group } = action.payload; // IGroup extends IGroupRow\r\n      console.assert(IsGroup(groupRow))\r\n      // TODO what about instanceof?\r\n      //const activeGroup: IGroup = { ...group, isExpanded: false }\r\n      const { topId, id } = group;\r\n      return {\r\n        ...state,\r\n        formMode: FormMode.EditingGroup,\r\n        loadingGroup: false,\r\n        groupLoaded: true,\r\n        keyExpanded: { topId, groupId: id, answerId: null },\r\n        //keyExpanded: null, //{ topId, groupId: parentId!, answerId: null },\r\n        //groupKeyExpanded: state.groupKeyExpanded ? { ...state.groupKeyExpanded, answerId: null } : null,\r\n        activeGroup: group,\r\n        activeAnswer: null,\r\n        selectedAnswerId: null,\r\n        error: undefined\r\n      };\r\n    }\r\n\r\n    case ActionTypes.SET_ANSWERS_LOADING:\r\n      //const { loadingAnswer } = action.payload; // group doesn't contain inAdding \r\n      return {\r\n        ...state,\r\n        loadingAnswers: true,\r\n        answerLoaded: false\r\n      }\r\n\r\n    case ActionTypes.GROUP_ANSWERS_LOADED: {\r\n      // const { groupRow } = action.payload;\r\n      //const { id, topId: topId, answerRows, hasMoreAnswers } = groupRow;\r\n      return {\r\n        ...state,\r\n        //loadingAnswer: false,\r\n        loadingAnswers: false\r\n      }\r\n    }\r\n\r\n    case ActionTypes.GROUP_DELETED: {\r\n      const { groupRow, id } = action.payload;\r\n      const topRows = !groupRow\r\n        ? state.topRows.filter(catRow => catRow.id !== id)\r\n        : state.topRows;\r\n      return {\r\n        ...state,\r\n        topRows,\r\n        loadingGroups: false,\r\n        activeGroup: null,\r\n        formMode: FormMode.None,\r\n        error: undefined,\r\n        whichRowId: undefined,\r\n        keyExpanded: {\r\n          topId: groupRow ? groupRow.topId : '',\r\n          groupId: groupRow ? groupRow.parentId ?? '' : '',\r\n          answerId: ''\r\n        }\r\n      };\r\n\r\n    }\r\n\r\n    case ActionTypes.CANCEL_GROUP_FORM:\r\n    case ActionTypes.CLOSE_GROUP_FORM: {\r\n      return {\r\n        ...state,\r\n        activeGroup: null,\r\n        formMode: FormMode.None\r\n      };\r\n    }\r\n\r\n\r\n    // First we add a new answer to the group.guestions\r\n    // After user clicks Save, we call createAnswer \r\n    /*\r\n    case ActionTypes.ADD_ANSWER: {\r\n      const { groupInfo } = action.payload;\r\n      const { groupKey, level } = groupInfo;\r\n      const { topId, id } = groupKey;\r\n      const answer: IAnswer = {\r\n        ...initialAnswer,\r\n        topId: id ?? '',\r\n        parentId: id,\r\n        inAdding: true\r\n      }\r\n      return {\r\n        ...state,\r\n        mode: Mode.AddingAnswer,\r\n        activeAnswer: answer\r\n      };\r\n    }\r\n    */\r\n\r\n    case ActionTypes.CANCEL_ADD_GROUP: {\r\n      const { topRows } = action.payload;\r\n      return {\r\n        ...state,\r\n        topRows,\r\n        activeGroup: null,\r\n        activeAnswer: null,\r\n        selectedAnswerId: null,\r\n        formMode: FormMode.None\r\n      };\r\n    }\r\n\r\n    case ActionTypes.SET_LOADING_ANSWER:\r\n      return {\r\n        ...state,\r\n        loadingAnswer: true,\r\n        answerLoaded: false\r\n      }\r\n\r\n    case ActionTypes.CANCEL_ADD_ANSWER: {\r\n      return {\r\n        ...state,\r\n        formMode: FormMode.None,\r\n        activeAnswer: null,\r\n        selectedAnswerId: null\r\n      };\r\n    }\r\n\r\n    case ActionTypes.SET_ANSWER_SELECTED: { // from Groups / AutoSuggestAnswer\r\n      const { answerKey } = action.payload;\r\n      const { topId, parentId: groupId, id: answerId } = answerKey;\r\n      return {\r\n        ...state,\r\n        topRows: state.topRows.filter(row => row.parentId === null),\r\n        keyExpanded: {\r\n          topId,\r\n          groupId: groupId,\r\n          answerId\r\n        },\r\n        /////nodeOpened: false, // keep topRows, and openNode\r\n        activeGroup: null,\r\n        activeAnswer: null,\r\n        selectedAnswerId: null\r\n      };\r\n    }\r\n\r\n\r\n    case ActionTypes.ADD_NEW_ANSWER_TO_ROW: {\r\n      const { newAnswerRow } = action.payload;\r\n      return {\r\n        ...state,\r\n        selectedAnswerId: newAnswerRow.id\r\n      };\r\n    }\r\n\r\n\r\n    case ActionTypes.SET_ANSWER: {\r\n      const { answer, formMode } = action.payload;\r\n      console.log(ActionTypes.SET_ANSWER, answer)\r\n      return {\r\n        ...state,\r\n        activeGroup: null,\r\n        activeAnswer: answer,\r\n        formMode,\r\n        error: undefined,\r\n        loadingGroup: false,\r\n        loadingAnswer: false,\r\n        answerLoaded: true\r\n      };\r\n    }\r\n\r\n    case ActionTypes.SET_ANSWER_AFTER_ASSIGN_ANSWER: {\r\n      const { answer } = action.payload;\r\n      //const { parentId, id } = answer;\r\n      //const inAdding = state.formMode === FormMode.AddingAnswer;\r\n\r\n      // for inAdding, _id is IDBValidKey('000000000000000000000000')\r\n      // thats why we look for q.inAdding instead of q._id === _id\r\n      // const x = state.groups.filter(c => c.id === parentId).filter(q=>q.id === id);\r\n      // console.error('SET_ANSWER_AFTER_ASSIGN_ANSWER', {x})\r\n\r\n      // TODO Popravi\r\n      // const rootRows = newTopRows.map((c: IGroup) => c.id === parentId\r\n      //   ? {\r\n      //     ...c,\r\n      //     answerRows: inAdding\r\n      //       ? c.answerRows.map(q => q.inAdding ? { ...answer, inAdding: q.inAdding } : q)\r\n      //       : c.answerRows.map(q => q.id === id ? { ...answer } : q), // TODO sta, ako je inViewing\r\n      //     inAdding: c.inAdding\r\n      //   }\r\n      //   : c\r\n      // );\r\n      return {\r\n        ...state,\r\n        //formMode: state.formMode, // keep mode\r\n        activeAnswer: answer,\r\n        loadingAnswer: false,\r\n        answerLoaded: true\r\n      };\r\n    }\r\n\r\n\r\n    case ActionTypes.SET_ANSWER_TO_VIEW: {\r\n      const { answer } = action.payload;\r\n      //const { topId, id, parentId } = answer;\r\n      const { keyExpanded } = state;\r\n      return {\r\n        ...state,\r\n        formMode: FormMode.ViewingAnswer,\r\n        keyExpanded,\r\n        activeAnswer: answer,\r\n        loadingAnswer: false,\r\n        answerLoaded: true\r\n      }\r\n    }\r\n\r\n    case ActionTypes.SET_ANSWER_TO_EDIT: {\r\n      const { answer } = action.payload;\r\n      const { topId, id, parentId } = answer;\r\n      //const { keyExpanded } = state;\r\n      return {\r\n        ...state,\r\n        // groupKeyExpanded: groupKeyExpanded\r\n        //   ? { ...groupKeyExpanded, answerId: groupKeyExpanded.id === parentId ? id : null }\r\n        //   : null,\r\n        keyExpanded: { topId, groupId: parentId, answerId: id },\r\n        activeAnswer: answer,\r\n        formMode: FormMode.EditingAnswer,\r\n        selectedAnswerId: answer.id,\r\n        loadingAnswer: false,\r\n        answerLoaded: true\r\n      }\r\n    }\r\n\r\n    case ActionTypes.ANSWER_DELETED: {\r\n      //const { answer } = action.payload;\r\n      //const { parentId, id } = answer;\r\n      return {\r\n        ...state, // Popravi\r\n        activeAnswer: null,\r\n        selectedAnswerId: null,\r\n        formMode: FormMode.None,\r\n        loadingAnswer: false,\r\n        answerLoaded: true\r\n      }\r\n    }\r\n\r\n    case ActionTypes.CANCEL_ANSWER_FORM:\r\n    case ActionTypes.CLOSE_ANSWER_FORM: {\r\n      //const { answer } = action.payload;\r\n      return {\r\n        ...state,\r\n        formMode: FormMode.None,\r\n        activeAnswer: null,\r\n        selectedAnswerId: null\r\n      };\r\n    }\r\n\r\n    default:\r\n      alert(`Action ${action.type} not allowed`)\r\n      return {\r\n        ...state\r\n      }\r\n  }\r\n};\r\n\r\n\r\n\r\n/* -----------------------------\r\n   Deep Clone\r\n----------------------------- */\r\nexport class DeepClone {\r\n  static idToSet: string;\r\n  static newGroupRow: IGroupRow;\r\n  constructor(groupRow: IGroupRow) {\r\n    const { topId, id, parentId, title, link, kind, header, level, variations, numOfAnswers,\r\n      hasSubGroups, groupRows, created, modified, answerRows, isExpanded } = groupRow;\r\n\r\n    const subCatRows = groupRows.map((grpRow: IGroupRow) => {\r\n      console.log('DeepClone >>>>>>>>>>>>>>>', grpRow.id)\r\n      if (grpRow.id === DeepClone.idToSet) {\r\n        return { ...DeepClone.newGroupRow }\r\n      }\r\n      else {\r\n        return new DeepClone(grpRow).groupRow\r\n      }\r\n    });\r\n\r\n    this.groupRow = {\r\n      topId,\r\n      parentId,\r\n      id,\r\n      kind,\r\n      title,\r\n      link,\r\n      header,\r\n      level,\r\n      hasSubGroups,\r\n      groupRows: subCatRows,\r\n      numOfAnswers,\r\n      answerRows,\r\n      variations: variations ?? [],\r\n      created,\r\n      modified,\r\n      isExpanded\r\n    }\r\n  }\r\n  groupRow: IGroupRow;\r\n}\r\n\r\n\r\n","import { useGlobalState, useGlobalContext } from '@/global/GlobalProvider'\r\nimport React, { createContext, useContext, useReducer, useCallback, type Dispatch, useEffect } from 'react';\r\n\r\nimport type {\r\n  IGroup, IAnswer, IGroupsContext,\r\n  IGroupDtoEx, IGroupKey,\r\n  IAnswerDtoEx, IAnswerEx, IAnswerKey, IAnswerRow,\r\n  IGroupRow,\r\n  IGroupRowDtoEx,\r\n  IGroupRowDto,\r\n  ILoadGroupAnswers,\r\n  IExpandInfo,\r\n  IKeyExpanded,\r\n  IGroupsState,\r\n  ILocStorage\r\n} from '@/groups/types';\r\n\r\n\r\nimport {\r\n  ActionTypes,\r\n  GroupKey, Group, GroupDto,\r\n  Answer,\r\n  AnswerDto,\r\n  AnswerRowDto,\r\n  GroupRow,\r\n  AnswerKey,\r\n  FormMode,\r\n  GroupRowDto,\r\n  _generateId\r\n} from '@/groups/types';\r\n\r\nimport { GroupReducer, initialAnswer, initialGroup } from '@/groups/GroupReducer';\r\n\r\nconst GroupsContext = createContext<IGroupsContext>({} as any);\r\nconst GroupDispatchContext = createContext<Dispatch<any>>(() => null);\r\n\r\ntype IProps = {\r\n  children: React.ReactNode\r\n}\r\n\r\nexport const initialState: IGroupsState = {\r\n  formMode: FormMode.None,\r\n\r\n  allGroupRows: new Map<string, IGroupRow>(),\r\n  allGroupRowsLoaded: undefined,\r\n\r\n  topRows: [],\r\n  topRowsLoading: false,\r\n  topRowsLoaded: false,\r\n\r\n  nodeOpening: false,\r\n  nodeOpened: false,\r\n\r\n  keyExpanded: null,\r\n\r\n  groupId_answerId_done: undefined,\r\n\r\n  activeGroup: null,\r\n  activeAnswer: null,\r\n  selectedAnswerId: null,\r\n\r\n  loadingGroups: false,\r\n  loadingAnswers: false,\r\n  loadingGroup: false, groupLoaded: false,\r\n  loadingAnswer: false, answerLoaded: false,\r\n\r\n  error: undefined,\r\n\r\n  rowExpanding: false,\r\n  rowExpanded: false\r\n}\r\n\r\nexport const GroupProvider: React.FC<IProps> = ({ children }) => {\r\n\r\n  const { loadAllGroupRowsGlobal } = useGlobalContext();\r\n  const globalState = useGlobalState();\r\n  const { KnowledgeAPI, isAuthenticated, workspace, authUser, canEdit } = globalState;\r\n  const { nickName } = authUser;\r\n\r\n  const [state, dispatch] = useReducer(GroupReducer, initialState);\r\n\r\n  const { formMode, activeGroup, activeAnswer, keyExpanded, topRows, allGroupRows, allGroupRowsLoaded } = state;\r\n\r\n  console.log('----->>> ----->>> ----->>> GroupProvider', topRows)\r\n\r\n  useEffect(() => {\r\n\r\n    let keyExpanded: IKeyExpanded | null = workspace === 'DEMO'\r\n      ? { topId: \"MTS\", groupId: \"REMOTECTRLS\", answerId: \"qqqqqq111\" }\r\n      : null;\r\n\r\n    if ('localStorage' in window) {\r\n      let s = localStorage.getItem('GROUPS_STATE');\r\n      console.log('GROUPS_STATE from localStorage', s)\r\n      if (s !== null) {\r\n        const locStorage: ILocStorage = JSON.parse(s);\r\n        if (locStorage.keyExpanded !== null)\r\n          keyExpanded = locStorage.keyExpanded!;\r\n      }\r\n    }\r\n    /**/\r\n    dispatch({ type: ActionTypes.SET_KEY_EXPANDED, payload: { keyExpanded } });\r\n  }, [workspace]);\r\n\r\n\r\n  const Execute = useCallback(\r\n    async (\r\n      method: string,\r\n      endpoint: string,\r\n      data: Object | null = null,\r\n      whichRowId: string | undefined = undefined\r\n    ): Promise<any> => {\r\n      const accessToken = localStorage.getItem(\"accessToken\");\r\n      if (accessToken) {\r\n        try {\r\n          console.log(\"------Execute endpoint:\", endpoint)\r\n          let response = null;\r\n\r\n          const headers = new Headers();\r\n          const bearer = `Bearer ${accessToken}`;\r\n          headers.append(\"Authorization\", bearer);\r\n\r\n          if (data) headers.append('Content-Type', 'application/json');\r\n\r\n          let options = {\r\n            method: method,\r\n            headers: headers,\r\n            body: data ? JSON.stringify(data) : null,\r\n          };\r\n\r\n          response = (await fetch(endpoint, options));\r\n          if (response.ok) {\r\n            if ((response.status === 200 || response.status === 201)) {\r\n              let responseData = null; //response;\r\n              try {\r\n                responseData = await response.json();\r\n              }\r\n              catch (error) {\r\n                dispatch({\r\n                  type: ActionTypes.SET_ERROR, payload: {\r\n                    error: new Error(`Response status: ${response.status}`),\r\n                    whichRowId\r\n                  }\r\n                });\r\n              }\r\n              finally {\r\n                return responseData;\r\n              }\r\n            }\r\n          }\r\n          else {\r\n            const { errors } = await response.json();\r\n            const error = new Error(\r\n              errors?.map((e: { message: any; }) => e.message).join('\\n') ?? 'unknown',\r\n            )\r\n            dispatch({ type: ActionTypes.SET_ERROR, payload: { error, whichRowId } });\r\n          }\r\n        }\r\n        catch (e) {\r\n          console.log('-------------->>> execute', method, endpoint, e)\r\n          dispatch({ type: ActionTypes.SET_ERROR, payload: { error: new Error(`fetch eror`), whichRowId } });\r\n        }\r\n      }\r\n      return null;\r\n    }, []);\r\n\r\n\r\n  // ---------------------------\r\n  // load all groupRows\r\n  // ---------------------------\r\n  const loadAllGroupRows = useCallback(async (): Promise<Map<string, IGroupRow> | null> => {\r\n    return new Promise(async (resolve) => {\r\n      const allGroupRows = await loadAllGroupRowsGlobal();\r\n      if (allGroupRows) {\r\n        dispatch({ type: ActionTypes.SET_ALL_GROUP_ROWS, payload: { allGroupRows } });\r\n      }\r\n      else {\r\n        dispatch({ type: ActionTypes.SET_ERROR, payload: { error: new Error('Zajeb allGroupRows') } });\r\n      }\r\n      resolve(allGroupRows);\r\n    })\r\n  }, [loadAllGroupRowsGlobal]);\r\n\r\n\r\n  const getGrp = useCallback(async (id: string): Promise<IGroupRow | undefined> => {\r\n    try {\r\n      const grp: IGroupRow | undefined = allGroupRows.get(id);  // globalState.cats is Map<string, ICat>\r\n      return grp;\r\n    }\r\n    catch (error: any) {\r\n      console.log(error)\r\n      dispatch({ type: ActionTypes.SET_ERROR, payload: { error } });\r\n    }\r\n    return undefined;\r\n  }, [allGroupRows]);\r\n\r\n  useEffect(() => {\r\n    (async () => {\r\n      //if (allGroupRowsLoaded === undefined) {\r\n      await loadAllGroupRows();\r\n      //}\r\n    })()\r\n  }, [loadAllGroupRows]);\r\n\r\n  const getSubGrps = useCallback(async (groupId: string | null) => {\r\n    try {\r\n      let parentHeader = \"\";\r\n      const subGrps: IGroupRow[] = [];\r\n      allGroupRows.forEach((cat, id) => {  // globalState.cats is Map<string, ICat>\r\n        if (id === groupId) {\r\n          parentHeader = \"\"; //cat.header!;\r\n        }\r\n        else if (cat.parentId === groupId) {\r\n          subGrps.push(cat);\r\n        }\r\n      })\r\n      return { subGrps, parentHeader };\r\n    }\r\n    catch (error: any) {\r\n      console.log(error)\r\n      dispatch({ type: ActionTypes.SET_ERROR, payload: { error } });\r\n      return { subGrps: [], parentHeader: 'Kiks subGrps' }\r\n    }\r\n  }, [allGroupRows]);\r\n\r\n  const loadTopRows = useCallback(async () => {\r\n    return new Promise(async (resolve) => {\r\n      //const { keyExpanded } = state;\r\n      try {\r\n        dispatch({ type: ActionTypes.SET_TOP_ROWS_LOADING, payload: {} });\r\n        const url = `${KnowledgeAPI.endpointGroupRow}/${workspace}/toprows`;\r\n        console.log('GroupProvider loadTopRows url:', url)\r\n        console.log('loadTopRows AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA')\r\n        console.time();\r\n        await Execute(\"GET\", url)\r\n          .then((dtos: IGroupRowDto[]) => {\r\n            console.timeEnd();\r\n            console.log('loadTopRows CCCCCCCCCCCCCCCCCCCC')\r\n            const topRows: IGroupRow[] = dtos!.map((dto: IGroupRowDto) => {\r\n              dto.IsExpanded = keyExpanded\r\n                ? dto.Id === keyExpanded.groupId\r\n                : false;\r\n              //dto.TopId = dto.AnswerId;\r\n              return new GroupRow(dto).groupRow;\r\n            })\r\n            dispatch({ type: ActionTypes.SET_TOP_ROWS, payload: { topRows } });\r\n            resolve(true);\r\n          });\r\n      }\r\n      catch (error: any) {\r\n        console.log(error)\r\n        dispatch({ type: ActionTypes.SET_ERROR, payload: { error } });\r\n      }\r\n    })\r\n  }, [Execute, KnowledgeAPI.endpointGroupRow, keyExpanded, workspace]); // state, \r\n\r\n\r\n  // get group With subgroupRows and answerRows\r\n  const getGroup = useCallback(\r\n    async (groupKey: IGroupKey, includeAnswerId: string | null): Promise<any> => {\r\n      const { topId, id } = groupKey;\r\n      console.log({ groupKey, includeAnswerId })\r\n      return new Promise(async (resolve) => {\r\n        try {\r\n          const url = `${KnowledgeAPI.endpointGroup}/${workspace}/${topId}/${id}/${PAGE_SIZE}/${includeAnswerId}`;\r\n          console.time()\r\n          console.log('================ getGroup =======================')\r\n          await Execute(\"GET\", url)\r\n            .then((groupDtoEx: IGroupDtoEx) => {\r\n              console.timeEnd();\r\n              const { groupDto, msg } = groupDtoEx;\r\n              if (groupDto) {\r\n                resolve(new Group(groupDto).group);\r\n              }\r\n              else {\r\n                resolve(new Error(msg));\r\n              }\r\n            });\r\n        }\r\n        catch (error: any) {\r\n          console.log(error)\r\n          resolve(error);\r\n        }\r\n      })\r\n    }, [Execute, KnowledgeAPI.endpointGroup, workspace]);\r\n\r\n  const findGroupRow = useCallback(\r\n    async (groupRow: IGroupRow, id: string): Promise<IGroupRow | undefined> => {\r\n      if (groupRow.topId === id)\r\n        return groupRow;\r\n      const { groupRows } = groupRow;\r\n      let grp: IGroupRow | undefined = groupRows.find(c => c.id === id);\r\n      if (!grp) {\r\n        for (const c of groupRows) {\r\n          const grpRow = await findGroupRow(c, id);\r\n          if (grpRow) {\r\n            grp = grpRow;\r\n            console.log(\"findGroup Stop the loop for: \" + id);\r\n            break;\r\n          }\r\n        }\r\n      }\r\n      return grp;\r\n    }, []);\r\n\r\n\r\n  const expandNodesUpToTheTree = useCallback(\r\n    async (grpKey: IGroupKey, answerId: string | null, fromChatBotDlg = false): Promise<boolean> => {\r\n      return new Promise(async (resolve) => {\r\n        try {\r\n          let { topId, parentId, id } = grpKey;\r\n          console.assert(id !== null, 'id ne sme biti null u expandNodesUpToTheTree');\r\n          if (id) {\r\n            // const groupRow: IGroupRow | undefined = allGroupRows.get(id);\r\n            // if (groupRow) {\r\n            //   //topId = groupRow.topId;\r\n            //   parentId = groupRow.parentId;\r\n            // }\r\n            // else {\r\n            //   alert('reload all groupRow:' + id)\r\n            //   //return\r\n            // }\r\n          }\r\n          dispatch({\r\n            type: ActionTypes.SET_NODE_EXPANDING_UP_THE_TREE, payload: {\r\n              groupId_answerId_done: `${id}_${answerId}`\r\n            }\r\n          })\r\n          // ---------------------------------------------------------------------------\r\n          console.time();\r\n          const groupKey: IGroupKey = { topId, id, parentId: null }; // proveri ROOT\r\n          const query = new GroupKey(groupKey).toQuery(workspace);\r\n          const url = `${KnowledgeAPI.endpointGroupRow}?${query}&pageSize=${PAGE_SIZE}&includeAnswerId=${answerId ?? null}`;\r\n          await Execute(\"GET\", url)\r\n            .then(async (groupRowDtoEx: IGroupRowDtoEx) => {\r\n              //dispatch({ type: ActionTypes.CLEAN_SUB_TREE, payload: { groupKey: groupKey! } });\r\n              const { groupRowDto } = groupRowDtoEx;\r\n              console.timeEnd();\r\n              if (groupRowDto) {\r\n                let group: IGroup | null = null;\r\n                let answer: IAnswer | null = null;\r\n                const topRowNew: IGroupRow | null = new GroupRow(groupRowDto).groupRow;\r\n                const bottomRow = await findGroupRow(topRowNew, id!);\r\n                if (parentId !== null) {\r\n                  //topRow = groupRow!;\r\n                  group = { ...bottomRow!, doc1: '' };\r\n                  if (answerId) {\r\n                    const answerRow = bottomRow!.answerRows!.find(q => q.id === answerId && q.included)!;\r\n                    if (answerRow) {\r\n                      group = null;\r\n                      answer = {\r\n                        ...answerRow,\r\n                        source: 0,\r\n                        status: 0\r\n                      }\r\n                    }\r\n                  }\r\n                }\r\n                else {\r\n                  console.log('WHAT') // TODO\r\n                }\r\n                console.log('>>> expandNodeUpToTheTree groupRow', { topRowNew, groupRow: bottomRow, answerId: \"'\" + (answerId ?? 'jok') + \"'\" + (answerId ?? \"JOK\") })\r\n                const formMode = answerId\r\n                  ? canEdit\r\n                    ? FormMode.EditingAnswer\r\n                    : FormMode.ViewingAnswer\r\n                  : canEdit\r\n                    ? FormMode.EditingGroup\r\n                    : FormMode.ViewingGroup;\r\n                dispatch({\r\n                  type: ActionTypes.SET_NODE_EXPANDED_UP_THE_TREE, payload: {\r\n                    grpKey,\r\n                    groupRow: topRowNew,\r\n                    group: group!,\r\n                    answerId: answerId ?? null,\r\n                    answer,\r\n                    formMode,\r\n                    fromChatBotDlg //: fromChatBotDlg === 'true'\r\n                  }\r\n                })\r\n                resolve(true);\r\n              }\r\n              else {\r\n                resolve(false);\r\n              }\r\n            });\r\n        }\r\n        catch (error: any) {\r\n          console.log(error)\r\n          dispatch({ type: ActionTypes.SET_ERROR, payload: { error } });\r\n        }\r\n      })\r\n    }, [workspace, KnowledgeAPI.endpointGroupRow, Execute, allGroupRows, findGroupRow, canEdit]);\r\n\r\n\r\n  const getGroupRow = useCallback(\r\n    async (groupKey: IGroupKey, hidrate: boolean = false, includeAnswerId: string | null = null): Promise<any> => {\r\n      const query = new GroupKey(groupKey).toQuery(workspace);\r\n      return new Promise(async (resolve) => {\r\n        try {\r\n          const url = `${KnowledgeAPI.endpointGroupRow}/${hidrate}/${PAGE_SIZE}/${includeAnswerId}?${query}`;\r\n          console.time()\r\n          await Execute(\"GET\", url)\r\n            .then((groupRowDtoEx: IGroupRowDtoEx) => {\r\n              console.timeEnd();\r\n              const { groupRowDto, msg } = groupRowDtoEx;\r\n              if (groupRowDto) {\r\n                //groupRowDto.TopId = topId;\r\n                resolve(new GroupRow(groupRowDto).groupRow);\r\n              }\r\n              else {\r\n                resolve(new Error(msg));\r\n              }\r\n            });\r\n        }\r\n        catch (error: any) {\r\n          console.log(error)\r\n          resolve(error);\r\n        }\r\n      })\r\n    }, [Execute, KnowledgeAPI.endpointGroupRow, workspace]);\r\n\r\n\r\n  const expandGroup = useCallback(\r\n    async ({ groupKey, includeAnswerId, newAnswerRow, formMode }: IExpandInfo): Promise<any> => {\r\n      try {\r\n        //const { keyExpanded } = state;\r\n        dispatch({ type: ActionTypes.SET_ROW_EXPANDING, payload: {} });\r\n        const groupRow: IGroupRow = await getGroupRow(groupKey, true, includeAnswerId); // to reload Group\r\n        if (groupRow instanceof Error) {\r\n          dispatch({ type: ActionTypes.SET_ERROR, payload: { error: groupRow } });\r\n          console.error({ groupRow })\r\n        }\r\n        else {\r\n          let selectedAnswerId: string | undefined = undefined;\r\n          if (includeAnswerId && groupRow.answerRows!.filter((row: IAnswerRow) => row.included).length > 0) {\r\n            selectedAnswerId = includeAnswerId;\r\n          }\r\n          // if (newGroupRow) {\r\n          //   groupRow.groupRows = [newGroupRow, ...groupRow.groupRows];\r\n          // }\r\n          if (newAnswerRow) {\r\n            groupRow.answerRows = [newAnswerRow, ...groupRow.answerRows!];\r\n          }\r\n          groupRow.isExpanded = true;\r\n          console.log('@@@@@@@@@@@@@@@@@ expandGroup:', formMode, includeAnswerId)\r\n          if (formMode === FormMode.None && includeAnswerId) {\r\n            formMode = canEdit ? FormMode.EditingAnswer : FormMode.ViewingAnswer\r\n          }\r\n          dispatch({ type: ActionTypes.SET_ROW_EXPANDED, payload: { groupRow, formMode: formMode!, selectedAnswerId } });\r\n          return groupRow;\r\n        }\r\n      }\r\n      catch (error: any) {\r\n        console.log('error', error);\r\n        dispatch({ type: ActionTypes.SET_ERROR, payload: { error } });\r\n        return null;\r\n      }\r\n    }, [canEdit, getGroupRow]);\r\n\r\n\r\n  const collapseGroup = useCallback(\r\n    async (groupRow: IGroupRow) => {\r\n      const { topId, id } = groupRow;\r\n      //const { topRows } = state;\r\n      const topRow: IGroupRow = topRows.find(c => c.id === topId)!;\r\n      const grpRow: IGroupRow | undefined = await findGroupRow(topRow, id);\r\n      /*\r\n      const catRow: IGroupRow = (topRow.id === id)\r\n        ? topRow\r\n        : (await findGroupRow(topRow, id))!;\r\n      */\r\n      if (grpRow) {\r\n        groupRow = { ...grpRow, isExpanded: false, groupRows: [], answerRows: [] }\r\n        // rerender\r\n        dispatch({ type: ActionTypes.SET_ROW_COLLAPSED, payload: { groupRow } })\r\n      }\r\n      else {\r\n        dispatch({ type: ActionTypes.SET_ERROR, payload: { error: new Error('findGroup sranje'), whichRowId: id } });\r\n      }\r\n    }, [findGroupRow, topRows]);\r\n\r\n\r\n  const addGroup = useCallback(\r\n    async (parentGroupRow: IGroupRow | null) => {\r\n      try {\r\n        //if (formMode !== FormMode.None) {\r\n        dispatch({ type: ActionTypes.CLOSE_GROUP_FORM, payload: {} })\r\n        //}\r\n        //const id = _generateId;\r\n        const { topId, id, level } = parentGroupRow ?? { topId: _generateId, id: _generateId, level: 0 };\r\n        const newGroupRow: IGroupRow = {\r\n          ...initialGroup,\r\n          topId,\r\n          parentId: parentGroupRow ? id : null,\r\n          id: _generateId,\r\n          level: level + 1,\r\n          title: 'New Group',\r\n          isExpanded: false\r\n        }\r\n        if (parentGroupRow === null) { // add topRow\r\n          dispatch({\r\n            type: ActionTypes.SET_GROUP_TO_ADD_TOP, payload: {\r\n              //groupRow: { groupRow, groupRows: [newGroupRow, ...groupRow.groupRows]\r\n              newGroupRow\r\n            }\r\n          });\r\n        }\r\n        else {\r\n          // if (id !== null) {\r\n          //   const topRow: IGroupRow = state.topRows.find(c => c.id === topId)!;\r\n          //   parentGroupRow = findGroupRow(topRow, id)!;\r\n          // }\r\n          const groupRow: IGroupRow = {\r\n            ...parentGroupRow,\r\n            level: level + 1,\r\n            groupRows: [newGroupRow, ...parentGroupRow.groupRows],\r\n            hasSubGroups: true,\r\n            isExpanded: true\r\n          }\r\n          dispatch({\r\n            type: ActionTypes.SET_GROUP_TO_ADD, payload: {\r\n              groupRow,\r\n              newGroupRow: { ...newGroupRow } // , title: ''\r\n            }\r\n          })\r\n          // dispatch({\r\n          //   type: ActionTypes.SET_GROUP, payload: {\r\n          //     groupRow: { ...newGroupRow, doc1: ''}\r\n          //   }\r\n          // })\r\n          //const groupKey: IGroupKey = { topId, parentId, id };\r\n          // const newGroupRow: IGroupRow = {\r\n          //   ...initialGroup,\r\n          //   topId,\r\n          //   parentId,\r\n          //   id: _generateId,\r\n          //   level,\r\n          //   title: '' // new Group\r\n          // }\r\n          /*\r\n          if (isExpanded) {\r\n            groupRows.map(g => g.isExpanded = false);\r\n            const groupRow2: IGroupRow = {\r\n              ...groupRow,\r\n              groupRows: [newGroupRow, ...groupRows],\r\n            }\r\n            dispatch({ type: ActionTypes.SET_ROW_EXPANDED, payload: { groupRow: groupRow2, formMode: FormMode.AddingGroup } });\r\n            dispatch({ type: ActionTypes.SET_GROUP, payload: { groupRow: { ...newGroupRow, doc1: '' } } });\r\n          }\r\n          else {\r\n            const expandInfo: IExpandInfo = {\r\n              groupKey,\r\n              formMode: FormMode.AddingGroup,\r\n              newGroupRow\r\n            }\r\n            const row: IGroupRow | null = await expandGroup(expandInfo);\r\n            if (row) {\r\n              const group: IGroup = {\r\n                ...newGroupRow,\r\n                doc1: ''\r\n              }\r\n              dispatch({ type: ActionTypes.SET_GROUP, payload: { groupRow: group } });\r\n            }\r\n          }\r\n            */\r\n        }\r\n      }\r\n      catch (error: any) {\r\n        console.log('error', error);\r\n        dispatch({ type: ActionTypes.SET_ERROR, payload: { error } });\r\n      }\r\n    }, []);\r\n\r\n\r\n  const cancelAddGroup = useCallback(\r\n    async () => {\r\n      try {\r\n        const { parentId } = activeGroup!;\r\n        let parentRow: IGroupRow | undefined = undefined;\r\n\r\n        let rows: IGroupRow[] = [];\r\n        topRows.forEach(async topRow => {\r\n          if (parentId === null) {\r\n            rows = topRows.filter(catRow => catRow.id !== _generateId);\r\n          }\r\n          else {\r\n            parentRow = await findGroupRow(topRow, parentId!);\r\n            if (parentRow) {\r\n              parentRow.groupRows = parentRow.groupRows.filter((catRow: { id: string; }) => catRow.id !== _generateId);\r\n            }\r\n          }\r\n        });\r\n        dispatch({ type: ActionTypes.CANCEL_ADD_GROUP, payload: { topRows: (rows.length > 0) ? rows : topRows } });\r\n      }\r\n      catch (error: any) {\r\n        console.log('error', error);\r\n        dispatch({ type: ActionTypes.SET_ERROR, payload: { error } });\r\n      }\r\n    }, [activeGroup, expandGroup]);\r\n\r\n\r\n  const createGroup = useCallback(\r\n    async (group: IGroup) => {\r\n      const { id } = group;\r\n      dispatch({ type: ActionTypes.SET_LOADING_GROUP, payload: {} });\r\n      try {\r\n        const groupDto = new GroupDto(group, workspace).groupDto;\r\n        console.log(\"groupDto\", { groupDto })\r\n        const url = `${KnowledgeAPI.endpointGroup}`; //\r\n        console.time()\r\n        await Execute(\"POST\", url, groupDto, id)\r\n          .then(async (groupDtoEx: IGroupDtoEx) => {   //  | null\r\n            console.timeEnd();\r\n            const { groupDto } = groupDtoEx;\r\n            if (groupDto) {\r\n              //groupDto.TopId = topId!;\r\n              const group = new Group(groupDto).group;\r\n              console.log('Group successfully created', { group })\r\n              dispatch({ type: ActionTypes.CLOSE_GROUP_FORM, payload: {} })\r\n              // await loadAllGroupRows()\r\n              allGroupRows.set(group.id, { // TODO check it\r\n                ...group,\r\n                isExpanded: false\r\n              });\r\n              //.then(async () => { // done: boolean\r\n              //await loadTopRows();\r\n              //await onGroupIdChanged(topId, group.id); // replace _generateId with id, inside of tree\r\n              if (group.parentId === null) {\r\n                dispatch({ type: ActionTypes.SET_GROUP_ADDED, payload: { groupRow: group } }); // IGroup extends IGroup Row\r\n              }\r\n              else {\r\n                // const parentGroupKey: IGroupKey = {\r\n                //   topId: group.topId,\r\n                //   parentId: \"doesn't matter\",\r\n                //   id: group.parentId!\r\n                // };\r\n                // const expandInfo: IExpandInfo = {\r\n                //   groupKey: parentGroupKey,\r\n                //   formMode: FormMode.AddingGroup\r\n                // }\r\n                // alert('zovem expa')\r\n                // await expandGroup(expandInfo).then(() => {\r\n                //   dispatch({ type: ActionTypes.SET_GROUP_ADDED, payload: { groupRow: group } }); // IGroup extends IGroup Row\r\n                // });\r\n                dispatch({ type: ActionTypes.SET_GROUP_ADDED, payload: { groupRow: group } }); // IGroup extends IGroup Row\r\n              }\r\n              //})\r\n            }\r\n          });\r\n      }\r\n      catch (error: any) {\r\n        console.log(error)\r\n        dispatch({ type: ActionTypes.SET_ERROR, payload: { error: new Error('Server Error'), whichRowId: id } });\r\n      }\r\n    }, [Execute, KnowledgeAPI.endpointGroup, loadAllGroupRows, loadTopRows, workspace]);\r\n\r\n\r\n  const cancelAddAnswer = useCallback(\r\n    async () => {\r\n      try {\r\n        const { topId, parentId } = activeAnswer!;\r\n        const groupKey: IGroupKey = { topId, parentId, id: parentId! };\r\n        const expandInfo: IExpandInfo = {\r\n          groupKey,\r\n          formMode: FormMode.None\r\n        }\r\n        const groupRow: IGroupRow | null = await expandGroup(expandInfo);\r\n        if (groupRow) {\r\n          dispatch({ type: ActionTypes.CANCEL_ADD_ANSWER, payload: { groupRow } });\r\n        }\r\n      }\r\n      catch (error: any) {\r\n        console.log('error', error);\r\n        dispatch({ type: ActionTypes.SET_ERROR, payload: { error } });\r\n      }\r\n    }, [activeAnswer, expandGroup]);\r\n\r\n  const viewGroup = useCallback(async (groupRow: IGroupRow, includeAnswerId: string | null) => {\r\n    if (formMode === FormMode.AddingAnswer) {\r\n      await cancelAddAnswer();\r\n    }\r\n    else if (formMode === FormMode.AddingGroup) {\r\n      await cancelAddGroup();\r\n    }\r\n    dispatch({ type: ActionTypes.SET_LOADING_GROUP, payload: { groupRow } });\r\n    const groupKey = new GroupKey(groupRow).groupKey!;\r\n    const group: IGroup = await getGroup(groupKey, includeAnswerId);\r\n    if (group instanceof Error)\r\n      dispatch({ type: ActionTypes.SET_ERROR, payload: { error: group } });\r\n    else {\r\n      group.topId = groupRow.topId;\r\n      dispatch({ type: ActionTypes.SET_GROUP_TO_VIEW, payload: { groupRow: group } });\r\n    }\r\n  }, [cancelAddGroup, cancelAddAnswer, formMode, getGroup]);\r\n\r\n\r\n  const editGroup = useCallback(async (groupRow: IGroupRow, includeAnswerId: string | null) => {\r\n    // includeAnswerId = null;\r\n    //const { topId, parentId } = groupRow;\r\n    if (formMode === FormMode.AddingAnswer) {\r\n      await cancelAddAnswer();\r\n    }\r\n    else if (formMode === FormMode.AddingGroup) {\r\n      await cancelAddGroup();\r\n    }\r\n    dispatch({ type: ActionTypes.SET_LOADING_GROUP, payload: {} });\r\n    const groupKey = new GroupKey(groupRow).groupKey!;\r\n    const group: IGroup = await getGroup(groupKey, includeAnswerId);\r\n    if (group instanceof Error)\r\n      dispatch({ type: ActionTypes.SET_ERROR, payload: { error: group } });\r\n    else {\r\n      const grpRow: IGroupRow = { ...group, isExpanded: false, groupRows: [], answerRows: [] }\r\n      dispatch({ type: ActionTypes.SET_GROUP_TO_EDIT, payload: { groupRow: grpRow, group } });\r\n      /*\r\n      if (parentId === null) { // topRow\r\n        group.topId = groupRow.topId;\r\n        dispatch({ type: ActionTypes.SET_GROUP_TO_EDIT, payload: { groupRow: group } });\r\n      }\r\n      else {\r\n        const parentKey: IGroupKey = { topId, parentId, id: parentId }\r\n        // get acurate info from server (children will be collapsed)\r\n        const expandInfo: IExpandInfo = {\r\n          groupKey: parentKey,\r\n          formMode: FormMode.EditingGroup\r\n        }\r\n        await expandGroup(expandInfo).then(() => {\r\n          group.topId = groupRow.topId;\r\n          dispatch({ type: ActionTypes.SET_GROUP_TO_EDIT, payload: { groupRow: group } });\r\n        })\r\n      }\r\n        */\r\n    }\r\n  }, [cancelAddGroup, cancelAddAnswer, formMode, getGroup]);\r\n\r\n\r\n  const updateGroup = useCallback(\r\n    async (group: IGroup) => { // , closeForm: boolean\r\n      //const { topId, id, variations, title, kind, modified } = group;\r\n      dispatch({ type: ActionTypes.SET_LOADING_GROUP, payload: {} });\r\n      try {\r\n        const groupDto = new GroupDto(group, workspace).groupDto;\r\n        const url = `${KnowledgeAPI.endpointGroup}`;\r\n        console.time()\r\n        await Execute(\"PUT\", url, groupDto)\r\n          .then((groupDtoEx: IGroupDtoEx) => {\r\n            console.timeEnd();\r\n            const { groupDto, msg } = groupDtoEx;\r\n            if (groupDto) {\r\n              const group = new Group(groupDto).group;\r\n              const { topId } = group;\r\n              group.isExpanded = false;\r\n              group.topId = topId;\r\n              dispatch({ type: ActionTypes.SET_GROUP_UPDATED, payload: { /*groupRow: group, */group } });\r\n              // if (closeForm) {\r\n              //   dispatch({ type: ActionTypes.CLOSE_GROUP_FORM, payload: {} })\r\n              // }\r\n            }\r\n            else {\r\n              dispatch({ type: ActionTypes.SET_ERROR, payload: { error: new Error(`${msg}`) } });\r\n            }\r\n          });\r\n      }\r\n      catch (error: any) {\r\n        console.log(error)\r\n        dispatch({ type: ActionTypes.SET_ERROR, payload: { error: new Error(\"Karambol\") } });\r\n        return error;\r\n      }\r\n    }, [Execute, KnowledgeAPI.endpointGroup, workspace]);\r\n\r\n\r\n  const deleteGroup = useCallback(async (groupRow: IGroupRow) => {\r\n    //dispatch({ type: ActionTypes.SET_GROUP_LOADING, payload: { id, loading: false } });\r\n    try {\r\n      const { parentId, id } = groupRow;\r\n      groupRow.modified = { time: new Date(), nickName };\r\n      const groupDto = new GroupRowDto(groupRow, workspace).groupRowDto;\r\n      const url = `${KnowledgeAPI.endpointGroup}`;\r\n      console.time()\r\n      dispatch({ type: ActionTypes.SET_LOADING_GROUPS, payload: {} });\r\n      await Execute(\"DELETE\", url, groupDto)    //Modified: {  Time: new Date(), NickName: globalState.authUser.nickName }\r\n        .then(async (groupDtoEx: IGroupDtoEx) => {\r\n          console.timeEnd();\r\n          const { groupDto, msg } = groupDtoEx;\r\n          if (msg === \"OK\") {\r\n            console.log('Group successfully deleted', { groupRow })\r\n            let parentRow: IGroupRow | undefined = undefined;\r\n            if (parentId !== null) {\r\n              for await (const topRow of topRows) {\r\n                parentRow = await findGroupRow(topRow, parentId!);\r\n                if (parentRow)\r\n                  break;\r\n              }\r\n              parentRow!.hasSubGroups = groupDto!.HasSubGroups;\r\n              if (!parentRow!.hasSubGroups)\r\n                parentRow!.isExpanded = false;\r\n              parentRow!.groupRows = parentRow!.groupRows.filter(row => row.id !== id);\r\n            }\r\n            dispatch({ type: ActionTypes.GROUP_DELETED, payload: { groupRow: parentRow, id } });\r\n          }\r\n          else if (msg === \"HasSubGroups\") {\r\n            dispatch({ type: ActionTypes.SET_ERROR, payload: { error: new Error(\"First remove sub groups\"), whichRowId: groupDto!.Id } });\r\n          }\r\n          else if (msg === \"HasAnswers\") {\r\n            dispatch({ type: ActionTypes.SET_ERROR, payload: { error: new Error(\"First remove group answers\"), whichRowId: groupDto!.Id } });\r\n          }\r\n          else {\r\n            dispatch({ type: ActionTypes.SET_ERROR, payload: { error: new Error(msg), whichRowId: groupDto!.Id } });\r\n          }\r\n        })\r\n    }\r\n    catch (error: any) {\r\n      console.log(error)\r\n      return error;\r\n    }\r\n  }, [Execute, KnowledgeAPI.endpointGroup, expandGroup, loadAllGroupRows, loadTopRows, workspace]);\r\n\r\n\r\n  const deleteGroupVariation = async (groupKey: IGroupKey, variationName: string) => {\r\n    try {\r\n      console.log(\"Deleting Group Tag...\", { groupKey, variationName });\r\n      // const group = await dbp!.get('Groups', id);\r\n      // const obj: IGroup = {\r\n      //   ...group,\r\n      //   variations: group.variations.filter((variation: string) => variation !== variationName),\r\n      //   modified: {\r\n      //     Time: new Date(),\r\n      //     by: {\r\n      //       nickName: globalState.authUser.nickName\r\n      //     }\r\n      //   }\r\n      // }\r\n      // POPRAVI TODO\r\n      //updateGroup(obj, false);\r\n      console.log(\"Group Tag successfully deleted\");\r\n    }\r\n    catch (error: any) {\r\n      console.log('error', error);\r\n      dispatch({ type: ActionTypes.SET_ERROR, payload: { error } });\r\n    }\r\n  };\r\n\r\n\r\n  ////////////////////////////////////\r\n  // Answers\r\n  //\r\n\r\n  const PAGE_SIZE = 12;\r\n  const loadGroupAnswers = useCallback(async ({ groupKey, startCursor, includeAnswerId }: ILoadGroupAnswers): Promise<any> => {\r\n    try {\r\n      const { topId, id } = groupKey;\r\n      dispatch({ type: ActionTypes.SET_ANSWERS_LOADING, payload: {} })\r\n      try {\r\n        const url = `${KnowledgeAPI.endpointAnswer}/${workspace}/${topId}/${id}/${startCursor}/${PAGE_SIZE}/${includeAnswerId}`;\r\n        console.time()\r\n        await Execute!(\"GET\", url).then((groupDtoEx: IGroupDtoEx) => {\r\n          console.timeEnd();\r\n          const { groupDto } = groupDtoEx;\r\n          if (groupDto !== null) {\r\n            const group = new Group(groupDto).group;\r\n            // const { Title, AnswerRowDtos, HasMoreAnswers } = groupDto;\r\n            // AnswerRowDtos!.forEach((answerRowDto: IAnswerRowDto) => {\r\n            //   if (includeAnswerId && answerRowDto.Id === includeAnswerId) {\r\n            //     answerRowDto.Included = true;\r\n            //   }\r\n            //   answerRowDto.GroupTitle = Title; // TODO treba li\r\n            //   answerRowDtos.push(answerRowDto);\r\n            // })\r\n            // const answerRows: IAnswerRow[] = answerRowDtos.map(dto => new AnswerRow(dto).answerRow);\r\n            // dispatch({\r\n            //   type: ActionTypes.GROUP_ANSWERS_LOADED,\r\n            //   payload: { id, answerRows, hasMoreAnswers: HasMoreAnswers! }\r\n            // });\r\n            dispatch({\r\n              type: ActionTypes.GROUP_ANSWERS_LOADED,\r\n              payload: { groupRow: group }\r\n            });\r\n          }\r\n        });\r\n      }\r\n      catch (error: any) {\r\n        console.log(error)\r\n        dispatch({ type: ActionTypes.SET_ERROR, payload: { error } });\r\n      }\r\n    }\r\n    catch (error: any) {\r\n      console.log(error);\r\n      dispatch({ type: ActionTypes.SET_ERROR, payload: error });\r\n    }\r\n  }, [Execute, KnowledgeAPI.endpointAnswer, workspace]);\r\n\r\n\r\n  const addAnswer = useCallback(\r\n    async (groupKey: IGroupKey) => {\r\n      try {\r\n        const { topId, id } = groupKey;\r\n        let groupRow = await getGrp(id!);\r\n        if (!groupRow) {\r\n          alert(`Not found ${id}. Reload all Groups`)\r\n          return;\r\n        }\r\n        const newAnswerRow: IAnswerRow = {\r\n          topId,\r\n          parentId: groupKey.id,\r\n          id: _generateId, // do not change\r\n          title: 'answer text',\r\n          groupTitle: groupRow.title,\r\n          included: true\r\n        }\r\n        const answer: IAnswer = {\r\n          ...initialAnswer,\r\n          ...newAnswerRow,\r\n          title: ''\r\n        }\r\n        // console.assert(isExpanded);\r\n        // if (isExpanded) {\r\n        const topRow: IGroupRow = state.topRows.find(c => c.id === topId)!;\r\n        const grpRow: IGroupRow | undefined = await findGroupRow(topRow, id)!;\r\n        dispatch({\r\n          type: ActionTypes.ADD_NEW_ANSWER_TO_ROW, payload: {\r\n            groupRow: { ...grpRow!, answerRows: [newAnswerRow, ...grpRow!.answerRows!] },\r\n            newAnswerRow\r\n          }\r\n        });\r\n        dispatch({ type: ActionTypes.SET_ANSWER, payload: { answer, formMode: FormMode.AddingAnswer } });\r\n        //}\r\n        // else {\r\n        //   const expandInfo: IExpandInfo = {\r\n        //     groupKey,\r\n        //     formMode: FormMode.AddingAnswer,\r\n        //     newAnswerRow\r\n        //   }\r\n        //   await expandGroup(expandInfo);\r\n        //   dispatch({ type: ActionTypes.SET_ANSWER, payload: { answer, formMode: FormMode.AddingAnswer } });\r\n        // }\r\n\r\n      }\r\n      catch (error: any) {\r\n        console.log('error', error);\r\n        dispatch({ type: ActionTypes.SET_ERROR, payload: { error } });\r\n      }\r\n    }, [expandGroup, findGroupRow, getGrp, state.topRows]);\r\n\r\n\r\n  const createAnswer = useCallback(\r\n    async (answer: IAnswer) => {\r\n      const { topId, id, parentId } = answer; // title, modified, \r\n      // TODO\r\n      dispatch({ type: ActionTypes.SET_LOADING_GROUP, payload: {} });\r\n      try {\r\n        answer.created!.nickName = nickName;\r\n        const answerDto = new AnswerDto(answer, workspace).answerDto;\r\n        const url = `${KnowledgeAPI.endpointAnswer}`;\r\n        console.time()\r\n        console.log('>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> createAnswer', answerDto)\r\n        await Execute(\"POST\", url, answerDto)\r\n          .then(async (answerDtoEx: IAnswerDtoEx | null) => {\r\n            console.timeEnd();\r\n            if (answerDtoEx) {\r\n              console.log(\"::::::::::::::::::::\", { answerDtoEx });\r\n              const { answerDto } = answerDtoEx;\r\n              if (answerDto) {\r\n                const answer = new Answer(answerDto).answer;\r\n                answer.topId = topId;\r\n                console.log('Answer successfully created')\r\n                //dispatch({ type: ActionTypes.CLOSE_ANSWER_FORM })\r\n                await loadAllGroupRows() // numOfAnswers changed\r\n                  .then(async () => {\r\n                    const parentGroupKey: IGroupKey = { topId, parentId, id: parentId! };\r\n                    const expandInfo: IExpandInfo = {\r\n                      groupKey: parentGroupKey,\r\n                      formMode: FormMode.EditingAnswer\r\n                    }\r\n                    await expandGroup(expandInfo).then(() => {\r\n                      dispatch({ type: ActionTypes.SET_ANSWER, payload: { formMode: FormMode.EditingAnswer, answer } });\r\n                    });\r\n                  })\r\n              }\r\n            }\r\n          });\r\n      }\r\n      catch (error: any) {\r\n        console.log(error)\r\n        dispatch({ type: ActionTypes.SET_ERROR, payload: { error: new Error('Server Error'), whichRowId: id } });\r\n      }\r\n    }, [Execute, KnowledgeAPI.endpointAnswer, expandGroup, loadAllGroupRows, nickName, workspace]);\r\n\r\n\r\n  const updateAnswer = useCallback(\r\n    async (oldParentId: string, answer: IAnswer, groupChanged: boolean) => {\r\n      const { id } = answer; // , title, modified, parentId\r\n      // dispatch({ type: ActionTypes.SET_GROUP_LOADING, payload: { id: parentId!, loading: false } });\r\n      try {\r\n        answer.modified!.nickName = nickName;\r\n        const answerDto = new AnswerDto(answer, workspace).answerDto;\r\n        const url = `${KnowledgeAPI.endpointAnswer}`;\r\n        console.time()\r\n        answerDto.oldParentId = oldParentId;\r\n        console.log('>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> updateAnswer', answerDto)\r\n        let answerRet: IAnswer | null = null;\r\n        await Execute(\"PUT\", url, answerDto)\r\n          .then(async (answerDtoEx: IAnswerDtoEx) => {\r\n            console.timeEnd();\r\n            const { answerDto, msg } = answerDtoEx;\r\n            if (answerDto) {\r\n              answerRet = new Answer(answerDto).answer!;\r\n              console.log('Answer successfully updated: ', answerRet)\r\n              const { topId, parentId } = answerRet;\r\n              if (groupChanged) {\r\n                // nema koristi\r\n                // dispatch({ type: ActionTypes.SET_ANSWER, payload: { answer: answerRet } })\r\n                const { topId, parentId, id } = answerRet;\r\n                const keyExpanded: IKeyExpanded = {\r\n                  topId,\r\n                  groupId: parentId!,\r\n                  answerId: id\r\n                }\r\n                dispatch({ type: ActionTypes.FORCE_OPEN_NODE, payload: { keyExpanded } })\r\n              }\r\n              else {\r\n                const parentGroupKey: IGroupKey = { topId, parentId, id: parentId! }; // proveri\r\n                const expandInfo: IExpandInfo = {\r\n                  groupKey: parentGroupKey,\r\n                  formMode: FormMode.EditingAnswer\r\n                }\r\n                await expandGroup(expandInfo).then(() => {\r\n                  dispatch({ type: ActionTypes.SET_ANSWER, payload: { formMode: FormMode.EditingAnswer, answer: answerRet! } });\r\n                });\r\n              }\r\n            }\r\n            else {\r\n              dispatch({ type: ActionTypes.SET_ERROR, payload: { error: new Error(msg) } });\r\n            }\r\n          });\r\n        return answerRet;\r\n      }\r\n      catch (error: any) {\r\n        console.log(error)\r\n        dispatch({ type: ActionTypes.SET_ERROR, payload: { error: new Error('Server Error'), whichRowId: id } });\r\n      }\r\n    }, [Execute, KnowledgeAPI.endpointAnswer, expandGroup, nickName, workspace]);\r\n\r\n\r\n  const deleteAnswer = useCallback(\r\n    async (answerRow: IAnswerRow, isActive: boolean) => {\r\n      const { id, parentId, topId } = answerRow;\r\n      dispatch({ type: ActionTypes.SET_LOADING_ANSWER, payload: {} });\r\n      try {\r\n        const answerDto = new AnswerRowDto(answerRow, workspace).answerRowDto;\r\n        const url = `${KnowledgeAPI.endpointAnswer}`;\r\n        console.time()\r\n        await Execute(\"DELETE\", url, answerDto)\r\n          .then(async (answerDtoEx: IAnswerDtoEx) => {\r\n            const { answerDto } = answerDtoEx;\r\n            console.timeEnd();\r\n            if (answerDto) {\r\n              const answer = new Answer(answerDto).answer;\r\n              console.log('Answer successfully deleted')\r\n              if (isActive) {\r\n                dispatch({ type: ActionTypes.ANSWER_DELETED, payload: { answer } });\r\n              }\r\n              /*\r\n              //dispatch({ type: ActionTypes.CLOSE_ANSWER_FORM })\r\n              await loadAndCacheAllGroupRows(); // reload\r\n              */\r\n              const parentGroupKey: IGroupKey = { topId, parentId, id: parentId! }; // proveri\r\n              const expandInfo: IExpandInfo = {\r\n                groupKey: parentGroupKey,\r\n                formMode: FormMode.None\r\n              }\r\n              await expandGroup(expandInfo).then(() => {\r\n                // dispatch({ type: ActionTypes.SET_GROUP, payload: { groupRow: group } }); // IGroup extends IGroup Row\r\n              })\r\n            }\r\n            else {\r\n              console.error(answerDtoEx);\r\n              dispatch({ type: ActionTypes.SET_ERROR, payload: { error: new Error('Server Error'), whichRowId: id } });\r\n            }\r\n          });\r\n      }\r\n      catch (error: any) {\r\n        console.log(error)\r\n        dispatch({ type: ActionTypes.SET_ERROR, payload: { error: new Error('Server Error'), whichRowId: id } });\r\n      }\r\n    }, [Execute, KnowledgeAPI.endpointAnswer, expandGroup, workspace]);\r\n\r\n\r\n  const getAnswer = useCallback(\r\n    async (answerKey: IAnswerKey): Promise<any> => {\r\n      return new Promise(async (resolve) => {\r\n        try {\r\n          const query = new AnswerKey(answerKey).toQuery(workspace);\r\n          const url = `${KnowledgeAPI.endpointAnswer}?${query}`;\r\n          console.time()\r\n          console.log('getAnswer', answerKey)\r\n          await Execute(\"GET\", url)\r\n            .then((answerDtoEx: IAnswerDtoEx) => {\r\n              console.timeEnd();\r\n              const { answerDto, msg } = answerDtoEx;\r\n              if (answerDto) {\r\n                const answerEx: IAnswerEx = {\r\n                  answer: new Answer(answerDto).answer,\r\n                  msg\r\n                }\r\n                resolve(answerEx);\r\n              }\r\n              else {\r\n                const answerEx: IAnswerEx = {\r\n                  answer: null,\r\n                  msg\r\n                }\r\n                resolve(answerEx);\r\n              }\r\n              //}\r\n            });\r\n        }\r\n        catch (error: any) {\r\n          console.log(error);\r\n          const answerEx: IAnswerEx = {\r\n            answer: null,\r\n            msg: \"Problemos\"\r\n          }\r\n          resolve(answerEx);\r\n        }\r\n      })\r\n    }, [Execute, KnowledgeAPI.endpointAnswer, workspace]);\r\n\r\n\r\n  const viewAnswer = useCallback(async (answerRow: IAnswerRow) => {\r\n    const answerKey = new AnswerKey(answerRow).answerKey;\r\n    dispatch({ type: ActionTypes.SET_LOADING_ANSWER, payload: {} });\r\n    const answerEx: IAnswerEx = await getAnswer(answerKey!);\r\n    if (formMode === FormMode.AddingAnswer) {\r\n      await cancelAddAnswer();\r\n    }\r\n    else if (formMode === FormMode.AddingGroup) {\r\n      await cancelAddGroup();\r\n    }\r\n    const { answer, msg } = answerEx;\r\n    if (answer) {\r\n      answer.topId = answerRow.topId;\r\n      dispatch({ type: ActionTypes.SET_ANSWER_TO_VIEW, payload: { answer } });\r\n    }\r\n    else\r\n      dispatch({ type: ActionTypes.SET_ERROR, payload: { error: new Error(msg) } });\r\n  }, [cancelAddGroup, cancelAddAnswer, formMode, getAnswer]);\r\n\r\n\r\n  // const editAnswer = useCallback(async (answerRow: IAnswerRow) => {\r\n  //   const answerKey: IAnswerKey = new AnswerKey(answerRow).answerKey!;\r\n  //   if (formMode === FormMode.AddingAnswer) {\r\n  //     await cancelAddAnswer();\r\n  //   }\r\n  //   else if (formMode === FormMode.AddingGroup) {\r\n  //     await cancelAddGroup();\r\n  //   }\r\n  //   dispatch({ type: ActionTypes.SET_LOADING_ANSWER, payload: {} });\r\n  //   console.log(\"editAnswer:\", answerKey)\r\n  //   const answer = initialAnswer;\r\n  //   if (answer) {\r\n  //     // we don't reload groupRows, just use isSelected from activeAnswer\r\n  //     answer.topId = answerRow.topId;\r\n  //     dispatch({ type: ActionTypes.SET_ANSWER_TO_EDIT, payload: { answer } });\r\n  //   }\r\n  // }, [cancelAddGroup, cancelAddAnswer, formMode]);\r\n\r\n\r\n  const editAnswer = useCallback(async (answerRow: IAnswerRow) => {\r\n    const answerKey: IAnswerKey = new AnswerKey(answerRow).answerKey!;\r\n    if (formMode === FormMode.AddingAnswer) {\r\n      await cancelAddAnswer();\r\n    }\r\n    else if (formMode === FormMode.AddingGroup) {\r\n      await cancelAddGroup();\r\n    }\r\n    dispatch({ type: ActionTypes.SET_LOADING_ANSWER, payload: {} });\r\n    console.log(\"editAnswer:\", answerKey)\r\n    const answerEx: IAnswerEx = await getAnswer(answerKey!);\r\n    const { answer, msg } = answerEx;\r\n    if (answer) {\r\n      // we don't reload groupRows, just use isSelected from activeAnswer\r\n      answer.topId = answerRow.topId;\r\n\r\n      // const topRow: IGroupRow = state.topRows.find(c => c.id === answerRow.topId)!;\r\n      // const groupRow: IGroupRow = findGroupRow(topRow, answerRow.parentId)!;\r\n      //dispatch({ type: ActionTypes.SET_ANSWER_TO_EDIT, payload: { groupRow, answer } });\r\n      dispatch({ type: ActionTypes.CLOSE_ANSWER_FORM, payload: { answer } }); // to reset AnswerForm\r\n      dispatch({ type: ActionTypes.SET_ANSWER_TO_EDIT, payload: { answer } });\r\n    }\r\n    else\r\n      dispatch({ type: ActionTypes.SET_ERROR, payload: { error: new Error(msg) } });\r\n  }, [cancelAddGroup, cancelAddAnswer, formMode, getAnswer]);\r\n\r\n\r\n\r\n  // const onGroupIdChanged = useCallback(\r\n  //   async (topId: string, id: string): Promise<void> => {\r\n  //     const topRow: IGroupRow = topRows.find(c => c.id === topId)!;\r\n  //     console.log('Provider onGroupIdChanged >>>>>>:', topRow)\r\n  //     const groupRow: IGroupRow | undefined = await findGroupRow(topRow, _generateId);\r\n  //     console.log('Provider onGroupIdChanged >>>>>>:', groupRow, id)\r\n  //     groupRow!.id = id;\r\n  //     dispatch({ type: ActionTypes.RE_RENDER_TREE, payload: { groupRow: groupRow! } });\r\n  //   }, [findGroupRow, topRows]);\r\n\r\n  const onGroupTitleChanged = useCallback(\r\n    async (topId: string, id: string, title: string): Promise<void> => {\r\n      const topRow: IGroupRow = topRows.find(c => c.id === topId)!;\r\n      let groupRow: IGroupRow | undefined = await findGroupRow(topRow, id);\r\n      console.log('PROVIDER onGroupTitleChanged::', groupRow!.title, title)\r\n      if (groupRow!.title !== title) {\r\n        groupRow!.title = title === '' ? 'New Category' : title; // to avoid empty title\r\n        dispatch({\r\n          type: ActionTypes.RE_RENDER_TREE, payload: {} //categoryRow: categoryRow! }\r\n        });\r\n      }\r\n      return;\r\n    }, [findGroupRow, topRows]);\r\n\r\n  const onAnswerTitleChanged = useCallback(\r\n    async (topId: string, id: string, title: string): Promise<void> => {\r\n      const topRow: IGroupRow = topRows.find(c => c.id === topId)!;\r\n      let groupRow: IGroupRow | undefined = await findGroupRow(topRow, id);\r\n      if (groupRow) {\r\n        const answerRow = groupRow.answerRows!.find(a => a.id === id)!;\r\n        if (answerRow!.title !== title) {\r\n          answerRow.title = title === '' ? 'New Question' : title; // to avoid empty title;\r\n          // rerender\r\n          console.log('onAnswerTitleChanged+++>>>', id, groupRow)\r\n          dispatch({ type: ActionTypes.ANSWER_TITLE_CHANGED, payload: { groupRow } })\r\n        }\r\n      }\r\n      return;\r\n    }, [findGroupRow, topRows]);\r\n\r\n\r\n  const contextValue: IGroupsContext = {\r\n    state, getSubGrps, getGrp,\r\n    loadAllGroupRows,\r\n    expandNodesUpToTheTree,\r\n    loadTopRows,\r\n    addGroup, cancelAddGroup, createGroup,\r\n    viewGroup, editGroup, updateGroup, deleteGroup, deleteGroupVariation,\r\n    expandGroup, collapseGroup, onGroupTitleChanged,\r\n    loadGroupAnswers,\r\n    addAnswer, cancelAddAnswer, createAnswer,\r\n    viewAnswer, editAnswer, updateAnswer, deleteAnswer, onAnswerTitleChanged\r\n  }\r\n\r\n  if (!isAuthenticated || !allGroupRowsLoaded)  // removed keyExpanded === null\r\n    return null;\r\n\r\n  return (\r\n    <GroupsContext.Provider value={contextValue}>\r\n      <GroupDispatchContext.Provider value={dispatch}>\r\n        {children}\r\n      </GroupDispatchContext.Provider>\r\n    </GroupsContext.Provider>\r\n  );\r\n}\r\n\r\nexport function useGroupContext() {\r\n  return useContext(GroupsContext);\r\n}\r\n\r\nexport const useGroupDispatch = () => {\r\n  return useContext(GroupDispatchContext)\r\n};\r\n\r\n","import type { IGroupKey, IGroupRow } from '@/groups/types';\r\n\r\nimport type { ActionMap } from \"@/global/types\";\r\n\r\n/////////////////////////////////////////////////////////////////////////\r\n// DropDown Select Group\r\n\r\nexport interface IGrpState {\r\n\tloading: boolean,\r\n\tparentId: string | null,\r\n\ttitle: string,\r\n\tcats: IGroupRow[], // drop down groups\r\n\terror?: Error;\r\n}\r\n\r\nexport interface IGrpInfo {\r\n\tselId: string | null;\r\n\tgroupKey: IGroupKey | null,\r\n\tlevel: number,\r\n\tsetParentId: (cat: IGroupRow) => void;\r\n}\r\n\r\nexport enum GrpActionTypes {\r\n\tSET_LOADING = 'SET_LOADING',\r\n\tSET_SUB_CATS = 'SET_SUB_CATS',\r\n\tSET_ERROR = 'SET_ERROR',\r\n\tSET_EXPANDED = 'SET_EXPANDED',\r\n\tSET_PARENT_CAT = 'SET_PARENT_CAT'\r\n}\r\n\r\nexport type GrpsPayload = {\r\n\t[GrpActionTypes.SET_LOADING]: false;\r\n\r\n\t[GrpActionTypes.SET_SUB_CATS]: {\r\n\t\tsubGrps: IGroupRow[];\r\n\t};\r\n\r\n\t[GrpActionTypes.SET_EXPANDED]: {\r\n\t\tid: string;\r\n\t\texpanding: boolean;\r\n\t}\r\n\r\n\t[GrpActionTypes.SET_ERROR]: {\r\n\t\terror: Error;\r\n\t};\r\n\r\n\t[GrpActionTypes.SET_PARENT_CAT]: {\r\n\t\tcat: IGroupRow;\r\n\t};\r\n\r\n};\r\n\r\nexport type GrpsActions =\r\n\tActionMap<GrpsPayload>[keyof ActionMap<GrpsPayload>];\r\n\r\n\r\n\r\nexport type GrpActions = ActionMap<GrpsPayload>[keyof ActionMap<GrpsPayload>];","import React from 'react';\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\nimport { faCaretRight, faCaretDown } from '@fortawesome/free-solid-svg-icons'\r\n\r\nimport { ListGroup, Button } from \"react-bootstrap\";\r\n\r\nimport { type IGroupRow } from \"@/groups/types\";\r\n\r\nimport GrpList from \"@/global/Components/SelectGroup/GrpList\";\r\nimport { type GrpsActions, GrpActionTypes } from './types';\r\n\r\ninterface IGrpRow {\r\n    cat: IGroupRow;\r\n    selId: string | null;\r\n    dispatch: React.Dispatch<GrpsActions>;\r\n    setParentGrp: (cat: IGroupRow) => void;\r\n}\r\n\r\nconst GrpRow = ({ cat, dispatch, setParentGrp, selId }: IGrpRow) => {\r\n    const { topId, parentId, id, title, level, isExpanded } = cat;\r\n    const groupKey = { topId, parentId, id };\r\n\r\n    //const { isDarkMode, variant, bg } = useGlobalState();\r\n\r\n    const expand = (_id: IDBValidKey) => {\r\n        dispatch({ type: GrpActionTypes.SET_EXPANDED, payload: { id, expanding: !isExpanded } });\r\n    }\r\n\r\n    const onSelectGrp = (cat: IGroupRow) => {\r\n        // Load data from server and reinitialize group\r\n        // viewGroup(id);\r\n        setParentGrp(cat);\r\n    }\r\n\r\n    const Row1 =\r\n        <div className=\"d-flex justify-content-start align-items-center w-100 text-primary\">\r\n            <Button\r\n                variant='link'\r\n                size=\"sm\"\r\n                className=\"py-0 px-1\"\r\n                onClick={(e) => {\r\n                    expand(id!);\r\n                    e.stopPropagation();\r\n                    e.preventDefault();\r\n                }}\r\n                title=\"Expand\"\r\n            >\r\n                <FontAwesomeIcon icon={isExpanded ? faCaretDown : faCaretRight} size='lg' />\r\n            </Button>\r\n            <Button\r\n                variant='link'\r\n                size=\"sm\"\r\n                className={`py-0 mx-0 text-decoration-none`}\r\n                title={id}\r\n                onClick={() => onSelectGrp(cat)}\r\n            >\r\n                {title}\r\n            </Button>\r\n        </div>\r\n\r\n    return (\r\n        <>\r\n            <ListGroup.Item\r\n                variant={\"primary\"}\r\n                className=\"py-0 px-1 w-100\"\r\n                as=\"li\"\r\n            >\r\n                {Row1}\r\n            </ListGroup.Item>\r\n\r\n            {isExpanded && // Row2\r\n                <ListGroup.Item\r\n                    className=\"py-0 px-0\"\r\n                    variant={\"primary\"}\r\n                    as=\"li\"\r\n                >\r\n                    <GrpList\r\n                        selId={selId}\r\n                        level={level + 1}\r\n                        groupKey={groupKey}\r\n                        setParentId={setParentGrp}\r\n                    />\r\n                </ListGroup.Item>\r\n            }\r\n\r\n        </>\r\n    );\r\n};\r\n\r\nexport default GrpRow;\r\n","import { type Reducer } from 'react'\r\nimport { type IGroupRow } from \"@/groups/types\";\r\nimport  { type GrpsActions, GrpActionTypes, type IGrpState } from './types';\r\n\r\nexport const initialState: IGrpState = {\r\n  loading: false,\r\n  parentId: null,\r\n  title: '',\r\n  cats: []\r\n}\r\n\r\nexport const GrpReducer: Reducer<IGrpState, GrpsActions> = (state, action) => {\r\n\r\n  switch (action.type) {\r\n    case GrpActionTypes.SET_LOADING:\r\n      return {\r\n        ...state,\r\n        loading: true\r\n      }\r\n\r\n    case GrpActionTypes.SET_SUB_CATS: {\r\n      const { subGrps } = action.payload;\r\n      return {\r\n        ...state,\r\n        cats: state.cats.concat(subGrps),\r\n        loading: false\r\n      }\r\n    }\r\n\r\n    case GrpActionTypes.SET_ERROR: {\r\n      const { error } = action.payload;\r\n      return { ...state, error, loading: false };\r\n    }\r\n\r\n    case GrpActionTypes.SET_EXPANDED: {\r\n      const { id, expanding } = action.payload;\r\n      let { cats } = state;\r\n      if (!expanding) {\r\n        const ids = markForClean(cats, id!)\r\n        console.log('clean:', ids)\r\n        if (ids.length > 0) {\r\n          cats = cats.filter(c => !ids.includes(c.id))\r\n        }\r\n      }\r\n      return {\r\n        ...state,\r\n        cats: state.cats.map(c => c.id === id\r\n          ? { ...c, isExpanded: expanding }\r\n          : c\r\n        )\r\n      };\r\n    }\r\n\r\n    case GrpActionTypes.SET_PARENT_CAT: {\r\n      const { cat } = action.payload;\r\n      const { id, title } = cat;\r\n      return {\r\n        ...state,\r\n        parentId: id!,\r\n        title\r\n      };\r\n    }\r\n\r\n    default:\r\n      return state;  // TODO throw error\r\n  }\r\n};\r\n\r\n\r\nfunction markForClean(cats: IGroupRow[], id: string | null) {\r\n  let deca = cats\r\n    .filter(c => c.parentId === id)\r\n    .map(c => c.id)\r\n\r\n  deca.forEach(id => {\r\n    const unuci = id ? markForClean(cats, id) : [];\r\n    deca = deca.concat(unuci);\r\n  })\r\n  return deca\r\n}","import { useEffect, useReducer, useState } from \"react\";\r\nimport { ListGroup } from \"react-bootstrap\";\r\nimport GrpRow from \"@/global/Components/SelectGroup/GrpRow\";\r\nimport { GrpReducer, initialState } from \"@/global/Components/SelectGroup/GrpReducer\";\r\n//import { useGlobalContext } from \"@/global/GlobalProvider\";\r\nimport { GrpActionTypes, type IGrpInfo } from \"./types\";\r\nimport type { IGroupKey, IGroupRow } from \"@/groups/types\";\r\nimport { useGroupContext } from \"@/groups/GroupProvider\";\r\n\r\nconst GrpList = ({ selId, groupKey, level, setParentId }: IGrpInfo) => {\r\n    const [state, dispatch] = useReducer(GrpReducer, initialState);\r\n    const { getSubGrps } = useGroupContext();\r\n\r\n    const { id } = groupKey ?? { id: null };\r\n    const [catKey] = useState<IGroupKey | null>(groupKey)\r\n\r\n    useEffect(() => {\r\n        (async () => {\r\n            const res = await getSubGrps(id);\r\n            const { subGrps } = res;\r\n            dispatch({ type: GrpActionTypes.SET_SUB_CATS, payload: { subGrps } });\r\n        })()\r\n    }, [getSubGrps, catKey, id]);\r\n\r\n    const mySubGrps = state.cats.filter(c => c.parentId === id);\r\n\r\n    const setParentGrp = (cat: IGroupRow) => {\r\n        dispatch({ type: GrpActionTypes.SET_PARENT_CAT, payload: { cat } })\r\n        setParentId!(cat);\r\n    }\r\n\r\n    return (\r\n        <div className={level > 1 ? 'border  border-7 ms-4 h-25' : 'border border-7  h-25'} style={{ overflowY: 'auto' }}>\r\n            <ListGroup as=\"ul\" variant='dark' className=\"mb-0\">\r\n                {mySubGrps.filter(c => c.id !== selId).map((cat: IGroupRow) =>\r\n                    <GrpRow\r\n                        cat={cat}\r\n                        selId={selId}\r\n                        dispatch={dispatch}\r\n                        setParentGrp={setParentGrp}\r\n                        key={cat.id}\r\n                    />\r\n                )\r\n                }\r\n            </ListGroup>\r\n\r\n            {state.error && state.error.message}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default GrpList;\r\n","import { type ChangeEvent, type FormEvent, useState, useEffect, useRef } from \"react\";\r\nimport { useDebounce } from \"@uidotdev/usehooks\";\r\nimport * as Yup from \"yup\";\r\nimport { useFormik } from \"formik\";\r\nimport { Form, CloseButton, Row, Col, Stack } from \"react-bootstrap\";\r\nimport { CreatedModifiedForm } from \"@/common/CreateModifiedForm\"\r\nimport { FormButtons } from \"@/common/FormButtons\"\r\nimport type { IGroupRow, IAnswer, IAnswerFormProps } from \"@/groups/types\";\r\nimport { ActionTypes } from \"@/groups/types\";\r\nimport { FormMode } from \"@/groups/types\";\r\n\r\nimport { Select } from '@/common/components/Select';\r\nimport { sourceOptions, statusOptions } from '@/common/Options';\r\nimport GrpList from '@/global/Components/SelectGroup/GrpList'\r\n\r\nimport { useGroupContext, useGroupDispatch } from \"@/groups/GroupProvider\";\r\nimport Dropdown from 'react-bootstrap/Dropdown';\r\n\r\nconst AnswerForm = ({ answer, submitForm, children, showCloseButton, source = 0, closeModal }: IAnswerFormProps) => {\r\n\r\n  // const { globalState } = useGlobalContext();\r\n  // const { isDarkMode, variant, bg } = globalState;\r\n\r\n  const { state, onAnswerTitleChanged } = useGroupContext();\r\n  let { formMode } = state;\r\n\r\n  const viewing = formMode === FormMode.ViewingAnswer;\r\n  const editing = formMode === FormMode.EditingAnswer;\r\n  const adding = formMode === FormMode.AddingAnswer;\r\n\r\n  const isDisabled = viewing;\r\n\r\n  const { topId, id, title: qTitle } = answer;\r\n  //const answerKey = new AnswerKey(answer).answerKey;\r\n  // const groupKey: IGroupKey = { topId, parentId, id: parentId! }; // proveri\r\n\r\n  const dispatch = useGroupDispatch();\r\n\r\n  const closeForm = () => {\r\n    if (closeModal) {\r\n      closeModal();\r\n    }\r\n    else {\r\n      dispatch({ type: ActionTypes.CLOSE_ANSWER_FORM, payload: { answer } })\r\n    }\r\n  }\r\n\r\n  const cancelForm = () => {\r\n    if (closeModal) {\r\n      closeModal();\r\n    }\r\n    else {\r\n      dispatch({ type: ActionTypes.CANCEL_ANSWER_FORM, payload: { answer } })\r\n    }\r\n  }\r\n\r\n  const [searchTerm, setSearchTerm] = useState(qTitle);\r\n  const debouncedSearchTerm = useDebounce(searchTerm, 500);\r\n\r\n\r\n  // eslint-disable-next-line no-self-compare\r\n  const nameRef = useRef<HTMLTextAreaElement>(null);\r\n\r\n  const formik = useFormik({\r\n    enableReinitialize: true,\r\n    initialValues: answer,\r\n    validationSchema: Yup.object().shape({\r\n      title: Yup.string().required(\"Required\"),\r\n      parentId: Yup.string().required(\"Required\").notOneOf(['000000000000000000000000'])\r\n    }),\r\n    onSubmit: (values: IAnswer) => {\r\n      // console.log('AnswerForm.onSubmit', JSON.stringify(values, null, 2))\r\n      submitForm(values)\r\n      //props.handleClose(false);\r\n      setSearchTerm(values.title);\r\n    }\r\n  });\r\n\r\n  useEffect(() => {\r\n    const goBre = async () => {\r\n      // console.log('QuestionForm.useEffect - onQuestionTitleChanged', { debouncedSearchTerm, title: formik.values.title });\r\n      if (/*debouncedSearchTerm &&*/ formik.values.title !== debouncedSearchTerm) {\r\n        /*await*/ onAnswerTitleChanged(topId, id, formik.values.title);\r\n      }\r\n    };\r\n    goBre();\r\n  }, [debouncedSearchTerm, formik.values.title, onAnswerTitleChanged, topId, id]);\r\n\r\n  useEffect(() => {\r\n    nameRef.current!.focus();\r\n    if (source !== 0) {\r\n      formik.setFieldValue('source', source)\r\n    }\r\n  }, [formik, nameRef, source])\r\n\r\n\r\n  const handleChangeTitle = (event: ChangeEvent<HTMLTextAreaElement>) => {\r\n    formik.handleChange(event);\r\n    const value = event.target.value;\r\n    //if (value !== debouncedTitle)\r\n    //setTitle(value);\r\n    setSearchTerm(value);\r\n  };\r\n\r\n  const setParentId = (cat: IGroupRow) => {\r\n    formik.setFieldValue('parentId', cat.id);\r\n    formik.setFieldValue('groupTitle', cat.title);\r\n  }\r\n\r\n  //useEffect(() => {\r\n  //  setSearchTerm(qTitle);\r\n  //}, [qTitle]);\r\n\r\n  return (\r\n    <div className=\"form-wrapper px-3 py-1 my-0 my-1 w-100 answer-form\" >\r\n      {/* data-bs-theme={`${isDarkMode ? 'dark' : 'light'}`} */}\r\n      {showCloseButton && <CloseButton onClick={closeForm} className=\"float-end\" />}\r\n      <Row className='text-center'>\r\n        <Form.Label>Answer  {viewing ? 'Viewing' : editing ? 'Editing' : 'Adding'}</Form.Label>\r\n      </Row>\r\n      <Form onSubmit={formik.handleSubmit}>\r\n\r\n        <Stack direction=\"horizontal\" gap={0} className=\"border\">\r\n          <div className=\"p-0\"><Form.Label>Group:</Form.Label></div>\r\n          <div className=\"p-1\">\r\n            <Form.Group controlId=\"parentId\" className=\"group-select form-select-sm w-90\">\r\n              <Dropdown>\r\n                <Dropdown.Toggle variant=\"light\" id=\"dropdown-basic\" className=\"px-2 py-0 text-primary border\" disabled={isDisabled}>\r\n                  <span className=\"text-wrap me-1\">{formik.values.groupTitle}</span>\r\n                </Dropdown.Toggle>\r\n                <Dropdown.Menu className=\"p-0 border\" >\r\n                  <Dropdown.Item className=\"p-0 m-0 rounded-3\">\r\n                    <GrpList\r\n                      selId={formik.values.parentId}\r\n                      groupKey={null}  // TODO {groupKey}\r\n                      level={1}\r\n                      setParentId={setParentId}\r\n                    />\r\n                  </Dropdown.Item>\r\n                </Dropdown.Menu>\r\n              </Dropdown>\r\n\r\n              <Form.Control\r\n                as=\"input\"\r\n                name=\"parentId\"\r\n                onChange={formik.handleChange}\r\n                //onBlur={formik.handleBlur}\r\n                // onBlur={(e: React.FocusEvent<HTMLTextAreaElement>): void => {\r\n                //   if (isEdit && formik.initialValues.title !== formik.values.title)\r\n                //     formik.submitForm();\r\n                // }}\r\n                value={formik.values.parentId ? formik.values.parentId : ''}\r\n                placeholder='Group'\r\n                className=\"text-primary w-100\"\r\n                disabled={isDisabled}\r\n                hidden={true}\r\n              />\r\n              <Form.Text className=\"text-danger\">\r\n                {formik.touched.parentId && formik.errors.parentId ? (\r\n                  <div className=\"text-danger\">{formik.errors.parentId ? 'required' : ''}</div>\r\n                ) : null}\r\n              </Form.Text>\r\n            </Form.Group>\r\n          </div>\r\n        </Stack>\r\n\r\n        <Form.Group controlId=\"title\">\r\n          <Form.Label>Title</Form.Label>\r\n          <Form.Control\r\n            as=\"textarea\"\r\n            name=\"title\"\r\n            placeholder={formik.values.title === \"new Answer\" ? \"new Answer\" : \"answer text\"}\r\n            ref={nameRef}\r\n            onChange={handleChangeTitle}\r\n            // onBlur={formik.handleBlur}\r\n            // onBlur={(e: React.FocusEvent<HTMLTextAreaElement>): void => {\r\n            //   if (isEdit && formik.initialValues.title !== formik.values.title)\r\n            //     formik.submitForm();\r\n            // }}\r\n            value={formik.values.title}\r\n            rows={3}\r\n            className=\"text-primary w-100\"\r\n            disabled={isDisabled}\r\n          />\r\n          <Form.Text className=\"text-danger\">\r\n            {formik.touched.title && formik.errors.title ? (\r\n              <div className=\"text-danger\">{formik.errors.title}</div>\r\n            ) : null}\r\n          </Form.Text>\r\n        </Form.Group>\r\n\r\n        <Row>\r\n          <Col>\r\n            <Form.Group controlId=\"source\">\r\n              <Form.Label>Source</Form.Label>\r\n              <Select\r\n                id=\"source\"\r\n                name=\"source\"\r\n                options={sourceOptions}\r\n                onChange={(e: FormEvent<HTMLSelectElement>, value: any) => {\r\n                  e.preventDefault(); // ?\r\n                  formik.setFieldValue('source', value)\r\n                  // .then(() => { if (editing) formik.submitForm() })\r\n                }}\r\n                value={formik.values.source}\r\n                disabled={isDisabled}\r\n                classes=\"text-primary\"\r\n              />\r\n              <Form.Text className=\"text-danger\">\r\n                {formik.touched.source && formik.errors.source ? (\r\n                  <div className=\"text-danger\">{formik.errors.source}</div>\r\n                ) : null}\r\n              </Form.Text>\r\n            </Form.Group>\r\n          </Col>\r\n          <Col>\r\n            <Form.Group controlId=\"status\">\r\n              <Form.Label>Status</Form.Label>\r\n              <Select\r\n                id=\"status\"\r\n                name=\"status\"\r\n                options={statusOptions}\r\n                //onChange={formik.handleChange}\r\n                onChange={(e: FormEvent<HTMLSelectElement>, value: any) => {\r\n                  e.preventDefault(); // ?\r\n                  formik.setFieldValue('status', value)\r\n                  //.then(() => { if (editing) formik.submitForm() })\r\n                }}\r\n                value={formik.values.status}\r\n                disabled={isDisabled}\r\n                classes=\"text-primary\"\r\n              />\r\n              <Form.Text className=\"text-danger\">\r\n                {formik.touched.status && formik.errors.status ? (\r\n                  <div className=\"text-danger\">{formik.errors.status}</div>\r\n                ) : null}\r\n              </Form.Text>\r\n            </Form.Group>\r\n          </Col>\r\n        </Row>\r\n\r\n        {(viewing || editing) &&\r\n          <div className=\"my-1\">\r\n\r\n            <CreatedModifiedForm\r\n              created={answer.created}\r\n              modified={answer.modified}\r\n              classes=\"text-primary\"\r\n            />\r\n          </div>\r\n        }\r\n        {((formik.dirty && editing) || adding) &&\r\n          <FormButtons\r\n            cancelForm={cancelForm}\r\n            handleSubmit={formik.handleSubmit}\r\n            title={children}\r\n          />\r\n        }\r\n\r\n        {state.error && <div className=\"text-danger\">{state.error.message}</div>}\r\n\r\n      </Form>\r\n    </div >\r\n  );\r\n};\r\n\r\nexport default AnswerForm;","import { useGroupContext } from '@/groups/GroupProvider'\r\n\r\nimport AnswerForm from \"@/groups/components/answers/AnswerForm\";\r\nimport { type IAnswer } from \"@/groups/types\";\r\n\r\ninterface IProps {\r\n    closeModal?: () => void;\r\n    showCloseButton?: boolean;\r\n    source?: number;\r\n    setError?: (msg: string) => void;\r\n}\r\n\r\nconst AddAnswer = ({ closeModal, showCloseButton, source, setError }: IProps) => {\r\n\r\n    const { state, cancelAddAnswer, createAnswer } = useGroupContext();\r\n    const { activeAnswer } = state;\r\n    const topId = activeAnswer\r\n        ? activeAnswer.topId\r\n        : '';\r\n\r\n    if (!closeModal) {\r\n        // const cat = state.topGroupRows.find(c => c.id === answerRow.parentId)\r\n        // answerRow.groupTitle = cat ? cat.title : '';\r\n    }\r\n\r\n    const cancelAdd = async () => {\r\n        await cancelAddAnswer();\r\n    }\r\n\r\n\r\n    const submitForm = async (answerObject: IAnswer) => {\r\n        const newAnswer: IAnswer = {\r\n            ...answerObject,\r\n            topId: topId!,\r\n            created: {\r\n                time: new Date(),\r\n                nickName: ''\r\n            },\r\n            modified: undefined\r\n        }\r\n        const q = await createAnswer(newAnswer, closeModal !== undefined);\r\n        if (q) {\r\n            if (q.message) {\r\n                setError!(q.message)\r\n            }\r\n            else if (closeModal) {\r\n                closeModal();\r\n                //dispatch({ type: ActionTypes.CLEAN_TREE, payload: { id: q.parentId } })\r\n                //await openNode({ topId: '', id: q.parentId, answerId: q.id });\r\n            }\r\n        }\r\n    }\r\n\r\n    if (!activeAnswer)\r\n        return null;\r\n\r\n    // activeAnswer.title += odakle\r\n    return (\r\n        <AnswerForm\r\n            answer={activeAnswer!}\r\n            showCloseButton={showCloseButton ?? true}\r\n            source={source ?? 0}\r\n            closeModal={cancelAdd}\r\n            //formMode={FormMode.AddingAnswer}\r\n            submitForm={submitForm}\r\n        >\r\n            Create Answer\r\n        </AnswerForm >\r\n    )\r\n}\r\n\r\nexport default AddAnswer\r\n\r\n\r\n","import { useGroupContext } from '@/groups/GroupProvider'\r\n//import { useGlobalContext, useGlobalState } from '@/global/GlobalProvider'\r\n\r\nimport AnswerForm from \"@/groups/components/answers/AnswerForm\";\r\nimport { type IAnswer } from \"@/groups/types\";\r\n\r\nconst EditAnswer = ({ /*inLine*/ }: { inLine: boolean }) => {\r\n    const { state, updateAnswer } = useGroupContext();\r\n    const { activeAnswer } = state;  // loadingAnswer: answerLoading, \r\n    if (!activeAnswer)\r\n        return null;\r\n\r\n    //const { topId } = activeAnswer!;\r\n\r\n\r\n    if (!activeAnswer) {\r\n        return <div>Loading answer to edit...</div>\r\n    }\r\n\r\n    const submitForm = async (answerObject: IAnswer) => {\r\n        const newAnswer: IAnswer = {\r\n            ...answerObject,\r\n            created: undefined,\r\n            modified: {\r\n                time: new Date(),\r\n                nickName: ''\r\n            }\r\n        }\r\n\r\n        const { parentId } = activeAnswer;\r\n        const groupChanged = parentId !== newAnswer.parentId;\r\n        //const answerKey = new AnswerKey(activeAnswer).answerKey;\r\n        /*const answer =*/ await updateAnswer(parentId!, newAnswer, groupChanged);\r\n        /*\r\n        if (activeAnswer.parentId !== answer.parentId) {\r\n             await loadAndCacheAllGroupRows(); // reload, group could have been changed\r\n             await openNode({ topId: '', id: q.parentId, answerId: q.id });\r\n        }\r\n        */\r\n\r\n        // if (groupChanged) {\r\n        //     setTimeout(() => dispatch({ type: ActionTypes.CLOSE_ANSWER_FORM, payload: { answer: answer } }), 1000);\r\n        // }\r\n    };\r\n\r\n    return (\r\n        <AnswerForm\r\n            answer={activeAnswer!}\r\n            showCloseButton={true}\r\n            source={0}\r\n            submitForm={submitForm}\r\n        >\r\n            Update Answer\r\n        </AnswerForm>\r\n    );\r\n};\r\n\r\nexport default EditAnswer;\r\n","import { useEffect, useState } from 'react';\r\nimport { useGroupContext } from '@/groups/GroupProvider'\r\nimport type { IAnswer } from \"@/groups/types\";\r\nimport AnswerForm from \"@/groups/components/answers/AnswerForm\";\r\n\r\nconst ViewAnswer = ({ inLine }: { inLine: boolean }) => {\r\n    console.log(inLine ? \"ViewAnswer inLine\" : \"ViewAnswer not inLine\");\r\n    const { state } = useGroupContext();\r\n    const { activeAnswer } = state;\r\n    //const { topId, id, parentId } = activeAnswer!;\r\n\r\n    const [answer, setAnswer] = useState<IAnswer | null>(null);\r\n\r\n    useEffect(() => {\r\n        //const q = group!.answers.find(q => q.inEditing)\r\n        //if (group) {\r\n        //const q = group!.answers.find(q => q.id === id)\r\n        console.log(\"#################################### ViewAnswer setAnswer ...\", { activeAnswer })\r\n        //if (q) {\r\n        setAnswer(activeAnswer);\r\n        //}\r\n        //}\r\n    }, [activeAnswer]) // answerLoading\r\n    // if (answerLoading)\r\n    //     return <div>Loading answer...</div>\r\n    return (\r\n        <AnswerForm\r\n            answer={answer!}\r\n            showCloseButton={true}\r\n            source={0}\r\n            submitForm={() => { }}\r\n        >\r\n            View Answer\r\n        </AnswerForm>\r\n    );\r\n}\r\n\r\nexport default ViewAnswer;\r\n","import { useEffect } from 'react';\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\nimport { faRemove } from '@fortawesome/free-solid-svg-icons'\r\n\r\nimport { ListGroup, Button } from \"react-bootstrap\";\r\n\r\nimport { useGlobalState } from '@/global/GlobalProvider'\r\nimport { FormMode, type IGroupKey, type IAnswerRow } from \"@/groups/types\";\r\nimport { useGroupContext } from '@/groups/GroupProvider'\r\nimport { useHover } from \"@uidotdev/usehooks\";\r\n\r\nimport AddAnswer from \"@/groups/components/answers/AddAnswer\";\r\nimport EditAnswer from \"@/groups/components/answers/EditAnswer\";\r\nimport ViewAnswer from \"@/groups/components/answers/ViewAnswer\";\r\nimport Q from '@/assets/Q.png';\r\nimport QPlus from '@/assets/QPlus.png';\r\n\r\n\r\n//const AnswerRow = ({ answer, categoryInAdding }: { ref: React.ForwardedRef<HTMLLIElement>, answer: IAnswer, categoryInAdding: boolean | undefined }) => {\r\nconst AnswerRow = ({ answerRow, isSelected }: { answerRow: IAnswerRow, isSelected: boolean }) => {\r\n    const { id, topId, parentId, title } = answerRow; // , isSelected\r\n    //const answerKey: IAnswerKey = new AnswerKey(answerRow).answerKey!;\r\n    const categoryKey: IGroupKey = { topId, parentId, id: parentId! } // proveri\r\n\r\n    const { canEdit, authUser } = useGlobalState();\r\n    const { state, viewAnswer, addAnswer, editAnswer, deleteAnswer } = useGroupContext();\r\n\r\n    const { activeAnswer, formMode, loadingAnswer, answerLoaded } = state;\r\n    //const isSelected = useState(id === selectedAnswerId);\r\n\r\n    const showForm = activeAnswer !== null && activeAnswer.id === id;\r\n\r\n    //const [alreadyAdding] = useState(formMode === FormMode.AddingAnswer);\r\n    const alreadyAdding = formMode === FormMode.AddingAnswer;\r\n\r\n    const del = () => {\r\n        answerRow.modified = {\r\n            time: new Date(),\r\n            nickName: authUser.nickName\r\n        }\r\n        deleteAnswer(answerRow, showForm /* isActive */);\r\n    };\r\n\r\n    // const edit = async (Id: string) => {\r\n    //     // Load data from server and reinitialize answer\r\n    //     await editAnswer(answerRow);\r\n    // }\r\n\r\n    const onSelectAnswer = async (id: string) => {\r\n        console.log('AnswerRow onSelectAnswer', { id });\r\n        if (canEdit)\r\n            await editAnswer(answerRow);\r\n        else\r\n            await viewAnswer(answerRow);\r\n    }\r\n\r\n    const [hoverRef, hovering] = useHover();\r\n\r\n    useEffect(() => {\r\n        (async () => {\r\n            if (isSelected && !loadingAnswer && !answerLoaded) {\r\n                switch (formMode) {\r\n                    case FormMode.ViewingAnswer:\r\n                        await viewAnswer(answerRow);\r\n                        break;\r\n                    case FormMode.EditingAnswer:\r\n                        console.log('Zovem from AnswerRow')\r\n                        canEdit\r\n                            ? await editAnswer(answerRow)\r\n                            : await viewAnswer(answerRow);\r\n                        break;\r\n                }\r\n                // hoverRef!.current?\r\n                const el = document.getElementById(`AnswerRow${id}`);\r\n                el?.scrollIntoView({ behavior: 'smooth', block: 'end' });\r\n            }\r\n        })()\r\n        // after using new Answer() in getAnswer() editAnswer gets modified // viewAnswer, editAnswer\r\n    }, [canEdit, editAnswer, formMode, id, isSelected, loadingAnswer, answerLoaded, answerRow, viewAnswer]);\r\n\r\n    const Row1 =\r\n\r\n        <div id={`AnswerRow${id}`} className={`d-relative d-flex justify-content-start align-items-center w-100 mt-0 answer-row${isSelected ? '-selected' : ''}`} style={{ marginTop: '1px' }} >\r\n            <Button\r\n                variant='link'\r\n                size=\"sm\"\r\n                className=\"d-flex align-items-center px-1 text-secondary\"\r\n            >\r\n                <img width=\"22\" height=\"18\" src={Q} alt=\"Answer\" />\r\n            </Button>\r\n            <Button\r\n                variant='link'\r\n                size=\"sm\"\r\n                className={`p-0 px-1 m-1 ms-0 answer-row-title ${showForm ? 'fw-bold' : ''}`}\r\n                title={`id:${id!.toString()}`}\r\n                onClick={() => onSelectAnswer(id!)}\r\n                disabled={alreadyAdding}\r\n            >\r\n                {title}\r\n            </Button>\r\n            \r\n            {/* {canEdit && !alreadyAdding && hovering &&\r\n                <Button variant='link' size=\"sm\" className=\"ms-1 py-0 px-1 text-secondary\"\r\n                    //onClick={() => { dispatch({ type: ActionTypes.EDIT, answer }) }}>\r\n                    onClick={() => edit(_id!)}\r\n                >\r\n                    <FontAwesomeIcon icon={faEdit} size='lg' />\r\n                </Button>\r\n            } */}\r\n\r\n            {canEdit && !alreadyAdding && hovering &&\r\n                <div className=\"position-absolute text-nowrap d-flex align-items-center border border-0 border-warning p-0 end-0\">\r\n                    <Button\r\n                        variant='link'\r\n                        size=\"sm\"\r\n                        className=\"ms-1 p-0 text-secondary d-flex align-items-center\"\r\n                        title=\"Add Answer\"\r\n                        onClick={() => {\r\n                            //const categoryInfo: IGroupInfo = { categoryKey, level: 0 }\r\n                            addAnswer(categoryKey, true);\r\n                        }}\r\n                    >\r\n                        <img width=\"22\" height=\"18\" src={QPlus} alt=\"Add Answer\" />\r\n                    </Button>\r\n                    <Button variant='link' size=\"sm\" className=\"ms-0 p-0 text-secondary\"\r\n                        onClick={del}\r\n                    >\r\n                        <FontAwesomeIcon icon={faRemove} size='lg' />\r\n                    </Button>\r\n\r\n                </div>\r\n            }\r\n        </div>\r\n\r\n    // console.log('---@@@@@@@@@@@@@ AnswerRow', { id, isSelected, formMode, answerLoaded })\r\n    return (\r\n        // border border-3 border-danger\"\r\n        // <div className=\"py-0 px-0 w-100 list-group-item border\">\r\n        <ListGroup.Item\r\n            // variant={\"primary\"}\r\n            className=\"py-0 px-0 w-100\"\r\n            as=\"li\"\r\n        >\r\n            {isSelected && formMode === FormMode.AddingAnswer &&\r\n                <>\r\n                    <div id='div-answer' className=\"ms-0 d-md-none w-100\">\r\n                        <AddAnswer\r\n                            showCloseButton={true}\r\n                            source={0} />\r\n                    </div>\r\n                    <div ref={hoverRef} className=\"d-none d-md-block  border rounded-3\">\r\n                        {Row1}\r\n                    </div>\r\n                </>\r\n            }\r\n\r\n            {isSelected && formMode === FormMode.EditingAnswer &&\r\n                <>\r\n                    <div ref={hoverRef} className=\"\">\r\n                        {/* d-none d-md-block */}\r\n                        {Row1}\r\n                    </div>\r\n                    {/* <div class=\"d-lg-none\">hide on lg and wider screens</div> */}\r\n                    {/* <div id='div-answer' className=\"ms-0 d-md-none w-100\"> */}\r\n                    <div id='div-answer' className=\"ms-0 d-md-none w-100\">\r\n                        <EditAnswer inLine={true} />\r\n                    </div>\r\n                </>\r\n            }\r\n\r\n            {isSelected && formMode === FormMode.ViewingAnswer &&\r\n                <>\r\n                    <div ref={hoverRef} className=\"\">\r\n                        {/* d-none d-md-block */}\r\n                        {Row1}\r\n                    </div>\r\n                    {/* <div class=\"d-lg-none\">hide on lg and wider screens</div> */}\r\n                    <div ref={hoverRef} id='div-answer' className=\"ms-0 d-md-none w-100\">\r\n                        <ViewAnswer inLine={true} />\r\n                    </div>\r\n                </>\r\n            }\r\n\r\n            {!isSelected &&\r\n                // d-none d-md-block\r\n                <div ref={hoverRef} className=\"\">\r\n                    {Row1}\r\n                </div>\r\n            }\r\n\r\n        </ListGroup.Item>\r\n    );\r\n};\r\n\r\nexport default AnswerRow;\r\n","import { GroupKey, type IGroupRow, type ILoadGroupAnswers, type IAnswerRow } from \"@/groups/types\";\r\nimport { useGroupContext } from \"@/groups/GroupProvider\";\r\nimport useInfiniteScroll from \"react-infinite-scroll-hook\";\r\nimport { List, ListItem, Loading } from \"@/common/components/InfiniteList\";\r\nimport AnswerRow from \"@/groups/components/answers/AnswerRow\";\r\n\r\n//const AnswerList = ({ title, groupRow, level }: IParentInfo) => {\r\nconst AnswerList = ({ groupRow }: { groupRow: IGroupRow }) => {\r\n  const { state, loadGroupAnswers } = useGroupContext();\r\n  const { keyExpanded, loadingAnswer, error, selectedAnswerId } = state;\r\n  const { answerId } = keyExpanded!;\r\n  //? keyExpanded\r\n\r\n  groupRow.level += 1;\r\n  const { answerRows } = groupRow;\r\n  // console.log('@@@@@@@@@@@@@ AnswerList', { answerRows })\r\n\r\n  let hasMoreAnswers = false;\r\n\r\n  async function loadMore() {\r\n    try {\r\n      // const parentInfo: IParentInfo = {\r\n      //   groupRow,\r\n      //   startCursor: answerRows.length,\r\n      //   includeAnswerId: answerId ?? null\r\n      // }\r\n\r\n      const x: ILoadGroupAnswers = {\r\n        groupKey: new GroupKey(groupRow).groupKey!,\r\n        startCursor: answerRows!.length,\r\n        includeAnswerId: answerId ?? null\r\n      }\r\n      console.log('^^^^^^^^^^^^^ loadMore')\r\n      console.log('^^^^^^^^^^^^^', { x })\r\n      console.log('^^^^^^^^^^^^^ loadMore')\r\n      await loadGroupAnswers(x);\r\n    }\r\n    catch (error) {\r\n    }\r\n    finally {\r\n    }\r\n  }\r\n\r\n  // useEffect(() => {\r\n  //   //if (numOfAnswers > 0 && answerRows.length === 0) { // TODO\r\n  //   if (answerRows.length === 0) { // TODO\r\n  //     loadMore();\r\n  //   }\r\n  // }, [numOfAnswers, answerRows])\r\n\r\n\r\n  const [infiniteRef, { rootRef }] = useInfiniteScroll({\r\n    loading: loadingAnswer,\r\n    hasNextPage: hasMoreAnswers!,\r\n    onLoadMore: loadMore,\r\n    disabled: Boolean(error),\r\n    rootMargin: '0px 0px 100px 0px',\r\n  });\r\n\r\n  // console.log(\"QQQQQQQQQQQQQQQQQQQQQQQQQQQQQ AnswerList\", answerRows)\r\n  // if (loadingAnswer)\r\n  //   return <div> ... loading</div>\r\n\r\n  return (\r\n    <div\r\n      ref={rootRef}\r\n      className=\"ms-0\" // border border-1 border-info rounded-2\"\r\n      // className=\"max-h-[500px] max-w-[500px] overflow-auto bg-slate-100\"\r\n      style={{ maxHeight: '400px', overflowY: 'auto' }}\r\n    >\r\n      <List>\r\n        {answerRows!.length === 0 &&\r\n          <label>No answers</label>\r\n        }\r\n        {answerRows!.map((answerRow: IAnswerRow) => {\r\n          return <AnswerRow key={answerRow.id} answerRow={answerRow} isSelected={answerRow.id === selectedAnswerId} />\r\n        })}\r\n        {hasMoreAnswers && (\r\n          <ListItem ref={infiniteRef}>\r\n            <Loading />\r\n          </ListItem>\r\n        )}\r\n      </List>\r\n      {error && <p>Error: {error.message}</p>}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AnswerList;\r\n","import { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\nimport { faRemove, faThumbsUp, faPlus } from '@fortawesome/free-solid-svg-icons'\r\n\r\nimport { Button, Badge } from \"react-bootstrap\";\r\n\r\nimport { useGlobalState } from '@/global/GlobalProvider'\r\nimport { type IGroupKey, FormMode } from \"@/groups/types\";\r\nimport { useGroupContext } from '@/groups/GroupProvider'\r\nimport { type IVariation } from '@/groups/types'\r\nimport { useHover } from \"@uidotdev/usehooks\";\r\n\r\n// import AddTag from \"groups/components/tags/AddTag\";\r\n// import EditTag from \"groups/components/tags/EditTag\";\r\n// import ViewTag from \"groups/components/tags/ViewTag\";\r\n\r\n//const TagRow = ({ tag, groupInAdding }: { ref: React.ForwardedRef<HTMLLIElement>, tag: IVariation, groupInAdding: boolean | undefined }) => {\r\nconst VariationRow = ({ groupKey, tag, groupInAdding }: { groupKey: IGroupKey, tag: IVariation, groupInAdding: boolean | undefined }) => {\r\n    //const { topId, id } = groupKey;\r\n    const { name } = tag;\r\n    const { inViewing, inEditing, inAdding } = {\r\n        //parentId: '',\r\n        //level: 0,\r\n        inViewing: false,\r\n        inEditing: false,\r\n        inAdding: false,\r\n        //numOfTags: 4\r\n    };\r\n\r\n    const { canEdit } = useGlobalState();\r\n\r\n    // const { state, viewTag, editTag, deleteTag } = useGroupContext();\r\n    const { state, deleteGroupVariation } = useGroupContext();\r\n    //const dispatch = useGroupDispatch();\r\n\r\n    const alreadyAdding = false //state.mode === Mode.AddingTag;\r\n\r\n    const del = () => {\r\n        deleteGroupVariation(groupKey, name);\r\n    };\r\n\r\n    //const edit = (id: number) => {\r\n    // Load data from server and reinitialize tag\r\n    //editTag(id);\r\n    //}\r\n\r\n    //const onSelectTag = (id: number) => {\r\n    // Load data from server and reinitialize tag\r\n    //if (canEdit)\r\n    //editTag(id);\r\n    //else\r\n    //viewTag(id);\r\n    //}\r\n\r\n    const [hoverRef, hovering] = useHover();\r\n\r\n    const Row1 =\r\n        // <div ref={hoverRef} className=\"d-flex justify-content-start align-items-center text-secondary\">\r\n        <div ref={hoverRef} >\r\n\r\n            <Badge pill bg=\"secondary\">\r\n                {/* className={`text-info ${numOfTags === 0 ? 'd-none' : 'd-inline'}`} */}\r\n                {name}\r\n            </Badge>\r\n\r\n            {/* <Button\r\n                variant='link'\r\n                size=\"sm\"\r\n                className={`py-0 mx-0 text-decoration-none text-secondary ${(inViewing || inEditing) ? 'fw-bold' : ''}`}\r\n                title={`id:${id!.toString()}`}\r\n                onClick={() => onSelectTag(id!)}\r\n                disabled={alreadyAdding}\r\n            >\r\n                {name}\r\n            </Button> */}\r\n\r\n            {/* {canEdit && !alreadyAdding && hovering &&\r\n                <Button variant='link' size=\"sm\" className=\"ms-1 py-0 px-1 text-secondary\"\r\n                    //onClick={() => { dispatch({ type: ActionTypes.EDIT, tag }) }}>\r\n                    onClick={() => edit(_id!)}\r\n                >\r\n                    <FontAwesomeIcon icon={faEdit} size='lg' />\r\n                </Button>\r\n            } */}\r\n\r\n            {canEdit && !alreadyAdding && hovering &&\r\n                <Button variant='link' size=\"sm\" className=\"ms-0 py-0 mx-0 text-secondary\"\r\n                    onClick={del}\r\n                >\r\n                    <FontAwesomeIcon icon={faRemove} size='sm' />\r\n                </Button>\r\n            }\r\n\r\n            {false && canEdit && !alreadyAdding && hovering &&\r\n                <Button\r\n                    variant='link'\r\n                    size=\"sm\"\r\n                    className=\"ms-2 py-0 mx-1 text-secondary\"\r\n                    title=\"Add Tag\"\r\n                    onClick={() => {\r\n                        console.log('click q')\r\n                        //const groupInfo: IGroupInfo = { groupKey: { topId, parentId, id }, level }\r\n                        //dispatch({ type: ActionTypes.ADD_ANSWER, payload: { groupInfo } })\r\n                    }}\r\n                >\r\n                    <FontAwesomeIcon icon={faPlus} size='lg' />\r\n                    <FontAwesomeIcon icon={faThumbsUp} size='lg' style={{ marginLeft: '-5px' }} />\r\n                </Button>\r\n            }\r\n        </div>\r\n\r\n    return (\r\n\r\n        <div className=\"py-1 px-1\">\r\n            {inAdding && groupInAdding && state.formMode === FormMode.AddingVariation\r\n                ? (\r\n                    // <AddTag tag={tag} inLine={true} showCloseButton={true} />\r\n                    <span>add tag</span>\r\n                )\r\n                : ((inEditing && state.formMode === FormMode.EditingVariation) ||\r\n                    (inViewing && state.formMode === FormMode.ViewingVariation)) ? (\r\n                    <>\r\n                        {/* <div class=\"d-lg-none\">hide on lg and wider screens</div> */}\r\n                        <div id='div-tag' className=\"ms-0 d-md-none w-100\">\r\n                            {/* {inEditing && <EditTag inLine={true} />}\r\n                            {inViewing && <ViewTag inLine={true} />} */}\r\n                        </div>\r\n                        <div className=\"d-none d-md-block\">\r\n                            {Row1}\r\n                        </div>\r\n                    </>\r\n                )\r\n                    : (\r\n                        Row1\r\n                    )\r\n            }\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default VariationRow;\r\n","import { useEffect } from \"react\";\r\nimport type { IGroupKey, IVariation } from \"@/groups/types\";\r\nimport { useGroupContext } from \"@/groups/GroupProvider\";\r\n// import { useGlobalState } from \"@/global/GlobalProvider\";\r\n//import { List, ListItem, Loading } from \"common/components/InfiniteList\";\r\nimport VariationRow from \"@/groups/VariationRow\";\r\nimport { Stack } from \"react-bootstrap\";\r\n\r\nconst VariationList = ({ groupKey, variations }: { groupKey: IGroupKey, variations: IVariation[] }) => {\r\n\r\n  //const { canEdit } = useGlobalState();\r\n\r\n  const { state } = useGroupContext();\r\n  const { error } = state; // topRows: groups,\r\n\r\n\r\n  //const group = groups.find(c => c.id === parentId)!\r\n  // const { tags, numOfTags, hasMore } = group;\r\n\r\n  useEffect(() => {\r\n  }, [])\r\n\r\n\r\n  // useEffect(() => {\r\n  //   if (groupId != null) {\r\n  //     if (groupId === parentId!.toString() && tagId) {\r\n  //       setTimeout(() => {\r\n  //         if (canEdit)\r\n  //           editTag(parseInt(tagId))\r\n  //         else\r\n  //           viewTag(parseInt(tagId))\r\n  //       }, 3000)\r\n  //     }\r\n  //   }\r\n  // }, [viewTag, parentId, groupId, tagId, canEdit]);\r\n\r\n  // console.log('TagList render', tags, level)\r\n\r\n  return (\r\n    <div\r\n      className=\"ms-2\"\r\n    // className=\"max-h-[500px] max-w-[500px] overflow-auto bg-slate-100\"\r\n    // style={{ overflowX: 'auto' }}\r\n    >\r\n      <Stack direction=\"horizontal\" gap={2}>\r\n        {variations.length === 0 &&\r\n          <div>No</div>\r\n        }\r\n        {variations.length > 0 &&\r\n          variations.map((tag: IVariation) => {\r\n            return <VariationRow\r\n              groupKey={groupKey}\r\n              tag={tag}\r\n              groupInAdding={undefined}\r\n            />\r\n          })}\r\n      </Stack>\r\n      {error && <p>Error: {error.message}</p>}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default VariationList;\r\n","import { useEffect, useRef, type ChangeEvent, type FormEvent, useState } from \"react\";\r\nimport * as Yup from \"yup\";\r\nimport { useFormik } from \"formik\";\r\nimport { Form, CloseButton, Row, Stack } from \"react-bootstrap\";\r\nimport { CreatedModifiedForm } from \"@/common/CreateModifiedForm\"\r\nimport { FormButtons } from \"@/common/FormButtons\"\r\nimport type { IGroupFormProps, IGroup, IVariation, IGroupKey } from \"@/groups/types\";\r\nimport { FormMode, ActionTypes, GroupKey } from \"@/groups/types\";\r\n\r\nimport { useGroupContext, useGroupDispatch } from \"@/groups/GroupProvider\";\r\nimport AnswerList from \"@/groups/components/answers/AnswerList\";\r\nimport VariationList from \"@/groups/VariationList\";\r\nimport { Select } from \"@/common/components/Select\";\r\nimport { kindOptions } from \"@/common/Options\";\r\nimport { useDebounce } from \"@uidotdev/usehooks\";\r\n\r\nconst GroupForm = ({ formMode, group, submitForm, children }: IGroupFormProps) => {\r\n\r\n  //const { globalState } = useGlobalContext();\r\n  //const { isDarkMode, variant, bg } = globalState;\r\n\r\n  const { onGroupTitleChanged } = useGroupContext();\r\n\r\n  const viewing = formMode === FormMode.ViewingGroup;\r\n  const editing = formMode === FormMode.EditingGroup;\r\n  const adding = formMode === FormMode.AddingGroup;\r\n\r\n  const { topId, id, variations, answerRows, title: catTitle } = group;\r\n  console.log('GroupForm render: ', { topId, id, catTitle, formMode })\r\n  const groupKey: IGroupKey = new GroupKey(group).groupKey!;\r\n  //const groupKeyExpanded: IAnswerKey = { topId, id, answerId };\r\n\r\n  if (!document.getElementById('div-details')) {\r\n\r\n  }\r\n  const showAnswers = answerRows && answerRows.length > 0 //!answers.find(q => q.inAdding);\r\n  /* \r\n  We have, at two places:\r\n    <EditGroup inLine={true} />\r\n    <EditGroup inLine={false} />\r\n    so we execute loadGroupAnswers() twice in AnswerList, but OK\r\n  */\r\n\r\n  const dispatch = useGroupDispatch();\r\n\r\n  const closeForm = () => {\r\n    dispatch({ type: ActionTypes.CLOSE_GROUP_FORM, payload: {} })\r\n  }\r\n\r\n  const cancelForm = () => {\r\n    dispatch({ type: ActionTypes.CANCEL_GROUP_FORM, payload: {} })\r\n  }\r\n\r\n  const [searchTerm, setSearchTerm] = useState(catTitle);\r\n  const debouncedSearchTerm = useDebounce(searchTerm, 300);\r\n\r\n  const formik = useFormik({\r\n    enableReinitialize: true,\r\n    initialValues: group,\r\n    validationSchema: Yup.object().shape({\r\n      title: Yup.string().required(\"Required\"),\r\n      // email: Yup.string()\r\n      //   .email(\"You have enter an invalid email address\")\r\n      //   .required(\"Required\"),\r\n      // rollno: Yup.number()\r\n      //   .positive(\"Invalid roll number\")\r\n      //   .integer(\"Invalid roll number\")\r\n      //   .required(\"Required\"),\r\n    }),\r\n    onSubmit: (values: IGroup) => {\r\n      //alert(JSON.stringify(values, null, 2));\r\n      console.log('GroupForm.onSubmit', JSON.stringify(values, null, 2))\r\n      submitForm(values);\r\n      //props.handleClose(false);\r\n      setSearchTerm(values.title);\r\n    }\r\n  });\r\n\r\n   useEffect(() => {\r\n    const goBre = async () => {\r\n      console.log('GroupForm.useEffect - onGroupTitleChanged', { debouncedSearchTerm, title: formik.values.title });\r\n      if (/*debouncedSearchTerm &&*/ formik.values.title !== debouncedSearchTerm) {\r\n        /*await*/ onGroupTitleChanged(topId, id, formik.values.title);\r\n      }\r\n    };\r\n    goBre();\r\n  }, [debouncedSearchTerm, formik.values.title, onGroupTitleChanged]);\r\n\r\n  const handleChangeTitle = (event: ChangeEvent<HTMLTextAreaElement>) => {\r\n    formik.handleChange(event);\r\n    const value = event.target.value;\r\n    //if (value !== debouncedTitle)\r\n    //setTitle(value);\r\n    setSearchTerm(value);\r\n  };\r\n\r\n  // eslint-disable-next-line no-self-compare\r\n  // const nameRef = useRef<HTMLAreaElement | null>(null);\r\n  const nameRef = useRef<HTMLTextAreaElement>(null);\r\n\r\n\r\n  //useEffect(() => {\r\n    //setTitle(group.title);\r\n    //nameRef.current?.focus()\r\n    //nameRef.current?.select()\r\n  //}, [nameRef])\r\n\r\n  const isDisabled = false;\r\n\r\n  console.log('GroupForm render return: ', searchTerm);\r\n\r\n  return (\r\n    // data-bs-theme={`${isDarkMode ? 'dark' : 'light'}`}\r\n    <div className=\"form-wrapper p-2 group-form\" >\r\n      <CloseButton onClick={closeForm} className=\"float-end\" />\r\n      <Row className='text-center text-muted'>\r\n        <Form.Label>Group {viewing ? 'Viewing' : editing ? 'Editing' : 'Adding'}</Form.Label>\r\n      </Row>\r\n      <Form onSubmit={() => formik.handleSubmit}>\r\n\r\n        <Form.Group controlId=\"Variations\">\r\n          <Stack direction=\"horizontal\" gap={1}>\r\n            <div className=\"px-0\"><Form.Label>Variations:</Form.Label></div>\r\n            <div className=\"px-1 border border-1 border-secondary rounded\">\r\n              <VariationList\r\n                groupKey={groupKey}\r\n                variations={variations\r\n                  ? variations.map(variation => ({ name: variation } as IVariation))\r\n                  : []\r\n                }\r\n              />\r\n            </div>\r\n            <div className=\"ps-2\"><Form.Label>Kind:</Form.Label></div>\r\n            <div className=\"px-1 border border-1 border-secondary rounded\">\r\n              <Form.Group controlId=\"kind\">\r\n                {/* <Form.Label>Kind</Form.Label> */}\r\n                <Select\r\n                  id=\"kind\"\r\n                  name=\"kind\"\r\n                  options={kindOptions}\r\n                  onChange={(e: FormEvent<HTMLSelectElement>, value: any) => {\r\n                    e.preventDefault(); // ?\r\n                    formik.setFieldValue('kind', value)\r\n                    // .then(() => { if (editing) formik.submitForm() })\r\n                  }}\r\n                  value={formik.values.kind}\r\n                  disabled={isDisabled}\r\n                  classes=\"text-primary\"\r\n                />\r\n                <Form.Text className=\"text-danger\">\r\n                  {formik.touched.kind && formik.errors.kind ? (\r\n                    <div className=\"text-danger\">{formik.errors.kind}</div>\r\n                  ) : null}\r\n                </Form.Text>\r\n              </Form.Group>\r\n            </div>\r\n          </Stack>\r\n        </Form.Group>\r\n\r\n        <Form.Group controlId=\"title\">\r\n          <Form.Label>Title</Form.Label>\r\n          <Form.Control\r\n            as=\"textarea\"\r\n            name=\"title\"\r\n            placeholder={\"new Group\"}\r\n            value={searchTerm}\r\n            onChange={handleChangeTitle}\r\n            onFocus={(e) => { if (formMode === FormMode.AddingGroup) e.target.select()}}\r\n            ref={nameRef}\r\n            //onChange={handleChangeTitle}\r\n            // onChange={(e: any, value: any): {e: ChangeEvent<HTMLTextAreaElement>, value: string} => {\r\n            //         formik.handleChange(e, value);\r\n            //         console.log(value)\r\n            //       }}\r\n            //onBlur={formik.handleBlur}\r\n            // onBlur={(e: React.FocusEvent<HTMLTextAreaElement>): void => {\r\n            //   if (isEdit && formik.initialValues.title !== formik.values.title)\r\n            //     formik.submitForm();\r\n            // }}\r\n            rows={3}\r\n            className=\"text-primary w-100\"\r\n            disabled={viewing}\r\n          />\r\n          <Form.Text className=\"text-danger\">\r\n            {formik.touched.title && formik.errors.title ? (\r\n              <div className=\"text-danger\">{formik.errors.title}</div>\r\n            ) : null}\r\n          </Form.Text>\r\n        </Form.Group>\r\n\r\n\r\n        <Form.Group controlId=\"link\">\r\n          <Form.Label>Link</Form.Label>\r\n          {formik.values.hasSubGroups\r\n            ? <Form.Control\r\n              as=\"input\"\r\n              placeholder=\"/groups/...\"\r\n              name=\"link\"\r\n              onChange={formik.handleChange}\r\n              //onBlur={formik.handleBlur}\r\n              // onBlur={(e: React.FocusEvent<HTMLTextAreaElement>): void => {\r\n              //   if (isEdit && formik.initialValues.title !== formik.values.title)\r\n              //     formik.submitForm();\r\n              // }}\r\n              className=\"text-primary w-100\"\r\n              value={\"Can't have link (has sub groups)\"}\r\n              disabled={true}\r\n            />\r\n            : <>\r\n              <Form.Control\r\n                as=\"input\"\r\n                placeholder=\"/groups/...\"\r\n                name=\"link\"\r\n                onChange={formik.handleChange}\r\n                //onBlur={formik.handleBlur}\r\n                // onBlur={(e: React.FocusEvent<HTMLTextAreaElement>): void => {\r\n                //   if (isEdit && formik.initialValues.title !== formik.values.title)\r\n                //     formik.submitForm();\r\n                // }}\r\n                className=\"text-primary w-100\"\r\n                value={formik.values.link ?? ''}\r\n                disabled={viewing}\r\n              />\r\n              <Form.Text className=\"text-danger\">\r\n                {formik.touched.link && formik.errors.link ? (\r\n                  <div className=\"text-danger\">{formik.errors.link}</div>\r\n                ) : null}\r\n              </Form.Text>\r\n            </>\r\n          }\r\n        </Form.Group>\r\n\r\n        {/* <Form.Group>\r\n          <Form.Label>Number of Answers </Form.Label>\r\n          <div className=\"text-secondary\">{formik.values.numOfAnswers}</div>\r\n          // <div className=\"p-1 bg-dark text-white\">{createdBy}, {formatDate(created.date)}</div> \r\n        </Form.Group> */}\r\n\r\n        <Form.Group>\r\n          <Form.Label className=\"m-1 mb-0\">Answers ({`${formik.values.numOfAnswers}`}) </Form.Label>\r\n          {showAnswers &&\r\n            <AnswerList groupRow={group} />  // IGroup extends IGroupRow\r\n          }\r\n        </Form.Group>\r\n\r\n        {(viewing || editing) &&\r\n          <CreatedModifiedForm\r\n            created={group.created}\r\n            modified={group.modified}\r\n            classes=\"text-primary\"\r\n          />\r\n        }\r\n\r\n        {((formik.dirty && editing) || adding) &&\r\n          <FormButtons\r\n            cancelForm={cancelForm}\r\n            handleSubmit={formik.handleSubmit}\r\n            title={children}\r\n          />\r\n        }\r\n      </Form>\r\n    </div >\r\n  );\r\n};\r\n\r\nexport default GroupForm;","import { useGroupContext } from '@/groups/GroupProvider'\r\nimport { useGlobalState } from '@/global/GlobalProvider'\r\n\r\nimport GroupForm from \"@/groups/components/GroupForm\";\r\nimport { FormMode, type IGroup } from \"@/groups/types\";\r\n\r\nconst EditGroup = ({ inLine }: { inLine: boolean }) => {\r\n    const globalState = useGlobalState();\r\n    const { nickName } = globalState.authUser;\r\n\r\n    const { state, updateGroup, cancelAddGroup } = useGroupContext();\r\n\r\n    const { activeGroup, keyExpanded } = state;\r\n    const { answerId } = keyExpanded!;\r\n\r\n    const cancel = async () => {\r\n        await cancelAddGroup();\r\n    }\r\n\r\n    const close = async () => {\r\n        await cancelAddGroup();\r\n    }\r\n\r\n    const submitForm = async (groupObject: IGroup) => {\r\n        const object: IGroup = {\r\n            ...groupObject,\r\n            created: undefined,\r\n            modified: {\r\n                time: new Date(),\r\n                nickName: nickName\r\n            }\r\n        }\r\n        await updateGroup(object, true /* closeForm */)\r\n    };\r\n\r\n    return (\r\n        <GroupForm\r\n            inLine={inLine}\r\n            group={{ ...activeGroup! }}\r\n            answerId={answerId}\r\n            formMode={FormMode.EditingGroup}\r\n            cancel={cancel}\r\n            close={close}\r\n            submitForm={submitForm}\r\n        >\r\n            Update Group\r\n        </GroupForm>\r\n    );\r\n};\r\n\r\nexport default EditGroup;\r\n","\r\nimport { useGroupContext } from '@/groups/GroupProvider'\r\n\r\nimport { FormMode } from \"@/groups/types\";\r\nimport GroupForm from \"@/groups/components/GroupForm\";\r\n\r\nconst ViewGroup = ({ inLine }: { inLine: boolean }) => {\r\n    const { state, cancelAddGroup } = useGroupContext();\r\n    const { activeGroup, keyExpanded } = state;\r\n    const { answerId } = keyExpanded!;\r\n    const close = async () => {\r\n        await cancelAddGroup();\r\n    }\r\n    return (\r\n        <GroupForm\r\n            inLine={inLine}\r\n            group={{ ...activeGroup! }}\r\n            answerId={answerId}\r\n            formMode={FormMode.ViewingGroup}\r\n            close={close}\r\n            cancel={close}\r\n            submitForm={() => { }}\r\n        >\r\n            View Group\r\n        </GroupForm>\r\n    );\r\n}\r\n\r\nexport default ViewGroup;\r\n","import { useState } from \"react\";\r\nimport { useGroupContext } from '@/groups/GroupProvider'\r\nimport { useGlobalState } from '@/global/GlobalProvider'\r\n\r\nimport GroupForm from \"@/groups/components/GroupForm\";\r\nimport { FormMode, type IGroup } from \"@/groups/types\";\r\n\r\nconst AddGroup = ({ activeGroup }: { activeGroup: IGroup | null }) => {\r\n    const globalState = useGlobalState();\r\n    const { nickName } = globalState.authUser;\r\n    const { cancelAddGroup, createGroup } = useGroupContext();\r\n    //const { activeGroup } = state;\r\n\r\n    const [formValues] = useState<IGroup>({ ...activeGroup! });\r\n\r\n     const cancel = async () => {\r\n        await cancelAddGroup();\r\n    }\r\n\r\n    const close = async () => {\r\n        await cancelAddGroup();\r\n    }\r\n    const submitForm = async (group: IGroup) => {\r\n        const cat: IGroup = {\r\n            ...group,\r\n            created: {\r\n                time: new Date(),\r\n                nickName: nickName\r\n            },\r\n            modified: undefined\r\n        }\r\n        console.log(\"**********object\", cat)\r\n        await createGroup(cat);\r\n    }\r\n    if (!activeGroup === null)\r\n        return null;\r\n\r\n    console.log('AddGroup render >>>>>:', activeGroup);\r\n    return (\r\n        <>\r\n            {/* {inLine ?\r\n                <InLineGroupForm\r\n                    inLine={true}\r\n                    group={formValues}\r\n                    mode={FormMode.adding}\r\n                    submitForm={submitForm}\r\n                >\r\n                    Create\r\n                </InLineGroupForm>\r\n                : */}\r\n            <GroupForm\r\n                inLine={false}\r\n                group={formValues}\r\n                answerId={null}\r\n                formMode={FormMode.AddingGroup}\r\n                cancel={cancel}\r\n                close={close}\r\n                submitForm={submitForm}\r\n            >\r\n                Create Group\r\n            </GroupForm >\r\n            {/* } */}\r\n        </>\r\n    )\r\n}\r\n\r\nexport default AddGroup\r\n","import { useEffect, useState } from 'react';\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\nimport { faRemove, faCaretRight, faCaretDown, faPlus, faFolder } from '@fortawesome/free-solid-svg-icons'\r\nimport QPlus from '@/assets/QPlus.png';\r\n\r\nimport { ListGroup, Button, Badge, Collapse } from \"react-bootstrap\";\r\n\r\nimport { useGlobalState } from '@/global/GlobalProvider'\r\nimport { type IGroupKey, type IGroupRow, FormMode, type IExpandInfo, GroupKey } from \"@/groups/types\";\r\nimport { useGroupContext, } from '@/groups/GroupProvider'\r\n\r\nimport { useHover } from \"@uidotdev/usehooks\";\r\n\r\nimport GroupList from \"@/groups/components/GroupList\";\r\nimport EditGroup from \"@/groups/components/EditGroup\";\r\nimport ViewGroup from \"@/groups/components/ViewGroup\";\r\nimport AnswerList from './answers/AnswerList';\r\nimport AddGroup from './AddGroup';\r\n\r\nconst GroupRow = ({ groupRow, answerId }: { groupRow: IGroupRow, answerId: string | null }) => {\r\n\r\n    const { id, title, hasSubGroups, numOfAnswers, isExpanded, groupRows } = groupRow;\r\n    groupRow.level += 1;\r\n\r\n    const groupKey: IGroupKey = new GroupKey(groupRow).groupKey!;\r\n\r\n    // const [groupKey] = useState<IGroupKey>({ topId, id }); // otherwise reloads\r\n    // const [catKeyExpanded] = useState<IAnswerKey>({ topId, id, answerId }); // otherwise reloads\r\n\r\n    const { canEdit, authUser } = useGlobalState();\r\n\r\n    const { state, addGroup, viewGroup, editGroup, deleteGroup, expandGroup, collapseGroup, addAnswer } = useGroupContext();\r\n    //const dispatch = useGroupDispatch();\r\n\r\n    let { formMode, activeGroup, loadingGroup, groupLoaded } = state;\r\n    const isSelected = activeGroup !== null && (activeGroup.id === id);\r\n\r\n    const inAdding = formMode === FormMode.AddingGroup;\r\n    // TODO proveri ovo\r\n    const showAnswers = isExpanded && numOfAnswers > 0 // || answers.find(q => q.inAdding) // && !answers.find(q => q.inAdding); // We don't have answers loaded\r\n\r\n    const deleteGroupRow = () => {\r\n        groupRow.modified = {\r\n            time: new Date(),\r\n            nickName: authUser.nickName\r\n        }\r\n        deleteGroup(groupRow);\r\n    };\r\n\r\n    const handleExpandClick = async () => {\r\n        if (isExpanded) {\r\n            await collapseGroup(groupRow);\r\n        }\r\n        else {\r\n            const expandInfo: IExpandInfo = {\r\n                groupKey\r\n            }\r\n            await expandGroup(expandInfo);\r\n        }\r\n    }\r\n\r\n    // const edit = async () => {\r\n    //     // Load data from server and reinitialize group\r\n    //     await editGroup(groupRow, answerId ?? 'null');\r\n    // }\r\n\r\n    const [open, setOpen] = useState<boolean>(false);\r\n    useEffect(() => {\r\n        //if (groupRows.length > 0) \r\n            setOpen(true);\r\n    }, [groupRows]);\r\n\r\n    const onSelectGroup = async (): Promise<any> => {\r\n        if (canEdit)\r\n            await editGroup(groupRow, answerId ?? 'null');\r\n        else\r\n            await viewGroup(groupRow, answerId ?? 'null');\r\n    }\r\n\r\n    const [queue, setQueue] = useState<boolean>(false);\r\n\r\n    useEffect(() => {\r\n        if (queue) {// && groupRow.id === _generateId) {\r\n            addGroup(groupRow);\r\n            setQueue(false);\r\n        }\r\n    }, [addGroup, groupRow, queue]);\r\n\r\n\r\n    const [queue2, setQueue2] = useState<boolean>(false);\r\n    useEffect(() => {\r\n        if (queue2) {// && groupRow.id === _generateId) {\r\n            // actegoryRow is after reducer update\r\n            addAnswer(groupKey, isExpanded ?? false);\r\n            setQueue2(false);\r\n        }\r\n    }, [addAnswer, groupKey, isExpanded, queue2]);\r\n\r\n\r\n    useEffect(() => {\r\n        (async () => {\r\n            if (isSelected && !loadingGroup && !groupLoaded && !inAdding) {\r\n                console.log('GroupRow formMode:', formMode)\r\n                switch (formMode) {\r\n                    case FormMode.ViewingGroup:\r\n                        await viewGroup(groupRow, answerId ?? 'null');\r\n                        break;\r\n                    case FormMode.EditingGroup:\r\n                        canEdit\r\n                            ? await editGroup(groupRow, answerId ?? 'null')\r\n                            : await viewGroup(groupRow, answerId ?? 'null');\r\n                        break;\r\n                }\r\n            }\r\n        })()\r\n    }, [canEdit, groupKey, groupLoaded, groupRow, editGroup, expandGroup, formMode, inAdding, isSelected, loadingGroup, answerId, viewGroup]);\r\n\r\n    const [hoverRef, hovering] = useHover();\r\n    //console.log(\"..........................: \", document.querySelectorAll(`#Row${id}`)!.length);\r\n\r\n    const Row1 =\r\n        <div>\r\n            <div id={`Row${id}`} \r\n                className={`d-relative d-flex justify-content-start align-items-center w-100 mt-1 group-row${isSelected ? '-selected' : ''}`} \r\n                style={{ marginTop: '1px' }} >\r\n                <Button\r\n                    variant='link'\r\n                    size=\"sm\"\r\n                    className=\"py-0 px-1\" //  bg-light\"\r\n                    aria-controls={id+'-2'}\r\n                    aria-expanded={open}\r\n                    onClick={(e) => { handleExpandClick(); e.stopPropagation() }}\r\n                    title=\"Expand\"\r\n                    disabled={inAdding || (!hasSubGroups && numOfAnswers === 0)}\r\n                >\r\n                    <FontAwesomeIcon icon={isExpanded ? faCaretDown : faCaretRight} size='lg' />\r\n                </Button>\r\n                <Button\r\n                    variant='link'\r\n                    size=\"sm\"\r\n                    className=\"py-0 px-1 bg-light\"\r\n                    // onClick={expand}\r\n                    title=\"Expand\"\r\n                    disabled={true} //{alreadyAdding || (!hasSubGroups && numOfAnswers === 0)}\r\n                >\r\n                    <FontAwesomeIcon icon={faFolder} size='sm' />\r\n                </Button>\r\n                <Button\r\n                    variant='link'\r\n                    size=\"sm\"\r\n                    className={`py-0 ms-0 me-1 group-row-title ${isSelected ? 'fw-bold text-white bg-transparent' : ''}`}\r\n                    title={id}\r\n                    onClick={onSelectGroup}\r\n                    disabled={inAdding}\r\n                >\r\n                    {title}\r\n                    {/* &nbsp;<span>{formMode.substring(0, 3)}</span>&nbsp;<span>{hovering?'hov':'jok'}</span> */}\r\n                </Button>\r\n\r\n                {numOfAnswers > 0 &&\r\n                    <Badge pill bg=\"secondary\" className={'d-inline bg-transparent'}>\r\n                        {numOfAnswers}Q\r\n                        {/* <FontAwesomeIcon icon={faAnswer} size='sm' /> */}\r\n                        {/* <img width=\"22\" height=\"18\" src={Q} alt=\"Answer\" /> */}\r\n                    </Badge>\r\n                }\r\n\r\n                {canEdit && hovering && numOfAnswers === 0 &&\r\n                    <div className=\"position-absolute text-nowrap d-flex align-items-center border border-0 border-warning p-0 end-0\">\r\n                        <div className=\"d-flex align-items-center\">\r\n                            <Button\r\n                                variant='link'\r\n                                size=\"sm\"\r\n                                className=\"border-0 py-0 px-0 ms-0 text-success\"\r\n                                title=\"Add SubGroup\"\r\n                                onClick={async () => {\r\n                                    //dispatch({ type: ActionTypes.CLOSE_CATEGORY_FORM, payload: {} })\r\n                                    if (!isExpanded && (hasSubGroups || numOfAnswers > 0)) {\r\n                                        await handleExpandClick();\r\n                                    }\r\n                                    setTimeout(() => setQueue(true), 1000);\r\n                                }}\r\n                            >\r\n                                <FontAwesomeIcon icon={faPlus} size='lg' />\r\n                            </Button>\r\n                        </div>\r\n\r\n                        {!inAdding && !hasSubGroups &&\r\n                            // top-0 end-0\r\n                            <div className=\"d-flex align-items-center\">\r\n                                <Button\r\n                                    variant='link'\r\n                                    size=\"sm\"\r\n                                    className=\"p-0 mx-0 text-secondary d-flex align-items-center border border-0 border-warning\"\r\n                                    title=\"Add Answer\"\r\n                                    onClick={async () => {\r\n                                        //const groupInfo: IGroupInfo = { groupKey: { workspace: topId, id: groupRow.id }, level: groupRow.level }\r\n                                        if (!isExpanded && (hasSubGroups || numOfAnswers > 0)) {\r\n                                            await handleExpandClick();\r\n                                        }\r\n                                        setTimeout(() => setQueue2(true), 500);\r\n                                    }}\r\n                                >\r\n                                    <img width=\"22\" height=\"18\" src={QPlus} alt=\"Add Answer\" />\r\n                                </Button>\r\n                                <Button variant='link' size=\"sm\"\r\n                                    className=\"d-flex align-items-center border border-0 border-warning p-0\"\r\n                                    disabled={hasSubGroups || numOfAnswers > 0}\r\n                                    onClick={deleteGroupRow}\r\n                                >\r\n                                    <FontAwesomeIcon icon={faRemove} size='lg' />\r\n                                </Button>\r\n                            </div>\r\n                        }\r\n\r\n                    </div>\r\n                }\r\n\r\n                {/* TODO what about archive answers  numOfAnswers === 0 &&*/}\r\n\r\n            </div>\r\n            {showAnswers &&\r\n                <div className='ps-3'>\r\n                    <AnswerList groupRow={groupRow} />\r\n                </div>\r\n            }\r\n        </div>\r\n\r\n    // console.log({ title, isExpanded })\r\n\r\n    // if (group.level !== 1)\r\n    //     return (<div>GroupRow {group.id}</div>)\r\n\r\n    // console.log('groupRow:', { isSelected, formMode, id})\r\n    return (\r\n        <>\r\n            <ListGroup.Item\r\n                // variant={\"primary\"}\r\n                className=\"py-0 px-1 w-100 group-bg\"\r\n                as=\"li\"\r\n            >\r\n                {isSelected && formMode === FormMode.AddingGroup &&\r\n                    <div>\r\n                        <div ref={hoverRef} className=\"\">\r\n                            {Row1}\r\n                        </div>\r\n                        {/* ms-0 d-md-none w-100 */}\r\n                        <div className=\"ms-0 d-md-none w-100\">\r\n                            <AddGroup activeGroup={activeGroup} />\r\n                        </div>\r\n                    </div>\r\n                }\r\n\r\n                {isSelected && formMode === FormMode.EditingGroup &&\r\n                    <>\r\n                        {/* <div class=\"d-none d-md-block\">\r\n                            This content will be hidden on small screens and below, \r\n                            but visible on medium screens and above.</div> */}\r\n                        <div ref={hoverRef}>\r\n                            {Row1}\r\n                        </div>\r\n                        {/* <div id='divInLine' className=\"ms-0 d-md-none w-100\"> */}\r\n                        <div id='divInLine' className=\"ms-0 d-md-none w-100\">\r\n                            <EditGroup inLine={false} />\r\n                        </div>\r\n                    </>\r\n                }\r\n\r\n                {isSelected && formMode === FormMode.ViewingGroup &&\r\n                    <>\r\n                        {/* <div class=\"d-lg-none\">hide on lg and wider screens</div> */}\r\n                        <div ref={hoverRef}>\r\n                            {Row1}\r\n                        </div>\r\n                        {/* <div id='divInLine' className=\"ms-0 d-md-none w-100\"> */}\r\n                        <div id='divInLine' className=\"ms-0 d-md-none w-100\">\r\n                            <ViewGroup inLine={false} />\r\n                        </div>\r\n                    </>\r\n                }\r\n\r\n                {isSelected && formMode === FormMode.None &&\r\n                    <>\r\n                        {/* <div class=\"d-lg-none\">hide on lg and wider screens</div> */}\r\n                        <div ref={hoverRef}>\r\n                            {Row1}\r\n                        </div>\r\n                        {/* <div id='divInLine' className=\"ms-0 d-md-none w-100\"> */}\r\n                        <div id='divInLine' className=\"ms-0 d-md-none w-100\">\r\n                            <ViewGroup inLine={false} />\r\n                        </div>\r\n                    </>\r\n                }\r\n\r\n                {!isSelected &&\r\n                    <div ref={hoverRef}>\r\n                        {Row1}\r\n                    </div>\r\n                }\r\n\r\n                {/* {isSelected &&\r\n                    <div className=\"d-none d-md-block\">\r\n                        {Row1}\r\n                    </div>\r\n                } */}\r\n\r\n\r\n            </ListGroup.Item>\r\n\r\n            {state.error && state.whichRowId === id && <div className=\"text-danger\">{state.error.message}</div>}\r\n\r\n            {/* !inAdding && */}\r\n            {(isExpanded) && // Row2   //  || inAdding\r\n                <ListGroup.Item\r\n                    className=\"py-0 px-0 border-0 border-warning border-bottom-0 group-bg p-0 m-0\" // border border-3 \"\r\n                    variant={\"primary\"}\r\n                    as=\"li\"\r\n                >\r\n                    <div className=\"rambo\">\r\n                        {hasSubGroups &&\r\n                            <Collapse in={open}>\r\n                                <div id={id+'-2'} style={{ marginTop: '1px' }}>\r\n                                    {/* Wrap content in a div to prevent choppy animations caused by margins/padding */}\r\n                                    <div style={{ border: '1px solid #ddd', borderRadius: '4px' }}>\r\n                                        <GroupList groupRow={groupRow} isExpanded={isExpanded} />\r\n                                    </div>\r\n                                </div>\r\n                            </Collapse>\r\n                        }\r\n                        {/* {showAnswers &&\r\n                                <AnswerList groupRow={groupRow} />\r\n                            } */}\r\n                    </div>\r\n                </ListGroup.Item>\r\n            }\r\n        </>\r\n    );\r\n};\r\n\r\nexport default GroupRow;\r\n","import { ListGroup } from \"react-bootstrap\";\r\nimport GroupRow from \"@/groups/components/GroupRow\";\r\nimport type { IGroupRow, IParentInfo } from \"@/groups/types\";\r\nimport { useGroupContext } from \"@/groups/GroupProvider\";\r\n\r\nconst GroupList = ({ groupRow }: IParentInfo) => {\r\n\r\n    const { level, groupRows } = groupRow;\r\n\r\n    const { state } = useGroupContext();\r\n    let { keyExpanded } = state;\r\n    const { answerId } = keyExpanded ?? { topId: '', groupId: '', answerId: null };\r\n\r\n    return (\r\n        <div className={level! > 1 ? 'ms-2' : ''} >\r\n            <ListGroup as=\"ul\" variant='dark' className=\"mb-0 group-bg\">\r\n                {groupRows!.map((c: IGroupRow) =>\r\n                    <GroupRow\r\n                        //groupRow={{ ...c, isSelected: c.id === id }}\r\n                        groupRow={c}\r\n                        answerId={answerId === '' ? null : answerId}\r\n                        // {c.topId === topId && c.id === id ?answerId : null}\r\n                        key={c.id}\r\n                    />\r\n                )}\r\n            </ListGroup>\r\n            {/* {state.error && state.error} */}\r\n            {/* {state.loading && <div>...loading</div>} */}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default GroupList;\r\n","import { useEffect, useState } from 'react'\r\nimport { Modal } from \"react-bootstrap\";\r\n\r\nimport { type IAnswerRow } from \"./types\";\r\n\r\nimport { useGlobalState } from \"@/global/GlobalProvider\";\r\n//import { useGroupDispatch } from \"./GroupProvider\";\r\n\r\nimport AddAnswer from './components/answers/AddAnswer';\r\n\r\ninterface IProps {\r\n    show: boolean,\r\n    onHide: () => void;\r\n    newAnswerRow: IAnswerRow\r\n}\r\n\r\nconst ModalAddAnswer = (props: IProps) => {\r\n\r\n    const { isDarkMode } = useGlobalState();\r\n\r\n    // const handleClose = () => {\r\n    //     setShowAddAnswer(false);\r\n    // }\r\n\r\n    const [createAnswerError, setCreateAnswerError] = useState(\"\");\r\n\r\n    //const dispatch = useGroupDispatch();\r\n\r\n    useEffect(() => {\r\n        (async () => {\r\n\r\n        })()\r\n    }, [])\r\n\r\n    return (\r\n        <Modal\r\n            show={props.show}\r\n            onHide={props.onHide}\r\n            animation={true}\r\n            centered\r\n            size=\"lg\"\r\n            className=\"modal show\"\r\n            contentClassName={`${isDarkMode ? \"bg-secondary bg-gradient\" : \"bg-info bg-gradient\"}`}\r\n        >\r\n            <Modal.Header closeButton>\r\n                Store new Answer to the Database\r\n            </Modal.Header>\r\n            <Modal.Body className=\"py-0\">\r\n                <AddAnswer\r\n                    closeModal={props.onHide}\r\n                    showCloseButton={false}\r\n                    source={1} /*gmail*/\r\n                    setError={(msg) => setCreateAnswerError(msg)}\r\n                />\r\n            </Modal.Body>\r\n            <Modal.Footer>\r\n                {createAnswerError}\r\n            </Modal.Footer>\r\n        </Modal>\r\n    );\r\n};\r\n\r\nexport default ModalAddAnswer;","import { lazy, Suspense, useEffect, useState } from 'react'\r\nimport { Container, Row, Col, Button } from \"react-bootstrap\";\r\n\r\nimport { useParams } from 'react-router-dom';\r\n\r\nimport { ActionTypes, type IGroupKey, type IAnswerKey, FormMode } from \"./types\";\r\n\r\nimport { useGlobalContext, useGlobalState } from '@/global/GlobalProvider';\r\n\r\nimport { GroupProvider, useGroupContext, useGroupDispatch } from \"./GroupProvider\";\r\n\r\nimport GroupList from \"@/groups/components/GroupList\";\r\nimport ViewGroup from \"@/groups/components/ViewGroup\";\r\nimport EditGroup from \"@/groups/components/EditGroup\";\r\nimport ViewAnswer from \"@/groups/components/answers/ViewAnswer\";\r\nimport EditAnswer from \"@/groups/components/answers/EditAnswer\";\r\n\r\nimport { initialGroup, initialAnswer } from \"@/groups/GroupReducer\";\r\nimport ModalAddAnswer from './ModalAddAnswer';\r\nimport AddGroup from './components/AddGroup';\r\n//import { AutoSuggestAnswers } from '@/global/Components/AutoSuggests/AutoSuggestAnswers';\r\nimport AddAnswer from './components/answers/AddAnswer';\r\n\r\ninterface IProps {\r\n    groupId_answerId?: string;\r\n    fromChatBotDlg?: string;\r\n}\r\n\r\nconst AutoSuggestAnswers = lazy(() =>\r\n    import(\"@/global/Components/AutoSuggests/AutoSuggestAnswers\").then((module) => ({ default: module.AutoSuggestAnswers }))\r\n);\r\n\r\nconst Providered = ({ groupId_answerId, fromChatBotDlg }: IProps) => {\r\n    const { state, expandNodesUpToTheTree, loadTopRows, addGroup } = useGroupContext();\r\n    const {\r\n        allGroupRows, //allGroupRowsLoaded,\r\n        topRows, topRowsLoading, topRowsLoaded,\r\n        keyExpanded,\r\n        groupId_answerId_done,\r\n        nodeOpening, nodeOpened,\r\n        activeGroup,\r\n        activeAnswer,\r\n        formMode,\r\n        loadingGroups, loadingGroup,\r\n        loadingAnswers, loadingAnswer\r\n    } = state;\r\n\r\n    const { searchAnswers, setLastRouteVisited, setChatBotDlgEnabled } = useGlobalContext();\r\n    const { isDarkMode, chatBotDlgEnabled, lastRouteVisited } = useGlobalState();\r\n\r\n    const [modalShow, setModalShow] = useState(false);\r\n    // const handleClose = () => {\r\n    //     setModalShow(false);\r\n    // }\r\n\r\n    const [newAnswer, setNewAnswer] = useState({ ...initialAnswer });\r\n\r\n    const dispatch = useGroupDispatch();\r\n\r\n    const onSelectAnswer = async (answerKey: IAnswerKey) => {\r\n        //navigate(`/groups/${answerKey.topId}_${answerKey.id}`)\r\n        dispatch({ type: ActionTypes.SET_ANSWER_SELECTED, payload: { answerKey } })\r\n    }\r\n\r\n\r\n    let tekst = '';\r\n\r\n    useEffect(() => {\r\n        (async () => {\r\n            if (!topRowsLoading && !topRowsLoaded) {\r\n                console.log('ZOVEM 111 loadTopRows()')\r\n                await loadTopRows();\r\n            }\r\n        })()\r\n    }, [topRowsLoading, topRowsLoaded, loadTopRows]);\r\n\r\n\r\n    useEffect(() => {\r\n        (async () => {\r\n            if (!nodeOpening && topRowsLoaded && topRows.length > 0) {\r\n                if (groupId_answerId) {\r\n                    if (groupId_answerId === 'add_answer') {\r\n                        const sNewAnswer = localStorage.getItem('New_Answer');\r\n                        if (sNewAnswer) {\r\n                            const q = JSON.parse(sNewAnswer);\r\n                            setNewAnswer({ ...initialAnswer, groupTitle: 'Select', ...q })\r\n                            setModalShow(true);\r\n                            localStorage.removeItem('New_Answer');\r\n                            return null;\r\n                        }\r\n                    }\r\n                    else if (groupId_answerId !== groupId_answerId_done) { //} && !nodeOpened) {\r\n                        const arr = groupId_answerId.split('_');\r\n                        const groupId = arr[0];\r\n                        const answerId = arr[1];\r\n                        const grpKey: IGroupKey = { topId: '', id: groupId, parentId: 'ROOT' };\r\n                        console.log('zovem expandNodesUpToTheTree 1111111111111111111)', { groupId_answerId }, { groupId_answerId_done })\r\n                        await expandNodesUpToTheTree(grpKey, answerId !== 'null' ? answerId : null)\r\n                        console.log('zavrsio expandNodeUpToTheTree 1111111111111111111 DONE)', { groupId_answerId })\r\n                    }\r\n                }\r\n                else if (keyExpanded && !nodeOpened) {\r\n                    const { topId, groupId, answerId } = keyExpanded;\r\n                    if (groupId !== '') {\r\n                        const grpKey: IGroupKey = { topId, id: groupId, parentId: 'ROOT' }\r\n                        console.log('zovem expandNodeUpToTheTree 2222222222222)', { keyExpanded, grpKey })\r\n                        await expandNodesUpToTheTree(grpKey, answerId);\r\n                        console.log('zavrsio expandNodeUpToTheTree 2222222222222 DONE)')\r\n                    }\r\n                }\r\n\r\n                if (!chatBotDlgEnabled) // show ChatBotDlg button\r\n                    setChatBotDlgEnabled();\r\n            }\r\n        })()\r\n    }, [groupId_answerId, groupId_answerId_done, topRowsLoaded, keyExpanded, nodeOpening, nodeOpened, expandNodesUpToTheTree, fromChatBotDlg, chatBotDlgEnabled, setChatBotDlgEnabled]);\r\n\r\n    const route = `/knowledge/groups`;\r\n    useEffect(() => {\r\n        if (lastRouteVisited !== route)\r\n            setLastRouteVisited(route);\r\n    }, [lastRouteVisited, setLastRouteVisited]);\r\n\r\n    if (groupId_answerId !== 'add_answer') {\r\n        if (/*keyExpanded ||*/ (groupId_answerId && groupId_answerId !== groupId_answerId_done)) {\r\n            console.log(\"zzzzzz loading...\", { keyExpanded, groupId_answerId, groupId_answerId_done })\r\n            return <div>loading...</div>\r\n        }\r\n    }\r\n\r\n    //if (!nodeOpened)\r\n    //if (!allGroupRowsLoaded || !topRowsLoaded || topRows.length === 0) {\r\n    if (!topRowsLoaded) {// || topRows.length === 0) {\r\n        console.log('===>>> Groups  VRATIO')\r\n        return null\r\n    }\r\n\r\n    console.log('===>>> Groups !!!!!!!!!!!!!!!!!', activeGroup)\r\n\r\n    return (\r\n        <>\r\n            <Container>\r\n                <h5 className=\"text-warning mx-auto w-75 fw-bold\"><span className='groups'>Groups / </span><span className='answers'>Answers</span></h5>\r\n\r\n                <Row className={`${isDarkMode ? \"dark\" : \"\"}`}>\r\n                    <Col>\r\n                        <div className=\"d-flex justify-content-start align-items-center\">\r\n                            <div className=\"w-75 my-1 answers\">\r\n                                <Suspense fallback={<div>Loading...</div>}>\r\n                                    <AutoSuggestAnswers\r\n                                        tekst={tekst}\r\n                                        onSelectAnswer={onSelectAnswer}\r\n                                        allGroupRows={allGroupRows}\r\n                                        searchAnswers={searchAnswers}\r\n                                    />\r\n                                </Suspense>\r\n                            </div>\r\n                        </div>\r\n                    </Col>\r\n                </Row>\r\n\r\n                <Button variant=\"secondary\" size=\"sm\" type=\"button\" style={{ padding: '1px 4px' }}\r\n                    onClick={\r\n                        () => addGroup(null)\r\n                    }\r\n                >\r\n                    Add Group\r\n                </Button>\r\n\r\n                <Row className=\"my-1 h-auto\">\r\n                    <Col xs={12} md={5}>\r\n                        <div className=\"groups-border\" style={{ position: 'relative' }}>\r\n                            <GroupList groupRow={{ ...initialGroup, groupRows: topRows }} isExpanded={true} />\r\n                        </div>\r\n                    </Col>\r\n                    <Col xs={0} md={7}>\r\n                        {/* visible on medium screens and above. */}\r\n                        <div id='div-details' className=\"d-none d-md-block\">\r\n                            {activeGroup && formMode === FormMode.ViewingGroup && <ViewGroup inLine={false} />}\r\n                            {activeGroup && formMode === FormMode.EditingGroup &&\r\n                                <EditGroup inLine={false} />\r\n                            }\r\n                            {activeGroup && formMode === FormMode.AddingGroup && <AddGroup activeGroup={activeGroup} />}\r\n\r\n                            {activeAnswer && formMode === FormMode.ViewingAnswer && <ViewAnswer inLine={false} />}\r\n                            {activeAnswer && formMode === FormMode.EditingAnswer &&\r\n                                <EditAnswer inLine={false} />\r\n                            }\r\n                            {activeAnswer && formMode === FormMode.AddingAnswer && <AddAnswer />}\r\n                        </div>\r\n                    </Col>\r\n                </Row>\r\n            </Container>\r\n            {modalShow && activeAnswer &&\r\n                <ModalAddAnswer\r\n                    show={modalShow}\r\n                    onHide={() => { setModalShow(false) }}\r\n                    newAnswerRow={newAnswer}\r\n                />\r\n            }\r\n\r\n\r\n            {(loadingGroups || loadingAnswers) &&\r\n                <div className=\"d-flex justify-content-center align-items-center\" style={{ position: 'absolute', top: '40%', left: '20%' }}>\r\n                    <div className={`spinner-border ${loadingAnswers ? 'answer' : 'group'}-spinner`} role=\"status\">\r\n                        <span className=\"visually-hidden\">Loading...</span>\r\n                    </div>\r\n                </div>\r\n            }\r\n\r\n            {loadingGroup &&\r\n                <div className=\"d-flex justify-content-center align-items-center\" style={{ position: 'absolute', top: '50%', left: '50%' }}>\r\n                    <div className=\"spinner-border group-spinner\" role=\"status\">\r\n                        <span className=\"visually-hidden\">Loading...</span>\r\n                    </div>\r\n                </div>\r\n            }\r\n\r\n            {loadingAnswer &&\r\n                <div className=\"d-flex justify-content-center align-items-center\" style={{ position: 'absolute', top: '50%', left: '50%' }}>\r\n                    <div className=\"spinner-border answer-spinner\" role=\"status\">\r\n                        <span className=\"visually-hidden\">Loading...</span>\r\n                    </div>\r\n                </div>\r\n            }\r\n        </>\r\n    );\r\n};\r\n\r\ntype Params = {\r\n    groupId_answerId?: string;\r\n    fromChatBotDlg?: string;\r\n};\r\n\r\nconst Groups = () => {\r\n\r\n    let { groupId_answerId, fromChatBotDlg } = useParams<Params>();\r\n\r\n    if (groupId_answerId && groupId_answerId === 'groups')\r\n        groupId_answerId = undefined;\r\n\r\n    if (groupId_answerId) {\r\n        const arr = groupId_answerId!.split('_');\r\n        console.assert(arr.length === 2, \"expected 'groupId_answerId'\")\r\n    }\r\n    // const globalState = useGlobalState();\r\n    // const { isAuthenticated } = globalState;\r\n\r\n    // if (!isAuthenticated)\r\n    //     return <div>groups loading...</div>;\r\n\r\n    return (\r\n        <GroupProvider>\r\n            <Providered groupId_answerId={groupId_answerId} fromChatBotDlg={fromChatBotDlg} />\r\n        </GroupProvider>\r\n    )\r\n}\r\n\r\nexport default Groups;\r\n\r\n"],"file":"Groups-Dvoplftx.js"}