const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AssignedAnswers-D2_ezA7r.js","assets/index-CjQyPrKT.js","assets/index-CykrPP6v.css","assets/Options-DXPZ0-28.js","assets/lib-B8MYAnAC.js","assets/AutoSuggestAnswers-CVl6G3uk.js","assets/AutoSuggestAnswers-vl2QUoNQ.css","assets/AutoSuggestQuestions-CCkcrOVU.js","assets/AutoSuggestQuestions-DN6HBK-e.css"])))=>i.map(i=>d[i]);
import{A as s,d as wt,a as ht,b as Ct,F as f,I as fe,u as je,c as ae,r as E,C as _e,e as xe,f as ie,g as Pe,h as Rt,Q as Ue,i as ye,j as Tt,k as Ce,l as St,m as _t,n as e,B as Y,_ as Nt,o as Me,R as Ee,D as we,p as pe,q as vt,s as It,t as jt,v as Ot}from"./index-CjQyPrKT.js";import{L as oe,F as le,f as Be,a as $e,u as Re,B as Te,b as Ve,c as Ke,d as ze,e as Ne,g as I,S as Oe,h as ve,s as Qt,i as At,C as Ye,j as We,Q as He,k as Qe,l as bt,m as Dt,n as kt,o as Lt,p as qt,M as he}from"./Options-DXPZ0-28.js";import{f as Gt,a as Ft}from"./lib-B8MYAnAC.js";import{A as Pt}from"./AutoSuggestQuestions-CCkcrOVU.js";const Ie={topId:"",parentId:"null",id:"generateId",categoryTitle:"",title:"",assignedAnswers:[],numOfAssignedAnswers:0,relatedFilters:[],numOfRelatedFilters:0,source:0,status:0,included:!1},Ae={topId:"null",parentId:"null",id:"define at BackEnd",kind:0,title:"",link:"",header:"",level:0,variations:[],hasSubCategories:!1,categoryRows:[],questionRows:[],numOfQuestions:0,hasMoreQuestions:!1,isExpanded:!1,doc1:""},Ut=(t,r)=>{console.log("------------------------------->"),console.log("------------------------------->",r.type),console.log("------------------------------->");const{categoryRow:u}=r.payload;if(r.type===s.SET_KEY_EXPANDED){const{keyExpanded:p}=r.payload;return{...t,keyExpanded:p,nodeOpened:p===null?!0:t.nodeOpened}}let o=u?!wt.includes(r.type):!1;const{topRows:c}=t,n=ht.includes(r.type)?{...t}:Mt(t,r);if(o&&u){let p;const{topId:h,id:C}=u;if(C===h)p=c.map(R=>R.id===h?new J(u).categoryRow:new J(R).categoryRow);else{const R=c.find(x=>x.id===h);J.idToSet=C,J.newCategoryRow=u;const i=new J(R).categoryRow;p=c.map(x=>x.id===h?i:new J(x).categoryRow),J.idToSet=""}n.topRows=p}if(Ct.includes(r.type)){const{keyExpanded:p}=n,h={keyExpanded:p};localStorage.setItem("CATEGORIES_STATE",JSON.stringify(h))}return console.log("CategoryReducer newState",n),n},Mt=(t,r)=>{switch(r.type){case s.SET_TOP_ROWS_LOADING:return{...t,loadingCategories:!0,topRowsLoading:!0,topRowsLoaded:!1};case s.SET_TOP_ROWS:{const{topRows:o}=r.payload;return console.log("=> CategoriesReducer ActionTypes.SET_TOP_ROWS",t.topRows,o),{...t,topRows:o,topRowsLoading:!1,topRowsLoaded:!0,loadingCategories:!1}}case s.SET_ALL_CATEGORY_ROWS:{const{allCategoryRows:o}=r.payload;return{...t,allCategoryRows:o,allCategoryRowsLoaded:Date.now()}}case s.SET_NODE_EXPANDING_UP_THE_TREE:{const{categoryId_questionId_done:o}=r.payload;return{...t,categoryId_questionId_done:o,nodeOpening:!0,loadingCategories:!0,nodeOpened:!1,activeCategory:null,activeQuestion:null}}case s.SET_NODE_EXPANDED_UP_THE_TREE:{const{category:o,questionId:c,question:n}=r.payload;return{...t,activeCategory:o,activeQuestion:n,selectedQuestionId:c,nodeOpening:!1,nodeOpened:!0,loadingCategories:!1}}case s.SET_LOADING_CATEGORY:return{...t,loadingCategory:!0,categoryLoaded:!1};case s.FORCE_OPEN_NODE:const{keyExpanded:u}=r.payload;return alert("FORCE_OPEN_NODE is deprecated, use SET_QUESTION_SELECTED instead"),{...t,topRows:t.topRows.filter(o=>o.parentId===null),keyExpanded:u,nodeOpened:!1,activeCategory:null,activeQuestion:null,selectedQuestionId:null};case s.SET_SUB_CATEGORIES:return{...t,loadingCategory:!1};case s.SET_ERROR:{const{error:o,whichRowId:c}=r.payload;return{...t,error:o,whichRowId:c,loadingCategories:!1,loadingQuestions:!1,loadingCategory:!1,categoryLoaded:!1,loadingQuestion:!1,questionLoaded:!1}}case s.ADD_SUB_CATEGORY:{const{categoryKey:o,level:c}=r.payload,{topId:n}=o,p={...Ae,topId:n,level:c,parentId:""};return{...t,activeCategory:p,formMode:f.AddingCategory}}case s.SET_CATEGORY:{const{categoryRow:o}=r.payload;return console.assert(fe(o)),{...t,loadingCategory:!1,categoryLoaded:!0,activeCategory:o,activeQuestion:null,selectedQuestionId:null}}case s.SET_ROW_EXPANDING:return{...t,rowExpanding:!0,rowExpanded:!1,loadingCategories:!0};case s.SET_ROW_EXPANDED:{const{categoryRow:o}=r.payload,{topId:c,id:n}=o,{keyExpanded:p}=t,h=p?p.questionId:null;return{...t,loadingCategories:!1,keyExpanded:{topId:c,categoryId:n,questionId:h},activeQuestion:null,selectedQuestionId:h,loadingQuestion:!1,questionLoaded:!1,rowExpanding:!1,rowExpanded:!0}}case s.SET_ROW_COLLAPSED:{const{categoryRow:o}=r.payload,{topId:c,parentId:n}=o;return{...t,loadingCategories:!1,keyExpanded:{topId:c,categoryId:n??"",questionId:null},rowExpanding:!1,rowExpanded:!0,activeCategory:null,activeQuestion:null,selectedQuestionId:null}}case s.SET_CATEGORY_TO_VIEW:{const{categoryRow:o}=r.payload;console.assert(fe(o));const n={...o,isExpanded:!1};return{...t,formMode:f.ViewingCategory,loadingCategory:!1,activeCategory:n,activeQuestion:null,selectedQuestionId:null,error:void 0}}case s.SET_CATEGORY_TO_ADD_TOP:{const{newCategoryRow:o}=r.payload;return{...t,loadingCategory:!1,categoryLoaded:!0,activeCategory:{...o,doc1:""},activeQuestion:null,selectedQuestionId:null,topRows:[o,...t.topRows],formMode:f.AddingCategory}}case s.SET_CATEGORY_TO_ADD:{const{newCategoryRow:o}=r.payload;return{...t,loadingCategory:!1,categoryLoaded:!0,activeCategory:{...o,doc1:""},activeQuestion:null,selectedQuestionId:null,formMode:f.AddingCategory}}case s.SET_CATEGORY_ADDED:{const{categoryRow:o}=r.payload;console.assert(fe(o));const n={...o,isExpanded:!1},{topId:p,id:h}=n;return{...t,formMode:f.EditingCategory,loadingCategory:!1,categoryLoaded:!1,activeCategory:n,activeQuestion:null,selectedQuestionId:null,keyExpanded:{topId:p,categoryId:h,questionId:null}}}case s.SET_CATEGORY_TO_EDIT:case s.SET_CATEGORY_UPDATED:{const{categoryRow:o,category:c}=r.payload;console.assert(fe(o));const{topId:n,id:p}=c;return{...t,formMode:f.EditingCategory,loadingCategory:!1,categoryLoaded:!0,keyExpanded:{topId:n,categoryId:p,questionId:null},activeCategory:c,activeQuestion:null,selectedQuestionId:null,error:void 0}}case s.SET_CATEGORY_QUESTIONS_LOADING:return{...t,loadingQuestions:!0,questionLoaded:!1};case s.CATEGORY_QUESTIONS_LOADED:return{...t,loadingQuestions:!1};case s.DELETE_CATEGORY:return{...t,activeCategory:null,formMode:f.None,error:void 0,whichRowId:void 0};case s.CANCEL_CATEGORY_FORM:case s.CLOSE_CATEGORY_FORM:return{...t,activeCategory:null,formMode:f.None};case s.CANCEL_ADD_SUB_CATEGORY:return{...t,activeCategory:null,activeQuestion:null,selectedQuestionId:null,formMode:f.None};case s.SET_LOADING_QUESTION:return{...t,loadingQuestion:!0,questionLoaded:!1};case s.CANCEL_ADD_QUESTION:return{...t,formMode:f.None,activeQuestion:null,selectedQuestionId:null};case s.SET_QUESTION_SELECTED:{const{questionKey:o}=r.payload,{topId:c,parentId:n,id:p}=o;return{...t,topRows:t.topRows.filter(h=>h.parentId===null),keyExpanded:{topId:c,categoryId:n,questionId:p},activeCategory:null,activeQuestion:null,selectedQuestionId:null}}case s.ADD_NEW_QUESTION_TO_ROW:{const{newQuestionRow:o}=r.payload;return{...t,selectedQuestionId:o.id}}case s.SET_QUESTION:{const{question:o,formMode:c}=r.payload;return console.log(s.SET_QUESTION,o),{...t,activeCategory:null,activeQuestion:o,formMode:c,error:void 0,loadingCategory:!1,loadingQuestion:!1,questionLoaded:!0}}case s.SET_QUESTION_AFTER_ASSIGN_ANSWER:{const{question:o}=r.payload;return{...t,activeQuestion:o,loadingQuestion:!1,questionLoaded:!0}}case s.SET_QUESTION_TO_VIEW:{const{question:o}=r.payload,{keyExpanded:c}=t;return{...t,formMode:f.ViewingQuestion,keyExpanded:c,activeQuestion:o,loadingQuestion:!1,questionLoaded:!0}}case s.SET_QUESTION_TO_EDIT:{const{question:o}=r.payload,{topId:c,id:n,parentId:p}=o;return{...t,keyExpanded:{topId:c,categoryId:p,questionId:n},activeQuestion:o,formMode:f.EditingQuestion,selectedQuestionId:o.id,loadingQuestion:!1,questionLoaded:!0}}case s.QUESTION_DELETED:return{...t,activeQuestion:null,selectedQuestionId:null,formMode:f.None,loadingQuestion:!1,questionLoaded:!0};case s.CANCEL_QUESTION_FORM:case s.CLOSE_QUESTION_FORM:return{...t,formMode:f.None,activeQuestion:null,selectedQuestionId:null};default:return alert(`Action ${r.type} not allowed`),{...t}}};class J{static idToSet;static newCategoryRow;constructor(r){const{topId:u,id:o,parentId:c,title:n,link:p,kind:h,header:C,level:R,variations:i,numOfQuestions:x,hasSubCategories:D,categoryRows:N,created:O,modified:P,questionRows:A,isExpanded:$}=r,T=N.map(Q=>(console.log("DeepClone >>>>>>>>>>>>>>>",Q.id),Q.id===J.idToSet?{...J.newCategoryRow}:new J(Q).categoryRow));this.categoryRow={topId:u,parentId:c,id:o,kind:h,title:n,link:p,header:C,level:R,hasSubCategories:D,categoryRows:T,numOfQuestions:x,questionRows:A,variations:i??[],created:O,modified:P,isExpanded:$}}categoryRow}const Xe=E.createContext({}),Je=E.createContext(()=>null),Bt={formMode:f.None,allCategoryRows:new Map,allCategoryRowsLoaded:void 0,topRows:[],topRowsLoading:!1,topRowsLoaded:!1,nodeOpening:!1,nodeOpened:!1,keyExpanded:null,categoryId_questionId_done:void 0,activeCategory:null,activeQuestion:null,selectedQuestionId:null,loadingCategories:!1,loadingQuestions:!1,loadingCategory:!1,categoryLoaded:!1,loadingQuestion:!1,questionLoaded:!1,error:void 0,rowExpanding:!1,rowExpanded:!1},$t=({children:t})=>{const{loadAllCategoryRowsGlobal:r}=je(),u=ae(),{KnowledgeAPI:o,isAuthenticated:c,workspace:n,authUser:p,canEdit:h}=u,{nickName:C}=p,[R,i]=E.useReducer(Ut,Bt),{formMode:x,activeCategory:D,activeQuestion:N,keyExpanded:O,topRows:P,allCategoryRows:A,allCategoryRowsLoaded:$}=R;console.log("----->>> ----->>> ----->>> CategoryProvider"),E.useEffect(()=>{let l=n==="DEMO"?{topId:"MTS",categoryId:"REMOTECTRLS",questionId:"qqqqqq111"}:null;if("localStorage"in window){let a=localStorage.getItem("CATEGORIES_STATE");if(console.log("CATEGORIES_STATE loaded before signIn",a),a!==null){const y=JSON.parse(a);y.keyExpanded!==null&&(l=y.keyExpanded)}}i({type:s.SET_KEY_EXPANDED,payload:{keyExpanded:l}})},[n]);const T=E.useCallback(async(l,a,y=null,g=void 0)=>{const d=localStorage.getItem("accessToken");if(d)try{console.log("------Execute endpoint:",a);let m=null;const w=new Headers,_=`Bearer ${d}`;w.append("Authorization",_),y&&w.append("Content-Type","application/json");let G={method:l,headers:w,body:y?JSON.stringify(y):null};if(m=await fetch(a,G),m.ok){if(m.status===200||m.status===201){let W=null;try{W=await m.json()}catch{i({type:s.SET_ERROR,payload:{error:new Error(`Response status: ${m.status}`),whichRowId:g}})}finally{return W}}}else{const{errors:W}=await m.json(),V=new Error(W?.map(ee=>ee.message).join(`
`)??"unknown");i({type:s.SET_ERROR,payload:{error:V,whichRowId:g}})}}catch(m){console.log("-------------->>> execute",l,a,m),i({type:s.SET_ERROR,payload:{error:new Error("fetch eror"),whichRowId:g}})}return null},[]),Q=E.useCallback(async()=>new Promise(async l=>{const a=await r();i(a?{type:s.SET_ALL_CATEGORY_ROWS,payload:{allCategoryRows:a}}:{type:s.SET_ERROR,payload:{error:new Error("Zajeb allCategoryRows")}}),l(a)}),[r]),U=E.useCallback(async l=>{try{return A.get(l)}catch(a){console.log(a),i({type:s.SET_ERROR,payload:{error:a}})}},[A]);E.useEffect(()=>{(async()=>$===void 0&&await Q())()},[$,Q]);const v=E.useCallback(async l=>{try{let a="";const y=[];return A.forEach((g,d)=>{d===l?a="":g.parentId===l&&y.push(g)}),{subCats:y,parentHeader:a}}catch(a){return console.log(a),i({type:s.SET_ERROR,payload:{error:a}}),{subCats:[],parentHeader:"Kiks subCats"}}},[A]),K=E.useCallback(async()=>new Promise(async l=>{try{i({type:s.SET_TOP_ROWS_LOADING,payload:{}});const a=`${o.endpointCategoryRow}/${n}/toprows`;console.log("CategoryProvider loadTopRows url:",a),console.log("loadTopRows AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"),console.time(),await T("GET",a).then(y=>{console.timeEnd(),console.log("loadTopRows BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB");const g=y.map(d=>(d.IsExpanded=O?d.Id===O.categoryId:!1,new _e(d).categoryRow));i({type:s.SET_TOP_ROWS,payload:{topRows:g}}),l(!0)})}catch(a){console.log(a),i({type:s.SET_ERROR,payload:{error:a}})}}),[T,o.endpointCategoryRow,O,n]),k=E.useCallback(async(l,a)=>{const{topId:y,id:g}=l;return console.log({categoryKey:l,includeQuestionId:a}),new Promise(async d=>{try{const m=`${o.endpointCategory}/${n}/${y}/${g}/${re}/${a}`;console.time(),console.log("================ getCategory ======================="),await T("GET",m).then(w=>{console.timeEnd();const{categoryDto:_,msg:G}=w;d(_?new xe(_).category:new Error(G))})}catch(m){console.log(m),d(m)}})},[T,o.endpointCategory,n]),b=E.useCallback(async(l,a)=>{if(l.topId===a)return l;const{categoryRows:y}=l;let g=y.find(d=>d.id===a);if(!g)for(const d of y){const m=await b(d,a);if(m){g=m,console.log("findCategory Stop the loop for: "+a);break}}return g},[]),L=E.useCallback(async(l,a,y=!1)=>new Promise(async g=>{try{let{topId:d,parentId:m,id:w}=l;if(console.assert(w!==null,"id ne sme biti null u expandNodesUpToTheTree"),w){const V=A.get(w);V?(d=V.topId,m=V.parentId):alert("reload all categoryRow:"+w)}i({type:s.SET_NODE_EXPANDING_UP_THE_TREE,payload:{fromChatBotDlg:y,categoryId_questionId_done:`${w}_${a}`}}),console.time();const _={topId:d,id:w,parentId:null},G=new ie(_).toQuery(n),W=`${o.endpointCategoryRow}?${G}&pageSize=${re}&includeQuestionId=${a??null}`;await T("GET",W).then(async V=>{const{categoryRowDto:ee}=V;if(console.timeEnd(),ee){let ce=null,ue=null,ge=new _e(ee).categoryRow;if(m!==null){const qe=await b(ge,w);if(ce={...qe,doc1:""},a){const Ge=qe.questionRows.find(Fe=>Fe.id===a&&Fe.included);Ge&&(ce=null,ue={...Ge,assignedAnswers:[],numOfAssignedAnswers:0,numOfRelatedFilters:0,relatedFilters:[],source:0,status:0})}}console.log(">>> expandNodeUpToTheTree categoryRow",{categoryRow:ge,questionId:"'"+(a??"jok")+"'"+(a??"JOK")});const Se=a?h?f.EditingQuestion:f.ViewingQuestion:h?f.EditingCategory:f.ViewingCategory;i({type:s.SET_NODE_EXPANDED_UP_THE_TREE,payload:{catKey:l,categoryRow:ge,category:ce,questionId:a??null,question:ue,formMode:Se,fromChatBotDlg:y}}),g(!0)}else g(!1)})}catch(d){console.log(d),i({type:s.SET_ERROR,payload:{error:d}})}}),[n,o.endpointCategoryRow,T,A,b,h]),M=E.useCallback(async(l,a=!1,y=null)=>{const g=new ie(l).toQuery(n);return new Promise(async d=>{try{const m=`${o.endpointCategoryRow}/${a}/${re}/${y}?${g}`;console.time(),await T("GET",m).then(w=>{console.timeEnd();const{categoryRowDto:_,msg:G}=w;d(_?new _e(_).categoryRow:new Error(G))})}catch(m){console.log(m),d(m)}})},[T,o.endpointCategoryRow,n]),q=E.useCallback(async({categoryKey:l,includeQuestionId:a,newQuestionRow:y,formMode:g})=>{try{i({type:s.SET_ROW_EXPANDING,payload:{}});const d=await M(l,!0,a);if(d instanceof Error)i({type:s.SET_ERROR,payload:{error:d}}),console.error({cat:d});else{let m;return a&&d.questionRows.filter(w=>w.included).length>0&&(m=a),y&&(d.questionRows=[y,...d.questionRows]),d.isExpanded=!0,console.log("@@@@@@@@@@@@@@@@@ expandCategory:",g,a),g===f.None&&a&&(g=h?f.EditingQuestion:f.ViewingQuestion),i({type:s.SET_ROW_EXPANDED,payload:{categoryRow:d,formMode:g,selectedQuestionId:m}}),d}}catch(d){return console.log("error",d),i({type:s.SET_ERROR,payload:{error:d}}),null}},[h,M]),Z=E.useCallback(async l=>{const{topId:a,id:y}=l,g=P.find(m=>m.id===a),d=await b(g,y);d?(l={...d,isExpanded:!1,categoryRows:[],questionRows:[]},i({type:s.SET_ROW_COLLAPSED,payload:{categoryRow:l}})):i({type:s.SET_ERROR,payload:{error:new Error("findCategory sranje"),whichRowId:y}})},[b,P]),S=E.useCallback(async l=>{try{i({type:s.CLOSE_CATEGORY_FORM,payload:{}});const{topId:a,id:y,level:g}=l??{topId:"generateId",id:"generateId",level:0},d={...Ae,topId:a,parentId:l?y:null,id:"generateId",level:g+1,title:"New Category",isExpanded:!1};if(l===null)i({type:s.SET_CATEGORY_TO_ADD_TOP,payload:{newCategoryRow:d}});else{const m={...l,level:g+1,categoryRows:[d,...l.categoryRows],hasSubCategories:!0,isExpanded:!0};i({type:s.SET_CATEGORY_TO_ADD,payload:{categoryRow:m,newCategoryRow:d}})}}catch(a){console.log("error",a),i({type:s.SET_ERROR,payload:{error:a}})}},[]),z=E.useCallback(async()=>{try{const{topId:l,id:a,parentId:y}=D,d={categoryKey:{topId:l,parentId:y,id:a},formMode:f.None},m=await q(d);m&&i({type:s.CANCEL_ADD_SUB_CATEGORY,payload:{categoryRow:m}})}catch(l){console.log("error",l),i({type:s.SET_ERROR,payload:{error:l}})}},[D,q]),se=E.useCallback(async l=>{const{id:a}=l;i({type:s.SET_LOADING_CATEGORY,payload:{}});try{const y=new Pe(l,n).categoryDto;console.log("categoryDto",{categoryDto:y});const g=`${o.endpointCategory}`;console.time(),await T("POST",g,y,a).then(async d=>{console.timeEnd();const{categoryDto:m}=d;if(m){const w=new xe(m).category;console.log("Category successfully created",{category:w}),i({type:s.CLOSE_CATEGORY_FORM,payload:{}}),w.parentId===null?i({type:s.SET_CATEGORY_ADDED,payload:{categoryRow:w}}):i({type:s.SET_CATEGORY_ADDED,payload:{categoryRow:w}})}})}catch(y){console.log(y),i({type:s.SET_ERROR,payload:{error:new Error("Server Error"),whichRowId:a}})}},[T,o.endpointCategory,Q,K,n]),j=E.useCallback(async()=>{try{const{topId:l,parentId:a}=N,g={categoryKey:{topId:l,parentId:a,id:a},formMode:f.None},d=await q(g);d&&i({type:s.CANCEL_ADD_QUESTION,payload:{categoryRow:d}})}catch(l){console.log("error",l),i({type:s.SET_ERROR,payload:{error:l}})}},[N,q]),F=E.useCallback(async(l,a)=>{x===f.AddingQuestion?await j():x===f.AddingCategory&&await z(),i({type:s.SET_LOADING_CATEGORY,payload:{categoryRow:l}});const y=new ie(l).categoryKey,g=await k(y,a);g instanceof Error?i({type:s.SET_ERROR,payload:{error:g}}):(g.topId=l.topId,i({type:s.SET_CATEGORY_TO_VIEW,payload:{categoryRow:g}}))},[z,j,x,k]),H=E.useCallback(async(l,a)=>{x===f.AddingQuestion?await j():x===f.AddingCategory&&await z(),i({type:s.SET_LOADING_CATEGORY,payload:{}});const y=new ie(l).categoryKey,g=await k(y,a);if(g instanceof Error)i({type:s.SET_ERROR,payload:{error:g}});else{const d={...g,isExpanded:!1,categoryRows:[],questionRows:[]};i({type:s.SET_CATEGORY_TO_EDIT,payload:{categoryRow:d,category:g}})}},[z,j,x,k]),X=E.useCallback(async l=>{i({type:s.SET_LOADING_CATEGORY,payload:{}});try{const a=new Pe(l,n).categoryDto,y=`${o.endpointCategory}`;console.time(),await T("PUT",y,a).then(g=>{console.timeEnd();const{categoryDto:d,msg:m}=g;if(d){const w=new xe(d).category,{topId:_}=w;w.isExpanded=!1,w.topId=_,i({type:s.SET_CATEGORY_UPDATED,payload:{category:w}})}else i({type:s.SET_ERROR,payload:{error:new Error(`${m}`)}})})}catch(a){return console.log(a),i({type:s.SET_ERROR,payload:{error:new Error("Karambol")}}),a}},[T,o.endpointCategory,n]),ne=E.useCallback(async l=>{try{const{topId:a,parentId:y}=l,g=new Rt(l,n).categoryRowDto,d=`${o.endpointCategory}`;console.time(),await T("DELETE",d,g).then(async m=>{console.timeEnd();const{categoryDto:w,msg:_}=m;_==="OK"?(console.log("Category successfully deleted",{categoryRow:l}),await Q().then(async()=>{const G={categoryKey:{topId:a,parentId:"",id:y},formMode:f.None};y?await K():await q(G).then(()=>{})})):i(_==="HasSubCategories"?{type:s.SET_ERROR,payload:{error:new Error("First remove sub categories"),whichRowId:w.Id}}:_==="HasQuestions"?{type:s.SET_ERROR,payload:{error:new Error("First remove category questions"),whichRowId:w.Id}}:{type:s.SET_ERROR,payload:{error:new Error(_),whichRowId:w.Id}})})}catch(a){return console.log(a),a}},[T,o.endpointCategory,q,Q,K,n]),de=async(l,a)=>{try{console.log("Deleting Category Tag...",{categoryKey:l,variationName:a}),console.log("Category Tag successfully deleted")}catch(y){console.log("error",y),i({type:s.SET_ERROR,payload:{error:y}})}},re=12,lt=E.useCallback(async({categoryKey:l,startCursor:a,includeQuestionId:y})=>{try{const{topId:g,id:d}=l;i({type:s.SET_CATEGORY_QUESTIONS_LOADING,payload:{}});try{const m=`${o.endpointQuestion}/${n}/${g}/${d}/${a}/${re}/${y}`;console.time(),await T("GET",m).then(w=>{console.timeEnd();const{categoryDto:_}=w;if(_!==null){const G=new xe(_).category;i({type:s.CATEGORY_QUESTIONS_LOADED,payload:{categoryRow:G}})}})}catch(m){console.log(m),i({type:s.SET_ERROR,payload:{error:m}})}}catch(g){console.log(g),i({type:s.SET_ERROR,payload:g})}},[T,o.endpointQuestion,n]),dt=E.useCallback(async l=>{try{const{topId:a,id:y}=l;let g=await U(y);if(!g){alert(`Not found ${y}. Reload all Categories`);return}const d={topId:a,parentId:l.id,id:"generateId",title:"question text",categoryTitle:g.title,numOfAssignedAnswers:0,included:!0},m={...Ie,...d,title:""},w=R.topRows.find(G=>G.id===a),_=await b(w,y);i({type:s.ADD_NEW_QUESTION_TO_ROW,payload:{categoryRow:{..._,questionRows:[d,..._.questionRows]},newQuestionRow:d}}),i({type:s.SET_QUESTION,payload:{question:m,formMode:f.AddingQuestion}})}catch(a){console.log("error",a),i({type:s.SET_ERROR,payload:{error:a}})}},[q,b,U,R.topRows]),ct=E.useCallback(async l=>{const{topId:a,id:y,parentId:g}=l;i({type:s.SET_LOADING_CATEGORY,payload:{}});try{l.created.nickName=C;const d=new Ue(l,n).questionDto,m=`${o.endpointQuestion}`;console.time(),console.log(">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> createQuestion",d),await T("POST",m,d).then(async w=>{if(console.timeEnd(),w){console.log("::::::::::::::::::::",{questionDtoEx:w});const{questionDto:_}=w;if(_){const G=new ye(_).question;G.topId=a,console.log("Question successfully created"),await Q().then(async()=>{const V={categoryKey:{topId:a,parentId:g,id:g},formMode:f.EditingQuestion};await q(V).then(()=>{i({type:s.SET_QUESTION,payload:{formMode:f.EditingQuestion,question:G}})})})}}})}catch(d){console.log(d),i({type:s.SET_ERROR,payload:{error:new Error("Server Error"),whichRowId:y}})}},[T,o.endpointQuestion,q,Q,C,n]),ut=E.useCallback(async(l,a,y)=>{const{id:g}=a;try{a.modified.nickName=C;const d=new Ue(a,n).questionDto,m=`${o.endpointQuestion}`;console.time(),d.oldParentId=l,console.log(">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> updateQuestion",d);let w=null;return await T("PUT",m,d).then(async _=>{console.timeEnd();const{questionDto:G,msg:W}=_;if(G){w=new ye(G).question,console.log("Question successfully updated: ",w);const{topId:V,parentId:ee}=w;if(y){const{topId:ce,parentId:ue,id:ge}=w,Se={topId:ce,categoryId:ue,questionId:ge};i({type:s.FORCE_OPEN_NODE,payload:{keyExpanded:Se}})}else{const ue={categoryKey:{topId:V,parentId:ee,id:ee},formMode:f.EditingQuestion};await q(ue).then(()=>{i({type:s.SET_QUESTION,payload:{formMode:f.EditingQuestion,question:w}})})}}else i({type:s.SET_ERROR,payload:{error:new Error(W)}})}),w}catch(d){console.log(d),i({type:s.SET_ERROR,payload:{error:new Error("Server Error"),whichRowId:g}})}},[T,o.endpointQuestion,q,C,n]),gt=E.useCallback(async(l,a)=>{const{id:y,parentId:g,topId:d}=l;i({type:s.SET_LOADING_QUESTION,payload:{}});try{const m=new Tt(l,n).questionRowDto,w=`${o.endpointQuestion}`;console.time(),await T("DELETE",w,m).then(async _=>{const{questionDto:G}=_;if(console.timeEnd(),G){const W=new ye(G).question;console.log("Question successfully deleted"),a&&i({type:s.QUESTION_DELETED,payload:{question:W}});const ee={categoryKey:{topId:d,parentId:g,id:g},formMode:f.None};await q(ee).then(()=>{})}else console.error(_),i({type:s.SET_ERROR,payload:{error:new Error("Server Error"),whichRowId:y}})})}catch(m){console.log(m),i({type:s.SET_ERROR,payload:{error:new Error("Server Error"),whichRowId:y}})}},[T,o.endpointQuestion,q,n]),me=E.useCallback(async l=>new Promise(async a=>{try{const y=new Ce(l).toQuery(n),g=`${o.endpointQuestion}?${y}`;console.time(),console.log("getQuestion",l),await T("GET",g).then(d=>{console.timeEnd();const{questionDto:m,msg:w}=d;if(m){const _={question:new ye(m).question,msg:w};a(_)}else a({question:null,msg:w})})}catch(y){console.log(y),a({question:null,msg:"Problemos"})}}),[T,o.endpointQuestion,n]),yt=E.useCallback(async l=>{const a=new Ce(l).questionKey;i({type:s.SET_LOADING_QUESTION,payload:{}});const y=await me(a);x===f.AddingQuestion?await j():x===f.AddingCategory&&await z();const{question:g,msg:d}=y;g?(g.topId=l.topId,i({type:s.SET_QUESTION_TO_VIEW,payload:{question:g}})):i({type:s.SET_ERROR,payload:{error:new Error(d)}})},[z,j,x,me]),pt=E.useCallback(async l=>{const a=new Ce(l).questionKey;x===f.AddingQuestion?await j():x===f.AddingCategory&&await z(),i({type:s.SET_LOADING_QUESTION,payload:{}}),console.log("editQuestion:",a);const y=await me(a),{question:g,msg:d}=y;g?(g.topId=l.topId,i({type:s.CLOSE_QUESTION_FORM,payload:{question:g}}),i({type:s.SET_QUESTION_TO_EDIT,payload:{question:g}})):i({type:s.SET_ERROR,payload:{error:new Error(d)}})},[z,j,x,me]),Et=E.useCallback(async(l,a,y)=>{try{var{topId:g,id:d}=y,m={topId:g,id:d,created:{time:new Date,nickName:C}};const w=new St(m).assignedAnswerDto;w.QuestionKeyDto=new _t(a,n).dto;let _=null;const G=`${o.endpointQuestionAnswer}/${l}`;console.time(),await T("POST",G,w).then(async W=>{console.timeEnd();const{questionDto:V}=W;console.log("::::::::::::::::::::",{questionDtoEx:W}),V&&(_=new ye(V).question,console.log("Question successfully modified"))}),_&&i({type:s.SET_QUESTION_AFTER_ASSIGN_ANSWER,payload:{question:_}})}catch(w){console.log("error",w),i({type:s.SET_ERROR,payload:{error:w}})}},[T,o.endpointQuestionAnswer,C,n]),mt=E.useCallback(async(l,a,y)=>{const g=P.find(m=>m.id===l);let d=await b(g,a);console.log("Provider onCategoryTitleChanged:",y),d.title!==y&&(d.title=y,i({type:s.CATEGORY_TITLE_CHANGED,payload:{categoryRow:d}}))},[b,P]),ft=E.useCallback(async(l,a,y)=>{const{parentId:g,id:d}=a,m=await b(l,g);if(m){const w=m.questionRows.find(_=>_.id===d);w.title=y,console.log("onQuestionTitleChanged+++>>>",d,m),i({type:s.QUESTION_TITLE_CHANGED,payload:{categoryRow:m}})}},[b]),xt={state:R,loadAllCategoryRows:Q,getSubCats:v,getCat:U,expandNodesUpToTheTree:L,loadTopRows:K,addSubCategory:S,cancelAddCategory:z,createCategory:se,viewCategory:F,editCategory:H,updateCategory:X,deleteCategory:ne,deleteCategoryVariation:de,expandCategory:q,collapseCategory:Z,onCategoryTitleChanged:mt,loadCategoryQuestions:lt,addQuestion:dt,cancelAddQuestion:j,createQuestion:ct,viewQuestion:yt,editQuestion:pt,updateQuestion:ut,deleteQuestion:gt,onQuestionTitleChanged:ft,assignQuestionAnswer:Et};return!c||!$?null:e.jsx(Xe.Provider,{value:xt,children:e.jsx(Je.Provider,{value:i,children:t})})};function B(){return E.useContext(Xe)}const be=()=>E.useContext(Je);var te=(t=>(t.SET_LOADING="SET_LOADING",t.SET_SUB_CATS="SET_SUB_CATS",t.SET_ERROR="SET_ERROR",t.SET_EXPANDED="SET_EXPANDED",t.SET_PARENT_CAT="SET_PARENT_CAT",t))(te||{});const Vt=({cat:t,dispatch:r,setParentCat:u,selId:o})=>{const{topId:c,parentId:n,id:p,title:h,level:C,isExpanded:R}=t,i={topId:c,parentId:n,id:p},x=O=>{r({type:te.SET_EXPANDED,payload:{id:p,expanding:!R}})},D=O=>{u(O)},N=e.jsxs("div",{className:"d-flex justify-content-start align-items-center w-100 text-primary",children:[e.jsx(Y,{variant:"link",size:"sm",className:"py-0 px-1",onClick:O=>{x(),O.stopPropagation(),O.preventDefault()},title:"Expand",children:e.jsx(le,{icon:R?Be:$e,size:"lg"})}),e.jsx(Y,{variant:"link",size:"sm",className:"py-0 mx-0 text-decoration-none",title:p,onClick:()=>D(t),children:h})]});return e.jsxs(e.Fragment,{children:[e.jsx(oe.Item,{variant:"primary",className:"py-0 px-1 w-100",as:"li",children:N}),R&&e.jsx(oe.Item,{className:"py-0 px-0",variant:"primary",as:"li",children:e.jsx(et,{selId:o,level:C+1,categoryKey:i,setParentId:u})})]})},Kt={loading:!1,parentId:null,title:"",cats:[]},zt=(t,r)=>{switch(r.type){case te.SET_LOADING:return{...t,loading:!0};case te.SET_SUB_CATS:{const{subCats:u}=r.payload;return{...t,cats:t.cats.concat(u),loading:!1}}case te.SET_ERROR:{const{error:u}=r.payload;return{...t,error:u,loading:!1}}case te.SET_EXPANDED:{const{id:u,expanding:o}=r.payload;let{cats:c}=t;if(!o){const n=Ze(c,u);console.log("clean:",n),n.length>0&&(c=c.filter(p=>!n.includes(p.id)))}return{...t,cats:t.cats.map(n=>n.id===u?{...n,isExpanded:o}:n)}}case te.SET_PARENT_CAT:{const{cat:u}=r.payload,{id:o,title:c}=u;return{...t,parentId:o,title:c}}default:return t}};function Ze(t,r){let u=t.filter(o=>o.parentId===r).map(o=>o.id);return u.forEach(o=>{const c=o?Ze(t,o):[];u=u.concat(c)}),u}const et=({selId:t,categoryKey:r,level:u,setParentId:o})=>{const[c,n]=E.useReducer(zt,Kt),{getSubCats:p}=B(),{id:h}=r??{id:null},[C]=E.useState(r);E.useEffect(()=>{(async()=>{const x=await p(h),{subCats:D}=x;n({type:te.SET_SUB_CATS,payload:{subCats:D}})})()},[p,C,h]);const R=c.cats.filter(x=>x.parentId===h),i=x=>{n({type:te.SET_PARENT_CAT,payload:{cat:x}}),o(x)};return e.jsxs("div",{className:u>1?"border  border-7 ms-4 h-25":"border border-7  h-25",style:{overflowY:"auto"},children:[e.jsx(oe,{as:"ul",variant:"dark",className:"mb-0",children:R.filter(x=>x.id!==t).map(x=>e.jsx(Vt,{cat:x,selId:t,dispatch:n,setParentCat:i},x.id))}),c.error&&c.error.message]})},Yt=({relatedFilter:t})=>{const{filter:r,numOfUsages:u,created:o,lastUsed:c}=t,{time:n,nickName:p}=o,h=`Created by: ${p}, ${Gt(new Date(n))}`,C=!1,R=N=>{console.log("RelatedFilter onSelectAnswer",{filter:N})},[i,x]=Re(),D=e.jsxs("div",{ref:i,className:"d-flex justify-content-start align-items-center w-100 text-light related-filter-row",children:[e.jsx(Y,{variant:"link",size:"sm",className:"py-0 mx-0 title text-light text-wrap",title:h,onClick:()=>R(r),disabled:C,children:r}),e.jsxs(Te,{pill:!0,bg:"secondary",className:`text-light ${u===0?"d-none":"d-inline"}`,children:[u,u===1?" usage":" usages"]}),e.jsx("span",{className:"small ms-1",children:Ft(c.time)}),x]});return e.jsx(oe.Item,{className:"py-0 px-0",as:"li",children:D},r)},Wt=({relatedFilters:t})=>{const{globalState:r}=je(),{variant:u}=r,{state:o}=B(),c=async n=>{console.log("RelatedFilters unAssignFilter",{relatedFilter:n})};return e.jsx("div",{className:"mx-0 my-1 border rounded-2 px-1 py-1border-light fs-6 related-filters",children:e.jsxs("div",{children:[e.jsx("label",{className:"text-muted",children:"Most frequently selected Filters (for the next Question in ChatBot)"}),t.length>0?e.jsx(oe,{as:"ul",variant:u,className:"my-1",children:t.map(n=>e.jsx(Yt,{relatedFilter:n,unAssignFilter:c},n.filter))}):e.jsx("div",{className:"border text-light",children:"No filters"}),o.error&&e.jsx("div",{children:"state.error"})]})})},De=({question:t,submitForm:r,children:u,showCloseButton:o,source:c=0,closeModal:n})=>{const{state:p,onQuestionTitleChanged:h}=B();let{formMode:C,topRows:R}=p;const i=E.lazy(()=>Nt(()=>import("./AssignedAnswers-D2_ezA7r.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8])).then(j=>({default:j.default}))),x=C===f.ViewingQuestion,D=C===f.EditingQuestion,N=C===f.AddingQuestion,O=x,{topId:P,id:A,assignedAnswers:$,relatedFilters:T,title:Q}=t,U=new Ce(t).questionKey,v=be(),K=()=>{n?n():v({type:s.CLOSE_QUESTION_FORM,payload:{question:t}})},k=()=>{n?n():v({type:s.CANCEL_QUESTION_FORM,payload:{question:t}})},[b,L]=E.useState(A+"/"+Q),M=Ve(b,500),[q]=E.useState(R.find(j=>j.id===P)),Z=E.useRef(null),S=Ke({enableReinitialize:!0,initialValues:t,validationSchema:ze().shape({title:Ne().required("Required"),parentId:Ne().required("Required").notOneOf(["000000000000000000000000"])}),onSubmit:j=>{r(j),L(j.id+"/"+j.title)}});E.useEffect(()=>{(async()=>{const F=M.split("/"),H=F[0];if(S.values.id===H){console.log("QuestionForm.useEffect - onQuestioTitleChanged",{debouncedSearchTerm:M,searchTerm:b,title:S.values.title});const X=F[1];await h(q,S.values,X)}})()},[M,S.values,h,b,q]),E.useEffect(()=>{Z.current.focus(),c!==0&&S.setFieldValue("source",c)},[S,Z,c]);const z=j=>{S.handleChange(j);const F=j.target.value;L(A+"/"+F)},se=j=>{S.setFieldValue("parentId",j.id),S.setFieldValue("categoryTitle",j.title)};return console.log("@@@@@@@@@@@@@@@@@@@@@ QuestionForm.render: ",{searchTerm:b,qTitle:Q,debouncedSearchTerm:M}),e.jsxs("div",{className:"form-wrapper px-3 py-1 my-0 my-1 w-100 question-form",children:[o&&e.jsx(Me,{onClick:K,className:"float-end"}),e.jsx(Ee,{className:"text-center",children:e.jsxs(I.Label,{children:["Question  ",x?"Viewing":D?"Editing":"Adding"]})}),e.jsxs(I,{onSubmit:S.handleSubmit,children:[e.jsxs(Oe,{direction:"horizontal",gap:0,className:"border",children:[e.jsx("div",{className:"p-0",children:e.jsx(I.Label,{children:"Category:"})}),e.jsx("div",{className:"p-1",children:e.jsxs(I.Group,{controlId:"parentId",className:"category-select form-select-sm w-90",children:[e.jsxs(we,{children:[e.jsx(we.Toggle,{variant:"light",id:"dropdown-basic",className:"px-2 py-0 text-primary border",disabled:O,children:e.jsx("span",{className:"text-wrap me-1",children:S.values.categoryTitle})}),e.jsx(we.Menu,{className:"p-0 border",children:e.jsx(we.Item,{className:"p-0 m-0 rounded-3",children:e.jsx(et,{selId:S.values.parentId,categoryKey:null,level:1,setParentId:se})})})]}),e.jsx(I.Control,{as:"input",name:"parentId",onChange:S.handleChange,value:S.values.parentId?S.values.parentId:"",placeholder:"Category",className:"text-primary w-100",disabled:O,hidden:!0}),e.jsx(I.Text,{className:"text-danger",children:S.touched.parentId&&S.errors.parentId?e.jsx("div",{className:"text-danger",children:S.errors.parentId?"required":""}):null})]})})]}),e.jsxs(I.Group,{controlId:"title",children:[e.jsx(I.Label,{children:"Title"}),e.jsx(I.Control,{as:"textarea",name:"title",placeholder:S.values.title==="new Question"?"new Question":"question text",ref:Z,onChange:z,value:S.values.title,rows:3,className:"text-primary w-100",disabled:O}),e.jsx(I.Text,{className:"text-danger",children:S.touched.title&&S.errors.title?e.jsx("div",{className:"text-danger",children:S.errors.title}):null})]}),e.jsxs(Ee,{children:[e.jsx(pe,{children:e.jsxs(I.Group,{controlId:"source",children:[e.jsx(I.Label,{children:"Source"}),e.jsx(ve,{id:"source",name:"source",options:Qt,onChange:(j,F)=>{j.preventDefault(),S.setFieldValue("source",F)},value:S.values.source,disabled:O,classes:"text-primary"}),e.jsx(I.Text,{className:"text-danger",children:S.touched.source&&S.errors.source?e.jsx("div",{className:"text-danger",children:S.errors.source}):null})]})}),e.jsx(pe,{children:e.jsxs(I.Group,{controlId:"status",children:[e.jsx(I.Label,{children:"Status"}),e.jsx(ve,{id:"status",name:"status",options:At,onChange:(j,F)=>{j.preventDefault(),S.setFieldValue("status",F)},value:S.values.status,disabled:O,classes:"text-primary"}),e.jsx(I.Text,{className:"text-danger",children:S.touched.status&&S.errors.status?e.jsx("div",{className:"text-danger",children:S.errors.status}):null})]})})]}),(x||D)&&e.jsxs("div",{className:"my-1",children:[e.jsx(E.Suspense,{fallback:e.jsx("div",{children:"Loading..."}),children:e.jsx(i,{questionKey:U,questionTitle:b,assignedAnswers:$,isDisabled:O})}),e.jsx(Wt,{questionKey:U,questionTitle:b,relatedFilters:T}),e.jsx(Ye,{created:t.created,modified:t.modified,classes:"text-primary"})]}),(S.dirty&&D||N)&&e.jsx(We,{cancelForm:k,handleSubmit:S.handleSubmit,title:u}),p.error&&e.jsx("div",{className:"text-danger",children:p.error.message})]})]})},ke=({closeModal:t,showCloseButton:r,source:u,setError:o})=>{const{state:c,cancelAddQuestion:n,createQuestion:p}=B(),{activeQuestion:h}=c,C=h?h.topId:"",R=async()=>{await n()},i=async x=>{const D={...x,topId:C,created:{time:new Date,nickName:""},modified:void 0},N=await p(D,t!==void 0);N&&(N.message?o(N.message):t&&t())};return h?e.jsx(De,{question:h,showCloseButton:r??!0,source:u??0,closeModal:R,submitForm:i,children:"Create Question"}):null},tt=({})=>{const{state:t,updateQuestion:r}=B(),{activeQuestion:u}=t;if(!u)return null;if(!u)return e.jsx("div",{children:"Loading question to edit..."});const o=async c=>{const n={...c,created:void 0,modified:{time:new Date,nickName:""}},{parentId:p}=u,h=p!==n.parentId;await r(p,n,h)};return e.jsx(De,{question:u,showCloseButton:!0,source:0,submitForm:o,children:"Update Question"})},ot=({inLine:t})=>{console.log(t?"ViewQuestion inLine":"ViewQuestion not inLine");const{state:r}=B(),{activeQuestion:u}=r,[o,c]=E.useState(null);return E.useEffect(()=>{console.log("#################################### ViewQuestion setQuestion ...",{activeQuestion:u}),c(u)},[u]),e.jsx(De,{question:o,showCloseButton:!0,source:0,submitForm:()=>{},children:"View Question"})},Ht=({questionRow:t,isSelected:r})=>{const{id:u,topId:o,parentId:c,title:n,numOfAssignedAnswers:p}=t,h={topId:o,parentId:c,id:c},{canEdit:C,authUser:R}=ae(),{state:i,viewQuestion:x,addQuestion:D,editQuestion:N,deleteQuestion:O}=B(),{activeQuestion:P,formMode:A,loadingQuestion:$,questionLoaded:T}=i,Q=P!==null&&P.id===u,U=A===f.AddingQuestion,v=()=>{t.modified={time:new Date,nickName:R.nickName},O(t,Q)},K=async M=>{console.log("QuestionRow onSelectQuestion",{id:M}),C?await N(t):await x(t)},[k,b]=Re();E.useEffect(()=>{(async()=>{if(r&&!$&&!T){switch(A){case f.ViewingQuestion:await x(t);break;case f.EditingQuestion:console.log("Zovem from QuestionRow"),C?await N(t):await x(t);break}document.getElementById(`QuestionRow${u}`)?.scrollIntoView({behavior:"smooth",block:"end"})}})()},[C,N,A,u,r,$,T,t,x]);const L=e.jsxs("div",{id:`QuestionRow${u}`,className:`d-relative d-flex justify-content-start align-items-center w-100 mt-0 question-row${r?"-selected":""}`,style:{marginTop:"1px"},children:[e.jsx(Y,{variant:"link",size:"sm",className:"d-flex align-items-center px-1 text-secondary",children:e.jsx("img",{width:"22",height:"18",src:vt,alt:"Question"})}),e.jsx(Y,{variant:"link",size:"sm",className:`p-0 px-1 m-1 ms-0 question-row-title ${Q?"fw-bold":""}`,title:`id:${u.toString()}`,onClick:()=>K(u),disabled:U,children:n}),e.jsxs(Te,{pill:!0,bg:"secondary",className:`text-info ${p===0?"d-none":"d-inline"}`,children:[p,"a"]}),C&&!U&&b&&e.jsxs("div",{className:"position-absolute text-nowrap d-flex align-items-center border border-0 border-warning p-0 end-0",children:[e.jsx(Y,{variant:"link",size:"sm",className:"ms-1 p-0 text-secondary d-flex align-items-center",title:"Add Question",onClick:()=>{D(h,!0)},children:e.jsx("img",{width:"22",height:"18",src:He,alt:"Add Question"})}),e.jsx(Y,{variant:"link",size:"sm",className:"ms-0 p-0 text-secondary",onClick:v,children:e.jsx(le,{icon:Qe,size:"lg"})})]})]});return e.jsxs(oe.Item,{className:"py-0 px-0 w-100",as:"li",children:[r&&A===f.AddingQuestion&&e.jsxs(e.Fragment,{children:[e.jsx("div",{id:"div-question",className:"ms-0 d-md-none w-100",children:e.jsx(ke,{showCloseButton:!0,source:0})}),e.jsx("div",{ref:k,className:"d-none d-md-block  border rounded-3",children:L})]}),r&&A===f.EditingQuestion&&e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:k,className:"",children:L}),e.jsx("div",{id:"div-question",className:"ms-0 d-md-none w-100",children:e.jsx(tt,{inLine:!0})})]}),r&&A===f.ViewingQuestion&&e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:k,className:"",children:L}),e.jsx("div",{ref:k,id:"div-question",className:"ms-0 d-md-none w-100",children:e.jsx(ot,{inLine:!0})})]}),!r&&e.jsx("div",{ref:k,className:"",children:L})]})},st=({categoryRow:t})=>{const{state:r,loadCategoryQuestions:u}=B(),{keyExpanded:o,loadingQuestion:c,error:n,selectedQuestionId:p}=r,{questionId:h}=o;t.level+=1;const{questionRows:C}=t;let R=!1;async function i(){try{const N={categoryKey:new ie(t).categoryKey,startCursor:C.length,includeQuestionId:h??null};console.log("^^^^^^^^^^^^^ loadMore"),console.log("^^^^^^^^^^^^^",{x:N}),console.log("^^^^^^^^^^^^^ loadMore"),await u(N)}catch{}}const[x,{rootRef:D}]=bt({loading:c,hasNextPage:R,onLoadMore:i,disabled:!!n,rootMargin:"0px 0px 100px 0px"});return e.jsxs("div",{ref:D,className:"ms-0",style:{maxHeight:"400px",overflowY:"auto"},children:[e.jsxs(Dt,{children:[C.length===0&&e.jsx("label",{children:"No questions"}),C.map(N=>e.jsx(Ht,{questionRow:N,isSelected:N.id===p},N.id)),R]}),n&&e.jsxs("p",{children:["Error: ",n.message]})]})},Xt=({categoryKey:t,tag:r,categoryInAdding:u})=>{const{name:o}=r,{canEdit:c}=ae(),{state:n,deleteCategoryVariation:p}=B(),h=()=>{p(t,o)},[C,R]=Re(),i=e.jsxs("div",{ref:C,children:[e.jsx(Te,{pill:!0,bg:"secondary",children:o}),c&&!0&&R&&e.jsx(Y,{variant:"link",size:"sm",className:"ms-0 py-0 mx-0 text-secondary",onClick:h,children:e.jsx(le,{icon:Qe,size:"sm"})}),!1]});return e.jsx("div",{className:"py-1 px-1",children:i})},Jt=({categoryKey:t,variations:r})=>{const{state:u}=B(),{error:o}=u;return E.useEffect(()=>{},[]),e.jsxs("div",{className:"ms-2",children:[e.jsxs(Oe,{direction:"horizontal",gap:2,children:[r.length===0&&e.jsx("div",{children:"No variations"}),r.length>0&&r.map(c=>e.jsx(Xt,{categoryKey:t,tag:c,categoryInAdding:void 0}))]}),o&&e.jsxs("p",{children:["Error: ",o.message]})]})},Le=({formMode:t,category:r,submitForm:u,children:o})=>{const{onCategoryTitleChanged:c}=B(),n=t===f.ViewingCategory,p=t===f.EditingCategory,h=t===f.AddingCategory,{topId:C,id:R,variations:i,questionRows:x,title:D}=r;console.log("CategoryForm render: ",{topId:C,id:R,catTitle:D,formMode:t,variations:i});const N=new ie(r).categoryKey;document.getElementById("div-details");const O=x&&x.length>0,P=be(),A=()=>{P({type:s.CLOSE_CATEGORY_FORM,payload:{}})},$=()=>{P({type:s.CANCEL_CATEGORY_FORM,payload:{}})},[T,Q]=E.useState(D),U=Ve(T,300),v=Ke({enableReinitialize:!0,initialValues:r,validationSchema:ze().shape({title:Ne().required("Required")}),onSubmit:L=>{console.log("CategoryForm.onSubmit",JSON.stringify(L,null,2)),u(L),Q(L.title)}});E.useEffect(()=>{(async()=>U&&v.values.title!==U&&console.log("CategoryForm.useEffect - onCategoryTitleChanged zvao Bi",{debouncedSearchTerm:U,title:v.values.title}))()},[U,v.values.title,c]);const K=L=>{v.handleChange(L);const M=L.target.value;Q(M)},k=E.useRef(null);E.useEffect(()=>{k.current.focus()},[r.title,k]);const b=!1;return console.log("CategoryForm render return: ",T),e.jsxs("div",{className:"form-wrapper p-2 category-form",children:[e.jsx(Me,{onClick:A,className:"float-end"}),e.jsx(Ee,{className:"text-center text-muted",children:e.jsxs(I.Label,{children:["Category ",n?"Viewing":p?"Editing":"Adding"]})}),e.jsxs(I,{onSubmit:()=>v.handleSubmit,children:[e.jsx(I.Group,{controlId:"Variations",children:e.jsxs(Oe,{direction:"horizontal",gap:1,children:[e.jsx("div",{className:"px-0",children:e.jsx(I.Label,{children:"Variations:"})}),e.jsx("div",{className:"px-1 border border-1 border-secondary rounded",children:e.jsx(Jt,{categoryKey:N,variations:i?i.map(L=>({name:L})):[]})}),e.jsx("div",{className:"ps-2",children:e.jsx(I.Label,{children:"Kind:"})}),e.jsx("div",{className:"px-1 border border-1 border-secondary rounded",children:e.jsxs(I.Group,{controlId:"kind",children:[e.jsx(ve,{id:"kind",name:"kind",options:kt,onChange:(L,M)=>{L.preventDefault(),v.setFieldValue("kind",M)},value:v.values.kind,disabled:b,classes:"text-primary"}),e.jsx(I.Text,{className:"text-danger",children:v.touched.kind&&v.errors.kind?e.jsx("div",{className:"text-danger",children:v.errors.kind}):null})]})})]})}),e.jsxs(I.Group,{controlId:"title",children:[e.jsx(I.Label,{children:"Title"}),e.jsx(I.Control,{as:"textarea",name:"title",placeholder:v.values.title==="new Category"?"new Category":"category text",value:T,onChange:K,ref:k,rows:3,className:"text-primary w-100",disabled:n}),e.jsx(I.Text,{className:"text-danger",children:v.touched.title&&v.errors.title?e.jsx("div",{className:"text-danger",children:v.errors.title}):null})]}),e.jsxs(I.Group,{controlId:"link",children:[e.jsx(I.Label,{children:"Link"}),v.values.hasSubCategories?e.jsx(I.Control,{as:"input",placeholder:"/categories/...",name:"link",onChange:v.handleChange,className:"text-primary w-100",value:"Can't have link (has sub categories)",disabled:!0}):e.jsxs(e.Fragment,{children:[e.jsx(I.Control,{as:"input",placeholder:"/categories/...",name:"link",onChange:v.handleChange,className:"text-primary w-100",value:v.values.link??"",disabled:n}),e.jsx(I.Text,{className:"text-danger",children:v.touched.link&&v.errors.link?e.jsx("div",{className:"text-danger",children:v.errors.link}):null})]})]}),e.jsxs(I.Group,{children:[e.jsxs(I.Label,{className:"m-1 mb-0",children:["Questions (",`${v.values.numOfQuestions}`,") "]}),O&&e.jsx(st,{categoryRow:r})]}),(n||p)&&e.jsx(Ye,{created:r.created,modified:r.modified,classes:"text-primary"}),(v.dirty&&p||h)&&e.jsx(We,{cancelForm:$,handleSubmit:v.handleSubmit,title:o})]})]})},nt=({inLine:t})=>{const r=ae(),{nickName:u}=r.authUser,{state:o,updateCategory:c}=B(),{activeCategory:n,keyExpanded:p}=o,{questionId:h}=p,C=async R=>{const i={...R,created:void 0,modified:{time:new Date,nickName:u}};await c(i,!0)};return e.jsx(Le,{inLine:t,category:{...n},questionId:h,formMode:f.EditingCategory,submitForm:C,children:"Update Category"})},at=({inLine:t})=>{const{state:r}=B(),{activeCategory:u,keyExpanded:o}=r,{questionId:c}=o;return e.jsx(Le,{inLine:t,category:{...u},questionId:c,formMode:f.ViewingCategory,submitForm:()=>{},children:"View Category"})},rt=({activeCategory:t})=>{const r=ae(),{nickName:u}=r.authUser,{createCategory:o}=B(),[c]=E.useState({...t}),n=async p=>{const h={...p,created:{time:new Date,nickName:u},modified:void 0};console.log("**********object",h),await o(h)};return!t===null?null:(console.log("AddCategory render >>>>>:",t),e.jsx(e.Fragment,{children:e.jsx(Le,{inLine:!1,category:c,questionId:null,formMode:f.AddingCategory,submitForm:n,children:"Create Category"})}))},Zt=({categoryRow:t,questionId:r})=>{const{id:u,title:o,hasSubCategories:c,numOfQuestions:n,isExpanded:p,categoryRows:h}=t;t.level+=1;const C=new ie(t).categoryKey,{canEdit:R,authUser:i}=ae(),{state:x,addSubCategory:D,viewCategory:N,editCategory:O,deleteCategory:P,expandCategory:A,collapseCategory:$,addQuestion:T}=B();let{formMode:Q,activeCategory:U,loadingCategory:v,categoryLoaded:K}=x;const k=U!==null&&U.id===u,b=Q===f.AddingCategory,L=p&&n>0,M=()=>{t.modified={time:new Date,nickName:i.nickName},P(t)},q=async()=>{p?await $(t):await A({categoryKey:C})},[Z,S]=E.useState(!1);E.useEffect(()=>{S(!0)},[h]);const z=async()=>{R?await O(t,r??"null"):await N(t,r??"null")},[se,j]=E.useState(!1);E.useEffect(()=>{se&&(!p&&(c||n>0)&&q(),D(t),j(!1))},[D,t,se]);const[F,H]=E.useState(!1);E.useEffect(()=>{F&&(T(C,p??!1),H(!1))},[T,C,p,F]),E.useEffect(()=>{(async()=>{if(k&&!v&&!K&&!b)switch(console.log("CategoryRow formMode:",Q),Q){case f.ViewingCategory:await N(t,r??"null");break;case f.EditingCategory:R?await O(t,r??"null"):await N(t,r??"null");break}})()},[R,C,K,t,O,A,Q,b,k,v,r,N]);const[X,ne]=Re(),de=e.jsxs("div",{children:[e.jsxs("div",{id:`Row${u}`,className:`d-relative d-flex justify-content-start align-items-center w-100 mt-1 category-row${k?"-selected":""}`,style:{marginTop:"1px"},children:[e.jsx(Y,{variant:"link",size:"sm",className:"py-0 px-1","aria-controls":u+"-2","aria-expanded":Z,onClick:re=>{q(),re.stopPropagation()},title:"Expand",disabled:b||!c&&n===0,children:e.jsx(le,{icon:p?Be:$e,size:"lg"})}),e.jsx(Y,{variant:"link",size:"sm",className:"py-0 px-1 bg-light",title:"Expand",disabled:!0,children:e.jsx(le,{icon:Lt,size:"sm"})}),e.jsx(Y,{variant:"link",size:"sm",className:`py-0 ms-0 me-1 category-row-title ${k?"fw-bold text-white bg-transparent":""}`,title:u,onClick:z,disabled:b,children:o}),n>0&&e.jsxs(Te,{pill:!0,bg:"secondary",className:"d-inline bg-transparent",children:[n,"Q"]}),R&&ne&&e.jsxs("div",{className:"position-absolute text-nowrap d-flex align-items-center border border-0 border-warning p-0 end-0",children:[e.jsx("div",{className:"d-flex align-items-center",children:e.jsx(Y,{variant:"link",size:"sm",className:"border-0 py-0 px-0 ms-0 text-success",title:"Add SubCategory",onClick:async()=>{!p&&(c||n>0)&&await q(),setTimeout(()=>j(!0),500)},children:e.jsx(le,{icon:qt,size:"lg"})})}),!b&&!c&&e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(Y,{variant:"link",size:"sm",className:"p-0 mx-0 text-secondary d-flex align-items-center border border-0 border-warning1",title:"Add Question",onClick:async()=>{!p&&(c||n>0)&&await q(),setTimeout(()=>H(!0),500)},children:e.jsx("img",{width:"22",height:"18",src:He,alt:"Add Question"})}),e.jsx(Y,{variant:"link",size:"sm",className:"d-flex align-items-center border border-0 border-warning p-0",disabled:c||n>0,onClick:M,children:e.jsx(le,{icon:Qe,size:"lg"})})]})]})]}),L&&e.jsx("div",{className:"ps-3",children:e.jsx(st,{categoryRow:t})})]});return e.jsxs(e.Fragment,{children:[e.jsxs(oe.Item,{className:"py-0 px-1 w-100 category-bg",as:"li",children:[k&&Q===f.AddingCategory&&e.jsxs("div",{children:[e.jsx("div",{ref:X,className:"",children:de}),e.jsx("div",{className:"ms-0 d-md-none w-100",children:e.jsx(rt,{activeCategory:U})})]}),k&&Q===f.EditingCategory&&e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:X,children:de}),e.jsx("div",{id:"divInLine",className:"ms-0 d-md-none w-100",children:e.jsx(nt,{inLine:!1})})]}),k&&Q===f.ViewingCategory&&e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:X,children:de}),e.jsx("div",{id:"divInLine",className:"ms-0 d-md-none w-100",children:e.jsx(at,{inLine:!1})})]}),!k&&e.jsx("div",{ref:X,children:de})]}),x.error&&x.whichRowId===u&&e.jsx("div",{className:"text-danger",children:x.error.message}),p&&e.jsx(oe.Item,{className:"py-0 px-0 border-0 border-warning border-bottom-0 category-bg p-0 m-0",variant:"primary",as:"li",children:e.jsx("div",{className:"rambo",children:c&&e.jsx(It,{in:Z,children:e.jsx("div",{id:u+"-2",style:{marginTop:"1px"},children:e.jsx("div",{style:{border:"1px solid #ddd",borderRadius:"4px"},children:e.jsx(it,{categoryRow:t,isExpanded:p})})})})})})]})},it=({categoryRow:t})=>{const{level:r,categoryRows:u}=t,{state:o}=B();let{keyExpanded:c}=o;const{questionId:n}=c??{questionId:null};return e.jsx("div",{className:r>1?"ms-2":"",children:e.jsx(oe,{as:"ul",variant:"dark",className:"mb-0 category-bg",children:u.map(p=>e.jsx(Zt,{categoryRow:p,questionId:n===""?null:n},p.id))})})},eo=t=>{const{isDarkMode:r}=ae(),[u,o]=E.useState("");return E.useEffect(()=>{},[]),e.jsxs(he,{show:t.show,onHide:t.onHide,animation:!0,centered:!0,size:"lg",className:"modal show",contentClassName:`${r?"bg-secondary bg-gradient":"bg-info bg-gradient"}`,children:[e.jsx(he.Header,{closeButton:!0,children:"Store new Question to the Database"}),e.jsx(he.Body,{className:"py-0",children:e.jsx(ke,{closeModal:t.onHide,showCloseButton:!1,source:1,setError:c=>o(c)})}),e.jsx(he.Footer,{children:u})]})},to=({categoryId_questionId:t,fromChatBotDlg:r})=>{const{state:u,expandNodesUpToTheTree:o,loadTopRows:c,addSubCategory:n}=B(),{allCategoryRows:p,topRows:h,topRowsLoading:C,topRowsLoaded:R,keyExpanded:i,categoryId_questionId_done:x,nodeOpening:D,nodeOpened:N,activeCategory:O,activeQuestion:P,formMode:A,loadingCategories:$,loadingCategory:T,loadingQuestions:Q,loadingQuestion:U}=u,{searchQuestions:v,setLastRouteVisited:K,setChatBotDlgEnabled:k}=je(),{isDarkMode:b,chatBotDlgEnabled:L}=ae(),[M,q]=E.useState(!1),[Z,S]=E.useState({...Ie}),z=be(),se=async F=>{z({type:s.SET_QUESTION_SELECTED,payload:{questionKey:F}})};let j="";return E.useEffect(()=>{(async()=>!C&&!R&&(console.log("ZOVEM 111 loadTopRows()"),await c()))()},[C,R,c,r]),E.useEffect(()=>{(async()=>{if(!D&&R&&h.length>0){if(t){if(t==="add_question"){const F=localStorage.getItem("New_Question");if(F){const H=JSON.parse(F);return S({...Ie,categoryTitle:"Select",...H}),q(!0),localStorage.removeItem("New_Question"),null}}else if(t!==x){const F=t.split("_"),H=F[0],X=F[1],ne={topId:"",id:H,parentId:"ROOT"};console.log("zovem expandNodesUpToTheTree 1111111111111111111)",{categoryId_questionId:t},{categoryId_questionId_done:x}),await o(ne,X!=="null"?X:null,r==="from_chat"),console.log("zavrsio expandNodeUpToTheTree 1111111111111111111 DONE)",{categoryId_questionId:t})}}else if(i&&!N){const{topId:F,categoryId:H,questionId:X}=i;if(H!==""){const ne={topId:F,id:H,parentId:"ROOT"};console.log("zovem expandNodeUpToTheTree 2222222222222)",{keyExpanded:i,catKey:ne}),await o(ne,X),console.log("zavrsio expandNodeUpToTheTree 2222222222222 DONE)")}}L||k()}})()},[t,x,R,i,D,N,o,r,L,k]),E.useEffect(()=>{},[K]),t!=="add_question"&&t&&t!==x?(console.log("zzzzzz loading...",{keyExpanded:i,categoryId_questionId:t,categoryId_questionId_done:x}),e.jsx("div",{children:"loading..."})):R?(console.log("===>>> Categories !!!!!!!!!!!!!!!!!",O),e.jsxs(e.Fragment,{children:[e.jsxs(Ot,{children:[e.jsxs("h5",{className:"text-warning mx-auto w-75 fw-bold",children:[e.jsx("span",{className:"categories",children:"Categories / "}),e.jsx("span",{className:"questions",children:"Questions"})]}),e.jsx(Ee,{className:`${b?"dark":""}`,children:e.jsx(pe,{children:e.jsx("div",{className:"d-flex justify-content-start align-items-center",children:e.jsx("div",{className:"w-75 my-1 questions",children:e.jsx(Pt,{tekst:j,onSelectQuestion:se,allCategoryRows:p,searchQuestions:v})})})})}),e.jsx(Y,{variant:"secondary",size:"sm",type:"button",style:{padding:"1px 4px"},onClick:()=>n(null),children:"Add Category"}),e.jsxs(Ee,{className:"my-1 h-auto",children:[e.jsx(pe,{xs:12,md:5,children:e.jsx("div",{className:"categories-border",style:{position:"relative"},children:e.jsx(it,{categoryRow:{...Ae,categoryRows:h},isExpanded:!0})})}),e.jsx(pe,{xs:0,md:7,children:e.jsxs("div",{id:"div-details",className:"d-none d-md-block",children:[O&&A===f.ViewingCategory&&e.jsx(at,{inLine:!1}),O&&A===f.EditingCategory&&e.jsx(nt,{inLine:!1}),O&&A===f.AddingCategory&&e.jsx(rt,{activeCategory:O}),P&&A===f.ViewingQuestion&&e.jsx(ot,{inLine:!1}),P&&A===f.EditingQuestion&&e.jsx(tt,{inLine:!1}),P&&A===f.AddingQuestion&&e.jsx(ke,{})]})})]})]}),M&&P&&e.jsx(eo,{show:M,onHide:()=>{q(!1)},newQuestionRow:Z}),($||Q)&&e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{position:"absolute",top:"40%",left:"20%"},children:e.jsx("div",{className:`spinner-border ${Q?"question":"category"}-spinner`,role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})}),T&&e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{position:"absolute",top:"50%",left:"50%"},children:e.jsx("div",{className:"spinner-border category-spinner",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})}),U&&e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{position:"absolute",top:"50%",left:"50%"},children:e.jsx("div",{className:"spinner-border question-spinner",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})})]})):(console.log("===>>> Categories  VRATIO"),null)},oo=()=>{let{categoryId_questionId:t,fromChatBotDlg:r}=jt();if(t&&t==="categories"&&(t=void 0),t){const u=t.split("_");console.assert(u.length===2,"expected 'categoryId_questionId'")}return e.jsx($t,{children:e.jsx(to,{categoryId_questionId:t,fromChatBotDlg:r})})},io=Object.freeze(Object.defineProperty({__proto__:null,default:oo},Symbol.toStringTag,{value:"Module"}));export{io as C,B as u};
//# sourceMappingURL=Categories-CKhh5Guy.js.map
