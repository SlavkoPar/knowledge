const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AssignedAnswers-DJmdaNaJ.js","assets/index-CUqi-i3V.js","assets/index-CykrPP6v.css","assets/Options-EXGgihB2.js","assets/lib-BnBEcQwU.js","assets/AutoSuggestAnswers-Cn-T_wZA.js","assets/AutoSuggestAnswers-vl2QUoNQ.css","assets/AutoSuggestQuestions-By6q447N.js","assets/AutoSuggestQuestions-DN6HBK-e.css"])))=>i.map(i=>d[i]);
import{A as s,d as Ct,a as Rt,b as Tt,F as m,I as xe,u as Ae,c as re,r as E,C as Ne,e as he,f as le,g as Pe,h as St,Q as Ue,i as ye,j as _t,k as Te,l as Nt,m as jt,n as e,B as Y,_ as vt,o as Me,R as Ee,D as Ce,p as pe,q as Ot,s as It,t as At,v as Qt}from"./index-CUqi-i3V.js";import{L as ne,F as de,f as $e,a as Ve,u as Se,B as _e,b as Ke,c as ze,d as Ye,e as je,g as O,S as Qe,h as ve,s as bt,i as Dt,C as Be,j as We,Q as He,k as be,l as kt,m as Lt,n as qt,o as Gt,p as Ft,M as Re}from"./Options-EXGgihB2.js";import{f as Pt,a as Ut}from"./lib-BnBEcQwU.js";import{A as Mt}from"./AutoSuggestQuestions-By6q447N.js";const Oe={topId:"",parentId:"null",id:"generateId",categoryTitle:"",title:"",assignedAnswers:[],numOfAssignedAnswers:0,relatedFilters:[],numOfRelatedFilters:0,source:0,status:0,included:!1},Xe={topId:"null",parentId:"null",id:"define at BackEnd",kind:0,title:"",link:"",header:"",level:0,variations:[],hasSubCategories:!1,categoryRows:[],questionRows:[],numOfQuestions:0,hasMoreQuestions:!1,isExpanded:!1,doc1:""},$t=(t,i)=>{console.log("------------------------------->"),console.log("------------------------------->",i.type),console.log("------------------------------->");const{categoryRow:g}=i.payload;if(i.type===s.SET_KEY_EXPANDED){const{keyExpanded:l}=i.payload;return{...t,keyExpanded:l,nodeOpened:l===null?!0:t.nodeOpened}}let a=g?!Ct.includes(i.type):!1;const{topRows:r}=t,u=Rt.includes(i.type)?{...t}:Vt(t,i);if(a&&g){let l;const{topId:x,id:T}=g;if(T===x)l=r.map(R=>R.id===x?new Z(g).categoryRow:new Z(R).categoryRow);else{const R=r.find(o=>o.id===x);Z.idToSet=i.type==="SET_CATEGORY_ADDED"?"generateId":T,Z.newCategoryRow=g;const N=new Z(R).categoryRow;l=r.map(o=>o.id===x?N:new Z(o).categoryRow),Z.idToSet=""}u.topRows=l}if(Tt.includes(i.type)){const{keyExpanded:l}=u,x={keyExpanded:l};localStorage.setItem("CATEGORIES_STATE",JSON.stringify(x))}return console.log("CategoryReducer newState",u),u},Vt=(t,i)=>{switch(i.type){case s.SET_TOP_ROWS_LOADING:return{...t,loadingCategories:!0,topRowsLoading:!0,topRowsLoaded:!1};case s.SET_TOP_ROWS:{const{topRows:a}=i.payload;return console.log("=> CategoriesReducer ActionTypes.SET_TOP_ROWS",t.topRows,a),{...t,topRows:a,topRowsLoading:!1,topRowsLoaded:!0,loadingCategories:!1}}case s.SET_ALL_CATEGORY_ROWS:{const{allCategoryRows:a}=i.payload;return{...t,allCategoryRows:a,allCategoryRowsLoaded:Date.now()}}case s.SET_ALL_GROUP_ROWS:{const{allGroupRows:a}=i.payload;return{...t,allGroupRows:a,allGroupRowsLoaded:Date.now()}}case s.SET_NODE_EXPANDING_UP_THE_TREE:{const{categoryId_questionId_done:a}=i.payload;return{...t,categoryId_questionId_done:a,nodeOpening:!0,loadingCategories:!0,nodeOpened:!1,activeCategory:null,activeQuestion:null}}case s.SET_NODE_EXPANDED_UP_THE_TREE:{const{category:a,questionId:r,question:u,formMode:l}=i.payload;return{...t,activeCategory:a,activeQuestion:u,selectedQuestionId:r,formMode:l,nodeOpening:!1,nodeOpened:!0,loadingCategories:!1}}case s.SET_LOADING_CATEGORY:return{...t,loadingCategory:!0,categoryLoaded:!1};case s.FORCE_OPEN_NODE:const{keyExpanded:g}=i.payload;return alert("FORCE_OPEN_NODE is deprecated, use SET_QUESTION_SELECTED instead"),{...t,topRows:t.topRows.filter(a=>a.parentId===null),keyExpanded:g,nodeOpened:!1,activeCategory:null,activeQuestion:null,selectedQuestionId:null};case s.SET_SUB_CATEGORIES:return{...t,loadingCategory:!1};case s.SET_ERROR:{const{error:a,whichRowId:r}=i.payload;return{...t,error:a,whichRowId:r,loadingCategories:!1,loadingQuestions:!1,loadingCategory:!1,categoryLoaded:!1,loadingQuestion:!1,questionLoaded:!1}}case s.SET_CATEGORY:{const{categoryRow:a}=i.payload;return console.assert(xe(a)),{...t,loadingCategory:!1,categoryLoaded:!0,activeCategory:a,activeQuestion:null,selectedQuestionId:null}}case s.SET_ROW_EXPANDING:return{...t,rowExpanding:!0,rowExpanded:!1,loadingCategories:!0};case s.SET_ROW_EXPANDED:{const{categoryRow:a}=i.payload,{topId:r,id:u}=a,{keyExpanded:l}=t,x=l?l.questionId:null;return{...t,loadingCategories:!1,keyExpanded:{topId:r,categoryId:u,questionId:x},activeQuestion:null,selectedQuestionId:x,loadingQuestion:!1,questionLoaded:!1,rowExpanding:!1,rowExpanded:!0}}case s.SET_ROW_COLLAPSED:{const{categoryRow:a}=i.payload,{topId:r,parentId:u}=a;return{...t,loadingCategories:!1,keyExpanded:{topId:r,categoryId:u??"",questionId:null},rowExpanding:!1,rowExpanded:!0,activeCategory:null,activeQuestion:null,selectedQuestionId:null}}case s.SET_CATEGORY_TO_VIEW:{const{categoryRow:a}=i.payload;console.assert(xe(a));const u={...a,isExpanded:!1};return{...t,formMode:m.ViewingCategory,loadingCategory:!1,activeCategory:u,activeQuestion:null,selectedQuestionId:null,error:void 0}}case s.SET_CATEGORY_TO_ADD_TOP:{const{newCategoryRow:a}=i.payload;return{...t,loadingCategory:!1,categoryLoaded:!0,activeCategory:{...a,doc1:""},activeQuestion:null,selectedQuestionId:null,topRows:[a,...t.topRows],formMode:m.AddingCategory}}case s.SET_CATEGORY_TO_ADD:{const{newCategoryRow:a}=i.payload;return{...t,loadingCategory:!1,categoryLoaded:!0,activeCategory:{...a,doc1:""},activeQuestion:null,selectedQuestionId:null,formMode:m.AddingCategory}}case s.SET_CATEGORY_ADDED:{const{categoryRow:a}=i.payload;console.assert(xe(a));const u={...a,isExpanded:!1},{topId:l,id:x}=u;return{...t,formMode:m.EditingCategory,loadingCategory:!1,categoryLoaded:!1,activeCategory:u,activeQuestion:null,selectedQuestionId:null,keyExpanded:{topId:l,categoryId:x,questionId:null}}}case s.SET_CATEGORY_TO_EDIT:case s.SET_CATEGORY_UPDATED:{const{categoryRow:a,category:r}=i.payload;console.assert(xe(a));const{topId:u,id:l}=r;return{...t,formMode:m.EditingCategory,loadingCategory:!1,categoryLoaded:!0,keyExpanded:{topId:u,categoryId:l,questionId:null},activeCategory:r,activeQuestion:null,selectedQuestionId:null,error:void 0}}case s.SET_CATEGORY_QUESTIONS_LOADING:return{...t,loadingQuestions:!0,questionLoaded:!1};case s.CATEGORY_QUESTIONS_LOADED:return{...t,loadingQuestions:!1};case s.DELETE_CATEGORY:return{...t,activeCategory:null,formMode:m.None,error:void 0,whichRowId:void 0};case s.CANCEL_CATEGORY_FORM:case s.CLOSE_CATEGORY_FORM:return{...t,activeCategory:null,formMode:m.None};case s.CANCEL_ADD_SUB_CATEGORY:return{...t,activeCategory:null,activeQuestion:null,selectedQuestionId:null,formMode:m.None};case s.SET_LOADING_QUESTION:return{...t,loadingQuestion:!0,questionLoaded:!1};case s.CANCEL_ADD_QUESTION:return{...t,formMode:m.None,activeQuestion:null,selectedQuestionId:null};case s.SET_QUESTION_SELECTED:{const{questionKey:a}=i.payload,{topId:r,parentId:u,id:l}=a;return{...t,topRows:t.topRows.filter(x=>x.parentId===null),keyExpanded:{topId:r,categoryId:u,questionId:l},activeCategory:null,activeQuestion:null,selectedQuestionId:null}}case s.ADD_NEW_QUESTION_TO_ROW:{const{newQuestionRow:a}=i.payload;return{...t,selectedQuestionId:a.id}}case s.SET_QUESTION:{const{question:a,formMode:r}=i.payload;return console.log(s.SET_QUESTION,a),{...t,activeCategory:null,activeQuestion:a,formMode:r,error:void 0,loadingCategory:!1,loadingQuestion:!1,questionLoaded:!0}}case s.SET_QUESTION_AFTER_ASSIGN_ANSWER:{const{question:a}=i.payload;return{...t,activeQuestion:a,loadingQuestion:!1,questionLoaded:!0}}case s.SET_QUESTION_TO_VIEW:{const{question:a}=i.payload,{keyExpanded:r}=t;return{...t,formMode:m.ViewingQuestion,keyExpanded:r,activeQuestion:a,loadingQuestion:!1,questionLoaded:!0}}case s.SET_QUESTION_TO_EDIT:{const{question:a}=i.payload,{topId:r,id:u,parentId:l}=a;return{...t,keyExpanded:{topId:r,categoryId:l,questionId:u},activeQuestion:a,formMode:m.EditingQuestion,selectedQuestionId:a.id,loadingQuestion:!1,questionLoaded:!0}}case s.QUESTION_DELETED:return{...t,activeQuestion:null,selectedQuestionId:null,formMode:m.None,loadingQuestion:!1,questionLoaded:!0};case s.CANCEL_QUESTION_FORM:case s.CLOSE_QUESTION_FORM:return{...t,formMode:m.None,activeQuestion:null,selectedQuestionId:null};default:return alert(`Action ${i.type} not allowed`),{...t}}};class Z{static idToSet;static newCategoryRow;constructor(i){const{topId:g,id:a,parentId:r,title:u,link:l,kind:x,header:T,level:R,variations:N,numOfQuestions:o,hasSubCategories:S,categoryRows:j,created:A,modified:F,questionRows:b,isExpanded:P}=i,M=j.map(C=>(console.log("DeepClone >>>>>>>>>>>>>>>",C.id),C.id===Z.idToSet?{...Z.newCategoryRow}:new Z(C).categoryRow));this.categoryRow={topId:g,parentId:r,id:a,kind:x,title:u,link:l,header:T,level:R,hasSubCategories:S,categoryRows:M,numOfQuestions:o,questionRows:b,variations:N??[],created:A,modified:F,isExpanded:P}}categoryRow}const Je=E.createContext({}),Ze=E.createContext(()=>null),Kt={formMode:m.None,allCategoryRows:new Map,allCategoryRowsLoaded:void 0,allGroupRows:new Map,allGroupRowsLoaded:void 0,topRows:[],topRowsLoading:!1,topRowsLoaded:!1,nodeOpening:!1,nodeOpened:!1,keyExpanded:null,categoryId_questionId_done:void 0,activeCategory:null,activeQuestion:null,selectedQuestionId:null,loadingCategories:!1,loadingQuestions:!1,loadingCategory:!1,categoryLoaded:!1,loadingQuestion:!1,questionLoaded:!1,error:void 0,rowExpanding:!1,rowExpanded:!1},zt=({children:t})=>{const{loadAllCategoryRowsGlobal:i,loadAllGroupRowsGlobal:g}=Ae(),a=re(),{KnowledgeAPI:r,isAuthenticated:u,workspace:l,authUser:x,canEdit:T}=a,{nickName:R}=x,[N,o]=E.useReducer($t,Kt),{formMode:S,activeCategory:j,activeQuestion:A,keyExpanded:F,topRows:b,allCategoryRows:P,allCategoryRowsLoaded:M}=N;console.log("----->>> ----->>> ----->>> CategoryProvider",b),E.useEffect(()=>{let d=l==="DEMO"?{topId:"MTS",categoryId:"REMOTECTRLS",questionId:"qqqqqq111"}:null;if("localStorage"in window){let n=localStorage.getItem("CATEGORIES_STATE");if(console.log("CATEGORIES_STATE from localStorage",n),n!==null){const p=JSON.parse(n);p.keyExpanded!==null&&(d=p.keyExpanded)}}o({type:s.SET_KEY_EXPANDED,payload:{keyExpanded:d}})},[l]);const C=E.useCallback(async(d,n,p=null,y=void 0)=>{const c=localStorage.getItem("accessToken");if(c)try{console.log("------Execute endpoint:",n);let f=null;const w=new Headers,_=`Bearer ${c}`;w.append("Authorization",_),p&&w.append("Content-Type","application/json");let q={method:d,headers:w,body:p?JSON.stringify(p):null};if(f=await fetch(n,q),f.ok){if(f.status===200||f.status===201){let B=null;try{B=await f.json()}catch{o({type:s.SET_ERROR,payload:{error:new Error(`Response status: ${f.status}`),whichRowId:y}})}finally{return B}}}else{const{errors:B}=await f.json(),X=new Error(B?.map(oe=>oe.message).join(`
`)??"unknown");o({type:s.SET_ERROR,payload:{error:X,whichRowId:y}})}}catch(f){console.log("-------------->>> execute",d,n,f),o({type:s.SET_ERROR,payload:{error:new Error("fetch eror"),whichRowId:y}})}return null},[]),L=E.useCallback(async()=>new Promise(async d=>{const n=await i();o(n?{type:s.SET_ALL_CATEGORY_ROWS,payload:{allCategoryRows:n}}:{type:s.SET_ERROR,payload:{error:new Error("Zajeb allCategoryRows")}}),d(n)}),[i]),v=E.useCallback(async()=>new Promise(async d=>{const n=await g();o(n?{type:s.SET_ALL_GROUP_ROWS,payload:{allGroupRows:n}}:{type:s.SET_ERROR,payload:{error:new Error("Zajeb allGroupRows")}}),d(n)}),[g]),K=E.useCallback(async d=>{try{return P.get(d)}catch(n){console.log(n),o({type:s.SET_ERROR,payload:{error:n}})}},[P]);E.useEffect(()=>{(async()=>await L())()},[L]);const k=E.useCallback(async d=>{try{let n="";const p=[];return P.forEach((y,c)=>{c===d?n="":y.parentId===d&&p.push(y)}),{subCats:p,parentHeader:n}}catch(n){return console.log(n),o({type:s.SET_ERROR,payload:{error:n}}),{subCats:[],parentHeader:"Kiks subCats"}}},[P]),G=E.useCallback(async()=>new Promise(async d=>{try{o({type:s.SET_TOP_ROWS_LOADING,payload:{}});const n=`${r.endpointCategoryRow}/${l}/toprows`;console.log("CategoryProvider loadTopRows url:",n),console.log("loadTopRows AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"),console.time(),await C("GET",n).then(p=>{console.timeEnd(),console.log("loadTopRows CCCCCCCCCCCCCCCCCCCC");const y=p.map(c=>(c.IsExpanded=F?c.Id===F.categoryId:!1,new Ne(c).categoryRow));o({type:s.SET_TOP_ROWS,payload:{topRows:y}}),d(!0)})}catch(n){console.log(n),o({type:s.SET_ERROR,payload:{error:n}})}}),[C,r.endpointCategoryRow,F,l]),Q=E.useCallback(async(d,n)=>{const{topId:p,id:y}=d;return console.log({categoryKey:d,includeQuestionId:n}),new Promise(async c=>{try{const f=`${r.endpointCategory}/${l}/${p}/${y}/${me}/${n}`;console.time(),console.log("================ getCategory ======================="),await C("GET",f).then(w=>{console.timeEnd();const{categoryDto:_,msg:q}=w;c(_?new he(_).category:new Error(q))})}catch(f){console.log(f),c(f)}})},[C,r.endpointCategory,l]),D=E.useCallback(async(d,n)=>{if(d.topId===n)return d;const{categoryRows:p}=d;let y=p.find(c=>c.id===n);if(!y)for(const c of p){const f=await D(c,n);if(f){y=f,console.log("findCategory Stop the loop for: "+n);break}}return y},[]),J=E.useCallback(async(d,n,p=!1)=>new Promise(async y=>{try{let{topId:c,parentId:f,id:w}=d;console.assert(w!==null,"id ne sme biti null u expandNodesUpToTheTree"),o({type:s.SET_NODE_EXPANDING_UP_THE_TREE,payload:{fromChatBotDlg:p,categoryId_questionId_done:`${w}_${n}`}}),console.time();const _={topId:c,id:w,parentId:null},q=new le(_).toQuery(l),B=`${r.endpointCategoryRow}?${q}&pageSize=${me}&includeQuestionId=${n??null}`;await C("GET",B).then(async X=>{const{categoryRowDto:oe}=X;if(console.timeEnd(),oe){let ce=null,ue=null;const we=new Ne(oe).categoryRow,ge=await D(we,w);if(f!==null&&(ce={...ge,doc1:""},n)){const Ge=ge.questionRows.find(Fe=>Fe.id===n&&Fe.included);Ge&&(ce=null,ue={...Ge,assignedAnswers:[],numOfAssignedAnswers:0,numOfRelatedFilters:0,relatedFilters:[],source:0,status:0})}console.log(">>> expandNodeUpToTheTree categoryRow",{categoryRow:ge,questionId:"'"+(n??"jok")+"'"+(n??"JOK")});const ht=n?T?m.EditingQuestion:m.ViewingQuestion:T?m.EditingCategory:m.ViewingCategory;o({type:s.SET_NODE_EXPANDED_UP_THE_TREE,payload:{catKey:d,categoryRow:we,category:ce,questionId:n??null,question:ue,formMode:ht,fromChatBotDlg:p}}),y(!0)}else y(!1)})}catch(c){console.log(c),o({type:s.SET_ERROR,payload:{error:c}})}}),[l,r.endpointCategoryRow,C,P,D,T]),W=E.useCallback(async(d,n=!1,p=null)=>{const y=new le(d).toQuery(l);return new Promise(async c=>{try{const f=`${r.endpointCategoryRow}/${n}/${me}/${p}?${y}`;console.time(),await C("GET",f).then(w=>{console.timeEnd();const{categoryRowDto:_,msg:q}=w;c(_?new Ne(_).categoryRow:new Error(q))})}catch(f){console.log(f),c(f)}})},[C,r.endpointCategoryRow,l]),h=E.useCallback(async({categoryKey:d,includeQuestionId:n,newQuestionRow:p,formMode:y})=>{try{o({type:s.SET_ROW_EXPANDING,payload:{}});const c=await W(d,!0,n);if(c instanceof Error)o({type:s.SET_ERROR,payload:{error:c}}),console.error({cat:c});else{let f;return n&&c.questionRows.filter(w=>w.included).length>0&&(f=n),p&&(c.questionRows=[p,...c.questionRows]),c.isExpanded=!0,console.log("@@@@@@@@@@@@@@@@@ expandCategory:",y,n),y===m.None&&n&&(y=T?m.EditingQuestion:m.ViewingQuestion),o({type:s.SET_ROW_EXPANDED,payload:{categoryRow:c,formMode:y,selectedQuestionId:f}}),c}}catch(c){return console.log("error",c),o({type:s.SET_ERROR,payload:{error:c}}),null}},[T,W]),ie=E.useCallback(async d=>{const{topId:n,id:p}=d,y=b.find(f=>f.id===n),c=await D(y,p);c?(d={...c,isExpanded:!1,categoryRows:[],questionRows:[]},o({type:s.SET_ROW_COLLAPSED,payload:{categoryRow:d}})):o({type:s.SET_ERROR,payload:{error:new Error("findCategory sranje"),whichRowId:p}})},[D,b]),ae=E.useCallback(async d=>{try{o({type:s.CLOSE_CATEGORY_FORM,payload:{}});const{topId:n,id:p,level:y}=d??{topId:"generateId",id:"generateId",level:0},c={...Xe,topId:n,parentId:d?p:null,id:"generateId",level:y+1,title:"New Category",isExpanded:!1};if(d===null)o({type:s.SET_CATEGORY_TO_ADD_TOP,payload:{newCategoryRow:c}});else{const f={...d,level:y+1,categoryRows:[c,...d.categoryRows],hasSubCategories:!0,isExpanded:!0};o({type:s.SET_CATEGORY_TO_ADD,payload:{categoryRow:f,newCategoryRow:{...c}}})}}catch(n){console.log("error",n),o({type:s.SET_ERROR,payload:{error:n}})}},[]),I=E.useCallback(async()=>{try{const d=j;d&&o({type:s.CANCEL_ADD_SUB_CATEGORY,payload:{categoryRow:d}})}catch(d){console.log("error",d),o({type:s.SET_ERROR,payload:{error:d}})}},[j,h]),z=E.useCallback(async d=>{const{id:n}=d;o({type:s.SET_LOADING_CATEGORY,payload:{}});try{const p=new Pe(d,l).categoryDto;console.log("categoryDto",{categoryDto:p});const y=`${r.endpointCategory}`;console.time(),await C("POST",y,p,n).then(async c=>{console.timeEnd();const{categoryDto:f}=c;if(f){const w=new he(f).category;console.log("Category successfully created",{category:w}),o({type:s.CLOSE_CATEGORY_FORM,payload:{}}),P.set(w.id,{...w,isExpanded:!1}),w.parentId===null?o({type:s.SET_CATEGORY_ADDED,payload:{categoryRow:w}}):o({type:s.SET_CATEGORY_ADDED,payload:{categoryRow:w}})}})}catch(p){console.log(p),o({type:s.SET_ERROR,payload:{error:new Error("Server Error"),whichRowId:n}})}},[C,r.endpointCategory,L,G,l]),$=E.useCallback(async()=>{try{const{topId:d,parentId:n}=A,y={categoryKey:{topId:d,parentId:n,id:n},formMode:m.None},c=await h(y);c&&o({type:s.CANCEL_ADD_QUESTION,payload:{categoryRow:c}})}catch(d){console.log("error",d),o({type:s.SET_ERROR,payload:{error:d}})}},[A,h]),U=E.useCallback(async(d,n)=>{S===m.AddingQuestion?await $():S===m.AddingCategory&&await I(),o({type:s.SET_LOADING_CATEGORY,payload:{categoryRow:d}});const p=new le(d).categoryKey,y=await Q(p,n);y instanceof Error?o({type:s.SET_ERROR,payload:{error:y}}):(y.topId=d.topId,o({type:s.SET_CATEGORY_TO_VIEW,payload:{categoryRow:y}}))},[I,$,S,Q]),ee=E.useCallback(async(d,n)=>{S===m.AddingQuestion?await $():S===m.AddingCategory&&await I(),o({type:s.SET_LOADING_CATEGORY,payload:{}});const p=new le(d).categoryKey,y=await Q(p,n);if(y instanceof Error)o({type:s.SET_ERROR,payload:{error:y}});else{const c={...y,isExpanded:!1,categoryRows:[],questionRows:[]};o({type:s.SET_CATEGORY_TO_EDIT,payload:{categoryRow:c,category:y}})}},[I,$,S,Q]),H=E.useCallback(async d=>{o({type:s.SET_LOADING_CATEGORY,payload:{}});try{const n=new Pe(d,l).categoryDto,p=`${r.endpointCategory}`;console.time(),await C("PUT",p,n).then(y=>{console.timeEnd();const{categoryDto:c,msg:f}=y;if(c){const w=new he(c).category,{topId:_}=w;w.isExpanded=!1,w.topId=_,o({type:s.SET_CATEGORY_UPDATED,payload:{category:w}})}else o({type:s.SET_ERROR,payload:{error:new Error(`${f}`)}})})}catch(n){return console.log(n),o({type:s.SET_ERROR,payload:{error:new Error("Karambol")}}),n}},[C,r.endpointCategory,l]),te=E.useCallback(async d=>{try{const{topId:n,parentId:p}=d,y=new St(d,l).categoryRowDto,c=`${r.endpointCategory}`;console.time(),await C("DELETE",c,y).then(async f=>{console.timeEnd();const{categoryDto:w,msg:_}=f;_==="OK"?(console.log("Category successfully deleted",{categoryRow:d}),await L().then(async()=>{const q={categoryKey:{topId:n,parentId:"",id:p},formMode:m.None};p?await G():await h(q).then(()=>{})})):o(_==="HasSubCategories"?{type:s.SET_ERROR,payload:{error:new Error("First remove sub categories"),whichRowId:w.Id}}:_==="HasQuestions"?{type:s.SET_ERROR,payload:{error:new Error("First remove category questions"),whichRowId:w.Id}}:{type:s.SET_ERROR,payload:{error:new Error(_),whichRowId:w.Id}})})}catch(n){return console.log(n),n}},[C,r.endpointCategory,h,L,G,l]),lt=async(d,n)=>{try{console.log("Deleting Category Tag...",{categoryKey:d,variationName:n}),console.log("Category Tag successfully deleted")}catch(p){console.log("error",p),o({type:s.SET_ERROR,payload:{error:p}})}},me=12,dt=E.useCallback(async({categoryKey:d,startCursor:n,includeQuestionId:p})=>{try{const{topId:y,id:c}=d;o({type:s.SET_CATEGORY_QUESTIONS_LOADING,payload:{}});try{const f=`${r.endpointQuestion}/${l}/${y}/${c}/${n}/${me}/${p}`;console.time(),await C("GET",f).then(w=>{console.timeEnd();const{categoryDto:_}=w;if(_!==null){const q=new he(_).category;o({type:s.CATEGORY_QUESTIONS_LOADED,payload:{categoryRow:q}})}})}catch(f){console.log(f),o({type:s.SET_ERROR,payload:{error:f}})}}catch(y){console.log(y),o({type:s.SET_ERROR,payload:y})}},[C,r.endpointQuestion,l]),ct=E.useCallback(async d=>{try{const{topId:n,id:p}=d;let y=await K(p);if(!y){alert(`Not found ${p}. Reload all Categories`);return}const c={topId:n,parentId:d.id,id:"generateId",title:"question text",categoryTitle:y.title,numOfAssignedAnswers:0,included:!0},f={...Oe,...c,title:""},w=N.topRows.find(q=>q.id===n),_=await D(w,p);o({type:s.ADD_NEW_QUESTION_TO_ROW,payload:{categoryRow:{..._,questionRows:[c,..._.questionRows]},newQuestionRow:c}}),o({type:s.SET_QUESTION,payload:{question:f,formMode:m.AddingQuestion}})}catch(n){console.log("error",n),o({type:s.SET_ERROR,payload:{error:n}})}},[h,D,K,N.topRows]),ut=E.useCallback(async d=>{const{topId:n,id:p,parentId:y}=d;o({type:s.SET_LOADING_CATEGORY,payload:{}});try{d.created.nickName=R;const c=new Ue(d,l).questionDto,f=`${r.endpointQuestion}`;console.time(),console.log(">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> createQuestion",c),await C("POST",f,c).then(async w=>{if(console.timeEnd(),w){console.log("::::::::::::::::::::",{questionDtoEx:w});const{questionDto:_}=w;if(_){const q=new ye(_).question;q.topId=n,console.log("Question successfully created"),await L().then(async()=>{const X={categoryKey:{topId:n,parentId:y,id:y},formMode:m.EditingQuestion};await h(X).then(()=>{o({type:s.SET_QUESTION,payload:{formMode:m.EditingQuestion,question:q}})})})}}})}catch(c){console.log(c),o({type:s.SET_ERROR,payload:{error:new Error("Server Error"),whichRowId:p}})}},[C,r.endpointQuestion,h,L,R,l]),gt=E.useCallback(async(d,n,p)=>{const{id:y}=n;try{n.modified.nickName=R;const c=new Ue(n,l).questionDto,f=`${r.endpointQuestion}`;console.time(),c.oldParentId=d,console.log(">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> updateQuestion",c);let w=null;return await C("PUT",f,c).then(async _=>{console.timeEnd();const{questionDto:q,msg:B}=_;if(q){w=new ye(q).question,console.log("Question successfully updated: ",w);const{topId:X,parentId:oe}=w;if(p){const{topId:ce,parentId:ue,id:we}=w,ge={topId:ce,categoryId:ue,questionId:we};o({type:s.FORCE_OPEN_NODE,payload:{keyExpanded:ge}})}else{const ue={categoryKey:{topId:X,parentId:oe,id:oe},formMode:m.EditingQuestion};await h(ue).then(()=>{o({type:s.SET_QUESTION,payload:{formMode:m.EditingQuestion,question:w}})})}}else o({type:s.SET_ERROR,payload:{error:new Error(B)}})}),w}catch(c){console.log(c),o({type:s.SET_ERROR,payload:{error:new Error("Server Error"),whichRowId:y}})}},[C,r.endpointQuestion,h,R,l]),yt=E.useCallback(async(d,n)=>{const{id:p,parentId:y,topId:c}=d;o({type:s.SET_LOADING_QUESTION,payload:{}});try{const f=new _t(d,l).questionRowDto,w=`${r.endpointQuestion}`;console.time(),await C("DELETE",w,f).then(async _=>{const{questionDto:q}=_;if(console.timeEnd(),q){const B=new ye(q).question;console.log("Question successfully deleted"),n&&o({type:s.QUESTION_DELETED,payload:{question:B}});const oe={categoryKey:{topId:c,parentId:y,id:y},formMode:m.None};await h(oe).then(()=>{})}else console.error(_),o({type:s.SET_ERROR,payload:{error:new Error("Server Error"),whichRowId:p}})})}catch(f){console.log(f),o({type:s.SET_ERROR,payload:{error:new Error("Server Error"),whichRowId:p}})}},[C,r.endpointQuestion,h,l]),fe=E.useCallback(async d=>new Promise(async n=>{try{const p=new Te(d).toQuery(l),y=`${r.endpointQuestion}?${p}`;console.time(),console.log("getQuestion",d),await C("GET",y).then(c=>{console.timeEnd();const{questionDto:f,msg:w}=c;if(f){const _={question:new ye(f).question,msg:w};n(_)}else n({question:null,msg:w})})}catch(p){console.log(p),n({question:null,msg:"Problemos"})}}),[C,r.endpointQuestion,l]),pt=E.useCallback(async d=>{const n=new Te(d).questionKey;o({type:s.SET_LOADING_QUESTION,payload:{}});const p=await fe(n);S===m.AddingQuestion?await $():S===m.AddingCategory&&await I();const{question:y,msg:c}=p;y?(y.topId=d.topId,o({type:s.SET_QUESTION_TO_VIEW,payload:{question:y}})):o({type:s.SET_ERROR,payload:{error:new Error(c)}})},[I,$,S,fe]),Et=E.useCallback(async d=>{const n=new Te(d).questionKey;S===m.AddingQuestion?await $():S===m.AddingCategory&&await I(),o({type:s.SET_LOADING_QUESTION,payload:{}}),console.log("editQuestion:",n);const p=await fe(n),{question:y,msg:c}=p;y?(y.topId=d.topId,o({type:s.CLOSE_QUESTION_FORM,payload:{question:y}}),o({type:s.SET_QUESTION_TO_EDIT,payload:{question:y}})):o({type:s.SET_ERROR,payload:{error:new Error(c)}})},[I,$,S,fe]),mt=E.useCallback(async(d,n,p)=>{try{var{topId:y,id:c}=p,f={topId:y,id:c,created:{time:new Date,nickName:R}};const w=new Nt(f).assignedAnswerDto;w.QuestionKeyDto=new jt(n,l).dto;let _=null;const q=`${r.endpointQuestionAnswer}/${d}`;console.time(),await C("POST",q,w).then(async B=>{console.timeEnd();const{questionDto:X}=B;console.log("::::::::::::::::::::",{questionDtoEx:B}),X&&(_=new ye(X).question,console.log("Question successfully modified"))}),_&&o({type:s.SET_QUESTION_AFTER_ASSIGN_ANSWER,payload:{question:_}})}catch(w){console.log("error",w),o({type:s.SET_ERROR,payload:{error:w}})}},[C,r.endpointQuestionAnswer,R,l]),ft=E.useCallback(async(d,n,p)=>{const y=b.find(f=>f.id===d);let c=await D(y,n);console.log("PROVIDER onCategoryTitleChanged::",c.title,p),c.title!==p&&(c.title=p===""?"New Category":p,o({type:s.RE_RENDER_TREE,payload:{categoryRow:c}}))},[D,b]),wt=E.useCallback(async(d,n,p)=>{const{parentId:y,id:c}=n,f=await D(d,y);if(f){const w=f.questionRows.find(_=>_.id===c);w.title=p,console.log("onQuestionTitleChanged+++>>>",c,f),o({type:s.QUESTION_TITLE_CHANGED,payload:{categoryRow:f}})}},[D]),xt={state:N,loadAllCategoryRows:L,getSubCats:k,getCat:K,loadAllGroupRows:v,expandNodesUpToTheTree:J,loadTopRows:G,addSubCategory:ae,cancelAddCategory:I,createCategory:z,viewCategory:U,editCategory:ee,updateCategory:H,deleteCategory:te,deleteCategoryVariation:lt,expandCategory:h,collapseCategory:ie,onCategoryTitleChanged:ft,loadCategoryQuestions:dt,addQuestion:ct,cancelAddQuestion:$,createQuestion:ut,viewQuestion:pt,editQuestion:Et,updateQuestion:gt,deleteQuestion:yt,onQuestionTitleChanged:wt,assignQuestionAnswer:mt};return!u||!M?null:e.jsx(Je.Provider,{value:xt,children:e.jsx(Ze.Provider,{value:o,children:t})})};function V(){return E.useContext(Je)}const De=()=>E.useContext(Ze);var se=(t=>(t.SET_LOADING="SET_LOADING",t.SET_SUB_CATS="SET_SUB_CATS",t.SET_ERROR="SET_ERROR",t.SET_EXPANDED="SET_EXPANDED",t.SET_PARENT_CAT="SET_PARENT_CAT",t))(se||{});const Yt=({cat:t,dispatch:i,setParentCat:g,selId:a})=>{const{topId:r,parentId:u,id:l,title:x,level:T,isExpanded:R}=t,N={topId:r,parentId:u,id:l},o=A=>{i({type:se.SET_EXPANDED,payload:{id:l,expanding:!R}})},S=A=>{g(A)},j=e.jsxs("div",{className:"d-flex justify-content-start align-items-center w-100 text-primary",children:[e.jsx(Y,{variant:"link",size:"sm",className:"py-0 px-1",onClick:A=>{o(),A.stopPropagation(),A.preventDefault()},title:"Expand",children:e.jsx(de,{icon:R?$e:Ve,size:"lg"})}),e.jsx(Y,{variant:"link",size:"sm",className:"py-0 mx-0 text-decoration-none",title:l,onClick:()=>S(t),children:x})]});return e.jsxs(e.Fragment,{children:[e.jsx(ne.Item,{variant:"primary",className:"py-0 px-1 w-100",as:"li",children:j}),R&&e.jsx(ne.Item,{className:"py-0 px-0",variant:"primary",as:"li",children:e.jsx(tt,{selId:a,level:T+1,categoryKey:N,setParentId:g})})]})},Bt={loading:!1,parentId:null,title:"",cats:[]},Wt=(t,i)=>{switch(i.type){case se.SET_LOADING:return{...t,loading:!0};case se.SET_SUB_CATS:{const{subCats:g}=i.payload;return{...t,cats:t.cats.concat(g),loading:!1}}case se.SET_ERROR:{const{error:g}=i.payload;return{...t,error:g,loading:!1}}case se.SET_EXPANDED:{const{id:g,expanding:a}=i.payload;let{cats:r}=t;if(!a){const u=et(r,g);console.log("clean:",u),u.length>0&&(r=r.filter(l=>!u.includes(l.id)))}return{...t,cats:t.cats.map(u=>u.id===g?{...u,isExpanded:a}:u)}}case se.SET_PARENT_CAT:{const{cat:g}=i.payload,{id:a,title:r}=g;return{...t,parentId:a,title:r}}default:return t}};function et(t,i){let g=t.filter(a=>a.parentId===i).map(a=>a.id);return g.forEach(a=>{const r=a?et(t,a):[];g=g.concat(r)}),g}const tt=({selId:t,categoryKey:i,level:g,setParentId:a})=>{const[r,u]=E.useReducer(Wt,Bt),{getSubCats:l}=V(),{id:x}=i??{id:null},[T]=E.useState(i);E.useEffect(()=>{(async()=>{const o=await l(x),{subCats:S}=o;u({type:se.SET_SUB_CATS,payload:{subCats:S}})})()},[l,T,x]);const R=r.cats.filter(o=>o.parentId===x),N=o=>{u({type:se.SET_PARENT_CAT,payload:{cat:o}}),a(o)};return e.jsxs("div",{className:g>1?"border  border-7 ms-4 h-25":"border border-7  h-25",style:{overflowY:"auto"},children:[e.jsx(ne,{as:"ul",variant:"dark",className:"mb-0",children:R.filter(o=>o.id!==t).map(o=>e.jsx(Yt,{cat:o,selId:t,dispatch:u,setParentCat:N},o.id))}),r.error&&r.error.message]})},Ht=({relatedFilter:t})=>{const{filter:i,numOfUsages:g,created:a,lastUsed:r}=t,{time:u,nickName:l}=a,x=`Created by: ${l}, ${Pt(new Date(u))}`,T=!1,R=j=>{console.log("RelatedFilter onSelectAnswer",{filter:j})},[N,o]=Se(),S=e.jsxs("div",{ref:N,className:"d-flex justify-content-start align-items-center w-100 text-light related-filter-row",children:[e.jsx(Y,{variant:"link",size:"sm",className:"py-0 mx-0 title text-light text-wrap",title:x,onClick:()=>R(i),disabled:T,children:i}),e.jsxs(_e,{pill:!0,bg:"secondary",className:`text-light ${g===0?"d-none":"d-inline"}`,children:[g,g===1?" usage":" usages"]}),e.jsx("span",{className:"small ms-1",children:Ut(r.time)}),o]});return e.jsx(ne.Item,{className:"py-0 px-0",as:"li",children:S},i)},Xt=({relatedFilters:t})=>{const{globalState:i}=Ae(),{variant:g}=i,{state:a}=V(),r=async u=>{console.log("RelatedFilters unAssignFilter",{relatedFilter:u})};return e.jsx("div",{className:"mx-0 my-1 border rounded-2 px-1 py-1border-light fs-6 related-filters",children:e.jsxs("div",{children:[e.jsx("label",{className:"text-muted",children:"Most frequently selected Filters (for the next Question in ChatBot)"}),t.length>0?e.jsx(ne,{as:"ul",variant:g,className:"my-1",children:t.map(u=>e.jsx(Ht,{relatedFilter:u,unAssignFilter:r},u.filter))}):e.jsx("div",{className:"border text-light",children:"No filters"}),a.error&&e.jsx("div",{children:"state.error"})]})})},ke=({question:t,submitForm:i,children:g,showCloseButton:a,source:r=0,closeModal:u})=>{const{state:l,onQuestionTitleChanged:x}=V();let{formMode:T,topRows:R}=l;const N=E.lazy(()=>vt(()=>import("./AssignedAnswers-DJmdaNaJ.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8])).then(I=>({default:I.default}))),o=T===m.ViewingQuestion,S=T===m.EditingQuestion,j=T===m.AddingQuestion,A=o,{topId:F,id:b,assignedAnswers:P,relatedFilters:M,title:C}=t,L=new Te(t).questionKey,v=De(),K=()=>{u?u():v({type:s.CLOSE_QUESTION_FORM,payload:{question:t}})},k=()=>{u?u():v({type:s.CANCEL_QUESTION_FORM,payload:{question:t}})},[G,Q]=E.useState(b+"/"+C),D=Ke(G,500),[J]=E.useState(R.find(I=>I.id===F)),W=E.useRef(null),h=ze({enableReinitialize:!0,initialValues:t,validationSchema:Ye().shape({title:je().required("Required"),parentId:je().required("Required").notOneOf(["000000000000000000000000"])}),onSubmit:I=>{i(I),Q(I.id+"/"+I.title)}});E.useEffect(()=>{(async()=>{const z=D.split("/"),$=z[0];if(h.values.id===$){console.log("QuestionForm.useEffect - onQuestioTitleChanged",{debouncedSearchTerm:D,searchTerm:G,title:h.values.title});const U=z[1];await x(J,h.values,U)}})()},[D,h.values,x,G,J]),E.useEffect(()=>{W.current.focus(),r!==0&&h.setFieldValue("source",r)},[h,W,r]);const ie=I=>{h.handleChange(I);const z=I.target.value;Q(b+"/"+z)},ae=I=>{h.setFieldValue("parentId",I.id),h.setFieldValue("categoryTitle",I.title)};return console.log("@@@@@@@@@@@@@@@@@@@@@ QuestionForm.render: ",{searchTerm:G,qTitle:C,debouncedSearchTerm:D}),e.jsxs("div",{className:"form-wrapper px-3 py-1 my-0 my-1 w-100 question-form",children:[a&&e.jsx(Me,{onClick:K,className:"float-end"}),e.jsx(Ee,{className:"text-center",children:e.jsxs(O.Label,{children:["Question  ",o?"Viewing":S?"Editing":"Adding"]})}),e.jsxs(O,{onSubmit:h.handleSubmit,children:[e.jsxs(Qe,{direction:"horizontal",gap:0,className:"border",children:[e.jsx("div",{className:"p-0",children:e.jsx(O.Label,{children:"Category:"})}),e.jsx("div",{className:"p-1",children:e.jsxs(O.Group,{controlId:"parentId",className:"category-select form-select-sm w-90",children:[e.jsxs(Ce,{children:[e.jsx(Ce.Toggle,{variant:"light",id:"dropdown-basic",className:"px-2 py-0 text-primary border",disabled:A,children:e.jsx("span",{className:"text-wrap me-1",children:h.values.categoryTitle})}),e.jsx(Ce.Menu,{className:"p-0 border",children:e.jsx(Ce.Item,{className:"p-0 m-0 rounded-3",children:e.jsx(tt,{selId:h.values.parentId,categoryKey:null,level:1,setParentId:ae})})})]}),e.jsx(O.Control,{as:"input",name:"parentId",onChange:h.handleChange,value:h.values.parentId?h.values.parentId:"",placeholder:"Category",className:"text-primary w-100",disabled:A,hidden:!0}),e.jsx(O.Text,{className:"text-danger",children:h.touched.parentId&&h.errors.parentId?e.jsx("div",{className:"text-danger",children:h.errors.parentId?"required":""}):null})]})})]}),e.jsxs(O.Group,{controlId:"title",children:[e.jsx(O.Label,{children:"Title"}),e.jsx(O.Control,{as:"textarea",name:"title",placeholder:h.values.title==="new Question"?"new Question":"question text",ref:W,onChange:ie,value:h.values.title,rows:3,className:"text-primary w-100",disabled:A}),e.jsx(O.Text,{className:"text-danger",children:h.touched.title&&h.errors.title?e.jsx("div",{className:"text-danger",children:h.errors.title}):null})]}),e.jsxs(Ee,{children:[e.jsx(pe,{children:e.jsxs(O.Group,{controlId:"source",children:[e.jsx(O.Label,{children:"Source"}),e.jsx(ve,{id:"source",name:"source",options:bt,onChange:(I,z)=>{I.preventDefault(),h.setFieldValue("source",z)},value:h.values.source,disabled:A,classes:"text-primary"}),e.jsx(O.Text,{className:"text-danger",children:h.touched.source&&h.errors.source?e.jsx("div",{className:"text-danger",children:h.errors.source}):null})]})}),e.jsx(pe,{children:e.jsxs(O.Group,{controlId:"status",children:[e.jsx(O.Label,{children:"Status"}),e.jsx(ve,{id:"status",name:"status",options:Dt,onChange:(I,z)=>{I.preventDefault(),h.setFieldValue("status",z)},value:h.values.status,disabled:A,classes:"text-primary"}),e.jsx(O.Text,{className:"text-danger",children:h.touched.status&&h.errors.status?e.jsx("div",{className:"text-danger",children:h.errors.status}):null})]})})]}),(o||S)&&e.jsxs("div",{className:"my-1",children:[e.jsx(E.Suspense,{fallback:e.jsx("div",{children:"Loading..."}),children:e.jsx(N,{questionKey:L,questionTitle:G,assignedAnswers:P,isDisabled:A})}),e.jsx(Xt,{questionKey:L,questionTitle:G,relatedFilters:M}),e.jsx(Be,{created:t.created,modified:t.modified,classes:"text-primary"})]}),(h.dirty&&S||j)&&e.jsx(We,{cancelForm:k,handleSubmit:h.handleSubmit,title:g}),l.error&&e.jsx("div",{className:"text-danger",children:l.error.message})]})]})},Le=({closeModal:t,showCloseButton:i,source:g,setError:a})=>{const{state:r,cancelAddQuestion:u,createQuestion:l}=V(),{activeQuestion:x}=r,T=x?x.topId:"",R=async()=>{await u()},N=async o=>{const S={...o,topId:T,created:{time:new Date,nickName:""},modified:void 0},j=await l(S,t!==void 0);j&&(j.message?a(j.message):t&&t())};return x?e.jsx(ke,{question:x,showCloseButton:i??!0,source:g??0,closeModal:R,submitForm:N,children:"Create Question"}):null},ot=({})=>{const{state:t,updateQuestion:i,loadAllGroupRows:g}=V(),{activeQuestion:a,allGroupRowsLoaded:r}=t;if(!a)return null;if(!a)return e.jsx("div",{children:"Loading question to edit..."});E.useEffect(()=>{(async()=>r===void 0&&await g())()},[r,g]);const u=async l=>{const x={...l,created:void 0,modified:{time:new Date,nickName:""}},{parentId:T}=a,R=T!==x.parentId;await i(T,x,R)};return e.jsx(ke,{question:a,showCloseButton:!0,source:0,submitForm:u,children:"Update Question"})},st=({inLine:t})=>{console.log(t?"ViewQuestion inLine":"ViewQuestion not inLine");const{state:i}=V(),{activeQuestion:g}=i,[a,r]=E.useState(null);return E.useEffect(()=>{console.log("#################################### ViewQuestion setQuestion ...",{activeQuestion:g}),r(g)},[g]),e.jsx(ke,{question:a,showCloseButton:!0,source:0,submitForm:()=>{},children:"View Question"})},Jt=({questionRow:t,isSelected:i})=>{const{id:g,topId:a,parentId:r,title:u,numOfAssignedAnswers:l}=t,x={topId:a,parentId:r,id:r},{canEdit:T,authUser:R}=re(),{state:N,viewQuestion:o,addQuestion:S,editQuestion:j,deleteQuestion:A}=V(),{activeQuestion:F,formMode:b,loadingQuestion:P,questionLoaded:M}=N,C=F!==null&&F.id===g,L=b===m.AddingQuestion,v=()=>{t.modified={time:new Date,nickName:R.nickName},A(t,C)},K=async D=>{console.log("QuestionRow onSelectQuestion",{id:D}),T?await j(t):await o(t)},[k,G]=Se();E.useEffect(()=>{(async()=>{if(i&&!P&&!M){switch(b){case m.ViewingQuestion:await o(t);break;case m.EditingQuestion:console.log("Zovem from QuestionRow"),T?await j(t):await o(t);break}document.getElementById(`QuestionRow${g}`)?.scrollIntoView({behavior:"smooth",block:"end"})}})()},[T,j,b,g,i,P,M,t,o]);const Q=e.jsxs("div",{id:`QuestionRow${g}`,className:`d-relative d-flex justify-content-start align-items-center w-100 mt-0 question-row${i?"-selected":""}`,style:{marginTop:"1px"},children:[e.jsx(Y,{variant:"link",size:"sm",className:"d-flex align-items-center px-1 text-secondary",children:e.jsx("img",{width:"22",height:"18",src:Ot,alt:"Question"})}),e.jsx(Y,{variant:"link",size:"sm",className:`p-0 px-1 m-1 ms-0 question-row-title ${C?"fw-bold":""}`,title:`id:${g.toString()}`,onClick:()=>K(g),disabled:L,children:u}),e.jsxs(_e,{pill:!0,bg:"secondary",className:`text-info ${l===0?"d-none":"d-inline"}`,children:[l,"a"]}),T&&!L&&G&&e.jsxs("div",{className:"position-absolute text-nowrap d-flex align-items-center border border-0 border-warning p-0 end-0",children:[e.jsx(Y,{variant:"link",size:"sm",className:"ms-1 p-0 text-secondary d-flex align-items-center",title:"Add Question",onClick:()=>{S(x,!0)},children:e.jsx("img",{width:"22",height:"18",src:He,alt:"Add Question"})}),e.jsx(Y,{variant:"link",size:"sm",className:"ms-0 p-0 text-secondary",onClick:v,children:e.jsx(de,{icon:be,size:"lg"})})]})]});return e.jsxs(ne.Item,{className:"py-0 px-0 w-100",as:"li",children:[i&&b===m.AddingQuestion&&e.jsxs(e.Fragment,{children:[e.jsx("div",{id:"div-question",className:"ms-0 d-md-none w-100",children:e.jsx(Le,{showCloseButton:!0,source:0})}),e.jsx("div",{ref:k,className:"d-none d-md-block  border rounded-3",children:Q})]}),i&&b===m.EditingQuestion&&e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:k,className:"",children:Q}),e.jsx("div",{id:"div-question",className:"ms-0 d-md-none w-100",children:e.jsx(ot,{inLine:!0})})]}),i&&b===m.ViewingQuestion&&e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:k,className:"",children:Q}),e.jsx("div",{ref:k,id:"div-question",className:"ms-0 d-md-none w-100",children:e.jsx(st,{inLine:!0})})]}),!i&&e.jsx("div",{ref:k,className:"",children:Q})]})},nt=({categoryRow:t})=>{const{state:i,loadCategoryQuestions:g}=V(),{keyExpanded:a,loadingQuestion:r,error:u,selectedQuestionId:l}=i,{questionId:x}=a;t.level+=1;const{questionRows:T}=t;let R=!1;async function N(){try{const j={categoryKey:new le(t).categoryKey,startCursor:T.length,includeQuestionId:x??null};console.log("^^^^^^^^^^^^^ loadMore"),console.log("^^^^^^^^^^^^^",{x:j}),console.log("^^^^^^^^^^^^^ loadMore"),await g(j)}catch{}}const[o,{rootRef:S}]=kt({loading:r,hasNextPage:R,onLoadMore:N,disabled:!!u,rootMargin:"0px 0px 100px 0px"});return e.jsxs("div",{ref:S,className:"ms-0",style:{maxHeight:"400px",overflowY:"auto"},children:[e.jsxs(Lt,{children:[T.length===0&&e.jsx("label",{children:"No questions"}),T.map(j=>e.jsx(Jt,{questionRow:j,isSelected:j.id===l},j.id)),R]}),u&&e.jsxs("p",{children:["Error: ",u.message]})]})},Zt=({categoryKey:t,tag:i,categoryInAdding:g})=>{const{name:a}=i,{canEdit:r}=re(),{state:u,deleteCategoryVariation:l}=V(),x=()=>{l(t,a)},[T,R]=Se(),N=e.jsxs("div",{ref:T,children:[e.jsx(_e,{pill:!0,bg:"secondary",children:a}),r&&!0&&R&&e.jsx(Y,{variant:"link",size:"sm",className:"ms-0 py-0 mx-0 text-secondary",onClick:x,children:e.jsx(de,{icon:be,size:"sm"})}),!1]});return e.jsx("div",{className:"py-1 px-1",children:N})},eo=({categoryKey:t,variations:i})=>{const{state:g}=V(),{error:a}=g;return E.useEffect(()=>{},[]),e.jsxs("div",{className:"ms-2",children:[e.jsxs(Qe,{direction:"horizontal",gap:2,children:[i.length===0&&e.jsx("div",{children:"No variations"}),i.length>0&&i.map(r=>e.jsx(Zt,{categoryKey:t,tag:r,categoryInAdding:void 0}))]}),a&&e.jsxs("p",{children:["Error: ",a.message]})]})},qe=({formMode:t,category:i,submitForm:g,children:a})=>{const{onCategoryTitleChanged:r}=V(),u=t===m.ViewingCategory,l=t===m.EditingCategory,x=t===m.AddingCategory,{topId:T,id:R,variations:N,questionRows:o,title:S}=i;console.log("CategoryForm render: ",{topId:T,id:R,catTitle:S,formMode:t,variations:N});const j=new le(i).categoryKey;document.getElementById("div-details");const A=o&&o.length>0,F=De(),b=()=>{F({type:s.CLOSE_CATEGORY_FORM,payload:{}})},P=()=>{F({type:s.CANCEL_CATEGORY_FORM,payload:{}})},[M,C]=E.useState(S),L=Ke(M,300),v=ze({enableReinitialize:!0,initialValues:i,validationSchema:Ye().shape({title:je().required("Required")}),onSubmit:Q=>{console.log("CategoryForm.onSubmit",JSON.stringify(Q,null,2)),g(Q),C(Q.title)}});E.useEffect(()=>{(async()=>(console.log("CategoryForm.useEffect - onCategoryTitleChanged",{debouncedSearchTerm:L,title:v.values.title}),v.values.title!==L&&r(T,R,v.values.title)))()},[L,v.values.title,r]);const K=Q=>{v.handleChange(Q);const D=Q.target.value;C(D)},k=E.useRef(null);E.useEffect(()=>{},[k]);const G=!1;return console.log("CategoryForm render return: ",M),e.jsxs("div",{className:"form-wrapper p-2 category-form",children:[e.jsx(Me,{onClick:b,className:"float-end"}),e.jsx(Ee,{className:"text-center text-muted",children:e.jsxs(O.Label,{children:["Category ",u?"Viewing":l?"Editing":"Adding"]})}),e.jsxs(O,{onSubmit:()=>v.handleSubmit,children:[e.jsx(O.Group,{controlId:"Variations",children:e.jsxs(Qe,{direction:"horizontal",gap:1,children:[e.jsx("div",{className:"px-0",children:e.jsx(O.Label,{children:"Variations:"})}),e.jsx("div",{className:"px-1 border border-1 border-secondary rounded",children:e.jsx(eo,{categoryKey:j,variations:N?N.map(Q=>({name:Q})):[]})}),e.jsx("div",{className:"ps-2",children:e.jsx(O.Label,{children:"Kind:"})}),e.jsx("div",{className:"px-1 border border-1 border-secondary rounded",children:e.jsxs(O.Group,{controlId:"kind",children:[e.jsx(ve,{id:"kind",name:"kind",options:qt,onChange:(Q,D)=>{Q.preventDefault(),v.setFieldValue("kind",D)},value:v.values.kind,disabled:G,classes:"text-primary"}),e.jsx(O.Text,{className:"text-danger",children:v.touched.kind&&v.errors.kind?e.jsx("div",{className:"text-danger",children:v.errors.kind}):null})]})})]})}),e.jsxs(O.Group,{controlId:"title",children:[e.jsx(O.Label,{children:"Title"}),e.jsx(O.Control,{as:"textarea",name:"title",placeholder:"new Category",value:M,onChange:K,onFocus:Q=>{t===m.AddingCategory&&Q.target.select()},ref:k,rows:3,className:"text-primary w-100",disabled:u}),e.jsx(O.Text,{className:"text-danger",children:v.touched.title&&v.errors.title?e.jsx("div",{className:"text-danger",children:v.errors.title}):null})]}),e.jsxs(O.Group,{controlId:"link",children:[e.jsx(O.Label,{children:"Link"}),v.values.hasSubCategories?e.jsx(O.Control,{as:"input",placeholder:"/categories/...",name:"link",onChange:v.handleChange,className:"text-primary w-100",value:"Can't have link (has sub categories)",disabled:!0}):e.jsxs(e.Fragment,{children:[e.jsx(O.Control,{as:"input",placeholder:"/categories/...",name:"link",onChange:v.handleChange,className:"text-primary w-100",value:v.values.link??"",disabled:u}),e.jsx(O.Text,{className:"text-danger",children:v.touched.link&&v.errors.link?e.jsx("div",{className:"text-danger",children:v.errors.link}):null})]})]}),e.jsxs(O.Group,{children:[e.jsxs(O.Label,{className:"m-1 mb-0",children:["Questions (",`${v.values.numOfQuestions}`,") "]}),A&&e.jsx(nt,{categoryRow:i})]}),(u||l)&&e.jsx(Be,{created:i.created,modified:i.modified,classes:"text-primary"}),(v.dirty&&l||x)&&e.jsx(We,{cancelForm:P,handleSubmit:v.handleSubmit,title:a})]})]})},at=({inLine:t})=>{const i=re(),{nickName:g}=i.authUser,{state:a,updateCategory:r}=V(),{activeCategory:u,keyExpanded:l}=a,{questionId:x}=l,T=async R=>{const N={...R,created:void 0,modified:{time:new Date,nickName:g}};await r(N,!0)};return e.jsx(qe,{inLine:t,category:{...u},questionId:x,formMode:m.EditingCategory,submitForm:T,children:"Update Category"})},Ie=({inLine:t})=>{const{state:i}=V(),{activeCategory:g,keyExpanded:a}=i,{questionId:r}=a;return e.jsx(qe,{inLine:t,category:{...g},questionId:r,formMode:m.ViewingCategory,submitForm:()=>{},children:"View Category"})},rt=({activeCategory:t})=>{const i=re(),{nickName:g}=i.authUser,{createCategory:a}=V(),[r]=E.useState({...t}),u=async l=>{const x={...l,created:{time:new Date,nickName:g},modified:void 0};console.log("**********object",x),await a(x)};return!t===null?null:(console.log("AddCategory render >>>>>:",t),e.jsx(e.Fragment,{children:e.jsx(qe,{inLine:!1,category:r,questionId:null,formMode:m.AddingCategory,submitForm:u,children:"Create Category"})}))},to=({categoryRow:t,questionId:i})=>{const{id:g,title:a,hasSubCategories:r,numOfQuestions:u,isExpanded:l,categoryRows:x}=t;t.level+=1;const T=new le(t).categoryKey,{canEdit:R,authUser:N}=re(),{state:o,addSubCategory:S,viewCategory:j,editCategory:A,deleteCategory:F,expandCategory:b,collapseCategory:P,addQuestion:M}=V();let{formMode:C,activeCategory:L,loadingCategory:v,categoryLoaded:K}=o;const k=L!==null&&L.id===g,G=C===m.AddingCategory,Q=l&&u>0,D=()=>{t.modified={time:new Date,nickName:N.nickName},F(t)},J=async()=>{l?await P(t):await b({categoryKey:T})},[W,h]=E.useState(!1);E.useEffect(()=>{h(!0)},[x]);const ie=async()=>{R?await A(t,i??"null"):await j(t,i??"null")},[ae,I]=E.useState(!1);E.useEffect(()=>{ae&&(S(t),I(!1))},[S,t,ae]);const[z,$]=E.useState(!1);E.useEffect(()=>{z&&(M(T,l??!1),$(!1))},[M,T,l,z]),E.useEffect(()=>{(async()=>{if(k&&!v&&!K&&!G)switch(console.log("CategoryRow formMode:",C),C){case m.ViewingCategory:await j(t,i??"null");break;case m.EditingCategory:R?await A(t,i??"null"):await j(t,i??"null");break}})()},[R,T,K,t,A,b,C,G,k,v,i,j]);const[U,ee]=Se(),H=e.jsxs("div",{children:[e.jsxs("div",{id:`Row${g}`,className:`d-relative d-flex justify-content-start align-items-center w-100 mt-1 category-row${k?"-selected":""}`,style:{marginTop:"1px"},children:[e.jsx(Y,{variant:"link",size:"sm",className:"py-0 px-1","aria-controls":g+"-2","aria-expanded":W,onClick:te=>{J(),te.stopPropagation()},title:"Expand",disabled:G||!r&&u===0,children:e.jsx(de,{icon:l?$e:Ve,size:"lg"})}),e.jsx(Y,{variant:"link",size:"sm",className:"py-0 px-1 bg-light",title:"Expand",disabled:!0,children:e.jsx(de,{icon:Gt,size:"sm"})}),e.jsx(Y,{variant:"link",size:"sm",className:`py-0 ms-0 me-1 category-row-title ${k?"fw-bold text-white bg-transparent":""}`,title:g,onClick:ie,disabled:G,children:a}),u>0&&e.jsxs(_e,{pill:!0,bg:"secondary",className:"d-inline bg-transparent",children:[u,"Q"]}),R&&ee&&e.jsxs("div",{className:"position-absolute text-nowrap d-flex align-items-center border border-0 border-warning p-0 end-0",children:[e.jsx("div",{className:"d-flex align-items-center",children:e.jsx(Y,{variant:"link",size:"sm",className:"border-0 py-0 px-0 ms-0 text-success",title:"Add SubCategory",onClick:async()=>{!l&&(r||u>0)&&await J(),setTimeout(()=>I(!0),1e3)},children:e.jsx(de,{icon:Ft,size:"lg"})})}),!G&&!r&&e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(Y,{variant:"link",size:"sm",className:"p-0 mx-0 text-secondary d-flex align-items-center border border-0 border-warning1",title:"Add Question",onClick:async()=>{!l&&(r||u>0)&&await J(),setTimeout(()=>$(!0),500)},children:e.jsx("img",{width:"22",height:"18",src:He,alt:"Add Question"})}),e.jsx(Y,{variant:"link",size:"sm",className:"d-flex align-items-center border border-0 border-warning p-0",disabled:r||u>0,onClick:D,children:e.jsx(de,{icon:be,size:"lg"})})]})]})]}),Q&&e.jsx("div",{className:"ps-3",children:e.jsx(nt,{categoryRow:t})})]});return e.jsxs(e.Fragment,{children:[e.jsxs(ne.Item,{className:"py-0 px-1 w-100 category-bg",as:"li",children:[k&&C===m.AddingCategory&&e.jsxs("div",{children:[e.jsx("div",{ref:U,className:"",children:H}),e.jsx("div",{className:"ms-0 d-md-none w-100",children:e.jsx(rt,{activeCategory:L})})]}),k&&C===m.EditingCategory&&e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:U,children:H}),e.jsx("div",{id:"divInLine",className:"ms-0 d-md-none w-100",children:e.jsx(at,{inLine:!1})})]}),k&&C===m.ViewingCategory&&e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:U,children:H}),e.jsx("div",{id:"divInLine",className:"ms-0 d-md-none w-100",children:e.jsx(Ie,{inLine:!1})})]}),k&&C===m.None&&e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:U,children:H}),e.jsx("div",{id:"divInLine",className:"ms-0 d-md-none w-100",children:e.jsx(Ie,{inLine:!1})})]}),!k&&e.jsx("div",{ref:U,children:H})]}),o.error&&o.whichRowId===g&&e.jsx("div",{className:"text-danger",children:o.error.message}),l&&e.jsx(ne.Item,{className:"py-0 px-0 border-0 border-warning border-bottom-0 category-bg p-0 m-0",variant:"primary",as:"li",children:e.jsx("div",{className:"rambo",children:r&&e.jsx(It,{in:W,children:e.jsx("div",{id:g+"-2",style:{marginTop:"1px"},children:e.jsx("div",{style:{border:"1px solid #ddd",borderRadius:"4px"},children:e.jsx(it,{categoryRow:t,isExpanded:l})})})})})})]})},it=({categoryRow:t})=>{const{level:i,categoryRows:g}=t,{state:a}=V();let{keyExpanded:r}=a;const{questionId:u}=r??{questionId:null};return e.jsx("div",{className:i>1?"ms-2":"",children:e.jsx(ne,{as:"ul",variant:"dark",className:"mb-0 category-bg",children:g.map(l=>e.jsx(to,{categoryRow:l,questionId:u===""?null:u},l.id))})})},oo=t=>{const{isDarkMode:i}=re(),[g,a]=E.useState("");return E.useEffect(()=>{},[]),e.jsxs(Re,{show:t.show,onHide:t.onHide,animation:!0,centered:!0,size:"lg",className:"modal show",contentClassName:`${i?"bg-secondary bg-gradient":"bg-info bg-gradient"}`,children:[e.jsx(Re.Header,{closeButton:!0,children:"Store new Question to the Database"}),e.jsx(Re.Body,{className:"py-0",children:e.jsx(Le,{closeModal:t.onHide,showCloseButton:!1,source:1,setError:r=>a(r)})}),e.jsx(Re.Footer,{children:g})]})},so=({categoryId_questionId:t,fromChatBotDlg:i})=>{const{state:g,expandNodesUpToTheTree:a,loadTopRows:r,addSubCategory:u}=V(),{allCategoryRows:l,topRows:x,topRowsLoading:T,topRowsLoaded:R,keyExpanded:N,categoryId_questionId_done:o,nodeOpening:S,nodeOpened:j,activeCategory:A,activeQuestion:F,formMode:b,loadingCategories:P,loadingCategory:M,loadingQuestions:C,loadingQuestion:L}=g,{searchQuestions:v,setLastRouteVisited:K,setChatBotDlgEnabled:k}=Ae(),{isDarkMode:G,chatBotDlgEnabled:Q,lastRouteVisited:D}=re(),[J,W]=E.useState(!1),[h,ie]=E.useState({...Oe}),ae=De(),I=async U=>{ae({type:s.SET_QUESTION_SELECTED,payload:{questionKey:U}})};let z="";E.useEffect(()=>{(async()=>!T&&!R&&(console.log("ZOVEM 111 loadTopRows()"),await r()))()},[T,R,r]),E.useEffect(()=>{(async()=>{if(!S&&R&&x.length>0){if(t){if(t==="add_question"){const U=localStorage.getItem("New_Question");if(U){const ee=JSON.parse(U);return ie({...Oe,categoryTitle:"Select",...ee}),W(!0),localStorage.removeItem("New_Question"),null}}else if(t!==o){const U=t.split("_"),ee=U[0],H=U[1],te={topId:"",id:ee,parentId:"ROOT"};console.log("zovem expandNodesUpToTheTree 1111111111111111111)",{categoryId_questionId:t},{categoryId_questionId_done:o}),await a(te,H!=="null"?H:null,i==="from_chat"),console.log("zavrsio expandNodeUpToTheTree 1111111111111111111 DONE)",{categoryId_questionId:t})}}else if(N&&!j){const{topId:U,categoryId:ee,questionId:H}=N;if(ee!==""){const te={topId:U,id:ee,parentId:"ROOT"};console.log("zovem expandNodeUpToTheTree 2222222222222)",{keyExpanded:N,catKey:te}),await a(te,H),console.log("zavrsio expandNodeUpToTheTree 2222222222222 DONE)")}}Q||k()}})()},[t,o,R,N,S,j,a,i,Q,k]);const $="/knowledge/categories";return E.useEffect(()=>{D!==$&&K($)},[D,K]),t!=="add_question"&&t&&t!==o?(console.log("zzzzzz loading...",{keyExpanded:N,categoryId_questionId:t,categoryId_questionId_done:o}),e.jsx("div",{children:"loading..."})):R?(console.log("===>>> Categories !!!!!!!!!!!!!!!!!",A),e.jsxs(e.Fragment,{children:[e.jsxs(Qt,{children:[e.jsxs("h5",{className:"text-warning mx-auto w-75 fw-bold",children:[e.jsx("span",{className:"categories",children:"Categories / "}),e.jsx("span",{className:"questions",children:"Questions"})]}),e.jsx(Ee,{className:`${G?"dark":""}`,children:e.jsx(pe,{children:e.jsx("div",{className:"d-flex justify-content-start align-items-center",children:e.jsx("div",{className:"w-75 my-1 questions",children:e.jsx(Mt,{tekst:z,onSelectQuestion:I,allCategoryRows:l,searchQuestions:v})})})})}),e.jsx(Y,{variant:"secondary",size:"sm",type:"button",style:{padding:"1px 4px"},onClick:()=>u(null),children:"Add Category"}),e.jsxs(Ee,{className:"my-1 h-auto",children:[e.jsx(pe,{xs:12,md:5,children:e.jsx("div",{className:"categories-border",style:{position:"relative"},children:e.jsx(it,{categoryRow:{...Xe,categoryRows:x},isExpanded:!0})})}),e.jsx(pe,{xs:0,md:7,children:e.jsxs("div",{id:"div-details",className:"d-none d-md-block",children:[A&&b===m.ViewingCategory&&e.jsx(Ie,{inLine:!1}),A&&b===m.EditingCategory&&e.jsx(at,{inLine:!1}),A&&b===m.AddingCategory&&e.jsx(rt,{activeCategory:A}),F&&b===m.ViewingQuestion&&e.jsx(st,{inLine:!1}),F&&b===m.EditingQuestion&&e.jsx(ot,{inLine:!1}),F&&b===m.AddingQuestion&&e.jsx(Le,{})]})})]})]}),J&&F&&e.jsx(oo,{show:J,onHide:()=>{W(!1)},newQuestionRow:h}),(P||C)&&e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{position:"absolute",top:"40%",left:"20%"},children:e.jsx("div",{className:`spinner-border ${C?"question":"category"}-spinner`,role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})}),M&&e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{position:"absolute",top:"50%",left:"50%"},children:e.jsx("div",{className:"spinner-border category-spinner",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})}),L&&e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{position:"absolute",top:"50%",left:"50%"},children:e.jsx("div",{className:"spinner-border question-spinner",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})})]})):(console.log("===>>> Categories  VRATIO"),null)},no=()=>{let{categoryId_questionId:t,fromChatBotDlg:i}=At();if(t&&t==="categories"&&(t=void 0),t){const g=t.split("_");console.assert(g.length===2,"expected 'categoryId_questionId'")}return e.jsx(zt,{children:e.jsx(so,{categoryId_questionId:t,fromChatBotDlg:i})})},co=Object.freeze(Object.defineProperty({__proto__:null,default:no},Symbol.toStringTag,{value:"Module"}));export{co as C,V as u};
//# sourceMappingURL=Categories-BJbUWKOV.js.map
