import{ao as p,m as u,j as f}from"./index-DaKHXlkp.js";import{l as m,d as y,A as C,e as x,b as R,c as b}from"./lib-D4_UPh-i.js";const q=C;class A extends p.Component{state;isMob;allCategoryRows;searchQuestions;debouncedLoadSuggestions;constructor(e){console.log("AutoSuggestQuestions CONSTRUCTOR"),super(e),this.state={value:e.tekst||"",suggestions:[],noSuggestions:!1,highlighted:""},this.allCategoryRows=e.allCategoryRows,this.searchQuestions=e.searchQuestions,this.isMob=m.isMobile,this.loadSuggestions=this.loadSuggestions.bind(this),this.debouncedLoadSuggestions=y(this.loadSuggestions,300)}async loadSuggestions(e){this.setState({isLoading:!0}),console.time();const t=await this.getSuggestions(e);console.timeEnd(),e===this.state.value?this.setState({isLoading:!1,suggestions:t,noSuggestions:t.length===0}):this.setState({isLoading:!1})}componentDidMount(){setTimeout(()=>{window.focus()},300)}render(){const{value:e,suggestions:t,noSuggestions:n}=this.state;return u.jsxs("div",{children:[u.jsx(q,{onSuggestionsClearRequested:this.onSuggestionsClearRequested,multiSection:!0,suggestions:t,onSuggestionsFetchRequested:this.onSuggestionsFetchRequested.bind(this),onSuggestionSelected:this.onSuggestionSelected.bind(this),getSuggestionValue:this.getSuggestionValue,renderSuggestion:this.renderSuggestion,renderSectionTitle:this.renderSectionTitle,getSectionSuggestions:this.getSectionSuggestions,onSuggestionHighlighted:this.onSuggestionHighlighted.bind(this),highlightFirstSuggestion:!1,renderInputComponent:this.renderInputComponent,focusInputOnSuggestionClick:!this.isMob,inputProps:{placeholder:"Type 'remote'",value:e,onChange:(o,g)=>this.onChange(o,g),autoFocus:!0}}),n&&u.jsx("div",{className:"no-suggestions",children:"No questions to suggest"})]})}async getSuggestions(e){const t=x(e.trim());if(t==="")return[];if(e.length<3)return[];const n=new Map,o=[];try{console.log("--------->>>>> getSuggestions");var g=await this.searchQuestions(t,10);g.forEach(s=>{const{topId:l,parentId:i,id:a,title:r,numOfAssignedAnswers:c,included:h}=s,d=new f(s).questionKey;if(!o.includes(d)){o.push(d);const S={topId:l,parentId:i,id:a,numOfAssignedAnswers:c,title:r,categoryTitle:"",included:h};n.has(i)?n.get(i).push(S):n.set(i,[S])}})}catch(s){console.debug(s)}if(o.length===0)return[];try{let s=[];return n.forEach((l,i)=>{const a={id:i,categoryTitle:"",categoryParentTitle:"kuro",parentCategoryUp:"",questionRows:[]};if(i!==null){const r=this.allCategoryRows.get(i);if(r){const{title:c,titlesUpTheTree:h}=r;a.categoryTitle=c,a.parentCategoryUp=h}else alert(`${i} Not found in allCats`)}l.forEach(r=>{a.questionRows.push(r)}),s.push(a)}),s}catch(s){console.log(s)}return[]}onSuggestionsClearRequested=()=>{this.setState({suggestions:[],noSuggestions:!1})};onSuggestionSelected(e,t){e.preventDefault();const n=t.suggestion,{topId:o,parentId:g,id:s}=n;this.props.onSelectQuestion({topId:o,parentId:g,id:s},this.state.value)}renderSuggestion(e,t){const n=R(e.title,t.query),o=b(e.title,n);return u.jsx("span",{className:"d-inline-block text-truncate",style:{textAlign:"left"},children:o.map((g,s)=>{const l=g.highlight?"react-autosuggest__suggestion-match":void 0;return u.jsx("span",{className:`${l??""}`,children:g.text},s)})})}renderSectionTitle(e){const{parentCategoryUp:t}=e;return u.jsx("span",{children:t})}renderInputComponent(e){const{ref:t,...n}=e;return u.jsx("div",{children:u.jsx("input",{ref:t,autoFocus:!0,...n})})}onChange(e,{newValue:t}){e.preventDefault(),this.setState({value:t})}async onSuggestionsFetchRequested({value:e}){return this.debouncedLoadSuggestions(e)}getSuggestionValue(e){return e.title}getSectionSuggestions(e){return e.questionRows}onSuggestionHighlighted(e){this.setState({highlighted:e.suggestion})}}export{A};
//# sourceMappingURL=AutoSuggestQuestions-D6t-fky2.js.map
