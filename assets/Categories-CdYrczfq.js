const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AssignedAnswers-VLI0pKRD.js","assets/index-tJZqaoPT.js","assets/index-CykrPP6v.css","assets/Options-Br8K7PKj.js","assets/lib-DgbivQqg.js","assets/AutoSuggestAnswers-D5-KD1Ym.js","assets/AutoSuggestAnswers-vl2QUoNQ.css","assets/AutoSuggestQuestions-BKWdnxr0.js","assets/AutoSuggestQuestions-DN6HBK-e.css"])))=>i.map(i=>d[i]);
import{A as s,d as wt,a as ht,b as Ct,F as f,I as me,u as ve,c as ne,r as m,C as Se,e as fe,f as ae,g as Ge,h as Rt,Q as Fe,i as ue,j as Tt,k as he,l as St,m as _t,n as e,B as H,_ as Nt,o as Ue,R as ye,D as xe,p as ge,q as It,s as vt,t as jt}from"./index-tJZqaoPT.js";import{L as oe,F as re,f as Me,a as Pe,u as Ce,B as Re,b as Be,c as $e,d as Ve,e as _e,g as j,S as je,h as Ne,s as Ot,i as At,C as Ke,j as ze,Q as Ye,k as Oe,l as Qt,m as bt,n as Dt,o as kt,p as Lt,M as we}from"./Options-Br8K7PKj.js";import{f as qt,a as Gt}from"./lib-DgbivQqg.js";import{A as Ft}from"./AutoSuggestQuestions-BKWdnxr0.js";const Ie={topId:"",parentId:"null",id:"generateId",categoryTitle:"",title:"",assignedAnswers:[],numOfAssignedAnswers:0,relatedFilters:[],numOfRelatedFilters:0,source:0,status:0,included:!1},We={topId:"null",parentId:"null",id:"define at BackEnd",kind:0,title:"",link:"",header:"",level:0,variations:[],hasSubCategories:!1,categoryRows:[],questionRows:[],numOfQuestions:0,hasMoreQuestions:!1,isExpanded:!1,doc1:""},Ut=(t,i)=>{console.log("------------------------------->"),console.log("------------------------------->",i.type),console.log("------------------------------->");const{categoryRow:u}=i.payload;if(i.type===s.SET_FROM_LOCAL_STORAGE){const{keyExpanded:p}=i.payload;return{...t,keyExpanded:p}}let o=u?!wt.includes(i.type):!1;const{topRows:c}=t,n=ht.includes(i.type)?{...t}:Mt(t,i);if(o&&u){let p;const{topId:x,id:C}=u;if(C===x)p=c.map(T=>T.id===x?new J(u).categoryRow:new J(T).categoryRow);else{const T=c.find(h=>h.id===x);J.idToSet=C,J.newCategoryRow=u;const a=new J(T).categoryRow;p=c.map(h=>h.id===x?a:new J(h).categoryRow),J.idToSet=""}n.topRows=p}if(Ct.includes(i.type)){const{keyExpanded:p}=n,x={keyExpanded:p};localStorage.setItem("CATEGORIES_STATE",JSON.stringify(x))}return console.log("CategoryReducer newState",n),n},Mt=(t,i)=>{switch(i.type){case s.SET_TOP_ROWS_LOADING:return{...t,loadingCategories:!0,topRowsLoading:!0,topRowsLoaded:!1};case s.SET_TOP_ROWS:{const{topRows:o}=i.payload;return console.log("=> CategoriesReducer ActionTypes.SET_TOP_ROWS",t.topRows,o),{...t,topRows:o,topRowsLoading:!1,topRowsLoaded:!0,loadingCategories:!1}}case s.SET_ALL_CATEGORY_ROWS:{const{allCategoryRows:o}=i.payload;return{...t,allCategoryRows:o,allCategoryRowsLoaded:Date.now()}}case s.SET_NODE_EXPANDING_UP_THE_TREE:{const{categoryId_questionId_done:o}=i.payload;return{...t,categoryId_questionId_done:o,nodeOpening:!0,loadingCategories:!0,nodeOpened:!1,activeCategory:null,activeQuestion:null}}case s.SET_NODE_EXPANDED_UP_THE_TREE:{const{category:o,formMode:c,questionId:n,question:p}=i.payload;return{...t,activeCategory:o,activeQuestion:p,selectedQuestionId:n,formMode:c,nodeOpening:!1,nodeOpened:!0,loadingCategories:!1}}case s.SET_LOADING_CATEGORY:return{...t,loadingCategory:!0,categoryLoaded:!1};case s.FORCE_OPEN_NODE:const{keyExpanded:u}=i.payload;return{...t,topRows:t.topRows.filter(o=>o.parentId===null),keyExpanded:u,nodeOpened:!1,activeCategory:null,activeQuestion:null,selectedQuestionId:null};case s.SET_SUB_CATEGORIES:return{...t,loadingCategory:!1};case s.SET_ERROR:{const{error:o,whichRowId:c}=i.payload;return{...t,error:o,whichRowId:c,loadingCategories:!1,loadingQuestions:!1,loadingCategory:!1,categoryLoaded:!1,loadingQuestion:!1,questionLoaded:!1}}case s.ADD_SUB_CATEGORY:{const{categoryKey:o,level:c}=i.payload,{topId:n}=o,p={...We,topId:n,level:c,parentId:""};return{...t,activeCategory:p,formMode:f.AddingCategory}}case s.SET_CATEGORY:{const{categoryRow:o}=i.payload;return console.assert(me(o)),{...t,loadingCategory:!1,categoryLoaded:!0,activeCategory:o,activeQuestion:null,selectedQuestionId:null}}case s.SET_ROW_EXPANDING:return{...t,rowExpanding:!0,rowExpanded:!1,loadingCategories:!0};case s.SET_ROW_EXPANDED:{const{categoryRow:o}=i.payload,{topId:c,id:n}=o,{keyExpanded:p}=t,x=p?p.questionId:null;return{...t,loadingCategories:!1,keyExpanded:{topId:c,categoryId:n,questionId:x},activeQuestion:null,selectedQuestionId:x,loadingQuestion:!1,questionLoaded:!1,rowExpanding:!1,rowExpanded:!0}}case s.SET_ROW_COLLAPSED:{const{categoryRow:o}=i.payload,{topId:c,parentId:n}=o;return{...t,loadingCategories:!1,keyExpanded:{topId:c,categoryId:n??"",questionId:null},rowExpanding:!1,rowExpanded:!0,activeCategory:null,activeQuestion:null,selectedQuestionId:null}}case s.SET_CATEGORY_TO_VIEW:{const{categoryRow:o}=i.payload;console.assert(me(o));const n={...o,isExpanded:!1};return{...t,formMode:f.ViewingCategory,loadingCategory:!1,activeCategory:n,activeQuestion:null,selectedQuestionId:null}}case s.SET_CATEGORY_TO_ADD_TOP:{const{newCategoryRow:o}=i.payload;return{...t,loadingCategory:!1,categoryLoaded:!0,activeCategory:{...o,doc1:""},activeQuestion:null,selectedQuestionId:null,topRows:[o,...t.topRows],formMode:f.AddingCategory}}case s.SET_CATEGORY_TO_ADD:{const{newCategoryRow:o}=i.payload;return{...t,loadingCategory:!1,categoryLoaded:!0,activeCategory:{...o,doc1:""},activeQuestion:null,selectedQuestionId:null,formMode:f.AddingCategory}}case s.SET_CATEGORY_ADDED:{const{categoryRow:o}=i.payload;console.assert(me(o));const n={...o,isExpanded:!1},{topId:p,id:x}=n;return{...t,formMode:f.EditingCategory,loadingCategory:!1,categoryLoaded:!1,activeCategory:n,activeQuestion:null,selectedQuestionId:null,keyExpanded:{topId:p,categoryId:x,questionId:null},nodeOpened:!1}}case s.SET_CATEGORY_TO_EDIT:case s.SET_CATEGORY_UPDATED:{const{categoryRow:o,category:c}=i.payload;console.assert(me(o));const{topId:n,id:p}=c;return{...t,formMode:f.EditingCategory,loadingCategory:!1,categoryLoaded:!0,keyExpanded:{topId:n,categoryId:p,questionId:null},activeCategory:c,activeQuestion:null,selectedQuestionId:null}}case s.SET_CATEGORY_QUESTIONS_LOADING:return{...t,loadingQuestions:!0,questionLoaded:!1};case s.CATEGORY_QUESTIONS_LOADED:return{...t,loadingQuestions:!1};case s.DELETE_CATEGORY:return{...t,activeCategory:null,formMode:f.None,error:void 0,whichRowId:void 0};case s.CANCEL_CATEGORY_FORM:case s.CLOSE_CATEGORY_FORM:return{...t,activeCategory:null,formMode:f.None};case s.CANCEL_ADD_SUB_CATEGORY:return{...t,activeCategory:null,activeQuestion:null,selectedQuestionId:null,formMode:f.None};case s.SET_LOADING_QUESTION:return{...t,loadingQuestion:!0,questionLoaded:!1};case s.CANCEL_ADD_QUESTION:return{...t,formMode:f.None,activeQuestion:null,selectedQuestionId:null};case s.SET_QUESTION_SELECTED:{const{questionKey:o}=i.payload,{topId:c,parentId:n,id:p}=o;return{...t,topRows:t.topRows.filter(x=>x.parentId===null),keyExpanded:{topId:c,categoryId:n,questionId:p},nodeOpened:!1,activeCategory:null,activeQuestion:null,selectedQuestionId:null}}case s.ADD_NEW_QUESTION_TO_ROW:{const{newQuestionRow:o}=i.payload;return{...t,selectedQuestionId:o.id}}case s.SET_QUESTION:{const{question:o,formMode:c}=i.payload;return console.log(s.SET_QUESTION,o),{...t,activeCategory:null,activeQuestion:o,formMode:c,error:void 0,loadingCategory:!1,loadingQuestion:!1,questionLoaded:!0}}case s.SET_QUESTION_AFTER_ASSIGN_ANSWER:{const{question:o}=i.payload;return{...t,activeQuestion:o,loadingQuestion:!1,questionLoaded:!0}}case s.SET_QUESTION_TO_VIEW:{const{question:o}=i.payload,{keyExpanded:c}=t;return{...t,formMode:f.ViewingQuestion,keyExpanded:c,activeQuestion:o,loadingQuestion:!1,questionLoaded:!0}}case s.SET_QUESTION_TO_EDIT:{const{question:o}=i.payload,{topId:c,id:n,parentId:p}=o;return{...t,keyExpanded:{topId:c,categoryId:p,questionId:n},activeQuestion:o,formMode:f.EditingQuestion,selectedQuestionId:o.id,loadingQuestion:!1,questionLoaded:!0}}case s.QUESTION_DELETED:return{...t,activeQuestion:null,selectedQuestionId:null,formMode:f.None,loadingQuestion:!1,questionLoaded:!0};case s.CANCEL_QUESTION_FORM:case s.CLOSE_QUESTION_FORM:return{...t,formMode:f.None,activeQuestion:null,selectedQuestionId:null};default:return alert(`Action ${i.type} not allowed`),{...t}}};class J{static idToSet;static newCategoryRow;constructor(i){const{topId:u,id:o,parentId:c,title:n,link:p,kind:x,header:C,level:T,variations:a,numOfQuestions:h,hasSubCategories:O,categoryRows:I,created:A,modified:G,questionRows:Q,isExpanded:$}=i,R=I.map(b=>(console.log("DeepClone >>>>>>>>>>>>>>>",b.id),b.id===J.idToSet?{...J.newCategoryRow}:new J(b).categoryRow));this.categoryRow={topId:u,parentId:c,id:o,kind:x,title:n,link:p,header:C,level:T,hasSubCategories:O,categoryRows:R,numOfQuestions:h,questionRows:Q,variations:a??[],created:A,modified:G,isExpanded:$}}categoryRow}const He=m.createContext({}),Xe=m.createContext(()=>null),Pt={formMode:f.None,allCategoryRows:new Map,allCategoryRowsLoaded:void 0,topRows:[],topRowsLoading:!1,topRowsLoaded:!1,nodeOpening:!1,nodeOpened:!1,keyExpanded:null,categoryId_questionId_done:void 0,activeCategory:null,activeQuestion:null,selectedQuestionId:null,loadingCategories:!1,loadingQuestions:!1,loadingCategory:!1,categoryLoaded:!1,loadingQuestion:!1,questionLoaded:!1,error:void 0,rowExpanding:!1,rowExpanded:!1},Bt=({children:t})=>{const{loadAllCategoryRowsGlobal:i}=ve(),u=ne(),{KnowledgeAPI:o,isAuthenticated:c,workspace:n,authUser:p,canEdit:x}=u,{nickName:C}=p,[T,a]=m.useReducer(Ut,Pt),{formMode:h,activeCategory:O,activeQuestion:I,keyExpanded:A,topRows:G,allCategoryRows:Q,allCategoryRowsLoaded:$}=T;console.log("----->>> ----->>> ----->>> CategoryProvider"),m.useEffect(()=>{let l=n==="SLINDZA"?{topId:"QUESTIONS",categoryId:"QUESTIONS",questionId:"qqqqqq111"}:{topId:"MTS",categoryId:"REMOTECTRLS",questionId:"qqqqqq111"};if("localStorage"in window){let r=localStorage.getItem("CATEGORIES_STATE");if(console.log("CATEGORIES_STATE loaded before signIn",r),r!==null){const y=JSON.parse(r);y.keyExpanded!==null&&(l=y.keyExpanded)}}a({type:s.SET_FROM_LOCAL_STORAGE,payload:{keyExpanded:l}})},[n]);const R=m.useCallback(async(l,r,y=null,g=void 0)=>{const d=localStorage.getItem("accessToken");if(d)try{console.log("------Execute endpoint:",r);let E=null;const w=new Headers,_=`Bearer ${d}`;w.append("Authorization",_),y&&w.append("Content-Type","application/json");let L={method:l,headers:w,body:y?JSON.stringify(y):null};if(E=await fetch(r,L),E.ok){if(E.status===200||E.status===201){let z=null;try{z=await E.json()}catch{a({type:s.SET_ERROR,payload:{error:new Error(`Response status: ${E.status}`),whichRowId:g}})}finally{return z}}}else{const{errors:z}=await E.json(),Y=new Error(z?.map(ee=>ee.message).join(`
`)??"unknown");a({type:s.SET_ERROR,payload:{error:Y,whichRowId:g}})}}catch(E){console.log("-------------->>> execute",l,r,E),a({type:s.SET_ERROR,payload:{error:new Error("fetch eror"),whichRowId:g}})}return null},[]),b=m.useCallback(async()=>new Promise(async l=>{const r=await i();a(r?{type:s.SET_ALL_CATEGORY_ROWS,payload:{allCategoryRows:r}}:{type:s.SET_ERROR,payload:{error:new Error("Zajeb allCategoryRows")}}),l(r)}),[i]),B=m.useCallback(async l=>{try{return Q.get(l)}catch(r){console.log(r),a({type:s.SET_ERROR,payload:{error:r}})}},[Q]);m.useEffect(()=>{(async()=>$===void 0&&await b())()},[$,b]);const N=m.useCallback(async l=>{try{let r="";const y=[];return Q.forEach((g,d)=>{d===l?r="":g.parentId===l&&y.push(g)}),{subCats:y,parentHeader:r}}catch(r){return console.log(r),a({type:s.SET_ERROR,payload:{error:r}}),{subCats:[],parentHeader:"Kiks subCats"}}},[Q]),F=m.useCallback(async()=>new Promise(async l=>{try{a({type:s.SET_TOP_ROWS_LOADING,payload:{}});const r=`${o.endpointCategoryRow}/${n}/null/topRows/all`;console.log("CategoryProvider loadTopRows url:",r),console.log("loadTopRows AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"),console.time(),await R("GET",r).then(y=>{console.timeEnd(),console.log("loadTopRows BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB");const g=y.map(d=>(d.IsExpanded=A?d.Id===A.categoryId:!1,new Se(d).categoryRow));a({type:s.SET_TOP_ROWS,payload:{topRows:g}}),l(!0)})}catch(r){console.log(r),a({type:s.SET_ERROR,payload:{error:r}})}}),[R,o.endpointCategoryRow,A,n]),q=m.useCallback(async(l,r)=>{const{topId:y,id:g}=l;return console.log({categoryKey:l,includeQuestionId:r}),new Promise(async d=>{try{const E=`${o.endpointCategory}/${n}/${y}/${g}/${pe}/${r}`;console.time(),console.log("================ getCategory ======================="),await R("GET",E).then(w=>{console.timeEnd();const{categoryDto:_,msg:L}=w;d(_?new fe(_).category:new Error(L))})}catch(E){console.log(E),d(E)}})},[R,o.endpointCategory,n]),D=m.useCallback(async(l,r)=>{if(l.topId===r)return l;const{categoryRows:y}=l;let g=y.find(d=>d.id===r);if(!g)for(const d of y){const E=await D(d,r);if(E){g=E,console.log("findCategory Stop the loop for: "+r);break}}return g},[]),k=m.useCallback(async(l,r,y=!1)=>new Promise(async g=>{try{let{topId:d,parentId:E,id:w}=l;if(console.assert(w!==null,"id ne sme biti null u expandNodesUpToTheTree"),w){const Y=Q.get(w);Y?(d=Y.topId,E=Y.parentId):alert("reload all categoryRow:"+w)}a({type:s.SET_NODE_EXPANDING_UP_THE_TREE,payload:{fromChatBotDlg:y,categoryId_questionId_done:`${w}_${r}`}}),console.time();const _={topId:d,id:w,parentId:null},L=new ae(_).toQuery(n),z=`${o.endpointCategoryRow}?${L}&pageSize=${pe}&includeQuestionId=${r??null}`;await R("GET",z).then(async Y=>{const{categoryRowDto:ee}=Y;if(console.timeEnd(),ee){let le=null,de=null,ce=new Se(ee).categoryRow;if(E!==null){const ke=await D(ce,w);if(le={...ke,doc1:""},r){const Le=ke.questionRows.find(qe=>qe.id===r&&qe.included);Le&&(le=null,de={...Le,assignedAnswers:[],numOfAssignedAnswers:0,numOfRelatedFilters:0,relatedFilters:[],source:0,status:0})}}console.log(">>> expandNodeUpToTheTree categoryRow",{categoryRow:ce,questionId:"'"+(r??"jok")+"'"+(r??"JOK")});const Te=r?x?f.EditingQuestion:f.ViewingQuestion:x?f.EditingCategory:f.ViewingCategory;a({type:s.SET_NODE_EXPANDED_UP_THE_TREE,payload:{catKey:l,categoryRow:ce,category:le,questionId:r??null,question:de,formMode:Te,fromChatBotDlg:y}}),g(!0)}else g(!1)})}catch(d){console.log(d),a({type:s.SET_ERROR,payload:{error:d}})}}),[n,o.endpointCategoryRow,R,Q,D,x]),P=m.useCallback(async(l,r=!1,y=null)=>{const g=new ae(l).toQuery(n);return new Promise(async d=>{try{const E=`${o.endpointCategoryRow}/${r}/${pe}/${y}?${g}`;console.time(),await R("GET",E).then(w=>{console.timeEnd();const{categoryRowDto:_,msg:L}=w;d(_?new Se(_).categoryRow:new Error(L))})}catch(E){console.log(E),d(E)}})},[R,o.endpointCategoryRow,n]),U=m.useCallback(async({categoryKey:l,includeQuestionId:r,newQuestionRow:y,formMode:g})=>{try{a({type:s.SET_ROW_EXPANDING,payload:{}});const d=await P(l,!0,r);if(d instanceof Error)a({type:s.SET_ERROR,payload:{error:d}}),console.error({cat:d});else{let E;return r&&d.questionRows.filter(w=>w.included).length>0&&(E=r),y&&(d.questionRows=[y,...d.questionRows]),d.isExpanded=!0,console.log("@@@@@@@@@@@@@@@@@ expandCategory:",g,r),g===f.None&&r&&(g=x?f.EditingQuestion:f.ViewingQuestion),a({type:s.SET_ROW_EXPANDED,payload:{categoryRow:d,formMode:g,selectedQuestionId:E}}),d}}catch(d){return console.log("error",d),a({type:s.SET_ERROR,payload:{error:d}}),null}},[x,P]),Z=m.useCallback(async l=>{const{topId:r,id:y}=l,g=G.find(E=>E.id===r),d=await D(g,y);d?(l={...d,isExpanded:!1,categoryRows:[],questionRows:[]},a({type:s.SET_ROW_COLLAPSED,payload:{categoryRow:l}})):a({type:s.SET_ERROR,payload:{error:new Error("findCategory sranje"),whichRowId:y}})},[D,G]),S=m.useCallback(async l=>{try{a({type:s.CLOSE_CATEGORY_FORM,payload:{}});const{topId:r,id:y,parentId:g,level:d}=l??{topId:"generateId",id:"generateId",parentId:null,level:0},E={...We,topId:r,parentId:l?y:g,id:"generateId",level:d+1,title:"",isExpanded:!1};if(l===null)a({type:s.SET_CATEGORY_TO_ADD_TOP,payload:{newCategoryRow:E}});else{const w={...l,level:d+1,categoryRows:[E,...l.categoryRows],hasSubCategories:!0,isExpanded:!0};a({type:s.SET_CATEGORY_TO_ADD,payload:{categoryRow:w,newCategoryRow:E}})}}catch(r){console.log("error",r),a({type:s.SET_ERROR,payload:{error:r}})}},[]),K=m.useCallback(async()=>{try{const{topId:l,id:r,parentId:y}=O,d={categoryKey:{topId:l,parentId:y,id:r},formMode:f.None},E=await U(d);E&&a({type:s.CANCEL_ADD_SUB_CATEGORY,payload:{categoryRow:E}})}catch(l){console.log("error",l),a({type:s.SET_ERROR,payload:{error:l}})}},[O,U]),se=m.useCallback(async l=>{const{id:r}=l;a({type:s.SET_LOADING_CATEGORY,payload:{}});try{const y=new Ge(l,n).categoryDto;console.log("categoryDto",{categoryDto:y});const g=`${o.endpointCategory}`;console.time(),await R("POST",g,y,r).then(async d=>{console.timeEnd();const{categoryDto:E}=d;if(E){const w=new fe(E).category;console.log("Category successfully created",{category:w}),await b().then(async()=>{await F(),w.parentId===null?a({type:s.SET_CATEGORY_ADDED,payload:{categoryRow:w}}):a({type:s.SET_CATEGORY_ADDED,payload:{categoryRow:w}})})}})}catch(y){console.log(y),a({type:s.SET_ERROR,payload:{error:new Error("Server Error"),whichRowId:r}})}},[R,o.endpointCategory,b,F,n]),v=m.useCallback(async()=>{try{const{topId:l,parentId:r}=I,g={categoryKey:{topId:l,parentId:r,id:r},formMode:f.None},d=await U(g);d&&a({type:s.CANCEL_ADD_QUESTION,payload:{categoryRow:d}})}catch(l){console.log("error",l),a({type:s.SET_ERROR,payload:{error:l}})}},[I,U]),M=m.useCallback(async(l,r)=>{h===f.AddingQuestion?await v():h===f.AddingCategory&&await K(),a({type:s.SET_LOADING_CATEGORY,payload:{categoryRow:l}});const y=new ae(l).categoryKey,g=await q(y,r);g instanceof Error?a({type:s.SET_ERROR,payload:{error:g}}):(g.topId=l.topId,a({type:s.SET_CATEGORY_TO_VIEW,payload:{categoryRow:g}}))},[K,v,h,q]),W=m.useCallback(async(l,r)=>{h===f.AddingQuestion?await v():h===f.AddingCategory&&await K(),a({type:s.SET_LOADING_CATEGORY,payload:{}});const y=new ae(l).categoryKey,g=await q(y,r);if(g instanceof Error)a({type:s.SET_ERROR,payload:{error:g}});else{const d={...g,isExpanded:!1,categoryRows:[],questionRows:[]};a({type:s.SET_CATEGORY_TO_EDIT,payload:{categoryRow:d,category:g}})}},[K,v,h,q]),X=m.useCallback(async l=>{a({type:s.SET_LOADING_CATEGORY,payload:{}});try{const r=new Ge(l,n).categoryDto,y=`${o.endpointCategory}`;console.time(),await R("PUT",y,r).then(g=>{console.timeEnd();const{categoryDto:d,msg:E}=g;if(d){const w=new fe(d).category,{topId:_}=w;w.isExpanded=!1,w.topId=_,a({type:s.SET_CATEGORY_UPDATED,payload:{category:w}})}else a({type:s.SET_ERROR,payload:{error:new Error(`${E}`)}})})}catch(r){return console.log(r),a({type:s.SET_ERROR,payload:{error:new Error("Karambol")}}),r}},[R,o.endpointCategory,n]),ie=m.useCallback(async l=>{try{const{topId:r,parentId:y}=l,g=new Rt(l,n).categoryRowDto,d=`${o.endpointCategory}`;console.time(),await R("DELETE",d,g).then(async E=>{console.timeEnd();const{categoryDto:w,msg:_}=E;_==="OK"?(console.log("Category successfully deleted",{categoryRow:l}),await b().then(async()=>{const L={categoryKey:{topId:r,parentId:"",id:y},formMode:f.None};y?await F():await U(L).then(()=>{})})):a(_==="HasSubCategories"?{type:s.SET_ERROR,payload:{error:new Error("First remove sub categories"),whichRowId:w.Id}}:_==="HasQuestions"?{type:s.SET_ERROR,payload:{error:new Error("First remove category questions"),whichRowId:w.Id}}:{type:s.SET_ERROR,payload:{error:new Error(_),whichRowId:w.Id}})})}catch(r){return console.log(r),r}},[R,o.endpointCategory,U,b,F,n]),it=async(l,r)=>{try{console.log("Deleting Category Tag...",{categoryKey:l,variationName:r}),console.log("Category Tag successfully deleted")}catch(y){console.log("error",y),a({type:s.SET_ERROR,payload:{error:y}})}},pe=12,lt=m.useCallback(async({categoryKey:l,startCursor:r,includeQuestionId:y})=>{try{const{topId:g,id:d}=l;a({type:s.SET_CATEGORY_QUESTIONS_LOADING,payload:{}});try{const E=`${o.endpointQuestion}/${n}/${g}/${d}/${r}/${pe}/${y}`;console.time(),await R("GET",E).then(w=>{console.timeEnd();const{categoryDto:_}=w;if(_!==null){const L=new fe(_).category;a({type:s.CATEGORY_QUESTIONS_LOADED,payload:{categoryRow:L}})}})}catch(E){console.log(E),a({type:s.SET_ERROR,payload:{error:E}})}}catch(g){console.log(g),a({type:s.SET_ERROR,payload:g})}},[R,o.endpointQuestion,n]),dt=m.useCallback(async(l,r)=>{try{const{topId:y,id:g}=l;let d=await B(g);if(!d){alert(`Not found ${g}. Reload all Categories`);return}const E={topId:y,parentId:l.id,id:"generateId",title:"question text",categoryTitle:d.title,numOfAssignedAnswers:0,included:!0},w={...Ie,...E,title:""};if(console.assert(r),r){const _=T.topRows.find(z=>z.id===y),L=await D(_,g);L.questionRows=[E,...L.questionRows],a({type:s.ADD_NEW_QUESTION_TO_ROW,payload:{categoryRow:L,newQuestionRow:E}}),a({type:s.SET_QUESTION,payload:{question:w,formMode:f.AddingQuestion}})}}catch(y){console.log("error",y),a({type:s.SET_ERROR,payload:{error:y}})}},[U,D,B,T.topRows]),ct=m.useCallback(async l=>{const{topId:r,id:y,parentId:g}=l;a({type:s.SET_LOADING_CATEGORY,payload:{}});try{l.created.nickName=C;const d=new Fe(l,n).questionDto,E=`${o.endpointQuestion}`;console.time(),console.log(">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> createQuestion",d),await R("POST",E,d).then(async w=>{if(console.timeEnd(),w){console.log("::::::::::::::::::::",{questionDtoEx:w});const{questionDto:_}=w;if(_){const L=new ue(_).question;L.topId=r,console.log("Question successfully created"),await b().then(async()=>{const Y={categoryKey:{topId:r,parentId:g,id:g},formMode:f.EditingQuestion};await U(Y).then(()=>{a({type:s.SET_QUESTION,payload:{formMode:f.EditingQuestion,question:L}})})})}}})}catch(d){console.log(d),a({type:s.SET_ERROR,payload:{error:new Error("Server Error"),whichRowId:y}})}},[R,o.endpointQuestion,U,b,C,n]),ut=m.useCallback(async(l,r,y)=>{const{id:g}=r;try{r.modified.nickName=C;const d=new Fe(r,n).questionDto,E=`${o.endpointQuestion}`;console.time(),d.oldParentId=l,console.log(">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> updateQuestion",d);let w=null;return await R("PUT",E,d).then(async _=>{console.timeEnd();const{questionDto:L,msg:z}=_;if(L){w=new ue(L).question,console.log("Question successfully updated: ",w);const{topId:Y,parentId:ee}=w;if(y){const{topId:le,parentId:de,id:ce}=w,Te={topId:le,categoryId:de,questionId:ce};a({type:s.FORCE_OPEN_NODE,payload:{keyExpanded:Te}})}else{const de={categoryKey:{topId:Y,parentId:ee,id:ee},formMode:f.EditingQuestion};await U(de).then(()=>{a({type:s.SET_QUESTION,payload:{formMode:f.EditingQuestion,question:w}})})}}else a({type:s.SET_ERROR,payload:{error:new Error(z)}})}),w}catch(d){console.log(d),a({type:s.SET_ERROR,payload:{error:new Error("Server Error"),whichRowId:g}})}},[R,o.endpointQuestion,U,C,n]),gt=m.useCallback(async(l,r)=>{const{id:y,parentId:g,topId:d}=l;a({type:s.SET_LOADING_QUESTION,payload:{}});try{const E=new Tt(l,n).questionRowDto,w=`${o.endpointQuestion}`;console.time(),await R("DELETE",w,E).then(async _=>{const{questionDto:L}=_;if(console.timeEnd(),L){const z=new ue(L).question;console.log("Question successfully deleted"),r&&a({type:s.QUESTION_DELETED,payload:{question:z}});const ee={categoryKey:{topId:d,parentId:g,id:g},formMode:f.None};await U(ee).then(()=>{})}else console.error(_),a({type:s.SET_ERROR,payload:{error:new Error("Server Error"),whichRowId:y}})})}catch(E){console.log(E),a({type:s.SET_ERROR,payload:{error:new Error("Server Error"),whichRowId:y}})}},[R,o.endpointQuestion,U,n]),Ee=m.useCallback(async l=>new Promise(async r=>{try{const y=new he(l).toQuery(n),g=`${o.endpointQuestion}?${y}`;console.time(),console.log("getQuestion",l),await R("GET",g).then(d=>{console.timeEnd();const{questionDto:E,msg:w}=d;if(E){const _={question:new ue(E).question,msg:w};r(_)}else r({question:null,msg:w})})}catch(y){console.log(y),r({question:null,msg:"Problemos"})}}),[R,o.endpointQuestion,n]),yt=m.useCallback(async l=>{const r=new he(l).questionKey;a({type:s.SET_LOADING_QUESTION,payload:{}});const y=await Ee(r);h===f.AddingQuestion?await v():h===f.AddingCategory&&await K();const{question:g,msg:d}=y;g?(g.topId=l.topId,a({type:s.SET_QUESTION_TO_VIEW,payload:{question:g}})):a({type:s.SET_ERROR,payload:{error:new Error(d)}})},[K,v,h,Ee]),pt=m.useCallback(async l=>{const r=new he(l).questionKey;h===f.AddingQuestion?await v():h===f.AddingCategory&&await K(),a({type:s.SET_LOADING_QUESTION,payload:{}}),console.log("editQuestion:",r);const y=await Ee(r),{question:g,msg:d}=y;g?(g.topId=l.topId,a({type:s.CLOSE_QUESTION_FORM,payload:{question:g}}),a({type:s.SET_QUESTION_TO_EDIT,payload:{question:g}})):a({type:s.SET_ERROR,payload:{error:new Error(d)}})},[K,v,h,Ee]),Et=m.useCallback(async(l,r,y)=>{try{var{topId:g,id:d}=y,E={topId:g,id:d,created:{time:new Date,nickName:C}};const w=new St(E).assignedAnswerDto;w.QuestionKeyDto=new _t(r,n).dto;let _=null;const L=`${o.endpointQuestionAnswer}/${l}`;console.time(),await R("POST",L,w).then(async z=>{console.timeEnd();const{questionDto:Y}=z;console.log("::::::::::::::::::::",{questionDtoEx:z}),Y&&(_=new ue(Y).question,console.log("Question successfully modified"))}),_&&a({type:s.SET_QUESTION_AFTER_ASSIGN_ANSWER,payload:{question:_}})}catch(w){console.log("error",w),a({type:s.SET_ERROR,payload:{error:w}})}},[R,o.endpointQuestionAnswer,C,n]),mt=m.useCallback(async(l,r,y)=>{const g=G.find(E=>E.id===l);let d=await D(g,r);console.log("Provider onCategoryTitleChanged:",y),d.title!==y&&(d.title=y,a({type:s.CATEGORY_TITLE_CHANGED,payload:{categoryRow:d}}))},[D,G]),ft=m.useCallback(async(l,r,y)=>{const{parentId:g,id:d}=r,E=await D(l,g);if(E){const w=E.questionRows.find(_=>_.id===d);w.title=y,console.log("onQuestionTitleChanged+++>>>",d,E),a({type:s.QUESTION_TITLE_CHANGED,payload:{categoryRow:E}})}},[D]),xt={state:T,loadAllCategoryRows:b,getSubCats:N,getCat:B,expandNodesUpToTheTree:k,loadTopRows:F,addSubCategory:S,cancelAddCategory:K,createCategory:se,viewCategory:M,editCategory:W,updateCategory:X,deleteCategory:ie,deleteCategoryVariation:it,expandCategory:U,collapseCategory:Z,onCategoryTitleChanged:mt,loadCategoryQuestions:lt,addQuestion:dt,cancelAddQuestion:v,createQuestion:ct,viewQuestion:yt,editQuestion:pt,updateQuestion:ut,deleteQuestion:gt,onQuestionTitleChanged:ft,assignQuestionAnswer:Et};return!c||!$?null:e.jsx(He.Provider,{value:xt,children:e.jsx(Xe.Provider,{value:a,children:t})})};function V(){return m.useContext(He)}const Ae=()=>m.useContext(Xe);var te=(t=>(t.SET_LOADING="SET_LOADING",t.SET_SUB_CATS="SET_SUB_CATS",t.SET_ERROR="SET_ERROR",t.SET_EXPANDED="SET_EXPANDED",t.SET_PARENT_CAT="SET_PARENT_CAT",t))(te||{});const $t=({cat:t,dispatch:i,setParentCat:u,selId:o})=>{const{topId:c,parentId:n,id:p,title:x,level:C,isExpanded:T}=t,a={topId:c,parentId:n,id:p},h=A=>{i({type:te.SET_EXPANDED,payload:{id:p,expanding:!T}})},O=A=>{u(A)},I=e.jsxs("div",{className:"d-flex justify-content-start align-items-center w-100 text-primary",children:[e.jsx(H,{variant:"link",size:"sm",className:"py-0 px-1",onClick:A=>{h(),A.stopPropagation(),A.preventDefault()},title:"Expand",children:e.jsx(re,{icon:T?Me:Pe,size:"lg"})}),e.jsx(H,{variant:"link",size:"sm",className:"py-0 mx-0 text-decoration-none",title:p,onClick:()=>O(t),children:x})]});return e.jsxs(e.Fragment,{children:[e.jsx(oe.Item,{variant:"primary",className:"py-0 px-1 w-100",as:"li",children:I}),T&&e.jsx(oe.Item,{className:"py-0 px-0",variant:"primary",as:"li",children:e.jsx(Ze,{selId:o,level:C+1,categoryKey:a,setParentId:u})})]})},Vt={loading:!1,parentId:null,title:"",cats:[]},Kt=(t,i)=>{switch(i.type){case te.SET_LOADING:return{...t,loading:!0};case te.SET_SUB_CATS:{const{subCats:u}=i.payload;return{...t,cats:t.cats.concat(u),loading:!1}}case te.SET_ERROR:{const{error:u}=i.payload;return{...t,error:u,loading:!1}}case te.SET_EXPANDED:{const{id:u,expanding:o}=i.payload;let{cats:c}=t;if(!o){const n=Je(c,u);console.log("clean:",n),n.length>0&&(c=c.filter(p=>!n.includes(p.id)))}return{...t,cats:t.cats.map(n=>n.id===u?{...n,isExpanded:o}:n)}}case te.SET_PARENT_CAT:{const{cat:u}=i.payload,{id:o,title:c}=u;return{...t,parentId:o,title:c}}default:return t}};function Je(t,i){let u=t.filter(o=>o.parentId===i).map(o=>o.id);return u.forEach(o=>{const c=o?Je(t,o):[];u=u.concat(c)}),u}const Ze=({selId:t,categoryKey:i,level:u,setParentId:o})=>{const[c,n]=m.useReducer(Kt,Vt),{getSubCats:p}=V(),{id:x}=i??{id:null},[C]=m.useState(i);m.useEffect(()=>{(async()=>{const h=await p(x),{subCats:O}=h;n({type:te.SET_SUB_CATS,payload:{subCats:O}})})()},[p,C,x]);const T=c.cats.filter(h=>h.parentId===x),a=h=>{n({type:te.SET_PARENT_CAT,payload:{cat:h}}),o(h)};return e.jsxs("div",{className:u>1?"border  border-7 ms-4 h-25":"border border-7  h-25",style:{overflowY:"auto"},children:[e.jsx(oe,{as:"ul",variant:"dark",className:"mb-0",children:T.filter(h=>h.id!==t).map(h=>e.jsx($t,{cat:h,selId:t,dispatch:n,setParentCat:a},h.id))}),c.error&&c.error.message]})},zt=({relatedFilter:t})=>{const{filter:i,numOfUsages:u,created:o,lastUsed:c}=t,{time:n,nickName:p}=o,x=`Created by: ${p}, ${qt(new Date(n))}`,C=!1,T=I=>{console.log("RelatedFilter onSelectAnswer",{filter:I})},[a,h]=Ce(),O=e.jsxs("div",{ref:a,className:"d-flex justify-content-start align-items-center w-100 text-light related-filter-row",children:[e.jsx(H,{variant:"link",size:"sm",className:"py-0 mx-0 title text-light text-wrap",title:x,onClick:()=>T(i),disabled:C,children:i}),e.jsxs(Re,{pill:!0,bg:"secondary",className:`text-light ${u===0?"d-none":"d-inline"}`,children:[u,u===1?" usage":" usages"]}),e.jsx("span",{className:"small ms-1",children:Gt(c.time)}),h]});return e.jsx(oe.Item,{className:"py-0 px-0",as:"li",children:O},i)},Yt=({relatedFilters:t})=>{const{globalState:i}=ve(),{variant:u}=i,{state:o}=V(),c=async n=>{console.log("RelatedFilters unAssignFilter",{relatedFilter:n})};return e.jsx("div",{className:"mx-0 my-1 border rounded-2 px-1 py-1border-light fs-6 related-filters",children:e.jsxs("div",{children:[e.jsx("label",{className:"text-muted",children:"Most frequently selected Filters (for the next Question in ChatBot)"}),t.length>0?e.jsx(oe,{as:"ul",variant:u,className:"my-1",children:t.map(n=>e.jsx(zt,{relatedFilter:n,unAssignFilter:c},n.filter))}):e.jsx("div",{className:"border text-light",children:"No filters"}),o.error&&e.jsx("div",{children:"state.error"})]})})},Qe=({question:t,submitForm:i,children:u,showCloseButton:o,source:c=0,closeModal:n})=>{const{state:p,onQuestionTitleChanged:x}=V();let{formMode:C,topRows:T}=p;const a=m.lazy(()=>Nt(()=>import("./AssignedAnswers-VLI0pKRD.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8])).then(v=>({default:v.default}))),h=C===f.ViewingQuestion,O=C===f.EditingQuestion,I=C===f.AddingQuestion,A=h,{topId:G,id:Q,assignedAnswers:$,relatedFilters:R,title:b}=t,B=new he(t).questionKey,N=Ae(),F=()=>{n?n():N({type:s.CLOSE_QUESTION_FORM,payload:{question:t}})},q=()=>{n?n():N({type:s.CANCEL_QUESTION_FORM,payload:{question:t}})},[D,k]=m.useState(Q+"/"+b),P=Be(D,500),[U]=m.useState(T.find(v=>v.id===G)),Z=m.useRef(null),S=$e({enableReinitialize:!0,initialValues:t,validationSchema:Ve().shape({title:_e().required("Required"),parentId:_e().required("Required").notOneOf(["000000000000000000000000"])}),onSubmit:v=>{i(v),k(v.id+"/"+v.title)}});m.useEffect(()=>{(async()=>{const M=P.split("/"),W=M[0];if(S.values.id===W){console.log("QuestionForm.useEffect - onQuestioTitleChanged",{debouncedSearchTerm:P,searchTerm:D,title:S.values.title});const X=M[1];await x(U,S.values,X)}})()},[P,S.values,x,D,U]),m.useEffect(()=>{Z.current.focus(),c!==0&&S.setFieldValue("source",c)},[S,Z,c]);const K=v=>{S.handleChange(v);const M=v.target.value;k(Q+"/"+M)},se=v=>{S.setFieldValue("parentId",v.id),S.setFieldValue("categoryTitle",v.title)};return console.log("@@@@@@@@@@@@@@@@@@@@@ QuestionForm.render: ",{searchTerm:D,qTitle:b,debouncedSearchTerm:P}),e.jsxs("div",{className:"form-wrapper px-3 py-1 my-0 my-1 w-100 question-form",children:[o&&e.jsx(Ue,{onClick:F,className:"float-end"}),e.jsx(ye,{className:"text-center",children:e.jsxs(j.Label,{children:["Question  ",h?"Viewing":O?"Editing":"Adding"]})}),e.jsxs(j,{onSubmit:S.handleSubmit,children:[e.jsxs(je,{direction:"horizontal",gap:0,className:"border",children:[e.jsx("div",{className:"p-0",children:e.jsx(j.Label,{children:"Category:"})}),e.jsx("div",{className:"p-1",children:e.jsxs(j.Group,{controlId:"parentId",className:"category-select form-select-sm w-90",children:[e.jsxs(xe,{children:[e.jsx(xe.Toggle,{variant:"light",id:"dropdown-basic",className:"px-2 py-0 text-primary border",disabled:A,children:e.jsx("span",{className:"text-wrap me-1",children:S.values.categoryTitle})}),e.jsx(xe.Menu,{className:"p-0 border",children:e.jsx(xe.Item,{className:"p-0 m-0 rounded-3",children:e.jsx(Ze,{selId:S.values.parentId,categoryKey:null,level:1,setParentId:se})})})]}),e.jsx(j.Control,{as:"input",name:"parentId",onChange:S.handleChange,value:S.values.parentId?S.values.parentId:"",placeholder:"Category",className:"text-primary w-100",disabled:A,hidden:!0}),e.jsx(j.Text,{className:"text-danger",children:S.touched.parentId&&S.errors.parentId?e.jsx("div",{className:"text-danger",children:S.errors.parentId?"required":""}):null})]})})]}),e.jsxs(j.Group,{controlId:"title",children:[e.jsx(j.Label,{children:"Title"}),e.jsx(j.Control,{as:"textarea",name:"title",placeholder:S.values.title==="new Question"?"new Question":"question text",ref:Z,onChange:K,value:S.values.title,rows:3,className:"text-primary w-100",disabled:A}),e.jsx(j.Text,{className:"text-danger",children:S.touched.title&&S.errors.title?e.jsx("div",{className:"text-danger",children:S.errors.title}):null})]}),e.jsxs(ye,{children:[e.jsx(ge,{children:e.jsxs(j.Group,{controlId:"source",children:[e.jsx(j.Label,{children:"Source"}),e.jsx(Ne,{id:"source",name:"source",options:Ot,onChange:(v,M)=>{v.preventDefault(),S.setFieldValue("source",M)},value:S.values.source,disabled:A,classes:"text-primary"}),e.jsx(j.Text,{className:"text-danger",children:S.touched.source&&S.errors.source?e.jsx("div",{className:"text-danger",children:S.errors.source}):null})]})}),e.jsx(ge,{children:e.jsxs(j.Group,{controlId:"status",children:[e.jsx(j.Label,{children:"Status"}),e.jsx(Ne,{id:"status",name:"status",options:At,onChange:(v,M)=>{v.preventDefault(),S.setFieldValue("status",M)},value:S.values.status,disabled:A,classes:"text-primary"}),e.jsx(j.Text,{className:"text-danger",children:S.touched.status&&S.errors.status?e.jsx("div",{className:"text-danger",children:S.errors.status}):null})]})})]}),(h||O)&&e.jsxs("div",{className:"my-1",children:[e.jsx(m.Suspense,{fallback:e.jsx("div",{children:"Loading..."}),children:e.jsx(a,{questionKey:B,questionTitle:D,assignedAnswers:$,isDisabled:A})}),e.jsx(Yt,{questionKey:B,questionTitle:D,relatedFilters:R}),e.jsx(Ke,{created:t.created,modified:t.modified,classes:"text-primary"})]}),(S.dirty&&O||I)&&e.jsx(ze,{cancelForm:q,handleSubmit:S.handleSubmit,title:u}),p.error&&e.jsx("div",{className:"text-danger",children:p.error.message})]})]})},be=({closeModal:t,showCloseButton:i,source:u,setError:o})=>{const{state:c,cancelAddQuestion:n,createQuestion:p}=V(),{activeQuestion:x}=c,C=x?x.topId:"",T=async()=>{await n()},a=async h=>{const O={...h,topId:C,created:{time:new Date,nickName:""},modified:void 0},I=await p(O,t!==void 0);I&&(I.message?o(I.message):t&&t())};return x?e.jsx(Qe,{question:x,showCloseButton:i??!0,source:u??0,closeModal:T,submitForm:a,children:"Create Question"}):null},et=({})=>{const{state:t,updateQuestion:i}=V(),{activeQuestion:u}=t;if(!u)return null;if(!u)return e.jsx("div",{children:"Loading question to edit..."});const o=async c=>{const n={...c,created:void 0,modified:{time:new Date,nickName:""}},{parentId:p}=u,x=p!==n.parentId;await i(p,n,x)};return e.jsx(Qe,{question:u,showCloseButton:!0,source:0,submitForm:o,children:"Update Question"})},tt=({inLine:t})=>{console.log(t?"ViewQuestion inLine":"ViewQuestion not inLine");const{state:i}=V(),{activeQuestion:u}=i,[o,c]=m.useState(null);return m.useEffect(()=>{console.log("#################################### ViewQuestion setQuestion ...",{activeQuestion:u}),c(u)},[u]),e.jsx(Qe,{question:o,showCloseButton:!0,source:0,submitForm:()=>{},children:"View Question"})},Wt=({questionRow:t,isSelected:i})=>{const{id:u,topId:o,parentId:c,title:n,numOfAssignedAnswers:p}=t,x={topId:o,parentId:c,id:c},{canEdit:C,authUser:T}=ne(),{state:a,viewQuestion:h,addQuestion:O,editQuestion:I,deleteQuestion:A}=V(),{activeQuestion:G,formMode:Q,loadingQuestion:$,questionLoaded:R}=a,b=G!==null&&G.id===u,B=Q===f.AddingQuestion,N=()=>{t.modified={time:new Date,nickName:T.nickName},A(t,b)},F=async P=>{console.log("QuestionRow onSelectQuestion",{id:P}),C?await I(t):await h(t)},[q,D]=Ce();m.useEffect(()=>{(async()=>{if(i&&!$&&!R){switch(Q){case f.ViewingQuestion:await h(t);break;case f.EditingQuestion:console.log("Zovem from QuestionRow"),C?await I(t):await h(t);break}document.getElementById(`QuestionRow${u}`)?.scrollIntoView({behavior:"smooth",block:"end"})}})()},[C,I,Q,u,i,$,R,t,h]);const k=e.jsxs("div",{id:`QuestionRow${u}`,className:`d-relative d-flex justify-content-start align-items-center w-100 mt-1 question-row${i?"-selected":""}`,style:{marginTop:"1px"},children:[e.jsx(H,{variant:"link",size:"sm",className:"d-flex align-items-center px-1 text-secondary",children:e.jsx("img",{width:"22",height:"18",src:It,alt:"Question"})}),e.jsx(H,{variant:"link",size:"sm",className:`p-0 px-1 m-1 ms-0 question-row-title ${b?"fw-bold":""}`,title:`id:${u.toString()}`,onClick:()=>F(u),disabled:B,children:n}),e.jsxs(Re,{pill:!0,bg:"secondary",className:`text-info ${p===0?"d-none":"d-inline"}`,children:[p,"a"]}),C&&!B&&D&&e.jsxs("div",{className:"position-absolute text-nowrap d-flex align-items-center border border-0 border-warning p-0 end-0",children:[e.jsx(H,{variant:"link",size:"sm",className:"ms-1 p-0 text-secondary d-flex align-items-center",title:"Add Question",onClick:()=>{O(x,!0)},children:e.jsx("img",{width:"22",height:"18",src:Ye,alt:"Add Question"})}),e.jsx(H,{variant:"link",size:"sm",className:"ms-0 p-0 text-secondary",onClick:N,children:e.jsx(re,{icon:Oe,size:"lg"})})]})]});return e.jsxs(oe.Item,{className:"py-0 px-0 w-100",as:"li",children:[i&&Q===f.AddingQuestion&&e.jsxs(e.Fragment,{children:[e.jsx("div",{id:"div-question",className:"ms-0 d-md-none w-100",children:e.jsx(be,{showCloseButton:!0,source:0})}),e.jsx("div",{ref:q,className:"d-none d-md-block  border rounded-3",children:k})]}),i&&Q===f.EditingQuestion&&e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:q,className:"",children:k}),e.jsx("div",{id:"div-question",className:"ms-0 d-md-none w-100",children:e.jsx(et,{inLine:!0})})]}),i&&Q===f.ViewingQuestion&&e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:q,className:"",children:k}),e.jsx("div",{ref:q,id:"div-question",className:"ms-0 d-md-none w-100",children:e.jsx(tt,{inLine:!0})})]}),!i&&e.jsx("div",{ref:q,className:"",children:k})]})},ot=({categoryRow:t})=>{const{state:i,loadCategoryQuestions:u}=V(),{keyExpanded:o,loadingQuestion:c,error:n,selectedQuestionId:p}=i,{questionId:x}=o;t.level+=1;const{questionRows:C}=t;let T=!1;async function a(){try{const I={categoryKey:new ae(t).categoryKey,startCursor:C.length,includeQuestionId:x??null};console.log("^^^^^^^^^^^^^ loadMore"),console.log("^^^^^^^^^^^^^",{x:I}),console.log("^^^^^^^^^^^^^ loadMore"),await u(I)}catch{}finally{}}const[h,{rootRef:O}]=Qt({loading:c,hasNextPage:T,onLoadMore:a,disabled:!!n,rootMargin:"0px 0px 100px 0px"});return e.jsxs("div",{ref:O,className:"ms-0",style:{maxHeight:"400px",overflowY:"auto"},children:[e.jsxs(bt,{children:[C.length===0&&e.jsx("label",{children:"No questions"}),C.map(I=>e.jsx(Wt,{questionRow:I,isSelected:I.id===p},I.id)),T]}),n&&e.jsxs("p",{children:["Error: ",n.message]})]})},Ht=({categoryKey:t,tag:i,categoryInAdding:u})=>{const{name:o}=i,{canEdit:c}=ne(),{state:n,deleteCategoryVariation:p}=V(),x=()=>{p(t,o)},[C,T]=Ce(),a=e.jsxs("div",{ref:C,children:[e.jsx(Re,{pill:!0,bg:"secondary",children:o}),c&&!0&&T&&e.jsx(H,{variant:"link",size:"sm",className:"ms-0 py-0 mx-0 text-secondary",onClick:x,children:e.jsx(re,{icon:Oe,size:"sm"})}),!1]});return e.jsx("div",{className:"py-1 px-1",children:a})},Xt=({categoryKey:t,variations:i})=>{const{state:u}=V(),{error:o}=u;return m.useEffect(()=>{},[]),e.jsxs("div",{className:"ms-2",children:[e.jsxs(je,{direction:"horizontal",gap:2,children:[i.length===0&&e.jsx("div",{children:"No variations"}),i.length>0&&i.map(c=>e.jsx(Ht,{categoryKey:t,tag:c,categoryInAdding:void 0}))]}),o&&e.jsxs("p",{children:["Error: ",o.message]})]})},De=({formMode:t,category:i,submitForm:u,children:o})=>{const{onCategoryTitleChanged:c}=V(),n=t===f.ViewingCategory,p=t===f.EditingCategory,x=t===f.AddingCategory,{topId:C,id:T,variations:a,questionRows:h,title:O}=i;console.log("CategoryForm render: ",{topId:C,id:T,catTitle:O,formMode:t});const I=new ae(i).categoryKey;document.getElementById("div-details");const A=h&&h.length>0,G=Ae(),Q=()=>{G({type:s.CLOSE_CATEGORY_FORM,payload:{}})},$=()=>{G({type:s.CANCEL_CATEGORY_FORM,payload:{}})},[R,b]=m.useState(O),B=Be(R,300),N=$e({enableReinitialize:!0,initialValues:i,validationSchema:Ve().shape({title:_e().required("Required")}),onSubmit:k=>{console.log("CategoryForm.onSubmit",JSON.stringify(k,null,2)),u(k),b(k.title)}});m.useEffect(()=>{(async()=>{console.log("CategoryForm.useEffect - onCategoryTitleChanged",{debouncedSearchTerm:B,title:N.values.title}),B&&N.values.title!==B&&await c(C,T,B)})()},[B,N.values,c]);const F=k=>{N.handleChange(k);const P=k.target.value;b(P)},q=m.useRef(null);m.useEffect(()=>{q.current.focus()},[i.title,q]);const D=!1;return console.log("CategoryForm render return: ",R),e.jsxs("div",{className:"form-wrapper p-2 category-form",children:[e.jsx(Ue,{onClick:Q,className:"float-end"}),e.jsx(ye,{className:"text-center text-muted",children:e.jsxs(j.Label,{children:["Category ",n?"Viewing":p?"Editing":"Adding"]})}),e.jsxs(j,{onSubmit:()=>N.handleSubmit,children:[e.jsx(j.Group,{controlId:"Variations",children:e.jsxs(je,{direction:"horizontal",gap:1,children:[e.jsx("div",{className:"px-0",children:e.jsx(j.Label,{children:"Variations:"})}),e.jsx("div",{className:"px-1 border border-1 border-secondary rounded",children:e.jsx(Xt,{categoryKey:I,variations:a?a.map(k=>({name:k})):[]})}),e.jsx("div",{className:"ps-2",children:e.jsx(j.Label,{children:"Kind:"})}),e.jsx("div",{className:"px-1 border border-1 border-secondary rounded",children:e.jsxs(j.Group,{controlId:"kind",children:[e.jsx(Ne,{id:"kind",name:"kind",options:Dt,onChange:(k,P)=>{k.preventDefault(),N.setFieldValue("kind",P)},value:N.values.kind,disabled:D,classes:"text-primary"}),e.jsx(j.Text,{className:"text-danger",children:N.touched.kind&&N.errors.kind?e.jsx("div",{className:"text-danger",children:N.errors.kind}):null})]})})]})}),e.jsxs(j.Group,{controlId:"title",children:[e.jsx(j.Label,{children:"Title"}),e.jsx(j.Control,{as:"textarea",name:"title",placeholder:N.values.title==="new Category"?"new Category":"category text",value:R,onChange:F,ref:q,rows:3,className:"text-primary w-100",disabled:n}),e.jsx(j.Text,{className:"text-danger",children:N.touched.title&&N.errors.title?e.jsx("div",{className:"text-danger",children:N.errors.title}):null})]}),e.jsxs(j.Group,{controlId:"link",children:[e.jsx(j.Label,{children:"Link"}),N.values.hasSubCategories?e.jsx(j.Control,{as:"input",placeholder:"/categories/...",name:"link",onChange:N.handleChange,className:"text-primary w-100",value:"Can't have link (has sub categories)",disabled:!0}):e.jsxs(e.Fragment,{children:[e.jsx(j.Control,{as:"input",placeholder:"/categories/...",name:"link",onChange:N.handleChange,className:"text-primary w-100",value:N.values.link??"",disabled:n}),e.jsx(j.Text,{className:"text-danger",children:N.touched.link&&N.errors.link?e.jsx("div",{className:"text-danger",children:N.errors.link}):null})]})]}),e.jsxs(j.Group,{children:[e.jsxs(j.Label,{className:"m-1 mb-0",children:["Questions (",`${N.values.numOfQuestions}`,") "]}),A&&e.jsx(ot,{categoryRow:i})]}),(n||p)&&e.jsx(Ke,{created:i.created,modified:i.modified,classes:"text-primary"}),(N.dirty&&p||x)&&e.jsx(ze,{cancelForm:$,handleSubmit:N.handleSubmit,title:o})]})]})},st=({inLine:t})=>{const i=ne(),{nickName:u}=i.authUser,{state:o,updateCategory:c}=V(),{activeCategory:n,keyExpanded:p}=o,{questionId:x}=p,C=async T=>{const a={...T,created:void 0,modified:{time:new Date,nickName:u}};await c(a,!0)};return e.jsx(De,{inLine:t,category:{...n},questionId:x,formMode:f.EditingCategory,submitForm:C,children:"Update Category"})},nt=({inLine:t})=>{const{state:i}=V(),{activeCategory:u,keyExpanded:o}=i,{questionId:c}=o;return e.jsx(De,{inLine:t,category:{...u},questionId:c,formMode:f.ViewingCategory,submitForm:()=>{},children:"View Category"})},at=({activeCategory:t})=>{const i=ne(),{nickName:u}=i.authUser,{createCategory:o}=V(),[c]=m.useState({...t}),n=async p=>{const x={...p,created:{time:new Date,nickName:u},modified:void 0};console.log("**********object",x),await o(x)};return!t===null?null:(console.log("AddCategory render >>>>>:",t),e.jsx(e.Fragment,{children:e.jsx(De,{inLine:!1,category:c,questionId:null,formMode:f.AddingCategory,submitForm:n,children:"Create Category"})}))},Jt=({categoryRow:t,questionId:i})=>{const{id:u,title:o,hasSubCategories:c,numOfQuestions:n,isExpanded:p}=t;t.level+=1;const x=new ae(t).categoryKey,{canEdit:C,authUser:T}=ne(),{state:a,addSubCategory:h,viewCategory:O,editCategory:I,deleteCategory:A,expandCategory:G,collapseCategory:Q,addQuestion:$}=V();let{formMode:R,activeCategory:b,loadingCategory:B,categoryLoaded:N}=a;const F=b!==null&&b.id===u,q=R===f.AddingCategory,D=p&&n>0,k=()=>{t.modified={time:new Date,nickName:T.nickName},A(t)},P=async()=>{if(p)await Q(t);else{const X={categoryKey:x,byClick:!0,formMode:C?f.EditingCategory:f.ViewingCategory};await G(X)}},U=async()=>{C?await I(t,i??"null"):await O(t,i??"null")},[Z,S]=m.useState(!1);m.useEffect(()=>{Z&&(h(t),S(!1))},[h,t,Z]);const[K,se]=m.useState(!1);m.useEffect(()=>{K&&($(x,p??!1),se(!1))},[$,x,p,K]),m.useEffect(()=>{(async()=>{if(F&&!B&&!N&&!q)switch(console.log("CategoryRow formMode:",R),R){case f.ViewingCategory:await O(t,i??"null");break;case f.EditingCategory:C?await I(t,i??"null"):await O(t,i??"null");break}})()},[C,x,N,t,I,G,R,q,F,B,i,O]);const[v,M]=Ce(),W=e.jsxs("div",{children:[e.jsxs("div",{id:`Row${u}`,className:`d-relative d-flex justify-content-start align-items-center w-100 mt-1 category-row${F?"-selected":""}`,style:{marginTop:"1px"},children:[e.jsx(H,{variant:"link",size:"sm",className:"py-0 px-1",onClick:X=>{P(),X.stopPropagation()},title:"Expand",disabled:q||!c&&n===0,children:e.jsx(re,{icon:p?Me:Pe,size:"lg"})}),e.jsx(H,{variant:"link",size:"sm",className:"py-0 px-1 bg-light",title:"Expand",disabled:!0,children:e.jsx(re,{icon:kt,size:"sm"})}),e.jsx(H,{variant:"link",size:"sm",className:`py-0 ms-0 me-1 category-row-title ${F?"fw-bold text-white bg-transparent":""}`,title:u,onClick:U,disabled:q,children:o}),n>0&&e.jsxs(Re,{pill:!0,bg:"secondary",className:"d-inline bg-transparent",children:[n,"Q"]}),C&&M&&e.jsxs("div",{className:"position-absolute text-nowrap d-flex align-items-center border border-0 border-warning p-0 end-0",children:[e.jsx("div",{className:"d-flex align-items-center",children:e.jsx(H,{variant:"link",size:"sm",className:"border-0 py-0 px-0 ms-0 text-success",title:"Add SubCategory",onClick:async()=>{!p&&(c||n>0)&&await P(),setTimeout(()=>S(!0),500)},children:e.jsx(re,{icon:Lt,size:"lg"})})}),!q&&!c&&e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(H,{variant:"link",size:"sm",className:"p-0 mx-0 text-secondary d-flex align-items-center border border-0 border-warning1",title:"Add Question",onClick:async()=>{!p&&(c||n>0)&&await P(),setTimeout(()=>se(!0),500)},children:e.jsx("img",{width:"22",height:"18",src:Ye,alt:"Add Question"})}),e.jsx(H,{variant:"link",size:"sm",className:"d-flex align-items-center border border-0 border-warning p-0",disabled:c||n>0,onClick:k,children:e.jsx(re,{icon:Oe,size:"lg"})})]})]})]}),D&&e.jsx("div",{className:"ps-3",children:e.jsx(ot,{categoryRow:t})})]});return e.jsxs(e.Fragment,{children:[e.jsxs(oe.Item,{className:"py-0 px-1 w-100 category-bg",as:"li",children:[F&&R===f.AddingCategory&&e.jsxs("div",{children:[e.jsx("div",{ref:v,className:"",children:W}),e.jsx("div",{className:"ms-0 d-md-none w-100",children:e.jsx(at,{activeCategory:b})})]}),F&&R===f.EditingCategory&&e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:v,className:"",children:W}),e.jsx("div",{id:"divInLine",className:"ms-0 d-md-none w-100",children:e.jsx(st,{inLine:!1})})]}),F&&R===f.ViewingCategory&&e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:v,className:"",children:W}),e.jsx("div",{id:"divInLine",className:"ms-0 d-md-none w-100",children:e.jsx(nt,{inLine:!1})})]}),!F&&e.jsx("div",{ref:v,className:"",children:W})]}),a.error&&a.whichRowId===u&&e.jsx("div",{className:"text-danger",children:a.error.message}),p&&e.jsx(oe.Item,{className:"py-0 px-0 border-0 border-warning border-bottom-0 category-bg",variant:"primary",as:"li",children:p&&e.jsx(e.Fragment,{children:c&&e.jsx(rt,{categoryRow:t,title:o,isExpanded:p})})})]})},rt=({categoryRow:t,title:i})=>{const{state:u}=V();let{keyExpanded:o}=u;const{questionId:c}=o??{questionId:null};let n=1,p=[];return i==="ROOT"?p=u.topRows:(p=t.categoryRows,n=t.level),e.jsx("div",{className:n>1?"ms-2":"",children:e.jsx(oe,{as:"ul",variant:"dark",className:"mb-0 category-bg",children:p.map(x=>e.jsx(Jt,{categoryRow:x,questionId:c},x.id))})})},Zt=t=>{const{isDarkMode:i}=ne(),[u,o]=m.useState("");return m.useEffect(()=>{},[]),e.jsxs(we,{show:t.show,onHide:t.onHide,animation:!0,centered:!0,size:"lg",className:"modal show",contentClassName:`${i?"bg-secondary bg-gradient":"bg-info bg-gradient"}`,children:[e.jsx(we.Header,{closeButton:!0,children:"Store new Question to the Database"}),e.jsx(we.Body,{className:"py-0",children:e.jsx(be,{closeModal:t.onHide,showCloseButton:!1,source:1,setError:c=>o(c)})}),e.jsx(we.Footer,{children:u})]})},eo=({categoryId_questionId:t,fromChatBotDlg:i})=>{const{state:u,expandNodesUpToTheTree:o,loadTopRows:c,addSubCategory:n}=V(),{allCategoryRows:p,topRows:x,topRowsLoading:C,topRowsLoaded:T,keyExpanded:a,categoryId_questionId_done:h,nodeOpening:O,nodeOpened:I,activeCategory:A,activeQuestion:G,formMode:Q,loadingCategories:$,loadingCategory:R,loadingQuestions:b,loadingQuestion:B}=u,{searchQuestions:N,setLastRouteVisited:F,setChatBotDlgEnabled:q}=ve(),{isDarkMode:D,chatBotDlgEnabled:k}=ne(),[P,U]=m.useState(!1),[Z,S]=m.useState({...Ie}),K=Ae(),se=async M=>{K({type:s.SET_QUESTION_SELECTED,payload:{questionKey:M}})};let v="";return m.useEffect(()=>{(async()=>!C&&!T&&(console.log("ZOVEM 111 loadTopRows()"),await c()))()},[C,T,c,i]),m.useEffect(()=>{(async()=>{if(!O&&T){if(t){if(t==="add_question"){const M=localStorage.getItem("New_Question");if(M){const W=JSON.parse(M);return S({...Ie,categoryTitle:"Select",...W}),U(!0),localStorage.removeItem("New_Question"),null}}else if(t!==h){const M=t.split("_"),W=M[0],X=M[1],ie={topId:"",id:W,parentId:"ROOT"};console.log("zovem expandNodesUpToTheTree 1111111111111111111)",{categoryId_questionId:t},{categoryId_questionId_done:h}),await o(ie,X!=="null"?X:null,i==="from_chat"),console.log("zavrsio expandNodeUpToTheTree 1111111111111111111 DONE)",{categoryId_questionId:t})}}else if(a&&!I){const{topId:M,categoryId:W,questionId:X}=a;if(W!==""){const ie={topId:M,id:W,parentId:"ROOT"};console.log("zovem expandNodeUpToTheTree 2222222222222)",{keyExpanded:a,catKey:ie}),await o(ie,X),console.log("zavrsio expandNodeUpToTheTree 2222222222222 DONE)")}}k||q()}})()},[T,O,I,t,h,a,o,i,q,k]),m.useEffect(()=>{},[F]),t!=="add_question"&&t&&t!==h?(console.log("zzzzzz loading...",{keyExpanded:a,categoryId_questionId:t,categoryId_questionId_done:h}),e.jsx("div",{children:"loading..."})):!T||x.length===0?(console.log("===>>> Categories  VRATIO"),null):(console.log("===>>> Categories !!!!!!!!!!!!!!!!!",A),e.jsxs(e.Fragment,{children:[e.jsxs(jt,{children:[e.jsxs("h5",{className:"text-warning mx-auto w-75 fw-bold",children:[e.jsx("span",{className:"categories",children:"Categories / "}),e.jsx("span",{className:"questions",children:"Questions"})]}),e.jsx(ye,{className:`${D?"dark":""}`,children:e.jsx(ge,{children:e.jsx("div",{className:"d-flex justify-content-start align-items-center",children:e.jsx("div",{className:"w-75 my-1 questions",children:e.jsx(Ft,{tekst:v,onSelectQuestion:se,allCategoryRows:p,searchQuestions:N})})})})}),e.jsx(H,{variant:"secondary",size:"sm",type:"button",style:{padding:"1px 4px"},onClick:()=>n(null),children:"Add Category"}),e.jsxs(ye,{className:"my-1 h-auto",children:[e.jsx(ge,{xs:12,md:5,children:e.jsx("div",{className:"categories-border",style:{position:"relative"},children:e.jsx(rt,{categoryRow:null,title:"ROOT",isExpanded:!0})})}),e.jsx(ge,{xs:0,md:7,children:e.jsxs("div",{id:"div-details",className:"d-none d-md-block",children:[A&&Q===f.ViewingCategory&&e.jsx(nt,{inLine:!1}),A&&Q===f.EditingCategory&&e.jsx(st,{inLine:!1}),A&&Q===f.AddingCategory&&e.jsx(at,{activeCategory:A}),G&&Q===f.ViewingQuestion&&e.jsx(tt,{inLine:!1}),G&&Q===f.EditingQuestion&&e.jsx(et,{inLine:!1}),G&&Q===f.AddingQuestion&&e.jsx(be,{})]})})]})]}),P&&G&&e.jsx(Zt,{show:P,onHide:()=>{U(!1)},newQuestionRow:Z}),($||b)&&e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{position:"absolute",top:"40%",left:"20%"},children:e.jsx("div",{className:`spinner-border ${b?"question":"category"}-spinner`,role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})}),R&&e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{position:"absolute",top:"50%",left:"50%"},children:e.jsx("div",{className:"spinner-border category-spinner",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})}),B&&e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{position:"absolute",top:"50%",left:"50%"},children:e.jsx("div",{className:"spinner-border question-spinner",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})})]}))},to=()=>{let{categoryId_questionId:t,fromChatBotDlg:i}=vt();if(t&&t==="categories"&&(t=void 0),t){const u=t.split("_");console.assert(u.length===2,"expected 'categoryId_questionId'")}return e.jsx(Bt,{children:e.jsx(eo,{categoryId_questionId:t,fromChatBotDlg:i})})},ro=Object.freeze(Object.defineProperty({__proto__:null,default:to},Symbol.toStringTag,{value:"Module"}));export{ro as C,V as u};
//# sourceMappingURL=Categories-CdYrczfq.js.map
