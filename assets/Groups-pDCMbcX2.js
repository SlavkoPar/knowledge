const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AutoSuggestAnswers-DSvwzOb6.js","assets/index-ur131YHT.js","assets/index-CykrPP6v.css","assets/lib-j_GWzg-c.js","assets/utilities-8g5q_ELR.js","assets/AutoSuggestAnswers-vl2QUoNQ.css"])))=>i.map(i=>d[i]);
import{w as n,x as xs,y as fs,z as hs,E as m,G as ye,u as Fe,c as se,r as E,H as Ae,J as xe,K as re,L as Pe,M as Rs,N as Ue,O as fe,P as As,S as Ge,n as e,B as K,o as Me,R as Ee,D as he,p as ge,q as Gs,s as Ss,t as _s,v as Ts,_ as Ns}from"./index-ur131YHT.js";import{L as ae,F as te,f as We,a as $e,e as Ve,g as ze,h as Ke,i as Se,j as T,S as ve,k as _e,s as vs,l as js,C as Be,m as qe,u as je,Q as He,d as Ie,n as Is,o as Os,B as Xe,p as bs,q as Ds,r as Cs,M as Re}from"./Options-Jby_vknc.js";import"./utilities-8g5q_ELR.js";const Te={topId:"",parentId:"null",id:"generateId",groupTitle:"",title:"",source:0,status:0,included:!1},Qe={topId:"null",parentId:"null",id:"define at BackEnd",kind:0,title:"",link:"",header:"",level:0,variations:[],hasSubGroups:!1,groupRows:[],answerRows:[],numOfAnswers:0,hasMoreAnswers:!1,isExpanded:!1,doc1:""},ks=(s,a)=>{console.log("------------------------------->"),console.log("------------------------------->",a.type),console.log("------------------------------->");const{groupRow:u}=a.payload;if(a.type===n.SET_KEY_EXPANDED){const{keyExpanded:g}=a.payload;return{...s,keyExpanded:g,nodeOpened:g===null?!0:s.nodeOpened}}let o=u?!xs.includes(a.type):!1;const{topRows:c}=s,l=fs.includes(a.type)?{...s}:Ls(s,a);if(o&&u){let g;const{topId:x,id:G}=u;if(G===x)g=c.map(A=>A.id===x?new Q(u).groupRow:new Q(A).groupRow);else{const A=c.find(h=>h.id===x);Q.idToSet=a.type==="SET_GROUP_ADDED"?"generateId":G,Q.newGroupRow=u;const t=new Q(A).groupRow;g=c.map(h=>h.id===x?t:new Q(h).groupRow),Q.idToSet=""}l.topRows=g}if(hs.includes(a.type)){const{keyExpanded:g}=l,x={keyExpanded:g};localStorage.setItem("GROUPS_STATE",JSON.stringify(x))}return console.log("GroupReducer newState",l),l},Ls=(s,a)=>{switch(a.type){case n.SET_TOP_ROWS_LOADING:return{...s,loadingGroups:!0,topRowsLoading:!0,topRowsLoaded:!1};case n.SET_TOP_ROWS:{const{topRows:o}=a.payload;return console.log("=> GroupsReducer ActionTypes.SET_TOP_ROWS",s.topRows,o),{...s,topRows:o,topRowsLoading:!1,topRowsLoaded:!0,loadingGroups:!1}}case n.SET_ALL_GROUP_ROWS:{const{allGroupRows:o}=a.payload;return{...s,allGroupRows:o,allGroupRowsLoaded:Date.now()}}case n.SET_ALL_GROUP_ROWS:{const{allGroupRows:o}=a.payload;return{...s,allGroupRows:o,allGroupRowsLoaded:Date.now()}}case n.SET_NODE_EXPANDING_UP_THE_TREE:{const{groupId_answerId_done:o}=a.payload;return{...s,groupId_answerId_done:o,nodeOpening:!0,loadingGroups:!0,nodeOpened:!1,activeGroup:null,activeAnswer:null}}case n.SET_NODE_EXPANDED_UP_THE_TREE:{const{group:o,answerId:c,answer:l,formMode:g}=a.payload;return{...s,activeGroup:o,activeAnswer:l,selectedAnswerId:c,formMode:g,nodeOpening:!1,nodeOpened:!0,loadingGroups:!1}}case n.SET_LOADING_GROUP:return{...s,loadingGroup:!0,groupLoaded:!1};case n.FORCE_OPEN_NODE:const{keyExpanded:u}=a.payload;return alert("FORCE_OPEN_NODE is deprecated, use SET_ANSWER_SELECTED instead"),{...s,topRows:s.topRows.filter(o=>o.parentId===null),keyExpanded:u,nodeOpened:!1,activeGroup:null,activeAnswer:null,selectedAnswerId:null};case n.SET_SUB_GROUPS:return{...s,loadingGroup:!1};case n.SET_ERROR:{const{error:o,whichRowId:c}=a.payload;return{...s,error:o,whichRowId:c,loadingGroups:!1,loadingAnswers:!1,loadingGroup:!1,groupLoaded:!1,loadingAnswer:!1,answerLoaded:!1}}case n.SET_GROUP:{const{groupRow:o}=a.payload;return console.assert(ye(o)),{...s,loadingGroup:!1,groupLoaded:!0,activeGroup:o,activeAnswer:null,selectedAnswerId:null}}case n.SET_ROW_EXPANDING:return{...s,rowExpanding:!0,rowExpanded:!1,loadingGroups:!0};case n.SET_ROW_EXPANDED:{const{groupRow:o}=a.payload,{topId:c,id:l}=o,{keyExpanded:g}=s,x=g?g.answerId:null;return{...s,loadingGroups:!1,keyExpanded:{topId:c,groupId:l,answerId:x},activeAnswer:null,selectedAnswerId:x,loadingAnswer:!1,answerLoaded:!1,rowExpanding:!1,rowExpanded:!0}}case n.SET_ROW_COLLAPSED:{const{groupRow:o}=a.payload,{topId:c,parentId:l}=o;return{...s,loadingGroups:!1,keyExpanded:{topId:c,groupId:l??"",answerId:null},rowExpanding:!1,rowExpanded:!0,activeGroup:null,activeAnswer:null,selectedAnswerId:null}}case n.SET_GROUP_TO_VIEW:{const{groupRow:o}=a.payload;console.assert(ye(o));const l={...o,isExpanded:!1};return{...s,formMode:m.ViewingGroup,loadingGroup:!1,activeGroup:l,activeAnswer:null,selectedAnswerId:null,error:void 0}}case n.SET_GROUP_TO_ADD_TOP:{const{newGroupRow:o}=a.payload;return{...s,loadingGroup:!1,groupLoaded:!0,activeGroup:{...o,doc1:""},activeAnswer:null,selectedAnswerId:null,topRows:[o,...s.topRows],formMode:m.AddingGroup}}case n.SET_GROUP_TO_ADD:{const{newGroupRow:o}=a.payload;return{...s,loadingGroup:!1,groupLoaded:!0,activeGroup:{...o,doc1:""},activeAnswer:null,selectedAnswerId:null,formMode:m.AddingGroup}}case n.SET_GROUP_ADDED:{const{groupRow:o}=a.payload;console.assert(ye(o));const l={...o,isExpanded:!1},{topId:g,id:x}=l;return{...s,formMode:m.EditingGroup,loadingGroup:!1,groupLoaded:!1,activeGroup:l,activeAnswer:null,selectedAnswerId:null,keyExpanded:{topId:g,groupId:x,answerId:null}}}case n.SET_GROUP_TO_EDIT:case n.SET_GROUP_UPDATED:{const{groupRow:o,group:c}=a.payload;console.assert(ye(o));const{topId:l,id:g}=c;return{...s,formMode:m.EditingGroup,loadingGroup:!1,groupLoaded:!0,keyExpanded:{topId:l,groupId:g,answerId:null},activeGroup:c,activeAnswer:null,selectedAnswerId:null,error:void 0}}case n.SET_ANSWERS_LOADING:return{...s,loadingAnswers:!0,answerLoaded:!1};case n.GROUP_ANSWERS_LOADED:return{...s,loadingAnswers:!1};case n.DELETE_GROUP:return{...s,activeGroup:null,formMode:m.None,error:void 0,whichRowId:void 0};case n.CANCEL_GROUP_FORM:case n.CLOSE_GROUP_FORM:return{...s,activeGroup:null,formMode:m.None};case n.CANCEL_ADD_SUB_GROUP:return{...s,activeGroup:null,activeAnswer:null,selectedAnswerId:null,formMode:m.None};case n.SET_LOADING_ANSWER:return{...s,loadingAnswer:!0,answerLoaded:!1};case n.CANCEL_ADD_ANSWER:return{...s,formMode:m.None,activeAnswer:null,selectedAnswerId:null};case n.SET_ANSWER_SELECTED:{const{answerKey:o}=a.payload,{topId:c,parentId:l,id:g}=o;return{...s,topRows:s.topRows.filter(x=>x.parentId===null),keyExpanded:{topId:c,groupId:l,answerId:g},activeGroup:null,activeAnswer:null,selectedAnswerId:null}}case n.ADD_NEW_ANSWER_TO_ROW:{const{newAnswerRow:o}=a.payload;return{...s,selectedAnswerId:o.id}}case n.SET_ANSWER:{const{answer:o,formMode:c}=a.payload;return console.log(n.SET_ANSWER,o),{...s,activeGroup:null,activeAnswer:o,formMode:c,error:void 0,loadingGroup:!1,loadingAnswer:!1,answerLoaded:!0}}case n.SET_ANSWER_AFTER_ASSIGN_ANSWER:{const{answer:o}=a.payload;return{...s,activeAnswer:o,loadingAnswer:!1,answerLoaded:!0}}case n.SET_ANSWER_TO_VIEW:{const{answer:o}=a.payload,{keyExpanded:c}=s;return{...s,formMode:m.ViewingAnswer,keyExpanded:c,activeAnswer:o,loadingAnswer:!1,answerLoaded:!0}}case n.SET_ANSWER_TO_EDIT:{const{answer:o}=a.payload,{topId:c,id:l,parentId:g}=o;return{...s,keyExpanded:{topId:c,groupId:g,answerId:l},activeAnswer:o,formMode:m.EditingAnswer,selectedAnswerId:o.id,loadingAnswer:!1,answerLoaded:!0}}case n.ANSWER_DELETED:return{...s,activeAnswer:null,selectedAnswerId:null,formMode:m.None,loadingAnswer:!1,answerLoaded:!0};case n.CANCEL_ANSWER_FORM:case n.CLOSE_ANSWER_FORM:return{...s,formMode:m.None,activeAnswer:null,selectedAnswerId:null};default:return alert(`Action ${a.type} not allowed`),{...s}}};class Q{static idToSet;static newGroupRow;constructor(a){const{topId:u,id:o,parentId:c,title:l,link:g,kind:x,header:G,level:A,variations:t,numOfAnswers:h,hasSubGroups:I,groupRows:N,created:O,modified:b,answerRows:C,isExpanded:V}=a,S=N.map(j=>(console.log("DeepClone >>>>>>>>>>>>>>>",j.id),j.id===Q.idToSet?{...Q.newGroupRow}:new Q(j).groupRow));this.groupRow={topId:u,parentId:c,id:o,kind:x,title:l,link:g,header:G,level:A,hasSubGroups:I,groupRows:S,numOfAnswers:h,answerRows:C,variations:t??[],created:O,modified:b,isExpanded:V}}groupRow}const Je=E.createContext({}),Ye=E.createContext(()=>null),Ps={formMode:m.None,allGroupRows:new Map,allGroupRowsLoaded:void 0,topRows:[],topRowsLoading:!1,topRowsLoaded:!1,nodeOpening:!1,nodeOpened:!1,keyExpanded:null,groupId_answerId_done:void 0,activeGroup:null,activeAnswer:null,selectedAnswerId:null,loadingGroups:!1,loadingAnswers:!1,loadingGroup:!1,groupLoaded:!1,loadingAnswer:!1,answerLoaded:!1,error:void 0,rowExpanding:!1,rowExpanded:!1},Us=({children:s})=>{const{loadAllGroupRowsGlobal:a}=Fe(),u=se(),{KnowledgeAPI:o,isAuthenticated:c,workspace:l,authUser:g,canEdit:x}=u,{nickName:G}=g,[A,t]=E.useReducer(ks,Ps),{formMode:h,activeGroup:I,activeAnswer:N,keyExpanded:O,topRows:b,allGroupRows:C,allGroupRowsLoaded:V}=A;console.log("----->>> ----->>> ----->>> GroupProvider",b),E.useEffect(()=>{let d=l==="DEMO"?{topId:"MTS",groupId:"REMOTECTRLS",answerId:"qqqqqq111"}:null;if("localStorage"in window){let r=localStorage.getItem("GROUPS_STATE");if(console.log("GROUPS_STATE from localStorage",r),r!==null){const w=JSON.parse(r);w.keyExpanded!==null&&(d=w.keyExpanded)}}t({type:n.SET_KEY_EXPANDED,payload:{keyExpanded:d}})},[l]);const S=E.useCallback(async(d,r,w=null,p=void 0)=>{const i=localStorage.getItem("accessToken");if(i)try{console.log("------Execute endpoint:",r);let y=null;const R=new Headers,v=`Bearer ${i}`;R.append("Authorization",v),w&&R.append("Content-Type","application/json");let F={method:d,headers:R,body:w?JSON.stringify(w):null};if(y=await fetch(r,F),y.ok){if(y.status===200||y.status===201){let X=null;try{X=await y.json()}catch{t({type:n.SET_ERROR,payload:{error:new Error(`Response status: ${y.status}`),whichRowId:p}})}finally{return X}}}else{const{errors:X}=await y.json(),Y=new Error(X?.map(Z=>Z.message).join(`
`)??"unknown");t({type:n.SET_ERROR,payload:{error:Y,whichRowId:p}})}}catch(y){console.log("-------------->>> execute",d,r,y),t({type:n.SET_ERROR,payload:{error:new Error("fetch eror"),whichRowId:p}})}return null},[]),j=E.useCallback(async()=>new Promise(async d=>{const r=await a();t(r?{type:n.SET_ALL_GROUP_ROWS,payload:{allGroupRows:r}}:{type:n.SET_ERROR,payload:{error:new Error("Zajeb allGroupRows")}}),d(r)}),[a]),M=E.useCallback(async d=>{try{return C.get(d)}catch(r){console.log(r),t({type:n.SET_ERROR,payload:{error:r}})}},[C]);E.useEffect(()=>{(async()=>await j())()},[j]);const _=E.useCallback(async d=>{try{let r="";const w=[];return C.forEach((p,i)=>{i===d?r="":p.parentId===d&&w.push(p)}),{subGrps:w,parentHeader:r}}catch(r){return console.log(r),t({type:n.SET_ERROR,payload:{error:r}}),{subGrps:[],parentHeader:"Kiks subGrps"}}},[C]),U=E.useCallback(async()=>new Promise(async d=>{try{t({type:n.SET_TOP_ROWS_LOADING,payload:{}});const r=`${o.endpointGroupRow}/${l}/toprows`;console.log("GroupProvider loadTopRows url:",r),console.log("loadTopRows AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"),console.time(),await S("GET",r).then(w=>{console.timeEnd(),console.log("loadTopRows CCCCCCCCCCCCCCCCCCCC");const p=w.map(i=>(i.IsExpanded=O?i.Id===O.groupId:!1,new Ae(i).groupRow));t({type:n.SET_TOP_ROWS,payload:{topRows:p}}),d(!0)})}catch(r){console.log(r),t({type:n.SET_ERROR,payload:{error:r}})}}),[S,o.endpointGroupRow,O,l]),f=E.useCallback(async(d,r)=>{const{topId:w,id:p}=d;return console.log({groupKey:d,includeAnswerId:r}),new Promise(async i=>{try{const y=`${o.endpointGroup}/${l}/${w}/${p}/${H}/${r}`;console.time(),console.log("================ getGroup ======================="),await S("GET",y).then(R=>{console.timeEnd();const{groupDto:v,msg:F}=R;i(v?new xe(v).group:new Error(F))})}catch(y){console.log(y),i(y)}})},[S,o.endpointGroup,l]),D=E.useCallback(async(d,r)=>{if(d.topId===r)return d;const{groupRows:w}=d;let p=w.find(i=>i.id===r);if(!p)for(const i of w){const y=await D(i,r);if(y){p=y,console.log("findGroup Stop the loop for: "+r);break}}return p},[]),L=E.useCallback(async(d,r,w=!1)=>new Promise(async p=>{try{let{topId:i,parentId:y,id:R}=d;console.assert(R!==null,"id ne sme biti null u expandNodesUpToTheTree"),t({type:n.SET_NODE_EXPANDING_UP_THE_TREE,payload:{groupId_answerId_done:`${R}_${r}`}}),console.time();const v={topId:i,id:R,parentId:null},F=new re(v).toQuery(l),X=`${o.endpointGroupRow}?${F}&pageSize=${H}&includeAnswerId=${r??null}`;await S("GET",X).then(async Y=>{const{groupRowDto:Z}=Y;if(console.timeEnd(),Z){let ie=null,ce=null;const ue=new Ae(Z).groupRow,we=await D(ue,R);if(y!==null){if(ie={...we,doc1:""},r){const ke=we.answerRows.find(Le=>Le.id===r&&Le.included);ke&&(ie=null,ce={...ke,source:0,status:0})}}else console.log("WHAT");console.log(">>> expandNodeUpToTheTree groupRow",{topRowNew:ue,groupRow:we,answerId:"'"+(r??"jok")+"'"+(r??"JOK")});const ys=r?x?m.EditingAnswer:m.ViewingAnswer:x?m.EditingGroup:m.ViewingGroup;t({type:n.SET_NODE_EXPANDED_UP_THE_TREE,payload:{grpKey:d,groupRow:ue,group:ie,answerId:r??null,answer:ce,formMode:ys,fromChatBotDlg:w}}),p(!0)}else p(!1)})}catch(i){console.log(i),t({type:n.SET_ERROR,payload:{error:i}})}}),[l,o.endpointGroupRow,S,C,D,x]),P=E.useCallback(async(d,r=!1,w=null)=>{const p=new re(d).toQuery(l);return new Promise(async i=>{try{const y=`${o.endpointGroupRow}/${r}/${H}/${w}?${p}`;console.time(),await S("GET",y).then(R=>{console.timeEnd();const{groupRowDto:v,msg:F}=R;i(v?new Ae(v).groupRow:new Error(F))})}catch(y){console.log(y),i(y)}})},[S,o.endpointGroupRow,l]),k=E.useCallback(async({groupKey:d,includeAnswerId:r,newAnswerRow:w,formMode:p})=>{try{t({type:n.SET_ROW_EXPANDING,payload:{}});const i=await P(d,!0,r);if(i instanceof Error)t({type:n.SET_ERROR,payload:{error:i}}),console.error({groupRow:i});else{let y;return r&&i.answerRows.filter(R=>R.included).length>0&&(y=r),w&&(i.answerRows=[w,...i.answerRows]),i.isExpanded=!0,console.log("@@@@@@@@@@@@@@@@@ expandGroup:",p,r),p===m.None&&r&&(p=x?m.EditingAnswer:m.ViewingAnswer),t({type:n.SET_ROW_EXPANDED,payload:{groupRow:i,formMode:p,selectedAnswerId:y}}),i}}catch(i){return console.log("error",i),t({type:n.SET_ERROR,payload:{error:i}}),null}},[x,P]),oe=E.useCallback(async d=>{const{topId:r,id:w}=d,p=b.find(y=>y.id===r),i=await D(p,w);i?(d={...i,isExpanded:!1,groupRows:[],answerRows:[]},t({type:n.SET_ROW_COLLAPSED,payload:{groupRow:d}})):t({type:n.SET_ERROR,payload:{error:new Error("findGroup sranje"),whichRowId:w}})},[D,b]),pe=E.useCallback(async d=>{try{t({type:n.CLOSE_GROUP_FORM,payload:{}});const{topId:r,id:w,level:p}=d??{topId:"generateId",id:"generateId",level:0},i={...Qe,topId:r,parentId:d?w:null,id:"generateId",level:p+1,title:"New Group",isExpanded:!1};if(d===null)t({type:n.SET_GROUP_TO_ADD_TOP,payload:{newGroupRow:i}});else{const y={...d,level:p+1,groupRows:[i,...d.groupRows],hasSubGroups:!0,isExpanded:!0};t({type:n.SET_GROUP_TO_ADD,payload:{groupRow:y,newGroupRow:{...i}}})}}catch(r){console.log("error",r),t({type:n.SET_ERROR,payload:{error:r}})}},[]),B=E.useCallback(async()=>{try{const d=I;d&&t({type:n.CANCEL_ADD_SUB_GROUP,payload:{groupRow:d}})}catch(d){console.log("error",d),t({type:n.SET_ERROR,payload:{error:d}})}},[I,k]),le=E.useCallback(async d=>{const{id:r}=d;t({type:n.SET_LOADING_GROUP,payload:{}});try{const w=new Pe(d,l).groupDto;console.log("groupDto",{groupDto:w});const p=`${o.endpointGroup}`;console.time(),await S("POST",p,w,r).then(async i=>{console.timeEnd();const{groupDto:y}=i;if(y){const R=new xe(y).group;console.log("Group successfully created",{group:R}),t({type:n.CLOSE_GROUP_FORM,payload:{}}),C.set(R.id,{...R,isExpanded:!1}),R.parentId===null?t({type:n.SET_GROUP_ADDED,payload:{groupRow:R}}):t({type:n.SET_GROUP_ADDED,payload:{groupRow:R}})}})}catch(w){console.log(w),t({type:n.SET_ERROR,payload:{error:new Error("Server Error"),whichRowId:r}})}},[S,o.endpointGroup,j,U,l]),z=E.useCallback(async()=>{try{const{topId:d,parentId:r}=N,p={groupKey:{topId:d,parentId:r,id:r},formMode:m.None},i=await k(p);i&&t({type:n.CANCEL_ADD_ANSWER,payload:{groupRow:i}})}catch(d){console.log("error",d),t({type:n.SET_ERROR,payload:{error:d}})}},[N,k]),de=E.useCallback(async(d,r)=>{h===m.AddingAnswer?await z():h===m.AddingGroup&&await B(),t({type:n.SET_LOADING_GROUP,payload:{groupRow:d}});const w=new re(d).groupKey,p=await f(w,r);p instanceof Error?t({type:n.SET_ERROR,payload:{error:p}}):(p.topId=d.topId,t({type:n.SET_GROUP_TO_VIEW,payload:{groupRow:p}}))},[B,z,h,f]),ne=E.useCallback(async(d,r)=>{h===m.AddingAnswer?await z():h===m.AddingGroup&&await B(),t({type:n.SET_LOADING_GROUP,payload:{}});const w=new re(d).groupKey,p=await f(w,r);if(p instanceof Error)t({type:n.SET_ERROR,payload:{error:p}});else{const i={...p,isExpanded:!1,groupRows:[],answerRows:[]};t({type:n.SET_GROUP_TO_EDIT,payload:{groupRow:i,group:p}})}},[B,z,h,f]),W=E.useCallback(async d=>{t({type:n.SET_LOADING_GROUP,payload:{}});try{const r=new Pe(d,l).groupDto,w=`${o.endpointGroup}`;console.time(),await S("PUT",w,r).then(p=>{console.timeEnd();const{groupDto:i,msg:y}=p;if(i){const R=new xe(i).group,{topId:v}=R;R.isExpanded=!1,R.topId=v,t({type:n.SET_GROUP_UPDATED,payload:{group:R}})}else t({type:n.SET_ERROR,payload:{error:new Error(`${y}`)}})})}catch(r){return console.log(r),t({type:n.SET_ERROR,payload:{error:new Error("Karambol")}}),r}},[S,o.endpointGroup,l]),J=E.useCallback(async d=>{try{const{topId:r,parentId:w}=d,p=new Rs(d,l).groupRowDto,i=`${o.endpointGroup}`;console.time(),await S("DELETE",i,p).then(async y=>{console.timeEnd();const{groupDto:R,msg:v}=y;v==="OK"?(console.log("Group successfully deleted",{groupRow:d}),await j().then(async()=>{const F={groupKey:{topId:r,parentId:"",id:w},formMode:m.None};w?await U():await k(F).then(()=>{})})):t(v==="HasSubGroups"?{type:n.SET_ERROR,payload:{error:new Error("First remove sub groups"),whichRowId:R.Id}}:v==="HasAnswers"?{type:n.SET_ERROR,payload:{error:new Error("First remove group answers"),whichRowId:R.Id}}:{type:n.SET_ERROR,payload:{error:new Error(v),whichRowId:R.Id}})})}catch(r){return console.log(r),r}},[S,o.endpointGroup,k,j,U,l]),q=async(d,r)=>{try{console.log("Deleting Group Tag...",{groupKey:d,variationName:r}),console.log("Group Tag successfully deleted")}catch(w){console.log("error",w),t({type:n.SET_ERROR,payload:{error:w}})}},H=12,ls=E.useCallback(async({groupKey:d,startCursor:r,includeAnswerId:w})=>{try{const{topId:p,id:i}=d;t({type:n.SET_ANSWERS_LOADING,payload:{}});try{const y=`${o.endpointAnswer}/${l}/${p}/${i}/${r}/${H}/${w}`;console.time(),await S("GET",y).then(R=>{console.timeEnd();const{groupDto:v}=R;if(v!==null){const F=new xe(v).group;t({type:n.GROUP_ANSWERS_LOADED,payload:{groupRow:F}})}})}catch(y){console.log(y),t({type:n.SET_ERROR,payload:{error:y}})}}catch(p){console.log(p),t({type:n.SET_ERROR,payload:p})}},[S,o.endpointAnswer,l]),ds=E.useCallback(async d=>{try{const{topId:r,id:w}=d;let p=await M(w);if(!p){alert(`Not found ${w}. Reload all Groups`);return}const i={topId:r,parentId:d.id,id:"generateId",title:"answer text",groupTitle:p.title,included:!0},y={...Te,...i,title:""},R=A.topRows.find(F=>F.id===r),v=await D(R,w);t({type:n.ADD_NEW_ANSWER_TO_ROW,payload:{groupRow:{...v,answerRows:[i,...v.answerRows]},newAnswerRow:i}}),t({type:n.SET_ANSWER,payload:{answer:y,formMode:m.AddingAnswer}})}catch(r){console.log("error",r),t({type:n.SET_ERROR,payload:{error:r}})}},[k,D,M,A.topRows]),is=E.useCallback(async d=>{const{topId:r,id:w,parentId:p}=d;t({type:n.SET_LOADING_GROUP,payload:{}});try{d.created.nickName=G;const i=new Ue(d,l).answerDto,y=`${o.endpointAnswer}`;console.time(),console.log(">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> createAnswer",i),await S("POST",y,i).then(async R=>{if(console.timeEnd(),R){console.log("::::::::::::::::::::",{answerDtoEx:R});const{answerDto:v}=R;if(v){const F=new fe(v).answer;F.topId=r,console.log("Answer successfully created"),await j().then(async()=>{const Y={groupKey:{topId:r,parentId:p,id:p},formMode:m.EditingAnswer};await k(Y).then(()=>{t({type:n.SET_ANSWER,payload:{formMode:m.EditingAnswer,answer:F}})})})}}})}catch(i){console.log(i),t({type:n.SET_ERROR,payload:{error:new Error("Server Error"),whichRowId:w}})}},[S,o.endpointAnswer,k,j,G,l]),cs=E.useCallback(async(d,r,w)=>{const{id:p}=r;try{r.modified.nickName=G;const i=new Ue(r,l).answerDto,y=`${o.endpointAnswer}`;console.time(),i.oldParentId=d,console.log(">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> updateAnswer",i);let R=null;return await S("PUT",y,i).then(async v=>{console.timeEnd();const{answerDto:F,msg:X}=v;if(F){R=new fe(F).answer,console.log("Answer successfully updated: ",R);const{topId:Y,parentId:Z}=R;if(w){const{topId:ie,parentId:ce,id:ue}=R,we={topId:ie,groupId:ce,answerId:ue};t({type:n.FORCE_OPEN_NODE,payload:{keyExpanded:we}})}else{const ce={groupKey:{topId:Y,parentId:Z,id:Z},formMode:m.EditingAnswer};await k(ce).then(()=>{t({type:n.SET_ANSWER,payload:{formMode:m.EditingAnswer,answer:R}})})}}else t({type:n.SET_ERROR,payload:{error:new Error(X)}})}),R}catch(i){console.log(i),t({type:n.SET_ERROR,payload:{error:new Error("Server Error"),whichRowId:p}})}},[S,o.endpointAnswer,k,G,l]),ps=E.useCallback(async(d,r)=>{const{id:w,parentId:p,topId:i}=d;t({type:n.SET_LOADING_ANSWER,payload:{}});try{const y=new As(d,l).answerRowDto,R=`${o.endpointAnswer}`;console.time(),await S("DELETE",R,y).then(async v=>{const{answerDto:F}=v;if(console.timeEnd(),F){const X=new fe(F).answer;console.log("Answer successfully deleted"),r&&t({type:n.ANSWER_DELETED,payload:{answer:X}});const Z={groupKey:{topId:i,parentId:p,id:p},formMode:m.None};await k(Z).then(()=>{})}else console.error(v),t({type:n.SET_ERROR,payload:{error:new Error("Server Error"),whichRowId:w}})})}catch(y){console.log(y),t({type:n.SET_ERROR,payload:{error:new Error("Server Error"),whichRowId:w}})}},[S,o.endpointAnswer,k,l]),me=E.useCallback(async d=>new Promise(async r=>{try{const w=new Ge(d).toQuery(l),p=`${o.endpointAnswer}?${w}`;console.time(),console.log("getAnswer",d),await S("GET",p).then(i=>{console.timeEnd();const{answerDto:y,msg:R}=i;if(y){const v={answer:new fe(y).answer,msg:R};r(v)}else r({answer:null,msg:R})})}catch(w){console.log(w),r({answer:null,msg:"Problemos"})}}),[S,o.endpointAnswer,l]),us=E.useCallback(async d=>{const r=new Ge(d).answerKey;t({type:n.SET_LOADING_ANSWER,payload:{}});const w=await me(r);h===m.AddingAnswer?await z():h===m.AddingGroup&&await B();const{answer:p,msg:i}=w;p?(p.topId=d.topId,t({type:n.SET_ANSWER_TO_VIEW,payload:{answer:p}})):t({type:n.SET_ERROR,payload:{error:new Error(i)}})},[B,z,h,me]),ws=E.useCallback(async d=>{const r=new Ge(d).answerKey;h===m.AddingAnswer?await z():h===m.AddingGroup&&await B(),t({type:n.SET_LOADING_ANSWER,payload:{}}),console.log("editAnswer:",r);const w=await me(r),{answer:p,msg:i}=w;p?(p.topId=d.topId,t({type:n.CLOSE_ANSWER_FORM,payload:{answer:p}}),t({type:n.SET_ANSWER_TO_EDIT,payload:{answer:p}})):t({type:n.SET_ERROR,payload:{error:new Error(i)}})},[B,z,h,me]),gs=E.useCallback(async(d,r,w)=>{const p=b.find(y=>y.id===d);let i=await D(p,r);console.log("PROVIDER onGroupTitleChanged::",i.title,w),i.title!==w&&(i.title=w===""?"New Group":w,t({type:n.RE_RENDER_TREE,payload:{groupRow:i}}))},[D,b]),Es=E.useCallback(async(d,r,w)=>{const p=b.find(y=>y.id===d);let i=await D(p,r);if(i){const y=i.answerRows.find(R=>R.id===r);y.title!==w&&(y.title=w===""?"New Question":w,console.log("onAnswerTitleChanged+++>>>",r,i),t({type:n.ANSWER_TITLE_CHANGED,payload:{groupRow:i}}))}},[D,b]),ms={state:A,getSubGrps:_,getGrp:M,loadAllGroupRows:j,expandNodesUpToTheTree:L,loadTopRows:U,addSubGroup:pe,cancelAddGroup:B,createGroup:le,viewGroup:de,editGroup:ne,updateGroup:W,deleteGroup:J,deleteGroupVariation:q,expandGroup:k,collapseGroup:oe,onGroupTitleChanged:gs,loadGroupAnswers:ls,addAnswer:ds,cancelAddAnswer:z,createAnswer:is,viewAnswer:us,editAnswer:ws,updateAnswer:cs,deleteAnswer:ps,onAnswerTitleChanged:Es};return!c||!V?null:e.jsx(Je.Provider,{value:ms,children:e.jsx(Ye.Provider,{value:t,children:s})})};function $(){return E.useContext(Je)}const Oe=()=>E.useContext(Ye);var ee=(s=>(s.SET_LOADING="SET_LOADING",s.SET_SUB_CATS="SET_SUB_CATS",s.SET_ERROR="SET_ERROR",s.SET_EXPANDED="SET_EXPANDED",s.SET_PARENT_CAT="SET_PARENT_CAT",s))(ee||{});const Fs=({cat:s,dispatch:a,setParentGrp:u,selId:o})=>{const{topId:c,parentId:l,id:g,title:x,level:G,isExpanded:A}=s,t={topId:c,parentId:l,id:g},h=O=>{a({type:ee.SET_EXPANDED,payload:{id:g,expanding:!A}})},I=O=>{u(O)},N=e.jsxs("div",{className:"d-flex justify-content-start align-items-center w-100 text-primary",children:[e.jsx(K,{variant:"link",size:"sm",className:"py-0 px-1",onClick:O=>{h(),O.stopPropagation(),O.preventDefault()},title:"Expand",children:e.jsx(te,{icon:A?We:$e,size:"lg"})}),e.jsx(K,{variant:"link",size:"sm",className:"py-0 mx-0 text-decoration-none",title:g,onClick:()=>I(s),children:x})]});return e.jsxs(e.Fragment,{children:[e.jsx(ae.Item,{variant:"primary",className:"py-0 px-1 w-100",as:"li",children:N}),A&&e.jsx(ae.Item,{className:"py-0 px-0",variant:"primary",as:"li",children:e.jsx(es,{selId:o,level:G+1,groupKey:t,setParentId:u})})]})},Ms={loading:!1,parentId:null,title:"",cats:[]},Ws=(s,a)=>{switch(a.type){case ee.SET_LOADING:return{...s,loading:!0};case ee.SET_SUB_CATS:{const{subGrps:u}=a.payload;return{...s,cats:s.cats.concat(u),loading:!1}}case ee.SET_ERROR:{const{error:u}=a.payload;return{...s,error:u,loading:!1}}case ee.SET_EXPANDED:{const{id:u,expanding:o}=a.payload;let{cats:c}=s;if(!o){const l=Ze(c,u);console.log("clean:",l),l.length>0&&(c=c.filter(g=>!l.includes(g.id)))}return{...s,cats:s.cats.map(l=>l.id===u?{...l,isExpanded:o}:l)}}case ee.SET_PARENT_CAT:{const{cat:u}=a.payload,{id:o,title:c}=u;return{...s,parentId:o,title:c}}default:return s}};function Ze(s,a){let u=s.filter(o=>o.parentId===a).map(o=>o.id);return u.forEach(o=>{const c=o?Ze(s,o):[];u=u.concat(c)}),u}const es=({selId:s,groupKey:a,level:u,setParentId:o})=>{const[c,l]=E.useReducer(Ws,Ms),{getSubGrps:g}=$(),{id:x}=a??{id:null},[G]=E.useState(a);E.useEffect(()=>{(async()=>{const h=await g(x),{subGrps:I}=h;l({type:ee.SET_SUB_CATS,payload:{subGrps:I}})})()},[g,G,x]);const A=c.cats.filter(h=>h.parentId===x),t=h=>{l({type:ee.SET_PARENT_CAT,payload:{cat:h}}),o(h)};return e.jsxs("div",{className:u>1?"border  border-7 ms-4 h-25":"border border-7  h-25",style:{overflowY:"auto"},children:[e.jsx(ae,{as:"ul",variant:"dark",className:"mb-0",children:A.filter(h=>h.id!==s).map(h=>e.jsx(Fs,{cat:h,selId:s,dispatch:l,setParentGrp:t},h.id))}),c.error&&c.error.message]})},be=({answer:s,submitForm:a,children:u,showCloseButton:o,source:c=0,closeModal:l})=>{const{state:g,onAnswerTitleChanged:x}=$();let{formMode:G}=g;const A=G===m.ViewingAnswer,t=G===m.EditingAnswer,h=G===m.AddingAnswer,I=A,{topId:N,id:O,title:b}=s,C=Oe(),V=()=>{l?l():C({type:n.CLOSE_ANSWER_FORM,payload:{answer:s}})},S=()=>{l?l():C({type:n.CANCEL_ANSWER_FORM,payload:{answer:s}})},[j,M]=E.useState(b),_=Ve(j,500),U=E.useRef(null),f=ze({enableReinitialize:!0,initialValues:s,validationSchema:Ke().shape({title:Se().required("Required"),parentId:Se().required("Required").notOneOf(["000000000000000000000000"])}),onSubmit:P=>{a(P),M(P.title)}});E.useEffect(()=>{(async()=>f.values.title!==_&&x(N,O,f.values.title))()},[_,f.values.title,x,N,O]),E.useEffect(()=>{U.current.focus(),c!==0&&f.setFieldValue("source",c)},[f,U,c]);const D=P=>{f.handleChange(P);const k=P.target.value;M(k)},L=P=>{f.setFieldValue("parentId",P.id),f.setFieldValue("groupTitle",P.title)};return e.jsxs("div",{className:"form-wrapper px-3 py-1 my-0 my-1 w-100 answer-form",children:[o&&e.jsx(Me,{onClick:V,className:"float-end"}),e.jsx(Ee,{className:"text-center",children:e.jsxs(T.Label,{children:["Answer  ",A?"Viewing":t?"Editing":"Adding"]})}),e.jsxs(T,{onSubmit:f.handleSubmit,children:[e.jsxs(ve,{direction:"horizontal",gap:0,className:"border",children:[e.jsx("div",{className:"p-0",children:e.jsx(T.Label,{children:"Group:"})}),e.jsx("div",{className:"p-1",children:e.jsxs(T.Group,{controlId:"parentId",className:"group-select form-select-sm w-90",children:[e.jsxs(he,{children:[e.jsx(he.Toggle,{variant:"light",id:"dropdown-basic",className:"px-2 py-0 text-primary border",disabled:I,children:e.jsx("span",{className:"text-wrap me-1",children:f.values.groupTitle})}),e.jsx(he.Menu,{className:"p-0 border",children:e.jsx(he.Item,{className:"p-0 m-0 rounded-3",children:e.jsx(es,{selId:f.values.parentId,groupKey:null,level:1,setParentId:L})})})]}),e.jsx(T.Control,{as:"input",name:"parentId",onChange:f.handleChange,value:f.values.parentId?f.values.parentId:"",placeholder:"Group",className:"text-primary w-100",disabled:I,hidden:!0}),e.jsx(T.Text,{className:"text-danger",children:f.touched.parentId&&f.errors.parentId?e.jsx("div",{className:"text-danger",children:f.errors.parentId?"required":""}):null})]})})]}),e.jsxs(T.Group,{controlId:"title",children:[e.jsx(T.Label,{children:"Title"}),e.jsx(T.Control,{as:"textarea",name:"title",placeholder:f.values.title==="new Answer"?"new Answer":"answer text",ref:U,onChange:D,value:f.values.title,rows:3,className:"text-primary w-100",disabled:I}),e.jsx(T.Text,{className:"text-danger",children:f.touched.title&&f.errors.title?e.jsx("div",{className:"text-danger",children:f.errors.title}):null})]}),e.jsxs(Ee,{children:[e.jsx(ge,{children:e.jsxs(T.Group,{controlId:"source",children:[e.jsx(T.Label,{children:"Source"}),e.jsx(_e,{id:"source",name:"source",options:vs,onChange:(P,k)=>{P.preventDefault(),f.setFieldValue("source",k)},value:f.values.source,disabled:I,classes:"text-primary"}),e.jsx(T.Text,{className:"text-danger",children:f.touched.source&&f.errors.source?e.jsx("div",{className:"text-danger",children:f.errors.source}):null})]})}),e.jsx(ge,{children:e.jsxs(T.Group,{controlId:"status",children:[e.jsx(T.Label,{children:"Status"}),e.jsx(_e,{id:"status",name:"status",options:js,onChange:(P,k)=>{P.preventDefault(),f.setFieldValue("status",k)},value:f.values.status,disabled:I,classes:"text-primary"}),e.jsx(T.Text,{className:"text-danger",children:f.touched.status&&f.errors.status?e.jsx("div",{className:"text-danger",children:f.errors.status}):null})]})})]}),(A||t)&&e.jsx("div",{className:"my-1",children:e.jsx(Be,{created:s.created,modified:s.modified,classes:"text-primary"})}),(f.dirty&&t||h)&&e.jsx(qe,{cancelForm:S,handleSubmit:f.handleSubmit,title:u}),g.error&&e.jsx("div",{className:"text-danger",children:g.error.message})]})]})},De=({closeModal:s,showCloseButton:a,source:u,setError:o})=>{const{state:c,cancelAddAnswer:l,createAnswer:g}=$(),{activeAnswer:x}=c,G=x?x.topId:"",A=async()=>{await l()},t=async h=>{const I={...h,topId:G,created:{time:new Date,nickName:""},modified:void 0},N=await g(I,s!==void 0);N&&(N.message?o(N.message):s&&s())};return x?e.jsx(be,{answer:x,showCloseButton:a??!0,source:u??0,closeModal:A,submitForm:t,children:"Create Answer"}):null},ss=({})=>{const{state:s,updateAnswer:a}=$(),{activeAnswer:u}=s;if(!u)return null;if(!u)return e.jsx("div",{children:"Loading answer to edit..."});const o=async c=>{const l={...c,created:void 0,modified:{time:new Date,nickName:""}},{parentId:g}=u,x=g!==l.parentId;await a(g,l,x)};return e.jsx(be,{answer:u,showCloseButton:!0,source:0,submitForm:o,children:"Update Answer"})},os=({inLine:s})=>{console.log(s?"ViewAnswer inLine":"ViewAnswer not inLine");const{state:a}=$(),{activeAnswer:u}=a,[o,c]=E.useState(null);return E.useEffect(()=>{console.log("#################################### ViewAnswer setAnswer ...",{activeAnswer:u}),c(u)},[u]),e.jsx(be,{answer:o,showCloseButton:!0,source:0,submitForm:()=>{},children:"View Answer"})},$s=({answerRow:s,isSelected:a})=>{const{id:u,topId:o,parentId:c,title:l}=s,g={topId:o,parentId:c,id:c},{canEdit:x,authUser:G}=se(),{state:A,viewAnswer:t,addAnswer:h,editAnswer:I,deleteAnswer:N}=$(),{activeAnswer:O,formMode:b,loadingAnswer:C,answerLoaded:V}=A,S=O!==null&&O.id===u,j=b===m.AddingAnswer,M=()=>{s.modified={time:new Date,nickName:G.nickName},N(s,S)},_=async L=>{console.log("AnswerRow onSelectAnswer",{id:L}),x?await I(s):await t(s)},[U,f]=je();E.useEffect(()=>{(async()=>{if(a&&!C&&!V){switch(b){case m.ViewingAnswer:await t(s);break;case m.EditingAnswer:console.log("Zovem from AnswerRow"),x?await I(s):await t(s);break}document.getElementById(`AnswerRow${u}`)?.scrollIntoView({behavior:"smooth",block:"end"})}})()},[x,I,b,u,a,C,V,s,t]);const D=e.jsxs("div",{id:`AnswerRow${u}`,className:`d-relative d-flex justify-content-start align-items-center w-100 mt-0 answer-row${a?"-selected":""}`,style:{marginTop:"1px"},children:[e.jsx(K,{variant:"link",size:"sm",className:"d-flex align-items-center px-1 text-secondary",children:e.jsx("img",{width:"22",height:"18",src:Gs,alt:"Answer"})}),e.jsx(K,{variant:"link",size:"sm",className:`p-0 px-1 m-1 ms-0 answer-row-title ${S?"fw-bold":""}`,title:`id:${u.toString()}`,onClick:()=>_(u),disabled:j,children:l}),x&&!j&&f&&e.jsxs("div",{className:"position-absolute text-nowrap d-flex align-items-center border border-0 border-warning p-0 end-0",children:[e.jsx(K,{variant:"link",size:"sm",className:"ms-1 p-0 text-secondary d-flex align-items-center",title:"Add Answer",onClick:()=>{h(g,!0)},children:e.jsx("img",{width:"22",height:"18",src:He,alt:"Add Answer"})}),e.jsx(K,{variant:"link",size:"sm",className:"ms-0 p-0 text-secondary",onClick:M,children:e.jsx(te,{icon:Ie,size:"lg"})})]})]});return e.jsxs(ae.Item,{className:"py-0 px-0 w-100",as:"li",children:[a&&b===m.AddingAnswer&&e.jsxs(e.Fragment,{children:[e.jsx("div",{id:"div-answer",className:"ms-0 d-md-none w-100",children:e.jsx(De,{showCloseButton:!0,source:0})}),e.jsx("div",{ref:U,className:"d-none d-md-block  border rounded-3",children:D})]}),a&&b===m.EditingAnswer&&e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:U,className:"",children:D}),e.jsx("div",{id:"div-answer",className:"ms-0 d-md-none w-100",children:e.jsx(ss,{inLine:!0})})]}),a&&b===m.ViewingAnswer&&e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:U,className:"",children:D}),e.jsx("div",{ref:U,id:"div-answer",className:"ms-0 d-md-none w-100",children:e.jsx(os,{inLine:!0})})]}),!a&&e.jsx("div",{ref:U,className:"",children:D})]})},ns=({groupRow:s})=>{const{state:a,loadGroupAnswers:u}=$(),{keyExpanded:o,loadingAnswer:c,error:l,selectedAnswerId:g}=a,{answerId:x}=o;s.level+=1;const{answerRows:G}=s;let A=!1;async function t(){try{const N={groupKey:new re(s).groupKey,startCursor:G.length,includeAnswerId:x??null};console.log("^^^^^^^^^^^^^ loadMore"),console.log("^^^^^^^^^^^^^",{x:N}),console.log("^^^^^^^^^^^^^ loadMore"),await u(N)}catch{}}const[h,{rootRef:I}]=Is({loading:c,hasNextPage:A,onLoadMore:t,disabled:!!l,rootMargin:"0px 0px 100px 0px"});return e.jsxs("div",{ref:I,className:"ms-0",style:{maxHeight:"400px",overflowY:"auto"},children:[e.jsxs(Os,{children:[G.length===0&&e.jsx("label",{children:"No answers"}),G.map(N=>e.jsx($s,{answerRow:N,isSelected:N.id===g},N.id)),A]}),l&&e.jsxs("p",{children:["Error: ",l.message]})]})},Vs=({groupKey:s,tag:a,groupInAdding:u})=>{const{name:o}=a,{canEdit:c}=se(),{state:l,deleteGroupVariation:g}=$(),x=()=>{g(s,o)},[G,A]=je(),t=e.jsxs("div",{ref:G,children:[e.jsx(Xe,{pill:!0,bg:"secondary",children:o}),c&&!0&&A&&e.jsx(K,{variant:"link",size:"sm",className:"ms-0 py-0 mx-0 text-secondary",onClick:x,children:e.jsx(te,{icon:Ie,size:"sm"})}),!1]});return e.jsx("div",{className:"py-1 px-1",children:t})},zs=({groupKey:s,variations:a})=>{const{state:u}=$(),{error:o}=u;return E.useEffect(()=>{},[]),e.jsxs("div",{className:"ms-2",children:[e.jsxs(ve,{direction:"horizontal",gap:2,children:[a.length===0&&e.jsx("div",{children:"No variations"}),a.length>0&&a.map(c=>e.jsx(Vs,{groupKey:s,tag:c,groupInAdding:void 0}))]}),o&&e.jsxs("p",{children:["Error: ",o.message]})]})},Ce=({formMode:s,group:a,submitForm:u,children:o})=>{const{onGroupTitleChanged:c}=$(),l=s===m.ViewingGroup,g=s===m.EditingGroup,x=s===m.AddingGroup,{topId:G,id:A,variations:t,answerRows:h,title:I}=a;console.log("GroupForm render: ",{topId:G,id:A,catTitle:I,formMode:s});const N=new re(a).groupKey;document.getElementById("div-details");const O=h&&h.length>0,b=Oe(),C=()=>{b({type:n.CLOSE_GROUP_FORM,payload:{}})},V=()=>{b({type:n.CANCEL_GROUP_FORM,payload:{}})},[S,j]=E.useState(I),M=Ve(S,300),_=ze({enableReinitialize:!0,initialValues:a,validationSchema:Ke().shape({title:Se().required("Required")}),onSubmit:L=>{console.log("GroupForm.onSubmit",JSON.stringify(L,null,2)),u(L),j(L.title)}});E.useEffect(()=>{(async()=>(console.log("GroupForm.useEffect - onGroupTitleChanged",{debouncedSearchTerm:M,title:_.values.title}),c(G,A,_.values.title)))()},[M,_.values.title,c]);const U=L=>{_.handleChange(L);const P=L.target.value;j(P)},f=E.useRef(null);E.useEffect(()=>{f.current?.focus()},[f]);const D=!1;return console.log("GroupForm render return: ",S),e.jsxs("div",{className:"form-wrapper p-2 group-form",children:[e.jsx(Me,{onClick:C,className:"float-end"}),e.jsx(Ee,{className:"text-center text-muted",children:e.jsxs(T.Label,{children:["Group ",l?"Viewing":g?"Editing":"Adding"]})}),e.jsxs(T,{onSubmit:()=>_.handleSubmit,children:[e.jsx(T.Group,{controlId:"Variations",children:e.jsxs(ve,{direction:"horizontal",gap:1,children:[e.jsx("div",{className:"px-0",children:e.jsx(T.Label,{children:"Variations:"})}),e.jsx("div",{className:"px-1 border border-1 border-secondary rounded",children:e.jsx(zs,{groupKey:N,variations:t?t.map(L=>({name:L})):[]})}),e.jsx("div",{className:"ps-2",children:e.jsx(T.Label,{children:"Kind:"})}),e.jsx("div",{className:"px-1 border border-1 border-secondary rounded",children:e.jsxs(T.Group,{controlId:"kind",children:[e.jsx(_e,{id:"kind",name:"kind",options:bs,onChange:(L,P)=>{L.preventDefault(),_.setFieldValue("kind",P)},value:_.values.kind,disabled:D,classes:"text-primary"}),e.jsx(T.Text,{className:"text-danger",children:_.touched.kind&&_.errors.kind?e.jsx("div",{className:"text-danger",children:_.errors.kind}):null})]})})]})}),e.jsxs(T.Group,{controlId:"title",children:[e.jsx(T.Label,{children:"Title"}),e.jsx(T.Control,{as:"textarea",name:"title",placeholder:"new Group",value:S,onFocus:L=>{s===m.AddingGroup&&L.target.select()},onChange:U,ref:f,rows:3,className:"text-primary w-100",disabled:l}),e.jsx(T.Text,{className:"text-danger",children:_.touched.title&&_.errors.title?e.jsx("div",{className:"text-danger",children:_.errors.title}):null})]}),e.jsxs(T.Group,{controlId:"link",children:[e.jsx(T.Label,{children:"Link"}),_.values.hasSubGroups?e.jsx(T.Control,{as:"input",placeholder:"/groups/...",name:"link",onChange:_.handleChange,className:"text-primary w-100",value:"Can't have link (has sub groups)",disabled:!0}):e.jsxs(e.Fragment,{children:[e.jsx(T.Control,{as:"input",placeholder:"/groups/...",name:"link",onChange:_.handleChange,className:"text-primary w-100",value:_.values.link??"",disabled:l}),e.jsx(T.Text,{className:"text-danger",children:_.touched.link&&_.errors.link?e.jsx("div",{className:"text-danger",children:_.errors.link}):null})]})]}),e.jsxs(T.Group,{children:[e.jsxs(T.Label,{className:"m-1 mb-0",children:["Answers (",`${_.values.numOfAnswers}`,") "]}),O&&e.jsx(ns,{groupRow:a})]}),(l||g)&&e.jsx(Be,{created:a.created,modified:a.modified,classes:"text-primary"}),(_.dirty&&g||x)&&e.jsx(qe,{cancelForm:V,handleSubmit:_.handleSubmit,title:o})]})]})},rs=({inLine:s})=>{const a=se(),{nickName:u}=a.authUser,{state:o,updateGroup:c}=$(),{activeGroup:l,keyExpanded:g}=o,{answerId:x}=g,G=async A=>{const t={...A,created:void 0,modified:{time:new Date,nickName:u}};await c(t,!0)};return e.jsx(Ce,{inLine:s,group:{...l},answerId:x,formMode:m.EditingGroup,submitForm:G,children:"Update Group"})},Ne=({inLine:s})=>{const{state:a}=$(),{activeGroup:u,keyExpanded:o}=a,{answerId:c}=o;return e.jsx(Ce,{inLine:s,group:{...u},answerId:c,formMode:m.ViewingGroup,submitForm:()=>{},children:"View Group"})},ts=({activeGroup:s})=>{const a=se(),{nickName:u}=a.authUser,{createGroup:o}=$(),[c]=E.useState({...s}),l=async g=>{const x={...g,created:{time:new Date,nickName:u},modified:void 0};console.log("**********object",x),await o(x)};return!s===null?null:(console.log("AddGroup render >>>>>:",s),e.jsx(e.Fragment,{children:e.jsx(Ce,{inLine:!1,group:c,answerId:null,formMode:m.AddingGroup,submitForm:l,children:"Create Group"})}))},Ks=({groupRow:s,answerId:a})=>{const{id:u,title:o,hasSubGroups:c,numOfAnswers:l,isExpanded:g,groupRows:x}=s;s.level+=1;const G=new re(s).groupKey,{canEdit:A,authUser:t}=se(),{state:h,addSubGroup:I,viewGroup:N,editGroup:O,deleteGroup:b,expandGroup:C,collapseGroup:V,addAnswer:S}=$();let{formMode:j,activeGroup:M,loadingGroup:_,groupLoaded:U}=h;const f=M!==null&&M.id===u,D=j===m.AddingGroup,L=g&&l>0,P=()=>{s.modified={time:new Date,nickName:t.nickName},b(s)},k=async()=>{g?await V(s):await C({groupKey:G})},[oe,pe]=E.useState(!1);E.useEffect(()=>{pe(!0)},[x]);const B=async()=>{A?await O(s,a??"null"):await N(s,a??"null")},[le,z]=E.useState(!1);E.useEffect(()=>{le&&(I(s),z(!1))},[I,s,le]);const[de,ne]=E.useState(!1);E.useEffect(()=>{de&&(S(G,g??!1),ne(!1))},[S,G,g,de]),E.useEffect(()=>{(async()=>{if(f&&!_&&!U&&!D)switch(console.log("GroupRow formMode:",j),j){case m.ViewingGroup:await N(s,a??"null");break;case m.EditingGroup:A?await O(s,a??"null"):await N(s,a??"null");break}})()},[A,G,U,s,O,C,j,D,f,_,a,N]);const[W,J]=je(),q=e.jsxs("div",{children:[e.jsxs("div",{id:`Row${u}`,className:`d-relative d-flex justify-content-start align-items-center w-100 mt-1 group-row${f?"-selected":""}`,style:{marginTop:"1px"},children:[e.jsx(K,{variant:"link",size:"sm",className:"py-0 px-1","aria-controls":u+"-2","aria-expanded":oe,onClick:H=>{k(),H.stopPropagation()},title:"Expand",disabled:D||!c&&l===0,children:e.jsx(te,{icon:g?We:$e,size:"lg"})}),e.jsx(K,{variant:"link",size:"sm",className:"py-0 px-1 bg-light",title:"Expand",disabled:!0,children:e.jsx(te,{icon:Ds,size:"sm"})}),e.jsx(K,{variant:"link",size:"sm",className:`py-0 ms-0 me-1 group-row-title ${f?"fw-bold text-white bg-transparent":""}`,title:u,onClick:B,disabled:D,children:o}),l>0&&e.jsxs(Xe,{pill:!0,bg:"secondary",className:"d-inline bg-transparent",children:[l,"Q"]}),A&&J&&e.jsxs("div",{className:"position-absolute text-nowrap d-flex align-items-center border border-0 border-warning p-0 end-0",children:[e.jsx("div",{className:"d-flex align-items-center",children:e.jsx(K,{variant:"link",size:"sm",className:"border-0 py-0 px-0 ms-0 text-success",title:"Add SubGroup",onClick:async()=>{!g&&(c||l>0)&&await k(),setTimeout(()=>z(!0),1e3)},children:e.jsx(te,{icon:Cs,size:"lg"})})}),!D&&!c&&e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(K,{variant:"link",size:"sm",className:"p-0 mx-0 text-secondary d-flex align-items-center border border-0 border-warning1",title:"Add Answer",onClick:async()=>{!g&&(c||l>0)&&await k(),setTimeout(()=>ne(!0),500)},children:e.jsx("img",{width:"22",height:"18",src:He,alt:"Add Answer"})}),e.jsx(K,{variant:"link",size:"sm",className:"d-flex align-items-center border border-0 border-warning p-0",disabled:c||l>0,onClick:P,children:e.jsx(te,{icon:Ie,size:"lg"})})]})]})]}),L&&e.jsx("div",{className:"ps-3",children:e.jsx(ns,{groupRow:s})})]});return e.jsxs(e.Fragment,{children:[e.jsxs(ae.Item,{className:"py-0 px-1 w-100 group-bg",as:"li",children:[f&&j===m.AddingGroup&&e.jsxs("div",{children:[e.jsx("div",{ref:W,className:"",children:q}),e.jsx("div",{className:"ms-0 d-md-none w-100",children:e.jsx(ts,{activeGroup:M})})]}),f&&j===m.EditingGroup&&e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:W,children:q}),e.jsx("div",{id:"divInLine",className:"ms-0 d-md-none w-100",children:e.jsx(rs,{inLine:!1})})]}),f&&j===m.ViewingGroup&&e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:W,children:q}),e.jsx("div",{id:"divInLine",className:"ms-0 d-md-none w-100",children:e.jsx(Ne,{inLine:!1})})]}),f&&j===m.None&&e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:W,children:q}),e.jsx("div",{id:"divInLine",className:"ms-0 d-md-none w-100",children:e.jsx(Ne,{inLine:!1})})]}),!f&&e.jsx("div",{ref:W,children:q})]}),h.error&&h.whichRowId===u&&e.jsx("div",{className:"text-danger",children:h.error.message}),g&&e.jsx(ae.Item,{className:"py-0 px-0 border-0 border-warning border-bottom-0 group-bg p-0 m-0",variant:"primary",as:"li",children:e.jsx("div",{className:"rambo",children:c&&e.jsx(Ss,{in:oe,children:e.jsx("div",{id:u+"-2",style:{marginTop:"1px"},children:e.jsx("div",{style:{border:"1px solid #ddd",borderRadius:"4px"},children:e.jsx(as,{groupRow:s,isExpanded:g})})})})})})]})},as=({groupRow:s})=>{const{level:a,groupRows:u}=s,{state:o}=$();let{keyExpanded:c}=o;const{answerId:l}=c??{answerId:null};return e.jsx("div",{className:a>1?"ms-2":"",children:e.jsx(ae,{as:"ul",variant:"dark",className:"mb-0 group-bg",children:u.map(g=>e.jsx(Ks,{groupRow:g,answerId:l===""?null:l},g.id))})})},Bs=s=>{const{isDarkMode:a}=se(),[u,o]=E.useState("");return E.useEffect(()=>{},[]),e.jsxs(Re,{show:s.show,onHide:s.onHide,animation:!0,centered:!0,size:"lg",className:"modal show",contentClassName:`${a?"bg-secondary bg-gradient":"bg-info bg-gradient"}`,children:[e.jsx(Re.Header,{closeButton:!0,children:"Store new Answer to the Database"}),e.jsx(Re.Body,{className:"py-0",children:e.jsx(De,{closeModal:s.onHide,showCloseButton:!1,source:1,setError:c=>o(c)})}),e.jsx(Re.Footer,{children:u})]})},qs=E.lazy(()=>Ns(()=>import("./AutoSuggestAnswers-DSvwzOb6.js"),__vite__mapDeps([0,1,2,3,4,5])).then(s=>({default:s.AutoSuggestAnswers}))),Hs=({groupId_answerId:s,fromChatBotDlg:a})=>{const{state:u,expandNodesUpToTheTree:o,loadTopRows:c,addSubGroup:l}=$(),{allGroupRows:g,topRows:x,topRowsLoading:G,topRowsLoaded:A,keyExpanded:t,groupId_answerId_done:h,nodeOpening:I,nodeOpened:N,activeGroup:O,activeAnswer:b,formMode:C,loadingGroups:V,loadingGroup:S,loadingAnswers:j,loadingAnswer:M}=u,{searchAnswers:_,setLastRouteVisited:U,setChatBotDlgEnabled:f}=Fe(),{isDarkMode:D,chatBotDlgEnabled:L,lastRouteVisited:P}=se(),[k,oe]=E.useState(!1),[pe,B]=E.useState({...Te}),le=Oe(),z=async W=>{le({type:n.SET_ANSWER_SELECTED,payload:{answerKey:W}})};let de="";E.useEffect(()=>{(async()=>!G&&!A&&(console.log("ZOVEM 111 loadTopRows()"),await c()))()},[G,A,c]),E.useEffect(()=>{(async()=>{if(!I&&A&&x.length>0){if(s){if(s==="add_answer"){const W=localStorage.getItem("New_Answer");if(W){const J=JSON.parse(W);return B({...Te,groupTitle:"Select",...J}),oe(!0),localStorage.removeItem("New_Answer"),null}}else if(s!==h){const W=s.split("_"),J=W[0],q=W[1],H={topId:"",id:J,parentId:"ROOT"};console.log("zovem expandNodesUpToTheTree 1111111111111111111)",{groupId_answerId:s},{groupId_answerId_done:h}),await o(H,q!=="null"?q:null),console.log("zavrsio expandNodeUpToTheTree 1111111111111111111 DONE)",{groupId_answerId:s})}}else if(t&&!N){const{topId:W,groupId:J,answerId:q}=t;if(J!==""){const H={topId:W,id:J,parentId:"ROOT"};console.log("zovem expandNodeUpToTheTree 2222222222222)",{keyExpanded:t,grpKey:H}),await o(H,q),console.log("zavrsio expandNodeUpToTheTree 2222222222222 DONE)")}}L||f()}})()},[s,h,A,t,I,N,o,a,L,f]);const ne="/knowledge/groups";return E.useEffect(()=>{P!==ne&&U(ne)},[P,U]),s!=="add_answer"&&s&&s!==h?(console.log("zzzzzz loading...",{keyExpanded:t,groupId_answerId:s,groupId_answerId_done:h}),e.jsx("div",{children:"loading..."})):A?(console.log("===>>> Groups !!!!!!!!!!!!!!!!!",O),e.jsxs(e.Fragment,{children:[e.jsxs(Ts,{children:[e.jsxs("h5",{className:"text-warning mx-auto w-75 fw-bold",children:[e.jsx("span",{className:"groups",children:"Groups / "}),e.jsx("span",{className:"answers",children:"Answers"})]}),e.jsx(Ee,{className:`${D?"dark":""}`,children:e.jsx(ge,{children:e.jsx("div",{className:"d-flex justify-content-start align-items-center",children:e.jsx("div",{className:"w-75 my-1 answers",children:e.jsx(E.Suspense,{fallback:e.jsx("div",{children:"Loading..."}),children:e.jsx(qs,{tekst:de,onSelectAnswer:z,allGroupRows:g,searchAnswers:_})})})})})}),e.jsx(K,{variant:"secondary",size:"sm",type:"button",style:{padding:"1px 4px"},onClick:()=>l(null),children:"Add Group"}),e.jsxs(Ee,{className:"my-1 h-auto",children:[e.jsx(ge,{xs:12,md:5,children:e.jsx("div",{className:"groups-border",style:{position:"relative"},children:e.jsx(as,{groupRow:{...Qe,groupRows:x},isExpanded:!0})})}),e.jsx(ge,{xs:0,md:7,children:e.jsxs("div",{id:"div-details",className:"d-none d-md-block",children:[O&&C===m.ViewingGroup&&e.jsx(Ne,{inLine:!1}),O&&C===m.EditingGroup&&e.jsx(rs,{inLine:!1}),O&&C===m.AddingGroup&&e.jsx(ts,{activeGroup:O}),b&&C===m.ViewingAnswer&&e.jsx(os,{inLine:!1}),b&&C===m.EditingAnswer&&e.jsx(ss,{inLine:!1}),b&&C===m.AddingAnswer&&e.jsx(De,{})]})})]})]}),k&&b&&e.jsx(Bs,{show:k,onHide:()=>{oe(!1)},newAnswerRow:pe}),(V||j)&&e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{position:"absolute",top:"40%",left:"20%"},children:e.jsx("div",{className:`spinner-border ${j?"answer":"group"}-spinner`,role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})}),S&&e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{position:"absolute",top:"50%",left:"50%"},children:e.jsx("div",{className:"spinner-border group-spinner",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})}),M&&e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{position:"absolute",top:"50%",left:"50%"},children:e.jsx("div",{className:"spinner-border answer-spinner",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})})]})):(console.log("===>>> Groups  VRATIO"),null)},Ys=()=>{let{groupId_answerId:s,fromChatBotDlg:a}=_s();if(s&&s==="groups"&&(s=void 0),s){const u=s.split("_");console.assert(u.length===2,"expected 'groupId_answerId'")}return e.jsx(Us,{children:e.jsx(Hs,{groupId_answerId:s,fromChatBotDlg:a})})};export{Ys as default};
//# sourceMappingURL=Groups-pDCMbcX2.js.map
