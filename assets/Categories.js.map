{"version":3,"mappings":"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","names":["initialQuestion","_generateId","initialCategory","CategoryReducer","state","action","categoryRow","ActionTypes","keyExpanded","modifyTree","doNotModifyTree","topRows","newState","doNotCallInnerReducerActions","innerReducer","newTopRows","topId","id","idToSet","c","DeepClone","topRow","newTopRow","actionStoringToLocalStorage","locStorage","allCategoryRows","allGroupRows","categoryId_questionId_done","category","questionId","question","formMode","row","error","whichRowId","IsCategory","parentId","activeCategory","FormMode","newCategoryRow","catRow","questionKey","categoryId","newQuestionRow","title","link","kind","header","level","variations","numOfQuestions","hasSubCategories","categoryRows","created","modified","questionRows","isExpanded","subCatRows","CategoriesContext","createContext","CategoryDispatchContext","initialState","CategoryProvider","children","loadAllCategoryRowsGlobal","loadAllGroupRowsGlobal","useGlobalContext","globalState","useGlobalState","KnowledgeAPI","isAuthenticated","workspace","authUser","canEdit","nickName","dispatch","useReducer","activeQuestion","allCategoryRowsLoaded","useEffect","s","Execute","useCallback","method","endpoint","data","accessToken","response","headers","bearer","options","responseData","errors","e","loadAllCategoryRows","resolve","loadAllGroupRows","getCat","getSubCats","parentHeader","subCats","cat","loadTopRows","url","dtos","dto","CategoryRow","getCategory","categoryKey","includeQuestionId","PAGE_SIZE","categoryDtoEx","categoryDto","msg","Category","findCategoryRow","expandNodesUpToTheTree","catKey","fromChatBotDlg","query","CategoryKey","categoryRowDtoEx","categoryRowDto","topRowNew","bottomRow","questionRow","q","getCategoryRow","hidrate","expandCategory","selectedQuestionId","collapseCategory","addCategory","parentCategoryRow","cancelAddCategory","parentRow","rows","createCategory","CategoryDto","cancelAddQuestion","expandInfo","viewCategory","editCategory","updateCategory","deleteCategory","CategoryRowDto","deleteCategoryVariation","variationName","loadCategoryQuestions","startCursor","addQuestion","createQuestion","questionDto","QuestionDto","questionDtoEx","Question","updateQuestion","oldParentId","categoryChanged","questionRet","deleteQuestion","isActive","QuestionRowDto","getQuestion","QuestionKey","questionEx","viewQuestion","editQuestion","getAnswerCount","count","assignQuestionAnswer","assignedAnswerKey","assignedAnswer","AssignedAnswerDto","QuestionKeyDto","onCategoryTitleChanged","onQuestionTitleChanged","contextValue","jsx","useCategoryContext","useContext","useCategoryDispatch","QPlus","CatActionTypes","CatRow","setParentCat","selId","expand","_id","onSelectCat","Row1","jsxs","Button","FontAwesomeIcon","faCaretDown","faCaretRight","Fragment","ListGroup","CatList","CatReducer","expanding","cats","ids","markForClean","deca","unuci","setParentId","useState","res","mySubCats","AssignedAnswer","questionTitle","isDisabled","unAssignAnswer","answerTitle","time","emailFromClient","rowTitle","formatDate","isDarkMode","alreadyAdding","removeAnswer","onSelectAnswer","sendEMail","showReply","setShowReply","handleClose","copyToClipboard","err","hoverRef","hovering","useHover","faEnvelope","faCopy","faRemove","Modal","AddAnswer","AutoSuggestAnswers","lazy","module","AssignedAnswers","assignedAnswers","searchAnswers","variant","showAdd","setShowAdd","closeModal","showAssign","setShowAssign","errorMsg","setErrorMsg","onAnswerCreated","answer","assignAnswer","Suspense","RelatedFilter","relatedFilter","filter","numOfUsages","lastUsed","Badge","formatDateShort","RelatedFilters","relatedFilters","unAssignFilter","QuestionForm","submitForm","showCloseButton","source","viewing","editing","adding","qTitle","closeForm","cancelForm","searchTerm","setSearchTerm","debouncedSearchTerm","useDebounce","nameRef","useRef","formik","useFormik","Yup.object","Yup.string","values","handleChangeTitle","event","value","CloseButton","Row","Form","Stack","Dropdown","Col","Select","sourceOptions","statusOptions","CreatedModifiedForm","FormButtons","AddQuestion","setError","cancelAdd","questionObject","newQuestion","EditQuestion","allGroupRowsLoaded","ViewQuestion","inLine","setQuestion","QuestionRow","isSelected","numOfAssignedAnswers","loadingQuestion","questionLoaded","showForm","del","onSelectQuestion","Q","QuestionList","hasMoreQuestions","loadMore","x","infiniteRef","rootRef","useInfiniteScroll","List","VariationRow","tag","categoryInAdding","name","VariationList","CategoryForm","cancel","close","catTitle","showQuestions","variation","kindOptions","EditCategory","categoryObject","object","ViewCategory","AddCategory","formValues","loadingCategory","categoryLoaded","inAdding","deleteCategoryRow","handleExpandClick","open","setOpen","onSelectCategory","queue","setQueue","queue2","setQueue2","faFolder","faPlus","Collapse","CategoryList","ModalAddQuestion","props","createQuestionError","setCreateQuestionError","Providered","categoryId_questionId","topRowsLoading","topRowsLoaded","nodeOpening","nodeOpened","loadingCategories","loadingQuestions","searchQuestions","setLastRouteVisited","setChatBotDlgEnabled","chatBotDlgEnabled","lastRouteVisited","modalShow","setModalShow","setNewQuestion","tekst","sNewQuestion","arr","route","Container","AutoSuggestQuestions","Categories","useParams"],"ignoreList":[],"sources":["../../src/categories/CategoryReducer.tsx","../../src/categories/CategoryProvider.tsx","../../src/assets/QPlus.png","../../src/global/Components/SelectCategory/types.ts","../../src/global/Components/SelectCategory/CatRow.tsx","../../src/global/Components/SelectCategory/CatReducer.tsx","../../src/global/Components/SelectCategory/CatList.tsx","../../src/categories/components/questions/AssignedAnswer.tsx","../../src/categories/components/questions/AddAnswer.tsx","../../src/categories/components/questions/AssignedAnswers.tsx","../../src/categories/components/questions/RelatedFilter.tsx","../../src/categories/components/questions/RelatedFilters.tsx","../../src/categories/components/questions/QuestionForm.tsx","../../src/categories/components/questions/AddQuestion.tsx","../../src/categories/components/questions/EditQuestion.tsx","../../src/categories/components/questions/ViewQuestion.tsx","../../src/categories/components/questions/QuestionRow.tsx","../../src/categories/components/questions/QuestionList.tsx","../../src/categories/VariationRow.tsx","../../src/categories/VariationList.tsx","../../src/categories/components/CategoryForm.tsx","../../src/categories/components/EditCategory.tsx","../../src/categories/components/ViewCategory.tsx","../../src/categories/components/AddCategory.tsx","../../src/categories/components/CategoryRow.tsx","../../src/categories/components/CategoryList.tsx","../../src/categories/ModalAddQuestion.tsx","../../src/categories/Categories.tsx"],"sourcesContent":["import { type Reducer } from 'react'\r\nimport {\r\n  ActionTypes, type Actions, type ILocStorage, IsCategory,\r\n  type ICategoriesState, type ICategory, type ICategoryRow, type IQuestion,\r\n  actionStoringToLocalStorage, FormMode, doNotModifyTree, doNotCallInnerReducerActions,\r\n  _generateId\r\n} from \"@/categories/types\";\r\n\r\nexport const subCatRow: ICategoryRow = {\r\n  topId: _generateId, // for top rows: topId = ToUpperCase(id)\r\n  id: _generateId,\r\n  parentId: null,\r\n  level: 1,\r\n  isExpanded: false,\r\n  categoryRows: [],\r\n  kind: 0,\r\n  title: '',\r\n  link: null,\r\n  header: '',\r\n  hasSubCategories: false,\r\n  variations: [],\r\n  numOfQuestions: 0,\r\n  questionRows: []\r\n}\r\n\r\nexport const initialQuestion: IQuestion = {\r\n  topId: '',\r\n  parentId: 'null',\r\n  id: _generateId, //  keep _generateId, it is expected at BackEnd\r\n  categoryTitle: '',\r\n  title: '',\r\n  assignedAnswers: [],\r\n  numOfAssignedAnswers: 0,\r\n  relatedFilters: [],\r\n  numOfRelatedFilters: 0,\r\n  source: 0,\r\n  status: 0,\r\n  included: false\r\n}\r\n\r\nexport const initialCategory: ICategory = {\r\n  topId: 'null',\r\n  parentId: 'null',\r\n  id: 'define at BackEnd',\r\n  kind: 0,\r\n  title: '',\r\n  link: '',\r\n  header: '',\r\n  level: 0,\r\n  variations: [],\r\n  hasSubCategories: false,\r\n  categoryRows: [],\r\n  questionRows: [],\r\n  numOfQuestions: 0,\r\n  hasMoreQuestions: false,\r\n  isExpanded: false,\r\n  doc1: ''\r\n}\r\n\r\nexport const CategoryReducer: Reducer<ICategoriesState, Actions> = (state, action) => {\r\n\r\n  console.log('------------------------------->')\r\n  console.log('------------------------------->', action.type)\r\n  console.log('------------------------------->')\r\n  // ----------------------------------------------------------------------\r\n  // Rubljov: \"By giving the right name, you reveal the essence of things\"\r\n  // ----------------------------------------------------------------------\r\n  //\r\n  // - firstLevelCategoryRow AAA\r\n  // ------> categoryRow AAA.1\r\n  // --------- > categoryRow AAA 1.1\r\n  // --------- > ...\r\n  //\r\n  // ------> categoryRow AAA.2\r\n  // --------- > categoryRow AAA 2.1\r\n  // --------- > categoryRow AAA 2.2\r\n  // ------------ > Category Row AAA 2.2.1\r\n  // ------------ > categoryRow AAA 2.2.2\r\n  // --------------- > categoryRow AAA 2.2.2.1\r\n  // --------------- > categoryRow AAA 2.2.2.2\r\n  //\r\n  // --------- > categoryRow AAA 2.3\r\n  //\r\n  // - firstLevelCategoryRow BBB\r\n  // - ...\r\n\r\n  const { categoryRow } = action.payload;\r\n  // const isCategory = IsCategory(categoryRow); // ICategory rather than ICategoryRow\r\n\r\n  if (action.type === ActionTypes.SET_KEY_EXPANDED) {\r\n    const { keyExpanded } = action.payload;\r\n    return {\r\n      ...state,\r\n      keyExpanded,\r\n      nodeOpened: keyExpanded === null ? true : state.nodeOpened\r\n    }\r\n  }\r\n\r\n  let modifyTree = categoryRow\r\n    ? doNotModifyTree.includes(action.type) ? false : true\r\n    : false;\r\n\r\n  const { topRows } = state;\r\n\r\n  const newState = doNotCallInnerReducerActions.includes(action.type)\r\n    ? { ...state }\r\n    : innerReducer(state, action);\r\n\r\n  // return { ...state } // calling this, state would be destroyed, because of shallow copy\r\n  // Action that modify Tree\r\n  // Actually part topRows of state\r\n  if (modifyTree && categoryRow) { //} && categoryRow.topId !== 'ROOT') {\r\n    let newTopRows: ICategoryRow[];\r\n    const { topId, id } = categoryRow!;\r\n    const idToSet = (action.payload as any).idToSet ?? id; // for SET_CATEGORY_ADDED\r\n\r\n    if (id === topId) { // root category is added or updated\r\n      newTopRows = topRows.map(c => c.id === idToSet\r\n        ? new DeepClone(categoryRow!).categoryRow\r\n        : new DeepClone(c).categoryRow\r\n      );\r\n    }\r\n    else {\r\n      // actually topRows is from previous state\r\n      const topRow: ICategoryRow = topRows.find(c => c.id === topId)!;\r\n      DeepClone.idToSet = idToSet;\r\n      DeepClone.newCategoryRow = categoryRow!;\r\n      const newTopRow = new DeepClone(topRow).categoryRow;\r\n      newTopRows = topRows.map(c => c.id === topId\r\n        ? newTopRow\r\n        : new DeepClone(c).categoryRow\r\n      );\r\n      DeepClone.idToSet = '';\r\n    }\r\n    newState.topRows = newTopRows;\r\n  }\r\n  else {\r\n    // just clone to enable time-travel debugging\r\n  }\r\n\r\n  if (actionStoringToLocalStorage.includes(action.type)) {\r\n    const { keyExpanded } = newState;\r\n    const locStorage: ILocStorage = {\r\n      keyExpanded\r\n    }\r\n    localStorage.setItem('CATEGORIES_STATE', JSON.stringify(locStorage));\r\n  }\r\n\r\n  console.log('CategoryReducer newState', newState)\r\n  return newState;\r\n}\r\n\r\nconst innerReducer = (state: ICategoriesState, action: Actions): ICategoriesState => {\r\n  switch (action.type) {\r\n\r\n    //////////////////////////////////////////////////\r\n    // Rows Level: 1\r\n\r\n    case ActionTypes.SET_TOP_ROWS_LOADING:\r\n      return {\r\n        ...state,\r\n        loadingCategories: true,\r\n        topRowsLoading: true,\r\n        topRowsLoaded: false\r\n      }\r\n\r\n    case ActionTypes.SET_TOP_ROWS: {\r\n      const { topRows } = action.payload;\r\n      console.log('=> CategoriesReducer ActionTypes.SET_TOP_ROWS', state.topRows, topRows)\r\n      return {\r\n        ...state,\r\n        topRows,\r\n        topRowsLoading: false,\r\n        topRowsLoaded: true,\r\n        loadingCategories: false\r\n      };\r\n    }\r\n\r\n    case ActionTypes.SET_ALL_CATEGORY_ROWS: {\r\n      const { allCategoryRows } = action.payload;\r\n      return {\r\n        ...state,\r\n        allCategoryRows,\r\n        allCategoryRowsLoaded: Date.now()\r\n      };\r\n    }\r\n\r\n    case ActionTypes.SET_ALL_GROUP_ROWS: {\r\n      const { allGroupRows } = action.payload;\r\n      return {\r\n        ...state,\r\n        allGroupRows,\r\n        allGroupRowsLoaded: Date.now()\r\n      };\r\n    }\r\n\r\n    case ActionTypes.SET_NODE_EXPANDING_UP_THE_TREE: {\r\n      const { categoryId_questionId_done } = action.payload;\r\n      //const { keyExpanded /*, activeCategory, activeQuestion */ } = state;\r\n      return {\r\n        ...state,\r\n        categoryId_questionId_done,\r\n        nodeOpening: true,\r\n        loadingCategories: true,\r\n        nodeOpened: false,\r\n        //keyExpanded: fromChatBotDlg ? null : { ...keyExpanded! },\r\n        activeCategory: null, //fromChatBotDlg ? null : activeCategory,\r\n        activeQuestion: null //fromChatBotDlg ? null : activeQuestion\r\n      }\r\n    }\r\n\r\n    case ActionTypes.SET_NODE_EXPANDED_UP_THE_TREE: {\r\n      const { category, questionId, question, formMode } = action.payload;\r\n      return {\r\n        ...state,\r\n        activeCategory: category,\r\n        activeQuestion: question,\r\n        selectedQuestionId: questionId,\r\n        formMode,\r\n        nodeOpening: false,\r\n        nodeOpened: true,\r\n        loadingCategories: false\r\n      };\r\n    }\r\n\r\n    case ActionTypes.SET_LOADING_CATEGORIES:\r\n      return {\r\n        ...state,\r\n        //activeCategory: null,\r\n        loadingCategories: true\r\n      }\r\n\r\n    case ActionTypes.SET_LOADING_CATEGORY:\r\n      return {\r\n        ...state,\r\n        //activeCategory: null,\r\n        loadingCategory: true,\r\n        categoryLoaded: false\r\n      }\r\n\r\n\r\n    // case ActionTypes.FORCE_OPEN_NODE:\r\n    //   const { keyExpanded } = action.payload;\r\n    //   return {\r\n    //     ...state,\r\n    //     nodeOpening: false,\r\n    //     nodeOpened: false,\r\n    //     topRows: [],\r\n    //     topRowsLoaded: false,\r\n    //     keyExpanded\r\n    //   }\r\n\r\n    case ActionTypes.FORCE_OPEN_NODE:\r\n      const { keyExpanded } = action.payload;\r\n      alert('FORCE_OPEN_NODE is deprecated, use SET_QUESTION_SELECTED instead')\r\n      return {\r\n        ...state,\r\n        topRows: state.topRows.filter(row => row.parentId === null),\r\n        keyExpanded,\r\n        nodeOpened: false, // keep topRows, and openNode\r\n        activeCategory: null,\r\n        activeQuestion: null,\r\n        selectedQuestionId: null\r\n      }\r\n\r\n    // case ActionTypes.RESET_CATEGORY_QUESTION_DONE: {\r\n    //   return {\r\n    //     ...state,\r\n    //     categoryId_questionId_done: undefined,\r\n    //     categoryNodeLoaded: false\r\n    //   };\r\n    // }\r\n\r\n    case ActionTypes.SET_SUB_CATEGORIES: {\r\n      //const { categoryRows } = action.payload;\r\n      //const { topRows } = state;\r\n      //categoryRows.forEach((categoryRow: ICategoryRow) => {\r\n      //const { id, hasSubCategories, numOfQuestions } = categoryRow;\r\n      //})\r\n      return {\r\n        ...state,\r\n        loadingCategory: false,\r\n        //categoryLoaded: false proveri\r\n      };\r\n    }\r\n\r\n\r\n    case ActionTypes.SET_ERROR: {\r\n      const { error, whichRowId } = action.payload; // category.id or question.id\r\n      return {\r\n        ...state,\r\n        error,\r\n        whichRowId,\r\n        loadingCategories: false,\r\n        loadingQuestions: false,\r\n        loadingCategory: false, categoryLoaded: false,\r\n        loadingQuestion: false, questionLoaded: false\r\n      };\r\n    }\r\n\r\n\r\n    // case ActionTypes.SET_CATEGORY_ROW: {\r\n    //   const { categoryRow } = action.payload; // category doesn't contain  inAdding \r\n    //   console.assert(IsCategory(categoryRow));\r\n    //   const categoryKey = new CategoryKey(categoryRow).categoryKey!;\r\n    //   return {\r\n    //     ...state,\r\n    //     // keep mode\r\n    //     loadingCategory: false,\r\n    //     //keyExpanded: { ...categoryKey },\r\n    //     activeCategory: categoryRow,\r\n    //     activeQuestion: null\r\n    //   }\r\n    // }\r\n\r\n    case ActionTypes.SET_CATEGORY: {\r\n      const { categoryRow } = action.payload; // category doesn't contain  inAdding \r\n      console.assert(IsCategory(categoryRow));\r\n      //const categoryKey = new CategoryKey(categoryRow).categoryKey!;\r\n      return {\r\n        ...state,\r\n        // keep mode\r\n        loadingCategory: false,\r\n        categoryLoaded: true,\r\n        //keyExpanded: { ...categoryKey },\r\n        activeCategory: categoryRow,\r\n        activeQuestion: null,\r\n        selectedQuestionId: null,\r\n\r\n      }\r\n    }\r\n\r\n    case ActionTypes.SET_ROW_EXPANDING: {\r\n      return {\r\n        ...state,\r\n        rowExpanding: true,\r\n        rowExpanded: false,\r\n        loadingCategories: true\r\n      }\r\n    }\r\n\r\n    case ActionTypes.SET_ROW_EXPANDED: {\r\n      const { categoryRow } = action.payload; // , selectedQuestionId\r\n      const { topId, id } = categoryRow;\r\n      const { keyExpanded } = state;\r\n      const questionId = keyExpanded ? keyExpanded.questionId : null; // (topId === keyExpanded?.topId && id === keyExpanded.categoryId)\r\n      //? keyExpanded.questionId\r\n      //: null;\r\n      // Do not work with categoryRow, \r\n      // categoryRow will be proccesed in CategoryReducer, rather than in innerReducer\r\n      return {\r\n        ...state,\r\n        // keep mode\r\n        loadingCategories: false,\r\n        keyExpanded: {\r\n          topId,\r\n          categoryId: id,\r\n          questionId\r\n        },\r\n        //activeCategory: null,\r\n        activeQuestion: null,\r\n        selectedQuestionId: questionId, //selectedQuestionId ?? null,\r\n        loadingQuestion: false,\r\n        questionLoaded: false,\r\n        rowExpanding: false,\r\n        rowExpanded: true\r\n        //formMode\r\n      }\r\n    }\r\n\r\n    // case ActionTypes.SET_ROW_COLLAPSING: {\r\n    //   return {\r\n    //     ...state,\r\n    //     // keep mode\r\n    //     loadingCategories: true, \r\n    //     rowExpanding: true, // actually collapsing\r\n    //     rowExpanded: false\r\n    //   }\r\n    // }\r\n\r\n\r\n    case ActionTypes.SET_ROW_COLLAPSED: {\r\n      const { categoryRow } = action.payload; // category doesn't contain  inAdding \r\n      const { topId, parentId } = categoryRow;\r\n      //const categoryKey = new CategoryKey(categoryRow).categoryKey\r\n      return {\r\n        ...state,\r\n        // keep mode\r\n        loadingCategories: false,\r\n        keyExpanded: { topId, categoryId: parentId ?? '', questionId: null },\r\n        rowExpanding: false, // actually collapsing\r\n        rowExpanded: true,\r\n        activeCategory: null,\r\n        activeQuestion: null,\r\n        selectedQuestionId: null\r\n      }\r\n    }\r\n\r\n\r\n    case ActionTypes.SET_CATEGORY_TO_VIEW: {\r\n      const { categoryRow } = action.payload;\r\n      console.assert(IsCategory(categoryRow))\r\n      const category: ICategory = categoryRow as ICategory;\r\n      const activeCategory: ICategory = { ...category, isExpanded: false }\r\n      //const { topId, id, parentId } = category;\r\n      return {\r\n        ...state,\r\n        formMode: FormMode.ViewingCategory,\r\n        loadingCategory: false,\r\n        //keyExpanded: { ...state.keyExpanded, questionId: null },\r\n        activeCategory,\r\n        activeQuestion: null,\r\n        selectedQuestionId: null,\r\n        error: undefined\r\n      };\r\n    }\r\n\r\n    case ActionTypes.SET_CATEGORY_TO_ADD: {\r\n      const { newCategoryRow } = action.payload; // ICategory extends ICategoryRow\r\n      const { parentId } = newCategoryRow;\r\n      //const { topId } = category;\r\n      //console.assert(IsCategory(categoryRow))\r\n      // TODO what about instanceof?\r\n      return {\r\n        ...state,\r\n        loadingCategory: false,\r\n        categoryLoaded: true,\r\n        activeCategory: { ...newCategoryRow!, doc1: '' },\r\n        activeQuestion: null,\r\n        selectedQuestionId: null,\r\n        topRows: parentId ? state.topRows : [newCategoryRow!, ...state.topRows],\r\n        formMode: FormMode.AddingCategory\r\n      };\r\n    }\r\n\r\n    case ActionTypes.SET_CATEGORY_ADDED: {\r\n      const { categoryRow } = action.payload; // ICategory extends ICategoryRow\r\n      console.assert(IsCategory(categoryRow))\r\n      // TODO what about instanceof?\r\n      const category: ICategory = categoryRow as ICategory;\r\n      const activeCategory: ICategory = { ...category, isExpanded: false }\r\n      const { topId, id } = activeCategory;\r\n      //const { parentId } = category;\r\n      //const topRowsLoaded = parentId ? true : false;\r\n      return {\r\n        ...state,\r\n        formMode: FormMode.EditingCategory, // none\r\n        loadingCategory: false,\r\n        categoryLoaded: false,\r\n        // topRowsLoaded,\r\n        //categoryKeyExpanded: state.categoryKeyExpanded ? { ...state.categoryKeyExpanded, questionId: null } : null,\r\n        activeCategory,\r\n        activeQuestion: null,\r\n        selectedQuestionId: null,\r\n        keyExpanded: { topId, categoryId: id, questionId: null }, // set id to call openNode from categories\r\n      };\r\n    }\r\n\r\n    case ActionTypes.SET_CATEGORY_TO_EDIT:   // doesn't modify Tree\r\n    case ActionTypes.SET_CATEGORY_UPDATED: { // modifies Tree\r\n      const { categoryRow, category } = action.payload; // ICategory extends ICategoryRow\r\n      console.assert(IsCategory(categoryRow))\r\n      // TODO what about instanceof?\r\n      //const activeCategory: ICategory = { ...category, isExpanded: false }\r\n      const { topId, id } = category;\r\n      return {\r\n        ...state,\r\n        formMode: FormMode.EditingCategory,\r\n        loadingCategory: false,\r\n        categoryLoaded: true,\r\n        keyExpanded: { topId, categoryId: id, questionId: null },\r\n        //keyExpanded: null, //{ topId, categoryId: parentId!, questionId: null },\r\n        //categoryKeyExpanded: state.categoryKeyExpanded ? { ...state.categoryKeyExpanded, questionId: null } : null,\r\n        activeCategory: category,\r\n        activeQuestion: null,\r\n        selectedQuestionId: null,\r\n        error: undefined\r\n      };\r\n    }\r\n\r\n    case ActionTypes.SET_CATEGORY_QUESTIONS_LOADING:\r\n      //const { loadingQuestion } = action.payload; // category doesn't contain inAdding \r\n      return {\r\n        ...state,\r\n        loadingQuestions: true,\r\n        questionLoaded: false\r\n      }\r\n\r\n    case ActionTypes.CATEGORY_QUESTIONS_LOADED: {\r\n      // const { categoryRow } = action.payload;\r\n      //const { id, topId: topId, questionRows, hasMoreQuestions } = categoryRow;\r\n      return {\r\n        ...state,\r\n        //loadingQuestion: false,\r\n        loadingQuestions: false\r\n      }\r\n    }\r\n\r\n    case ActionTypes.CATEGORY_DELETED: {\r\n      const { categoryRow, id } = action.payload;\r\n      const topRows = !categoryRow\r\n        ? state.topRows.filter(catRow => catRow.id !== id)\r\n        : state.topRows;\r\n      return {\r\n        ...state,\r\n        topRows,\r\n        loadingCategories: false,\r\n        activeCategory: null,\r\n        formMode: FormMode.None,\r\n        error: undefined,\r\n        whichRowId: undefined,\r\n        keyExpanded: {\r\n          topId: categoryRow ? categoryRow.topId : '',\r\n          categoryId: categoryRow ? categoryRow.parentId ?? '' : '',\r\n          questionId: ''\r\n        }\r\n      };\r\n    }\r\n\r\n    case ActionTypes.CANCEL_CATEGORY_FORM:\r\n    case ActionTypes.CLOSE_CATEGORY_FORM: {\r\n      return {\r\n        ...state,\r\n        activeCategory: null,\r\n        formMode: FormMode.None\r\n      };\r\n    }\r\n\r\n\r\n    // First we add a new question to the category.guestions\r\n    // After user clicks Save, we call createQuestion \r\n    /*\r\n    case ActionTypes.ADD_QUESTION: {\r\n      const { categoryInfo } = action.payload;\r\n      const { categoryKey, level } = categoryInfo;\r\n      const { topId, id } = categoryKey;\r\n      const question: IQuestion = {\r\n        ...initialQuestion,\r\n        topId: id ?? '',\r\n        parentId: id,\r\n        inAdding: true\r\n      }\r\n      return {\r\n        ...state,\r\n        mode: Mode.AddingQuestion,\r\n        activeQuestion: question\r\n      };\r\n    }\r\n    */\r\n\r\n    case ActionTypes.CANCEL_ADD_CATEGORY: {\r\n      const { topRows } = action.payload;\r\n      return {\r\n        ...state,\r\n        topRows,\r\n        activeCategory: null,\r\n        activeQuestion: null,\r\n        selectedQuestionId: null,\r\n        formMode: FormMode.None\r\n      };\r\n    }\r\n\r\n    case ActionTypes.SET_LOADING_QUESTION:\r\n      return {\r\n        ...state,\r\n        loadingQuestion: true,\r\n        questionLoaded: false\r\n      }\r\n\r\n    case ActionTypes.CANCEL_ADD_QUESTION: {\r\n      return {\r\n        ...state,\r\n        formMode: FormMode.None,\r\n        activeQuestion: null,\r\n        selectedQuestionId: null\r\n      };\r\n    }\r\n\r\n    case ActionTypes.SET_QUESTION_SELECTED: { // from Categories / AutoSuggestQuestion\r\n      const { questionKey } = action.payload;\r\n      const { topId, parentId: categoryId, id: questionId } = questionKey;\r\n      return {\r\n        ...state,\r\n        topRows: state.topRows.filter(row => row.parentId === null),\r\n        keyExpanded: {\r\n          topId,\r\n          categoryId: categoryId,\r\n          questionId\r\n        },\r\n        /////nodeOpened: false, // keep topRows, and openNode\r\n        activeCategory: null,\r\n        activeQuestion: null,\r\n        selectedQuestionId: null\r\n      };\r\n    }\r\n\r\n\r\n    case ActionTypes.ADD_NEW_QUESTION_TO_ROW: {\r\n      const { newQuestionRow } = action.payload;\r\n      return {\r\n        ...state,\r\n        selectedQuestionId: newQuestionRow.id\r\n      };\r\n    }\r\n\r\n\r\n    case ActionTypes.SET_QUESTION: {\r\n      const { question, formMode } = action.payload;\r\n      console.log(ActionTypes.SET_QUESTION, question)\r\n      return {\r\n        ...state,\r\n        activeCategory: null,\r\n        activeQuestion: question,\r\n        formMode,\r\n        error: undefined,\r\n        loadingCategory: false,\r\n        loadingQuestion: false,\r\n        questionLoaded: true\r\n      };\r\n    }\r\n\r\n    case ActionTypes.SET_QUESTION_AFTER_ASSIGN_ANSWER: {\r\n      const { question } = action.payload;\r\n      //const { parentId, id } = question;\r\n      //const inAdding = state.formMode === FormMode.AddingQuestion;\r\n\r\n      // for inAdding, _id is IDBValidKey('000000000000000000000000')\r\n      // thats why we look for q.inAdding instead of q._id === _id\r\n      // const x = state.categories.filter(c => c.id === parentId).filter(q=>q.id === id);\r\n      // console.error('SET_QUESTION_AFTER_ASSIGN_ANSWER', {x})\r\n\r\n      // TODO Popravi\r\n      // const rootRows = newTopRows.map((c: ICategory) => c.id === parentId\r\n      //   ? {\r\n      //     ...c,\r\n      //     questionRows: inAdding\r\n      //       ? c.questionRows.map(q => q.inAdding ? { ...question, inAdding: q.inAdding } : q)\r\n      //       : c.questionRows.map(q => q.id === id ? { ...question } : q), // TODO sta, ako je inViewing\r\n      //     inAdding: c.inAdding\r\n      //   }\r\n      //   : c\r\n      // );\r\n      return {\r\n        ...state,\r\n        //formMode: state.formMode, // keep mode\r\n        activeQuestion: question,\r\n        loadingQuestion: false,\r\n        questionLoaded: true\r\n      };\r\n    }\r\n\r\n\r\n    case ActionTypes.SET_QUESTION_TO_VIEW: {\r\n      const { question } = action.payload;\r\n      //const { topId, id, parentId } = question;\r\n      const { keyExpanded } = state;\r\n      return {\r\n        ...state,\r\n        formMode: FormMode.ViewingQuestion,\r\n        keyExpanded,\r\n        activeQuestion: question,\r\n        loadingQuestion: false,\r\n        questionLoaded: true\r\n      }\r\n    }\r\n\r\n    case ActionTypes.SET_QUESTION_TO_EDIT: {\r\n      const { question } = action.payload;\r\n      const { topId, id, parentId } = question;\r\n      //const { keyExpanded } = state;\r\n      return {\r\n        ...state,\r\n        // categoryKeyExpanded: categoryKeyExpanded\r\n        //   ? { ...categoryKeyExpanded, questionId: categoryKeyExpanded.id === parentId ? id : null }\r\n        //   : null,\r\n        keyExpanded: { topId, categoryId: parentId, questionId: id },\r\n        activeQuestion: question,\r\n        formMode: FormMode.EditingQuestion,\r\n        selectedQuestionId: question.id,\r\n        loadingQuestion: false,\r\n        questionLoaded: true\r\n      }\r\n    }\r\n\r\n    case ActionTypes.QUESTION_DELETED: {\r\n      //const { question } = action.payload;\r\n      //const { parentId, id } = question;\r\n      return {\r\n        ...state, // Popravi\r\n        activeQuestion: null,\r\n        selectedQuestionId: null,\r\n        formMode: FormMode.None,\r\n        loadingQuestion: false,\r\n        questionLoaded: true\r\n      }\r\n    }\r\n\r\n    case ActionTypes.CANCEL_QUESTION_FORM:\r\n    case ActionTypes.CLOSE_QUESTION_FORM: {\r\n      //const { question } = action.payload;\r\n      return {\r\n        ...state,\r\n        formMode: FormMode.None,\r\n        activeQuestion: null,\r\n        selectedQuestionId: null\r\n      };\r\n    }\r\n\r\n    default:\r\n      alert(`Action ${action.type} not allowed`)\r\n      return {\r\n        ...state\r\n      }\r\n  }\r\n};\r\n\r\n\r\n\r\n/* -----------------------------\r\n   Deep Clone\r\n----------------------------- */\r\nexport class DeepClone {\r\n  static idToSet: string;\r\n  static newCategoryRow: ICategoryRow;\r\n  constructor(categoryRow: ICategoryRow) {\r\n    const { topId, id, parentId, title, link, kind, header, level, variations, numOfQuestions,\r\n      hasSubCategories, categoryRows, created, modified, questionRows, isExpanded } = categoryRow;\r\n\r\n    const subCatRows = categoryRows.map((catRow: ICategoryRow) => {\r\n      console.log('DeepClone >>>>>>>>>>>>>>>', catRow.id)\r\n      if (catRow.id === DeepClone.idToSet) {\r\n        return { ...DeepClone.newCategoryRow }\r\n      }\r\n      else {\r\n        return new DeepClone(catRow).categoryRow\r\n      }\r\n    });\r\n\r\n    this.categoryRow = {\r\n      topId,\r\n      parentId,\r\n      id,\r\n      kind,\r\n      title,\r\n      link,\r\n      header,\r\n      level,\r\n      hasSubCategories,\r\n      categoryRows: subCatRows,\r\n      numOfQuestions,\r\n      questionRows,\r\n      variations: variations ?? [],\r\n      created,\r\n      modified,\r\n      isExpanded\r\n    }\r\n  }\r\n  categoryRow: ICategoryRow;\r\n}\r\n\r\n\r\n","import { useGlobalState, useGlobalContext } from '@/global/GlobalProvider'\r\nimport React, { createContext, useContext, useReducer, useCallback, type Dispatch, useEffect } from 'react';\r\n\r\nimport type {\r\n  ICategory, IQuestion, ICategoriesContext,\r\n  ICategoryDtoEx, ICategoryKey,\r\n  IQuestionDtoEx, IQuestionEx, IQuestionKey, IQuestionRow,\r\n  ICategoryRow,\r\n  ICategoryRowDtoEx,\r\n  ICategoryRowDto,\r\n  ILoadCategoryQuestions,\r\n  IExpandInfo,\r\n  IKeyExpanded,\r\n  IAssignedAnswerKey,\r\n  ICategoriesState,\r\n  ILocStorage\r\n} from '@/categories/types';\r\n\r\n\r\nimport {\r\n  ActionTypes,\r\n  CategoryKey, Category, CategoryDto,\r\n  Question,\r\n  QuestionDto,\r\n  QuestionRowDto,\r\n  CategoryRow,\r\n  QuestionKey,\r\n  FormMode,\r\n  CategoryRowDto,\r\n  QuestionKeyDto,\r\n  _generateId\r\n} from '@/categories/types';\r\n\r\nimport { CategoryReducer, initialQuestion, initialCategory } from '@/categories/CategoryReducer';\r\nimport { type IAssignedAnswer, AssignedAnswerDto } from '@/categories/types';\r\nimport type { IGroupRow } from '@/groups/types';\r\n\r\nconst CategoriesContext = createContext<ICategoriesContext>({} as any);\r\nconst CategoryDispatchContext = createContext<Dispatch<any>>(() => null);\r\n\r\ntype IProps = {\r\n  children: React.ReactNode\r\n}\r\n\r\nexport const initialState: ICategoriesState = {\r\n  formMode: FormMode.None,\r\n\r\n  allCategoryRows: new Map<string, ICategoryRow>(),\r\n  allCategoryRowsLoaded: undefined,\r\n\r\n  allGroupRows: new Map<string, IGroupRow>(),\r\n  allGroupRowsLoaded: undefined,\r\n\r\n  topRows: [],\r\n  topRowsLoading: false,\r\n  topRowsLoaded: false,\r\n\r\n  nodeOpening: false,\r\n  nodeOpened: false,\r\n\r\n  keyExpanded: null,\r\n\r\n  categoryId_questionId_done: undefined,\r\n\r\n  activeCategory: null,\r\n  activeQuestion: null,\r\n  selectedQuestionId: null,\r\n\r\n  loadingCategories: false,\r\n  loadingQuestions: false,\r\n  loadingCategory: false, categoryLoaded: false,\r\n  loadingQuestion: false, questionLoaded: false,\r\n\r\n  error: undefined,\r\n\r\n  rowExpanding: false,\r\n  rowExpanded: false\r\n}\r\n\r\nexport const CategoryProvider: React.FC<IProps> = ({ children }) => {\r\n\r\n  const { loadAllCategoryRowsGlobal, loadAllGroupRowsGlobal } = useGlobalContext();\r\n  const globalState = useGlobalState();\r\n  const { KnowledgeAPI, isAuthenticated, workspace, authUser, canEdit } = globalState;\r\n  const { nickName } = authUser;\r\n\r\n  const [state, dispatch] = useReducer(CategoryReducer, initialState);\r\n\r\n  const { formMode, activeCategory, activeQuestion, keyExpanded, topRows, allCategoryRows, allCategoryRowsLoaded } = state;\r\n\r\n  console.log('----->>> ----->>> ----->>> CategoryProvider', topRows)\r\n\r\n  useEffect(() => {\r\n\r\n    let keyExpanded: IKeyExpanded | null = workspace === 'DEMO'\r\n      ? { topId: \"MTS\", categoryId: \"REMOTECTRLS\", questionId: \"qqqqqq111\" }\r\n      : null;\r\n\r\n    if ('localStorage' in window) {\r\n      let s = localStorage.getItem('CATEGORIES_STATE');\r\n      console.log('CATEGORIES_STATE from localStorage', s)\r\n      if (s !== null) {\r\n        const locStorage: ILocStorage = JSON.parse(s);\r\n        if (locStorage.keyExpanded !== null)\r\n          keyExpanded = locStorage.keyExpanded!;\r\n      }\r\n    }\r\n    /**/\r\n    dispatch({ type: ActionTypes.SET_KEY_EXPANDED, payload: { keyExpanded } });\r\n  }, [workspace]);\r\n\r\n\r\n  const Execute = useCallback(\r\n    async (\r\n      method: string,\r\n      endpoint: string,\r\n      data: Object | null = null,\r\n      whichRowId: string | undefined = undefined\r\n    ): Promise<any> => {\r\n      const accessToken = localStorage.getItem(\"accessToken\");\r\n      if (accessToken) {\r\n        try {\r\n          console.log(\"------Execute endpoint:\", endpoint)\r\n          let response = null;\r\n\r\n          const headers = new Headers();\r\n          const bearer = `Bearer ${accessToken}`;\r\n          headers.append(\"Authorization\", bearer);\r\n\r\n          if (data) headers.append('Content-Type', 'application/json');\r\n\r\n          let options = {\r\n            method: method,\r\n            headers: headers,\r\n            body: data ? JSON.stringify(data) : null,\r\n          };\r\n\r\n          response = (await fetch(endpoint, options));\r\n          if (response.ok || response.status === 404) {\r\n            if ((response.status === 200 || response.status === 201)) {\r\n              let responseData = null; //response;\r\n              try {\r\n                responseData = await response.json();\r\n              }\r\n              catch (error) {\r\n                dispatch({\r\n                  type: ActionTypes.SET_ERROR, payload: {\r\n                    error: new Error(`Response status: ${response.status}`),\r\n                    whichRowId\r\n                  }\r\n                });\r\n              }\r\n              finally {\r\n                return responseData;\r\n              }\r\n            }\r\n          }\r\n          else {\r\n            const { errors } = await response.json();\r\n            const error = new Error(\r\n              errors?.map((e: { message: any; }) => e.message).join('\\n') ?? 'unknown',\r\n            )\r\n            dispatch({ type: ActionTypes.SET_ERROR, payload: { error, whichRowId } });\r\n          }\r\n        }\r\n        catch (e) {\r\n          console.log('-------------->>> execute', method, endpoint, e)\r\n          dispatch({ type: ActionTypes.SET_ERROR, payload: { error: new Error(`fetch eror`), whichRowId } });\r\n        }\r\n      }\r\n      return null;\r\n    }, []);\r\n\r\n\r\n  // ---------------------------\r\n  // load all categoryRows\r\n  // ---------------------------\r\n  const loadAllCategoryRows = useCallback(async (): Promise<Map<string, ICategoryRow> | null> => {\r\n    return new Promise(async (resolve) => {\r\n      const allCategoryRows = await loadAllCategoryRowsGlobal();\r\n      if (allCategoryRows) {\r\n        dispatch({ type: ActionTypes.SET_ALL_CATEGORY_ROWS, payload: { allCategoryRows } });\r\n      }\r\n      else {\r\n        dispatch({ type: ActionTypes.SET_ERROR, payload: { error: new Error('Zajeb allCategoryRows') } });\r\n      }\r\n      resolve(allCategoryRows);\r\n    })\r\n  }, [loadAllCategoryRowsGlobal]);\r\n\r\n  // ---------------------------\r\n  // load all groupRows\r\n  // ---------------------------\r\n  const loadAllGroupRows = useCallback(async (): Promise<Map<string, IGroupRow> | null> => {\r\n    return new Promise(async (resolve) => {\r\n      const allGroupRows = await loadAllGroupRowsGlobal();\r\n      if (allGroupRows) {\r\n        dispatch({ type: ActionTypes.SET_ALL_GROUP_ROWS, payload: { allGroupRows } });\r\n      }\r\n      else {\r\n        dispatch({ type: ActionTypes.SET_ERROR, payload: { error: new Error('Zajeb allGroupRows') } });\r\n      }\r\n      resolve(allGroupRows);\r\n    })\r\n  }, [loadAllGroupRowsGlobal]);\r\n\r\n\r\n\r\n  const getCat = useCallback(async (id: string): Promise<ICategoryRow | undefined> => {\r\n    try {\r\n      const cat: ICategoryRow | undefined = allCategoryRows.get(id);  // globalState.cats is Map<string, ICat>\r\n      return cat;\r\n    }\r\n    catch (error: any) {\r\n      console.log(error)\r\n      dispatch({ type: ActionTypes.SET_ERROR, payload: { error } });\r\n    }\r\n    return undefined;\r\n  }, [allCategoryRows]);\r\n\r\n  useEffect(() => {\r\n    (async () => {\r\n      //if (allCategoryRowsLoaded === undefined) {\r\n      await loadAllCategoryRows();\r\n      //}\r\n    })()\r\n  }, [loadAllCategoryRows]);\r\n\r\n  const getSubCats = useCallback(async (categoryId: string | null) => {\r\n    try {\r\n      let parentHeader = \"\";\r\n      const subCats: ICategoryRow[] = [];\r\n      allCategoryRows.forEach((cat, id) => {  // globalState.cats is Map<string, ICat>\r\n        if (id === categoryId) {\r\n          parentHeader = \"\"; //cat.header!;\r\n        }\r\n        else if (cat.parentId === categoryId) {\r\n          subCats.push(cat);\r\n        }\r\n      })\r\n      return { subCats, parentHeader };\r\n    }\r\n    catch (error: any) {\r\n      console.log(error)\r\n      dispatch({ type: ActionTypes.SET_ERROR, payload: { error } });\r\n      return { subCats: [], parentHeader: 'Kiks subCats' }\r\n    }\r\n  }, [allCategoryRows]);\r\n\r\n  const loadTopRows = useCallback(async () => {\r\n    return new Promise(async (resolve) => {\r\n      //const { keyExpanded } = state;\r\n      try {\r\n        dispatch({ type: ActionTypes.SET_TOP_ROWS_LOADING, payload: {} });\r\n        const url = `${KnowledgeAPI.endpointCategoryRow}/${workspace}/toprows`;\r\n        console.log('CategoryProvider loadTopRows url:', url)\r\n        console.log('loadTopRows AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA')\r\n        console.time();\r\n        await Execute(\"GET\", url)\r\n          .then((dtos: ICategoryRowDto[]) => {\r\n            console.timeEnd();\r\n            console.log('loadTopRows CCCCCCCCCCCCCCCCCCCC')\r\n            const topRows: ICategoryRow[] = dtos!.map((dto: ICategoryRowDto) => {\r\n              dto.IsExpanded = keyExpanded\r\n                ? dto.Id === keyExpanded.categoryId\r\n                : false;\r\n              //dto.TopId = dto.QuestionId;\r\n              return new CategoryRow(dto).categoryRow;\r\n            })\r\n            dispatch({ type: ActionTypes.SET_TOP_ROWS, payload: { topRows } });\r\n            resolve(true);\r\n          });\r\n      }\r\n      catch (error: any) {\r\n        console.log(error)\r\n        dispatch({ type: ActionTypes.SET_ERROR, payload: { error } });\r\n      }\r\n    })\r\n  }, [Execute, KnowledgeAPI.endpointCategoryRow, keyExpanded, workspace]); // state, \r\n\r\n\r\n  // get category With subcategoryRows and questionRows\r\n  const getCategory = useCallback(\r\n    async (categoryKey: ICategoryKey, includeQuestionId: string | null): Promise<any> => {\r\n      const { topId, id } = categoryKey;\r\n      console.log({ categoryKey, includeQuestionId })\r\n      return new Promise(async (resolve) => {\r\n        try {\r\n          const url = `${KnowledgeAPI.endpointCategory}/${workspace}/${topId}/${id}/${PAGE_SIZE}/${includeQuestionId}`;\r\n          console.time()\r\n          console.log('================ getCategory =======================')\r\n          await Execute(\"GET\", url)\r\n            .then((categoryDtoEx: ICategoryDtoEx) => {\r\n              console.timeEnd();\r\n              const { categoryDto, msg } = categoryDtoEx;\r\n              if (categoryDto) {\r\n                resolve(new Category(categoryDto).category);\r\n              }\r\n              else {\r\n                resolve(new Error(msg));\r\n              }\r\n            });\r\n        }\r\n        catch (error: any) {\r\n          console.log(error)\r\n          resolve(error);\r\n        }\r\n      })\r\n    }, [Execute, KnowledgeAPI.endpointCategory, workspace]);\r\n\r\n  const findCategoryRow = useCallback(\r\n    async (categoryRow: ICategoryRow, id: string): Promise<ICategoryRow | undefined> => {\r\n      if (categoryRow.topId === id)\r\n        return categoryRow;\r\n      const { categoryRows } = categoryRow;\r\n      let cat: ICategoryRow | undefined = categoryRows.find(c => c.id === id);\r\n      if (!cat) {\r\n        for (const c of categoryRows) {\r\n          const catRow = await findCategoryRow(c, id);\r\n          if (catRow) {\r\n            cat = catRow;\r\n            console.log(\"findCategory Stop the loop for: \" + id);\r\n            break;\r\n          }\r\n        }\r\n      }\r\n      return cat;\r\n    }, []);\r\n\r\n\r\n  const expandNodesUpToTheTree = useCallback(\r\n    async (catKey: ICategoryKey, questionId: string | null, fromChatBotDlg = false): Promise<boolean> => {\r\n      return new Promise(async (resolve) => {\r\n        try {\r\n          let { topId, parentId, id } = catKey;\r\n          console.assert(id !== null, 'id ne sme biti null u expandNodesUpToTheTree');\r\n          if (id) {\r\n            // const categoryRow: ICategoryRow | undefined = allCategoryRows.get(id);\r\n            // if (categoryRow) {\r\n            //   topId = categoryRow.topId;\r\n            //   parentId = categoryRow.parentId;\r\n            // }\r\n            // else {\r\n            //   alert('reload all categoryRow:' + id)\r\n            //   //return\r\n            // }\r\n          }\r\n          dispatch({\r\n            type: ActionTypes.SET_NODE_EXPANDING_UP_THE_TREE, payload: {\r\n              fromChatBotDlg,\r\n              categoryId_questionId_done: `${id}_${questionId}`\r\n            }\r\n          })\r\n          // ---------------------------------------------------------------------------\r\n          console.time();\r\n          const categoryKey: ICategoryKey = { topId, id, parentId: null }; // proveri ROOT\r\n          const query = new CategoryKey(categoryKey).toQuery(workspace);\r\n          const url = `${KnowledgeAPI.endpointCategoryRow}?${query}&pageSize=${PAGE_SIZE}&includeQuestionId=${questionId ?? null}`;\r\n          await Execute(\"GET\", url)\r\n            .then(async (categoryRowDtoEx: ICategoryRowDtoEx) => {\r\n              //dispatch({ type: ActionTypes.CLEAN_SUB_TREE, payload: { categoryKey: categoryKey! } });\r\n              const { categoryRowDto } = categoryRowDtoEx;\r\n              console.timeEnd();\r\n              if (categoryRowDto) {\r\n                let category: ICategory | null = null;\r\n                let question: IQuestion | null = null;\r\n                const topRowNew: ICategoryRow | null = new CategoryRow(categoryRowDto).categoryRow;\r\n                const bottomRow = await findCategoryRow(topRowNew, id!);\r\n                if (parentId !== null) {\r\n                  category = { ...bottomRow!, doc1: '' };\r\n                  if (questionId) {\r\n                    const questionRow = bottomRow!.questionRows!.find(q => q.id === questionId && q.included)!;\r\n                    if (questionRow) {\r\n                      category = null;\r\n                      question = {\r\n                        ...questionRow,\r\n                        assignedAnswers: [],\r\n                        numOfAssignedAnswers: 0,\r\n                        numOfRelatedFilters: 0,\r\n                        relatedFilters: [],\r\n                        source: 0,\r\n                        status: 0\r\n                      }\r\n                    }\r\n                  }\r\n                }\r\n                console.log('>>> expandNodeUpToTheTree categoryRow', { categoryRow: bottomRow, questionId: \"'\" + (questionId ?? 'jok') + \"'\" + (questionId ?? \"JOK\") })\r\n                const formMode = questionId\r\n                  ? canEdit\r\n                    ? FormMode.EditingQuestion\r\n                    : FormMode.ViewingQuestion\r\n                  : canEdit\r\n                    ? FormMode.EditingCategory\r\n                    : FormMode.ViewingCategory;\r\n\r\n                dispatch({\r\n                  type: ActionTypes.SET_NODE_EXPANDED_UP_THE_TREE, payload: {\r\n                    catKey,\r\n                    categoryRow: topRowNew,\r\n                    category: category!,\r\n                    questionId: questionId ?? null,\r\n                    question,\r\n                    formMode,\r\n                    fromChatBotDlg //: fromChatBotDlg === 'true'\r\n                  }\r\n                })\r\n                resolve(true);\r\n              }\r\n              else {\r\n                resolve(false);\r\n              }\r\n            });\r\n        }\r\n        catch (error: any) {\r\n          console.log(error)\r\n          dispatch({ type: ActionTypes.SET_ERROR, payload: { error } });\r\n        }\r\n      })\r\n    }, [workspace, KnowledgeAPI.endpointCategoryRow, Execute, allCategoryRows, findCategoryRow, canEdit]);\r\n\r\n\r\n  const getCategoryRow = useCallback(\r\n    async (categoryKey: ICategoryKey, hidrate: boolean = false, includeQuestionId: string | null = null): Promise<any> => {\r\n      const query = new CategoryKey(categoryKey).toQuery(workspace);\r\n      return new Promise(async (resolve) => {\r\n        try {\r\n          const url = `${KnowledgeAPI.endpointCategoryRow}/${hidrate}/${PAGE_SIZE}/${includeQuestionId}?${query}`;\r\n          console.time()\r\n          await Execute(\"GET\", url)\r\n            .then((categoryRowDtoEx: ICategoryRowDtoEx) => {\r\n              console.timeEnd();\r\n              const { categoryRowDto, msg } = categoryRowDtoEx;\r\n              if (categoryRowDto) {\r\n                //categoryRowDto.TopId = topId;\r\n                resolve(new CategoryRow(categoryRowDto).categoryRow);\r\n              }\r\n              else {\r\n                resolve(new Error(msg));\r\n              }\r\n            });\r\n        }\r\n        catch (error: any) {\r\n          console.log(error)\r\n          resolve(error);\r\n        }\r\n      })\r\n    }, [Execute, KnowledgeAPI.endpointCategoryRow, workspace]);\r\n\r\n\r\n  const expandCategory = useCallback(\r\n    async ({ categoryKey, includeQuestionId, newQuestionRow, formMode }: IExpandInfo): Promise<any> => {\r\n      try {\r\n        //const { keyExpanded } = state;\r\n        dispatch({ type: ActionTypes.SET_ROW_EXPANDING, payload: {} });\r\n        const categoryRow: ICategoryRow = await getCategoryRow(categoryKey, true, includeQuestionId); // to reload Category\r\n        if (categoryRow instanceof Error) {\r\n          dispatch({ type: ActionTypes.SET_ERROR, payload: { error: categoryRow } });\r\n          console.error({ cat: categoryRow })\r\n        }\r\n        else {\r\n          let selectedQuestionId: string | undefined = undefined;\r\n          if (includeQuestionId && categoryRow.questionRows!.filter((row: IQuestionRow) => row.included).length > 0) {\r\n            selectedQuestionId = includeQuestionId;\r\n          }\r\n          // if (newCategoryRow) {\r\n          //   categoryRow.categoryRows = [newCategoryRow, ...categoryRow.categoryRows];\r\n          // }\r\n          if (newQuestionRow) {\r\n            categoryRow.questionRows = [newQuestionRow, ...categoryRow.questionRows!];\r\n          }\r\n          categoryRow.isExpanded = true;\r\n          console.log('@@@@@@@@@@@@@@@@@ expandCategory:', formMode, includeQuestionId)\r\n          if (formMode === FormMode.None && includeQuestionId) {\r\n            formMode = canEdit ? FormMode.EditingQuestion : FormMode.ViewingQuestion\r\n          }\r\n          dispatch({ type: ActionTypes.SET_ROW_EXPANDED, payload: { categoryRow, formMode: formMode!, selectedQuestionId } });\r\n          return categoryRow;\r\n        }\r\n      }\r\n      catch (error: any) {\r\n        console.log('error', error);\r\n        dispatch({ type: ActionTypes.SET_ERROR, payload: { error } });\r\n        return null;\r\n      }\r\n    }, [canEdit, getCategoryRow]);\r\n\r\n\r\n  const collapseCategory = useCallback(\r\n    async (categoryRow: ICategoryRow) => {\r\n      const { topId, id } = categoryRow;\r\n      //const { topRows } = state;\r\n      const topRow: ICategoryRow = topRows.find(c => c.id === topId)!;\r\n      const catRow: ICategoryRow | undefined = await findCategoryRow(topRow, id);\r\n      /*\r\n      const catRow: ICategoryRow = (topRow.id === id)\r\n        ? topRow\r\n        : (await findCategoryRow(topRow, id))!;\r\n      */\r\n      if (catRow) {\r\n        categoryRow = { ...catRow, isExpanded: false, categoryRows: [], questionRows: [] }\r\n        // rerender\r\n        dispatch({ type: ActionTypes.SET_ROW_COLLAPSED, payload: { categoryRow } })\r\n      }\r\n      else {\r\n        dispatch({ type: ActionTypes.SET_ERROR, payload: { error: new Error('findCategory sranje'), whichRowId: id } });\r\n      }\r\n    }, [findCategoryRow, topRows]);\r\n\r\n\r\n  const addCategory = useCallback(\r\n    async (parentCategoryRow: ICategoryRow | null) => {\r\n      try {\r\n        //if (formMode !== FormMode.None) {\r\n        dispatch({ type: ActionTypes.CLOSE_CATEGORY_FORM, payload: {} })\r\n        //}\r\n        //const id = _generateId;\r\n        const { topId, id, level } = parentCategoryRow ?? { topId: _generateId, id: _generateId, level: 0 };\r\n        const newCategoryRow: ICategoryRow = {\r\n          ...initialCategory,\r\n          topId,\r\n          parentId: parentCategoryRow ? id : null,\r\n          id: _generateId,\r\n          level: level + 1,\r\n          title: 'New Category',\r\n          isExpanded: false\r\n        }\r\n        if (parentCategoryRow === null) { // add topRow\r\n          dispatch({\r\n            type: ActionTypes.SET_CATEGORY_TO_ADD, payload: {\r\n              //categoryRow,\r\n              newCategoryRow\r\n            }\r\n          });\r\n        }\r\n        else {\r\n          const categoryRow: ICategoryRow = {\r\n            ...parentCategoryRow,\r\n            level: level + 1,\r\n            categoryRows: [newCategoryRow, ...parentCategoryRow.categoryRows],\r\n            hasSubCategories: true,\r\n            isExpanded: true\r\n          }\r\n          dispatch({\r\n            type: ActionTypes.SET_CATEGORY_TO_ADD, payload: {\r\n              categoryRow,\r\n              newCategoryRow: { ...newCategoryRow } // , title: ''\r\n            }\r\n          })\r\n        }\r\n      }\r\n      catch (error: any) {\r\n        console.log('error', error);\r\n        dispatch({ type: ActionTypes.SET_ERROR, payload: { error } });\r\n      }\r\n    }, []);\r\n\r\n\r\n  const cancelAddCategory = useCallback(\r\n    async () => {\r\n      try {\r\n        const { parentId } = activeCategory!;\r\n        let parentRow: ICategoryRow | undefined = undefined;\r\n\r\n        let rows: ICategoryRow[] = [];\r\n        topRows.forEach(async topRow => {\r\n          if (parentId === null) {\r\n            rows = topRows.filter(catRow => catRow.id !== _generateId);\r\n          }\r\n          else {\r\n            parentRow = await findCategoryRow(topRow, parentId!);\r\n            if (parentRow) {\r\n              parentRow.categoryRows = parentRow.categoryRows.filter((catRow: { id: string; }) => catRow.id !== _generateId);\r\n            }\r\n          }\r\n        });\r\n        dispatch({ type: ActionTypes.CANCEL_ADD_CATEGORY, payload: { topRows: (rows.length > 0) ? rows : topRows } });\r\n      }\r\n      catch (error: any) {\r\n        console.log('error', error);\r\n        dispatch({ type: ActionTypes.SET_ERROR, payload: { error } });\r\n      }\r\n    }, [activeCategory, expandCategory]);\r\n\r\n\r\n  const createCategory = useCallback(\r\n    async (category: ICategory) => {\r\n      const { id } = category;\r\n      dispatch({ type: ActionTypes.SET_LOADING_CATEGORY, payload: {} });\r\n      try {\r\n        const categoryDto = new CategoryDto(category, workspace).categoryDto;\r\n        console.log(\"categoryDto\", { categoryDto })\r\n        const url = `${KnowledgeAPI.endpointCategory}`; //\r\n        console.time()\r\n        await Execute(\"POST\", url, categoryDto, id)\r\n          .then(async (categoryDtoEx: ICategoryDtoEx) => {   //  | null\r\n            console.timeEnd();\r\n            const { categoryDto } = categoryDtoEx;\r\n            if (categoryDto) {\r\n              //categoryDto.TopId = topId!;\r\n              const category = new Category(categoryDto).category;\r\n              console.log('Category successfully created', { category })\r\n              dispatch({ type: ActionTypes.CLOSE_CATEGORY_FORM, payload: {} })\r\n              // await loadAllCategoryRows()\r\n              allCategoryRows.set(category.id, { // TODO check it\r\n                ...category,\r\n                isExpanded: false\r\n              });\r\n              //.then(async () => { // done: boolean\r\n              //await loadTopRows();\r\n              //await onCategoryIdChanged(topId, category.id); // replace _generateId with id, inside of tree\r\n              const idToSet = _generateId;\r\n              if (category.parentId === null) {\r\n                dispatch({ type: ActionTypes.SET_CATEGORY_ADDED, payload: { categoryRow: category, idToSet } }); // ICategory extends ICategory Row\r\n              }\r\n              else {\r\n                // const parentCategoryKey: ICategoryKey = {\r\n                //   topId: category.topId,\r\n                //   parentId: \"doesn't matter\",\r\n                //   id: category.parentId!\r\n                // };\r\n                // const expandInfo: IExpandInfo = {\r\n                //   categoryKey: parentCategoryKey,\r\n                //   formMode: FormMode.AddingCategory\r\n                // }\r\n                // alert('zovem expa')\r\n                // await expandCategory(expandInfo).then(() => {\r\n                //   dispatch({ type: ActionTypes.SET_CATEGORY_ADDED, payload: { categoryRow: category } }); // ICategory extends ICategory Row\r\n                // });\r\n                dispatch({ type: ActionTypes.SET_CATEGORY_ADDED, payload: { categoryRow: category, idToSet } }); // ICategory extends ICategory Row\r\n              }\r\n              //})\r\n            }\r\n          });\r\n      }\r\n      catch (error: any) {\r\n        console.log(error)\r\n        dispatch({ type: ActionTypes.SET_ERROR, payload: { error: new Error('Server Error'), whichRowId: id } });\r\n      }\r\n    }, [Execute, KnowledgeAPI.endpointCategory, loadAllCategoryRows, loadTopRows, workspace]);\r\n\r\n\r\n  const cancelAddQuestion = useCallback(\r\n    async () => {\r\n      try {\r\n        const { topId, parentId } = activeQuestion!;\r\n        const categoryKey: ICategoryKey = { topId, parentId, id: parentId! };\r\n        const expandInfo: IExpandInfo = {\r\n          categoryKey,\r\n          formMode: FormMode.None\r\n        }\r\n        const categoryRow: ICategoryRow | null = await expandCategory(expandInfo);\r\n        if (categoryRow) {\r\n          dispatch({ type: ActionTypes.CANCEL_ADD_QUESTION, payload: { categoryRow } });\r\n        }\r\n      }\r\n      catch (error: any) {\r\n        console.log('error', error);\r\n        dispatch({ type: ActionTypes.SET_ERROR, payload: { error } });\r\n      }\r\n    }, [activeQuestion, expandCategory]);\r\n\r\n  const viewCategory = useCallback(async (categoryRow: ICategoryRow, includeQuestionId: string | null) => {\r\n    if (formMode === FormMode.AddingQuestion) {\r\n      await cancelAddQuestion();\r\n    }\r\n    else if (formMode === FormMode.AddingCategory) {\r\n      await cancelAddCategory();\r\n    }\r\n    dispatch({ type: ActionTypes.SET_LOADING_CATEGORY, payload: { categoryRow } });\r\n    const categoryKey = new CategoryKey(categoryRow).categoryKey!;\r\n    const category: ICategory = await getCategory(categoryKey, includeQuestionId);\r\n    if (category instanceof Error)\r\n      dispatch({ type: ActionTypes.SET_ERROR, payload: { error: category } });\r\n    else {\r\n      category.topId = categoryRow.topId;\r\n      dispatch({ type: ActionTypes.SET_CATEGORY_TO_VIEW, payload: { categoryRow: category } });\r\n    }\r\n  }, [cancelAddCategory, cancelAddQuestion, formMode, getCategory]);\r\n\r\n\r\n  const editCategory = useCallback(async (categoryRow: ICategoryRow, includeQuestionId: string | null) => {\r\n    // includeQuestionId = null;\r\n    //const { topId, parentId } = categoryRow;\r\n    if (formMode === FormMode.AddingQuestion) {\r\n      await cancelAddQuestion();\r\n    }\r\n    else if (formMode === FormMode.AddingCategory) {\r\n      await cancelAddCategory();\r\n    }\r\n    dispatch({ type: ActionTypes.SET_LOADING_CATEGORY, payload: {} });\r\n    const categoryKey = new CategoryKey(categoryRow).categoryKey!;\r\n    const category: ICategory = await getCategory(categoryKey, includeQuestionId);\r\n    if (category instanceof Error)\r\n      dispatch({ type: ActionTypes.SET_ERROR, payload: { error: category } });\r\n    else {\r\n      const catRow: ICategoryRow = { ...category, isExpanded: false, categoryRows: [], questionRows: [] }\r\n      dispatch({ type: ActionTypes.SET_CATEGORY_TO_EDIT, payload: { categoryRow: catRow, category } });\r\n      /*\r\n      if (parentId === null) { // topRow\r\n        category.topId = categoryRow.topId;\r\n        dispatch({ type: ActionTypes.SET_CATEGORY_TO_EDIT, payload: { categoryRow: category } });\r\n      }\r\n      else {\r\n        const parentKey: ICategoryKey = { topId, parentId, id: parentId }\r\n        // get acurate info from server (children will be collapsed)\r\n        const expandInfo: IExpandInfo = {\r\n          categoryKey: parentKey,\r\n          formMode: FormMode.EditingCategory\r\n        }\r\n        await expandCategory(expandInfo).then(() => {\r\n          category.topId = categoryRow.topId;\r\n          dispatch({ type: ActionTypes.SET_CATEGORY_TO_EDIT, payload: { categoryRow: category } });\r\n        })\r\n      }\r\n        */\r\n    }\r\n  }, [cancelAddCategory, cancelAddQuestion, formMode, getCategory]);\r\n\r\n\r\n  const updateCategory = useCallback(\r\n    async (category: ICategory) => { // , closeForm: boolean\r\n      //const { topId, id, variations, title, kind, modified } = category;\r\n      dispatch({ type: ActionTypes.SET_LOADING_CATEGORY, payload: {} });\r\n      try {\r\n        const categoryDto = new CategoryDto(category, workspace).categoryDto;\r\n        const url = `${KnowledgeAPI.endpointCategory}`;\r\n        console.time()\r\n        await Execute(\"PUT\", url, categoryDto)\r\n          .then((categoryDtoEx: ICategoryDtoEx) => {\r\n            console.timeEnd();\r\n            const { categoryDto, msg } = categoryDtoEx;\r\n            if (categoryDto) {\r\n              const category = new Category(categoryDto).category;\r\n              const { topId } = category;\r\n              category.isExpanded = false;\r\n              category.topId = topId;\r\n              dispatch({ type: ActionTypes.SET_CATEGORY_UPDATED, payload: { /*categoryRow: category, */category } });\r\n              // if (closeForm) {\r\n              //   dispatch({ type: ActionTypes.CLOSE_CATEGORY_FORM, payload: {} })\r\n              // }\r\n            }\r\n            else {\r\n              dispatch({ type: ActionTypes.SET_ERROR, payload: { error: new Error(`${msg}`) } });\r\n            }\r\n          });\r\n      }\r\n      catch (error: any) {\r\n        console.log(error)\r\n        dispatch({ type: ActionTypes.SET_ERROR, payload: { error: new Error(\"Karambol\") } });\r\n        return error;\r\n      }\r\n    }, [Execute, KnowledgeAPI.endpointCategory, workspace]);\r\n\r\n\r\n  const deleteCategory = useCallback(async (categoryRow: ICategoryRow) => {\r\n    //dispatch({ type: ActionTypes.SET_CATEGORY_LOADING, payload: { id, loading: false } });\r\n    try {\r\n      const { parentId, id } = categoryRow;\r\n      categoryRow.modified = { time: new Date(), nickName };\r\n      const categoryDto = new CategoryRowDto(categoryRow, workspace).categoryRowDto;\r\n      const url = `${KnowledgeAPI.endpointCategory}`;\r\n      console.time()\r\n      dispatch({ type: ActionTypes.SET_LOADING_CATEGORIES, payload: {} });\r\n      await Execute(\"DELETE\", url, categoryDto)    //Modified: {  Time: new Date(), NickName: globalState.authUser.nickName }\r\n        .then(async (categoryDtoEx: ICategoryDtoEx) => {\r\n          console.timeEnd();\r\n          const { categoryDto, msg } = categoryDtoEx;\r\n          if (msg === \"OK\") {\r\n            console.log('Category successfully deleted', { categoryRow })\r\n            let parentRow: ICategoryRow | undefined = undefined;\r\n            if (parentId !== null) {\r\n              for await (const topRow of topRows) {\r\n                parentRow = await findCategoryRow(topRow, parentId!);\r\n                if (parentRow)\r\n                  break;\r\n              }\r\n              parentRow!.hasSubCategories = categoryDto!.HasSubCategories;\r\n              if (!parentRow!.hasSubCategories)\r\n                parentRow!.isExpanded = false;\r\n              parentRow!.categoryRows = parentRow!.categoryRows.filter(row => row.id !== id);\r\n            }\r\n            dispatch({ type: ActionTypes.CATEGORY_DELETED, payload: { categoryRow: parentRow, id } });\r\n          }\r\n          else if (msg === \"HasSubCategories\") {\r\n            dispatch({ type: ActionTypes.SET_ERROR, payload: { error: new Error(\"First remove sub categories\"), whichRowId: categoryDto!.Id } });\r\n          }\r\n          else if (msg === \"HasQuestions\") {\r\n            dispatch({ type: ActionTypes.SET_ERROR, payload: { error: new Error(\"First remove category questions\"), whichRowId: categoryDto!.Id } });\r\n          }\r\n          else {\r\n            dispatch({ type: ActionTypes.SET_ERROR, payload: { error: new Error(msg), whichRowId: categoryDto!.Id } });\r\n          }\r\n        })\r\n    }\r\n    catch (error: any) {\r\n      console.log(error)\r\n      return error;\r\n    }\r\n  }, [Execute, KnowledgeAPI.endpointCategory, expandCategory, loadAllCategoryRows, loadTopRows, workspace]);\r\n\r\n\r\n  const deleteCategoryVariation = async (categoryKey: ICategoryKey, variationName: string) => {\r\n    try {\r\n      console.log(\"Deleting Category Tag...\", { categoryKey, variationName });\r\n      // const category = await dbp!.get('Categories', id);\r\n      // const obj: ICategory = {\r\n      //   ...category,\r\n      //   variations: category.variations.filter((variation: string) => variation !== variationName),\r\n      //   modified: {\r\n      //     Time: new Date(),\r\n      //     by: {\r\n      //       nickName: globalState.authUser.nickName\r\n      //     }\r\n      //   }\r\n      // }\r\n      // POPRAVI TODO\r\n      //updateCategory(obj, false);\r\n      console.log(\"Category Tag successfully deleted\");\r\n    }\r\n    catch (error: any) {\r\n      console.log('error', error);\r\n      dispatch({ type: ActionTypes.SET_ERROR, payload: { error } });\r\n    }\r\n  };\r\n\r\n\r\n  ////////////////////////////////////\r\n  // Questions\r\n  //\r\n\r\n  const PAGE_SIZE = 12;\r\n  const loadCategoryQuestions = useCallback(async ({ categoryKey, startCursor, includeQuestionId }: ILoadCategoryQuestions): Promise<any> => {\r\n    try {\r\n      const { topId, id } = categoryKey;\r\n      dispatch({ type: ActionTypes.SET_CATEGORY_QUESTIONS_LOADING, payload: {} })\r\n      try {\r\n        const url = `${KnowledgeAPI.endpointQuestion}/${workspace}/${topId}/${id}/${startCursor}/${PAGE_SIZE}/${includeQuestionId}`;\r\n        console.time()\r\n        await Execute!(\"GET\", url).then((categoryDtoEx: ICategoryDtoEx) => {\r\n          console.timeEnd();\r\n          const { categoryDto } = categoryDtoEx;\r\n          if (categoryDto !== null) {\r\n            const category = new Category(categoryDto).category;\r\n            // const { Title, QuestionRowDtos, HasMoreQuestions } = categoryDto;\r\n            // QuestionRowDtos!.forEach((questionRowDto: IQuestionRowDto) => {\r\n            //   if (includeQuestionId && questionRowDto.Id === includeQuestionId) {\r\n            //     questionRowDto.Included = true;\r\n            //   }\r\n            //   questionRowDto.CategoryTitle = Title; // TODO treba li\r\n            //   questionRowDtos.push(questionRowDto);\r\n            // })\r\n            // const questionRows: IQuestionRow[] = questionRowDtos.map(dto => new QuestionRow(dto).questionRow);\r\n            // dispatch({\r\n            //   type: ActionTypes.CATEGORY_QUESTIONS_LOADED,\r\n            //   payload: { id, questionRows, hasMoreQuestions: HasMoreQuestions! }\r\n            // });\r\n            dispatch({\r\n              type: ActionTypes.CATEGORY_QUESTIONS_LOADED,\r\n              payload: { categoryRow: category }\r\n            });\r\n          }\r\n        });\r\n      }\r\n      catch (error: any) {\r\n        console.log(error)\r\n        dispatch({ type: ActionTypes.SET_ERROR, payload: { error } });\r\n      }\r\n    }\r\n    catch (error: any) {\r\n      console.log(error);\r\n      dispatch({ type: ActionTypes.SET_ERROR, payload: error });\r\n    }\r\n  }, [Execute, KnowledgeAPI.endpointQuestion, workspace]);\r\n\r\n  //////////////////////////////////////////\r\n  // Set initialQuestion to QuestionForm\r\n  const addQuestion = useCallback(\r\n    async (categoryKey: ICategoryKey) => {\r\n      try {\r\n        const { topId, id } = categoryKey;\r\n        let categoryRow = await getCat(id!);\r\n        if (!categoryRow) {\r\n          alert(`Not found ${id}. Reload all Categories`)\r\n          return;\r\n        }\r\n        const newQuestionRow: IQuestionRow = {\r\n          topId,\r\n          parentId: categoryKey.id,\r\n          id: _generateId, // do not change\r\n          title: 'question text',\r\n          categoryTitle: categoryRow.title,\r\n          numOfAssignedAnswers: 0,\r\n          included: true\r\n        }\r\n        const question: IQuestion = {\r\n          ...initialQuestion,\r\n          ...newQuestionRow,\r\n          title: ''\r\n        }\r\n        // console.assert(isExpanded);\r\n        // if (isExpanded) {\r\n        const topRow: ICategoryRow = state.topRows.find(c => c.id === topId)!;\r\n        const catRow: ICategoryRow | undefined = await findCategoryRow(topRow, id)!;\r\n        const { numOfQuestions, questionRows } = catRow!;\r\n        dispatch({\r\n          type: ActionTypes.ADD_NEW_QUESTION_TO_ROW, payload: {\r\n            categoryRow: { ...catRow!, isExpanded: true, numOfQuestions: numOfQuestions + 1, questionRows: [newQuestionRow, ...questionRows!] },\r\n            newQuestionRow\r\n          }\r\n        });\r\n        dispatch({ type: ActionTypes.SET_QUESTION, payload: { question, formMode: FormMode.AddingQuestion } });\r\n        //}\r\n        // else {\r\n        //   const expandInfo: IExpandInfo = {\r\n        //     categoryKey,\r\n        //     formMode: FormMode.AddingQuestion,\r\n        //     newQuestionRow\r\n        //   }\r\n        //   await expandCategory(expandInfo);\r\n        //   dispatch({ type: ActionTypes.SET_QUESTION, payload: { question, formMode: FormMode.AddingQuestion } });\r\n        // }\r\n\r\n      }\r\n      catch (error: any) {\r\n        console.log('error', error);\r\n        dispatch({ type: ActionTypes.SET_ERROR, payload: { error } });\r\n      }\r\n    }, [expandCategory, findCategoryRow, getCat, state.topRows]);\r\n\r\n\r\n  const createQuestion = useCallback(\r\n    async (question: IQuestion) => {\r\n      const { topId, id, parentId } = question; // title, modified, \r\n      // TODO\r\n      dispatch({ type: ActionTypes.SET_LOADING_CATEGORY, payload: {} });\r\n      try {\r\n        question.created!.nickName = nickName;\r\n        const questionDto = new QuestionDto(question, workspace).questionDto;\r\n        const url = `${KnowledgeAPI.endpointQuestion}`;\r\n        console.time()\r\n        console.log('>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> createQuestion', questionDto)\r\n        await Execute(\"POST\", url, questionDto)\r\n          .then(async (questionDtoEx: IQuestionDtoEx | null) => {\r\n            console.timeEnd();\r\n            if (questionDtoEx) {\r\n              console.log(\"::::::::::::::::::::\", { questionDtoEx });\r\n              const { questionDto } = questionDtoEx;\r\n              if (questionDto) {\r\n                const question = new Question(questionDto).question;\r\n                question.topId = topId;\r\n                console.log('Question successfully created')\r\n                //dispatch({ type: ActionTypes.CLOSE_QUESTION_FORM })\r\n                await loadAllCategoryRows() // numOfQuestions changed\r\n                  .then(async () => {\r\n                    const parentCategoryKey: ICategoryKey = { topId, parentId, id: parentId! };\r\n                    const expandInfo: IExpandInfo = {\r\n                      categoryKey: parentCategoryKey,\r\n                      formMode: FormMode.EditingQuestion\r\n                    }\r\n                    await expandCategory(expandInfo).then(() => {\r\n                      dispatch({ type: ActionTypes.SET_QUESTION, payload: { formMode: FormMode.EditingQuestion, question } });\r\n                    });\r\n                  })\r\n              }\r\n            }\r\n          });\r\n      }\r\n      catch (error: any) {\r\n        console.log(error)\r\n        dispatch({ type: ActionTypes.SET_ERROR, payload: { error: new Error('Server Error'), whichRowId: id } });\r\n      }\r\n    }, [Execute, KnowledgeAPI.endpointQuestion, expandCategory, loadAllCategoryRows, nickName, workspace]);\r\n\r\n\r\n  const updateQuestion = useCallback(\r\n    async (oldParentId: string, question: IQuestion, categoryChanged: boolean) => {\r\n      const { id } = question; // , title, modified, parentId\r\n      // dispatch({ type: ActionTypes.SET_CATEGORY_LOADING, payload: { id: parentId!, loading: false } });\r\n      try {\r\n        question.modified!.nickName = nickName;\r\n        const questionDto = new QuestionDto(question, workspace).questionDto;\r\n        const url = `${KnowledgeAPI.endpointQuestion}`;\r\n        console.time()\r\n        questionDto.oldParentId = oldParentId;\r\n        console.log('>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> updateQuestion', questionDto)\r\n        let questionRet: IQuestion | null = null;\r\n        await Execute(\"PUT\", url, questionDto)\r\n          .then(async (questionDtoEx: IQuestionDtoEx) => {\r\n            console.timeEnd();\r\n            const { questionDto, msg } = questionDtoEx;\r\n            if (questionDto) {\r\n              questionRet = new Question(questionDto).question!;\r\n              console.log('Question successfully updated: ', questionRet)\r\n              const { topId, parentId } = questionRet;\r\n              if (categoryChanged) {\r\n                // nema koristi\r\n                // dispatch({ type: ActionTypes.SET_QUESTION, payload: { question: questionRet } })\r\n                const { topId, parentId, id } = questionRet;\r\n                const keyExpanded: IKeyExpanded = {\r\n                  topId,\r\n                  categoryId: parentId!,\r\n                  questionId: id\r\n                }\r\n                dispatch({ type: ActionTypes.FORCE_OPEN_NODE, payload: { keyExpanded } })\r\n              }\r\n              else {\r\n                const parentCategoryKey: ICategoryKey = { topId, parentId, id: parentId! }; // proveri\r\n                const expandInfo: IExpandInfo = {\r\n                  categoryKey: parentCategoryKey,\r\n                  formMode: FormMode.EditingQuestion\r\n                }\r\n                await expandCategory(expandInfo).then(() => {\r\n                  dispatch({ type: ActionTypes.SET_QUESTION, payload: { formMode: FormMode.EditingQuestion, question: questionRet! } });\r\n                });\r\n              }\r\n            }\r\n            else {\r\n              dispatch({ type: ActionTypes.SET_ERROR, payload: { error: new Error(msg) } });\r\n            }\r\n          });\r\n        return questionRet;\r\n      }\r\n      catch (error: any) {\r\n        console.log(error)\r\n        dispatch({ type: ActionTypes.SET_ERROR, payload: { error: new Error('Server Error'), whichRowId: id } });\r\n      }\r\n    }, [Execute, KnowledgeAPI.endpointQuestion, expandCategory, nickName, workspace]);\r\n\r\n\r\n  const deleteQuestion = useCallback(\r\n    async (questionRow: IQuestionRow, isActive: boolean) => {\r\n      const { id, parentId, topId } = questionRow;\r\n      dispatch({ type: ActionTypes.SET_LOADING_QUESTION, payload: {} });\r\n      try {\r\n        const questionDto = new QuestionRowDto(questionRow, workspace).questionRowDto;\r\n        const url = `${KnowledgeAPI.endpointQuestion}`;\r\n        console.time()\r\n        await Execute(\"DELETE\", url, questionDto)\r\n          .then(async (questionDtoEx: IQuestionDtoEx) => {\r\n            const { questionDto } = questionDtoEx;\r\n            console.timeEnd();\r\n            if (questionDto) {\r\n              const question = new Question(questionDto).question;\r\n              console.log('Question successfully deleted')\r\n              if (isActive) {\r\n                dispatch({ type: ActionTypes.QUESTION_DELETED, payload: { question } });\r\n              }\r\n              /*\r\n              //dispatch({ type: ActionTypes.CLOSE_QUESTION_FORM })\r\n              await loadAndCacheAllCategoryRows(); // reload\r\n              */\r\n              const parentCategoryKey: ICategoryKey = { topId, parentId, id: parentId! }; // proveri\r\n              const expandInfo: IExpandInfo = {\r\n                categoryKey: parentCategoryKey,\r\n                formMode: FormMode.None\r\n              }\r\n              await expandCategory(expandInfo).then(() => {\r\n                // dispatch({ type: ActionTypes.SET_CATEGORY, payload: { categoryRow: category } }); // ICategory extends ICategory Row\r\n              })\r\n            }\r\n            else {\r\n              console.error(questionDtoEx);\r\n              dispatch({ type: ActionTypes.SET_ERROR, payload: { error: new Error('Server Error'), whichRowId: id } });\r\n            }\r\n          });\r\n      }\r\n      catch (error: any) {\r\n        console.log(error)\r\n        dispatch({ type: ActionTypes.SET_ERROR, payload: { error: new Error('Server Error'), whichRowId: id } });\r\n      }\r\n    }, [Execute, KnowledgeAPI.endpointQuestion, expandCategory, workspace]);\r\n\r\n\r\n  const getQuestion = useCallback(\r\n    async (questionKey: IQuestionKey): Promise<any> => {\r\n      return new Promise(async (resolve) => {\r\n        try {\r\n          const query = new QuestionKey(questionKey).toQuery(workspace);\r\n          const url = `${KnowledgeAPI.endpointQuestion}?${query}`;\r\n          console.time()\r\n          console.log('getQuestion', questionKey)\r\n          await Execute(\"GET\", url)\r\n            .then((questionDtoEx: IQuestionDtoEx) => {\r\n              console.timeEnd();\r\n              const { questionDto, msg } = questionDtoEx;\r\n              if (questionDto) {\r\n                const questionEx: IQuestionEx = {\r\n                  question: new Question(questionDto).question,\r\n                  msg\r\n                }\r\n                resolve(questionEx);\r\n              }\r\n              else {\r\n                const questionEx: IQuestionEx = {\r\n                  question: null,\r\n                  msg\r\n                }\r\n                resolve(questionEx);\r\n              }\r\n              //}\r\n            });\r\n        }\r\n        catch (error: any) {\r\n          console.log(error);\r\n          const questionEx: IQuestionEx = {\r\n            question: null,\r\n            msg: \"Problemos\"\r\n          }\r\n          resolve(questionEx);\r\n        }\r\n      })\r\n    }, [Execute, KnowledgeAPI.endpointQuestion, workspace]);\r\n\r\n\r\n  const viewQuestion = useCallback(async (questionRow: IQuestionRow) => {\r\n    const questionKey = new QuestionKey(questionRow).questionKey;\r\n    dispatch({ type: ActionTypes.SET_LOADING_QUESTION, payload: {} });\r\n    const questionEx: IQuestionEx = await getQuestion(questionKey!);\r\n    if (formMode === FormMode.AddingQuestion) {\r\n      await cancelAddQuestion();\r\n    }\r\n    else if (formMode === FormMode.AddingCategory) {\r\n      await cancelAddCategory();\r\n    }\r\n    const { question, msg } = questionEx;\r\n    if (question) {\r\n      question.topId = questionRow.topId;\r\n      dispatch({ type: ActionTypes.SET_QUESTION_TO_VIEW, payload: { question } });\r\n    }\r\n    else\r\n      dispatch({ type: ActionTypes.SET_ERROR, payload: { error: new Error(msg) } });\r\n  }, [cancelAddCategory, cancelAddQuestion, formMode, getQuestion]);\r\n\r\n\r\n  // const editQuestion = useCallback(async (questionRow: IQuestionRow) => {\r\n  //   const questionKey: IQuestionKey = new QuestionKey(questionRow).questionKey!;\r\n  //   if (formMode === FormMode.AddingQuestion) {\r\n  //     await cancelAddQuestion();\r\n  //   }\r\n  //   else if (formMode === FormMode.AddingCategory) {\r\n  //     await cancelAddCategory();\r\n  //   }\r\n  //   dispatch({ type: ActionTypes.SET_LOADING_QUESTION, payload: {} });\r\n  //   console.log(\"editQuestion:\", questionKey)\r\n  //   const question = initialQuestion;\r\n  //   if (question) {\r\n  //     // we don't reload categoryRows, just use isSelected from activeQuestion\r\n  //     question.topId = questionRow.topId;\r\n  //     dispatch({ type: ActionTypes.SET_QUESTION_TO_EDIT, payload: { question } });\r\n  //   }\r\n  // }, [cancelAddCategory, cancelAddQuestion, formMode]);\r\n\r\n\r\n  const editQuestion = useCallback(async (questionRow: IQuestionRow) => {\r\n    const questionKey: IQuestionKey = new QuestionKey(questionRow).questionKey!;\r\n    if (formMode === FormMode.AddingQuestion) {\r\n      await cancelAddQuestion();\r\n    }\r\n    else if (formMode === FormMode.AddingCategory) {\r\n      await cancelAddCategory();\r\n    }\r\n    dispatch({ type: ActionTypes.SET_LOADING_QUESTION, payload: {} });\r\n    console.log(\"editQuestion:\", questionKey)\r\n    const questionEx: IQuestionEx = await getQuestion(questionKey!);\r\n    const { question, msg } = questionEx;\r\n    if (question) {\r\n      // we don't reload categoryRows, just use isSelected from activeQuestion\r\n      question.topId = questionRow.topId;\r\n\r\n      // const topRow: ICategoryRow = state.topRows.find(c => c.id === questionRow.topId)!;\r\n      // const categoryRow: ICategoryRow = findCategoryRow(topRow, questionRow.parentId)!;\r\n      //dispatch({ type: ActionTypes.SET_QUESTION_TO_EDIT, payload: { categoryRow, question } });\r\n      dispatch({ type: ActionTypes.CLOSE_QUESTION_FORM, payload: { question } }); // to reset QuestionForm\r\n      dispatch({ type: ActionTypes.SET_QUESTION_TO_EDIT, payload: { question } });\r\n    }\r\n    else\r\n      dispatch({ type: ActionTypes.SET_ERROR, payload: { error: new Error(msg) } });\r\n  }, [cancelAddCategory, cancelAddQuestion, formMode, getQuestion]);\r\n\r\n\r\n  const getAnswerCount = useCallback(async (): Promise<number> => {\r\n    return new Promise(async (resolve) => {\r\n      try {\r\n        const url = `${KnowledgeAPI.endpointAnswer}/${workspace}`;\r\n        await Execute(\"GET\", url)\r\n          .then((count: number) => {\r\n            resolve(count);\r\n          });\r\n      }\r\n      catch (error: any) {\r\n        console.log('error', error);\r\n        dispatch({ type: ActionTypes.SET_ERROR, payload: { error } });\r\n      }\r\n    });\r\n  }, [Execute, KnowledgeAPI.endpointAnswer, workspace]);\r\n\r\n    // action: 'Assign' or 'UnAssign'\r\n    const assignQuestionAnswer = useCallback(\r\n      async (action: 'Assign' | 'UnAssign', questionKey: IQuestionKey, assignedAnswerKey: IAssignedAnswerKey): Promise<any> => {\r\n        try {\r\n          var { topId, id } = assignedAnswerKey;\r\n          var assignedAnswer: IAssignedAnswer = {\r\n            topId,\r\n            id,\r\n            created: {\r\n              time: new Date(),\r\n              nickName\r\n            }\r\n          }\r\n          const dto = new AssignedAnswerDto(assignedAnswer).assignedAnswerDto;\r\n          dto.QuestionKeyDto = new QuestionKeyDto(questionKey, workspace).dto;\r\n          let question: IQuestion | null = null;\r\n          const url = `${KnowledgeAPI.endpointQuestionAnswer}/${action}`;\r\n          console.time()\r\n          await Execute(\"POST\", url, dto)\r\n            .then(async (questionDtoEx: IQuestionDtoEx) => {\r\n              console.timeEnd();\r\n              const { questionDto } = questionDtoEx;\r\n              console.log(\"::::::::::::::::::::\", { questionDtoEx });\r\n              if (questionDto) {\r\n                question = new Question(questionDto).question;\r\n                console.log('Question successfully modified')\r\n                //dispatch({ type: ActionTypes.SET_QUESTION, payload: { question: assignedAnswer } });\r\n                //dispatch({ type: ActionTypes.CLOSE_QUESTION_FORM })\r\n              }\r\n            });\r\n          if (question) {\r\n            dispatch({ type: ActionTypes.SET_QUESTION_AFTER_ASSIGN_ANSWER, payload: { question } });\r\n          }\r\n          /*\r\n          const assignedAnswers = [...question.assignedAnswers, newAssignedAnwser];\r\n          const obj: IQuestion = {\r\n            ...question,\r\n            assignedAnswers,\r\n            numOfAssignedAnswers: assignedAnswers.length\r\n          }\r\n          await dbp!.put('Questions', obj, questionId);\r\n          console.log(\"Question Answer successfully assigned\", obj);\r\n          */\r\n          ///////////////////\r\n          // newAssignedAnwser.answer.title = answer.title;\r\n          // obj.assignedAnswers = [...question.assignedAnswers, newAssignedAnwser];;\r\n          // dispatch({ type: ActionTypes.SET_QUESTION, payload: { question: obj } });\r\n          //dispatch({ type: ActionTypes.SET_QUESTION_AFTER_ASSIGN_ANSWER, payload: { question: { ...obj } } });\r\n        }\r\n        catch (error: any) {\r\n          console.log('error', error);\r\n          dispatch({ type: ActionTypes.SET_ERROR, payload: { error } });\r\n        }\r\n      }, [Execute, KnowledgeAPI.endpointQuestionAnswer, nickName, workspace]);\r\n\r\n\r\n    const onCategoryTitleChanged = useCallback(\r\n      async (topId: string, id: string, title: string): Promise<void> => {\r\n        const topRow: ICategoryRow = topRows.find(c => c.id === topId)!;\r\n        let categoryRow: ICategoryRow | undefined = await findCategoryRow(topRow, id);\r\n        console.log('PROVIDER onCategoryTitleChanged::', categoryRow!.title, title)\r\n        if (categoryRow!.title !== title) {\r\n          categoryRow!.title = title === '' ? 'New Category' : title; // to avoid empty title\r\n          dispatch({\r\n            type: ActionTypes.RE_RENDER_TREE, payload: {} //categoryRow: categoryRow! }\r\n          });\r\n        }\r\n        return;\r\n      }, [findCategoryRow, topRows]);\r\n\r\n\r\n    const onQuestionTitleChanged = useCallback(\r\n      async (topId: string, categoryId: string, id: string, title: string): Promise<void> => {\r\n        const topRow: ICategoryRow = topRows.find(c => c.id === topId)!;\r\n        let categoryRow: ICategoryRow | undefined = await findCategoryRow(topRow, categoryId);\r\n        if (categoryRow) {\r\n          const questionRow = categoryRow.questionRows!.find(q => q.id === id)!;\r\n          if (questionRow!.title !== title) {\r\n            questionRow.title = title === '' ? 'New Question' : title; // to avoid empty title;\r\n            // rerender\r\n            console.log('onQuestionTitleChanged+++>>>', id, categoryRow)\r\n            dispatch({ type: ActionTypes.QUESTION_TITLE_CHANGED, payload: { categoryRow } })\r\n          }\r\n        }\r\n        return;\r\n      }, [findCategoryRow, topRows]);\r\n\r\n    const contextValue: ICategoriesContext = {\r\n      state, loadAllCategoryRows, getSubCats, getCat,\r\n      loadAllGroupRows,\r\n      expandNodesUpToTheTree,\r\n      loadTopRows,\r\n      addCategory, cancelAddCategory, createCategory,\r\n      viewCategory, editCategory, updateCategory, deleteCategory, deleteCategoryVariation,\r\n      expandCategory, collapseCategory, onCategoryTitleChanged,\r\n      loadCategoryQuestions,\r\n      addQuestion, cancelAddQuestion, createQuestion,\r\n      viewQuestion, editQuestion, updateQuestion, deleteQuestion, onQuestionTitleChanged,\r\n      getAnswerCount, assignQuestionAnswer\r\n    }\r\n\r\n    if (!isAuthenticated || !allCategoryRowsLoaded)  // removed keyExpanded === null\r\n      return null;\r\n\r\n    return (\r\n      <CategoriesContext.Provider value={contextValue}>\r\n        <CategoryDispatchContext.Provider value={dispatch}>\r\n          {children}\r\n        </CategoryDispatchContext.Provider>\r\n      </CategoriesContext.Provider>\r\n    );\r\n  }\r\n\r\nexport function useCategoryContext() {\r\n    return useContext(CategoriesContext);\r\n  }\r\n\r\n  export const useCategoryDispatch = () => {\r\n    return useContext(CategoryDispatchContext)\r\n  };\r\n\r\n\r\n","export default \"__VITE_ASSET__Vg5QUNe9__\"","import type { ICategoryKey, ICategoryRow } from '@/categories/types';\r\n\r\nimport type { ActionMap } from \"@/global/types\";\r\n\r\n/////////////////////////////////////////////////////////////////////////\r\n// DropDown Select Category\r\n\r\nexport interface ICatState {\r\n\tloading: boolean,\r\n\tparentId: string | null,\r\n\ttitle: string,\r\n\tcats: ICategoryRow[], // drop down categories\r\n\terror?: Error;\r\n}\r\n\r\nexport interface ICatInfo {\r\n\tselId: string | null;\r\n\tcategoryKey: ICategoryKey | null,\r\n\tlevel: number,\r\n\tsetParentId: (cat: ICategoryRow) => void;\r\n}\r\n\r\nexport enum CatActionTypes {\r\n\tSET_LOADING = 'SET_LOADING',\r\n\tSET_SUB_CATS = 'SET_SUB_CATS',\r\n\tSET_ERROR = 'SET_ERROR',\r\n\tSET_EXPANDED = 'SET_EXPANDED',\r\n\tSET_PARENT_CAT = 'SET_PARENT_CAT'\r\n}\r\n\r\nexport type CatsPayload = {\r\n\t[CatActionTypes.SET_LOADING]: false;\r\n\r\n\t[CatActionTypes.SET_SUB_CATS]: {\r\n\t\tsubCats: ICategoryRow[];\r\n\t};\r\n\r\n\t[CatActionTypes.SET_EXPANDED]: {\r\n\t\tid: string;\r\n\t\texpanding: boolean;\r\n\t}\r\n\r\n\t[CatActionTypes.SET_ERROR]: {\r\n\t\terror: Error;\r\n\t};\r\n\r\n\t[CatActionTypes.SET_PARENT_CAT]: {\r\n\t\tcat: ICategoryRow;\r\n\t};\r\n\r\n};\r\n\r\nexport type CatsActions =\r\n\tActionMap<CatsPayload>[keyof ActionMap<CatsPayload>];\r\n\r\n\r\n\r\nexport type CatActions = ActionMap<CatsPayload>[keyof ActionMap<CatsPayload>];","import React from 'react';\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\nimport { faCaretRight, faCaretDown } from '@fortawesome/free-solid-svg-icons'\r\n\r\nimport { ListGroup, Button } from \"react-bootstrap\";\r\n\r\nimport { type ICategoryRow } from \"@/categories/types\";\r\n\r\nimport CatList from \"@/global/Components/SelectCategory/CatList\";\r\nimport { type CatsActions, CatActionTypes } from './types';\r\n\r\ninterface ICatRow {\r\n    cat: ICategoryRow;\r\n    selId: string | null;\r\n    dispatch: React.Dispatch<CatsActions>;\r\n    setParentCat: (cat: ICategoryRow) => void;\r\n}\r\n\r\nconst CatRow = ({ cat, dispatch, setParentCat, selId }: ICatRow) => {\r\n    const { topId, parentId, id, title, level, isExpanded } = cat;\r\n    const categoryKey = { topId, parentId, id };\r\n\r\n    //const { isDarkMode, variant, bg } = useGlobalState();\r\n\r\n    const expand = (_id: IDBValidKey) => {\r\n        dispatch({ type: CatActionTypes.SET_EXPANDED, payload: { id, expanding: !isExpanded } });\r\n    }\r\n\r\n    const onSelectCat = (cat: ICategoryRow) => {\r\n        // Load data from server and reinitialize category\r\n        // viewCategory(id);\r\n        setParentCat(cat);\r\n    }\r\n\r\n    const Row1 =\r\n        <div className=\"d-flex justify-content-start align-items-center w-100 text-primary\">\r\n            <Button\r\n                variant='link'\r\n                size=\"sm\"\r\n                className=\"py-0 px-1\"\r\n                onClick={(e) => {\r\n                    expand(id!);\r\n                    e.stopPropagation();\r\n                    e.preventDefault();\r\n                }}\r\n                title=\"Expand\"\r\n            >\r\n                <FontAwesomeIcon icon={isExpanded ? faCaretDown : faCaretRight} size='lg' />\r\n            </Button>\r\n            <Button\r\n                variant='link'\r\n                size=\"sm\"\r\n                className={`py-0 mx-0 text-decoration-none`}\r\n                title={id}\r\n                onClick={() => onSelectCat(cat)}\r\n            >\r\n                {title}\r\n            </Button>\r\n        </div>\r\n\r\n    return (\r\n        <>\r\n            <ListGroup.Item\r\n                variant={\"primary\"}\r\n                className=\"py-0 px-1 w-100\"\r\n                as=\"li\"\r\n            >\r\n                {Row1}\r\n            </ListGroup.Item>\r\n\r\n            {isExpanded && // Row2\r\n                <ListGroup.Item\r\n                    className=\"py-0 px-0\"\r\n                    variant={\"primary\"}\r\n                    as=\"li\"\r\n                >\r\n                    <CatList\r\n                        selId={selId}\r\n                        level={level + 1}\r\n                        categoryKey={categoryKey}\r\n                        setParentId={setParentCat}\r\n                    />\r\n                </ListGroup.Item>\r\n            }\r\n\r\n        </>\r\n    );\r\n};\r\n\r\nexport default CatRow;\r\n","import { type Reducer } from 'react'\r\nimport { type ICategoryRow } from \"@/categories/types\";\r\nimport  { type CatsActions, CatActionTypes, type ICatState } from './types';\r\n\r\nexport const initialState: ICatState = {\r\n  loading: false,\r\n  parentId: null,\r\n  title: '',\r\n  cats: []\r\n}\r\n\r\nexport const CatReducer: Reducer<ICatState, CatsActions> = (state, action) => {\r\n\r\n  switch (action.type) {\r\n    case CatActionTypes.SET_LOADING:\r\n      return {\r\n        ...state,\r\n        loading: true\r\n      }\r\n\r\n    case CatActionTypes.SET_SUB_CATS: {\r\n      const { subCats } = action.payload;\r\n      return {\r\n        ...state,\r\n        cats: state.cats.concat(subCats),\r\n        loading: false\r\n      }\r\n    }\r\n\r\n    case CatActionTypes.SET_ERROR: {\r\n      const { error } = action.payload;\r\n      return { ...state, error, loading: false };\r\n    }\r\n\r\n    case CatActionTypes.SET_EXPANDED: {\r\n      const { id, expanding } = action.payload;\r\n      let { cats } = state;\r\n      if (!expanding) {\r\n        const ids = markForClean(cats, id!)\r\n        console.log('clean:', ids)\r\n        if (ids.length > 0) {\r\n          cats = cats.filter(c => !ids.includes(c.id))\r\n        }\r\n      }\r\n      return {\r\n        ...state,\r\n        cats: state.cats.map(c => c.id === id\r\n          ? { ...c, isExpanded: expanding }\r\n          : c\r\n        )\r\n      };\r\n    }\r\n\r\n    case CatActionTypes.SET_PARENT_CAT: {\r\n      const { cat } = action.payload;\r\n      const { id, title } = cat;\r\n      return {\r\n        ...state,\r\n        parentId: id!,\r\n        title\r\n      };\r\n    }\r\n\r\n    default:\r\n      return state;  // TODO throw error\r\n  }\r\n};\r\n\r\n\r\nfunction markForClean(cats: ICategoryRow[], id: string | null) {\r\n  let deca = cats\r\n    .filter(c => c.parentId === id)\r\n    .map(c => c.id)\r\n\r\n  deca.forEach(id => {\r\n    const unuci = id ? markForClean(cats, id) : [];\r\n    deca = deca.concat(unuci);\r\n  })\r\n  return deca\r\n}","import { useEffect, useReducer, useState } from \"react\";\r\nimport { ListGroup } from \"react-bootstrap\";\r\nimport CatRow from \"@/global/Components/SelectCategory/CatRow\";\r\nimport { CatReducer, initialState } from \"@/global/Components/SelectCategory/CatReducer\";\r\n//import { useGlobalContext } from \"@/global/GlobalProvider\";\r\nimport { CatActionTypes, type ICatInfo } from \"./types\";\r\nimport type { ICategoryKey, ICategoryRow } from \"@/categories/types\";\r\nimport { useCategoryContext } from \"@/categories/CategoryProvider\";\r\n\r\nconst CatList = ({ selId, categoryKey, level, setParentId }: ICatInfo) => {\r\n    const [state, dispatch] = useReducer(CatReducer, initialState);\r\n    const { getSubCats } = useCategoryContext();\r\n\r\n    const { id } = categoryKey ?? { id: null };\r\n    const [catKey] = useState<ICategoryKey | null>(categoryKey)\r\n\r\n    useEffect(() => {\r\n        (async () => {\r\n            const res = await getSubCats(id);\r\n            const { subCats } = res;\r\n            dispatch({ type: CatActionTypes.SET_SUB_CATS, payload: { subCats } });\r\n        })()\r\n    }, [getSubCats, catKey, id]);\r\n\r\n    const mySubCats = state.cats.filter(c => c.parentId === id);\r\n\r\n    const setParentCat = (cat: ICategoryRow) => {\r\n        dispatch({ type: CatActionTypes.SET_PARENT_CAT, payload: { cat } })\r\n        setParentId!(cat);\r\n    }\r\n\r\n    return (\r\n        <div className={level > 1 ? 'border  border-7 ms-4 h-25' : 'border border-7  h-25'} style={{ overflowY: 'auto' }}>\r\n            <ListGroup as=\"ul\" variant='dark' className=\"mb-0\">\r\n                {mySubCats.filter(c => c.id !== selId).map((cat: ICategoryRow) =>\r\n                    <CatRow\r\n                        cat={cat}\r\n                        selId={selId}\r\n                        dispatch={dispatch}\r\n                        setParentCat={setParentCat}\r\n                        key={cat.id}\r\n                    />\r\n                )\r\n                }\r\n            </ListGroup>\r\n\r\n            {state.error && state.error.message}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default CatList;\r\n","import { useState } from \"react\";\r\n\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\nimport { faCopy, faEnvelope, faRemove } from '@fortawesome/free-solid-svg-icons'\r\n\r\nimport { ListGroup, Button, Modal } from \"react-bootstrap\";\r\n\r\nimport { useGlobalState } from '@/global/GlobalProvider'\r\nimport { formatDate } from '@/common/utilities'\r\nimport { type IAssignedAnswer } from '@/categories/types';\r\n\r\nimport { useHover } from \"@uidotdev/usehooks\";\r\n\r\ninterface IProps {\r\n    questionTitle: string,\r\n    assignedAnswer: IAssignedAnswer,\r\n    groupInAdding: boolean | undefined,\r\n    isDisabled: boolean,\r\n    unAssignAnswer: (assignedAnswer: IAssignedAnswer) => void\r\n}\r\nconst AssignedAnswer = ({ questionTitle, assignedAnswer, isDisabled, unAssignAnswer }: IProps) => {\r\n\r\n    const { id, answerTitle, created } = assignedAnswer;\r\n\r\n    const { time, nickName } = created!;\r\n    const emailFromClient = localStorage.getItem('emailFromClient');\r\n\r\n    const rowTitle = `Created by: ${nickName}, ${formatDate(new Date(time))}`\r\n\r\n    const { canEdit, isDarkMode } = useGlobalState();\r\n\r\n    //const { nickName, email } = authUser;\r\n\r\n    //const { state } = useCategoryContext();\r\n\r\n    const alreadyAdding = false;\r\n\r\n    const removeAnswer = () => {\r\n        unAssignAnswer(assignedAnswer)\r\n    };\r\n\r\n    //const edit = (id: number) => {\r\n    // Load data from server and reinitialize answer\r\n    //editAnswer(id);\r\n    //}\r\n\r\n    const onSelectAnswer = (id: string) => {\r\n        console.log(`Selected Answer id=${id}`);\r\n        // Load data from server and reinitialize answer\r\n        //viewAnswer(id);\r\n    }\r\n\r\n    const sendEMail = () => {\r\n\r\n        /*\r\n        const values = {\r\n            wsName,\r\n            from_name: userName,\r\n            to_name: emailFromClient,\r\n            questionTitle,\r\n            answer: title,\r\n            email_from: email,\r\n            email_to: emailFromClient,\r\n            contact_number: 0\r\n        }\r\n        values.contact_number = Math.random() * 100000 | 0;\r\n        */\r\n\r\n        // emailjs.send('service_akla4ca', 'template_2nbaqbj', values, 'YeDIRPwve3mgTemkA')\r\n        //     .then(function () {\r\n        //         console.log('SUCCESS!');\r\n        //         handleClose();\r\n        //     }, function (error) {\r\n        //         console.log('FAILED...', error);\r\n        //         //closeForm();\r\n        //     });\r\n    }\r\n\r\n    const [showReply, setShowReply] = useState(false);\r\n    const handleClose = () => setShowReply(false);\r\n\r\n    const copyToClipboard = (answerTitle: string): void => {\r\n        if (navigator.clipboard) {\r\n            navigator.clipboard.writeText(answerTitle) // input!.value)\r\n                .then(() => {\r\n                    console.log('Copied to clipboard successfully.');\r\n                    alert('Answer copied to clipboard');\r\n                }, (err) => {\r\n                    console.log('Failed to copy the text to clipboard.', err);\r\n                });\r\n        }\r\n    }\r\n\r\n    const [hoverRef, hovering] = useHover();\r\n\r\n    const Row1 =\r\n        <div ref={hoverRef} className=\"d-flex justify-content-start align-items-center w-100 text-light bg-info\">\r\n            <Button\r\n                variant='link'\r\n                size=\"sm\"\r\n                className=\"py-0 px-0 text-info\"\r\n                onClick={() => emailFromClient ? setShowReply(true) : copyToClipboard(answerTitle!)}\r\n            >\r\n                <FontAwesomeIcon\r\n                    icon={emailFromClient ? faEnvelope : faCopy}\r\n                    size='sm'\r\n                    title='Send this Answer in a reply on Question'\r\n                />\r\n            </Button>\r\n            <Button\r\n                variant='link'\r\n                size=\"sm\"\r\n                className=\"py-0 mx-1 text-decoration-none text-white text-wrap\"\r\n                title={rowTitle}\r\n                onClick={() => onSelectAnswer(id)}\r\n                disabled={alreadyAdding}\r\n            >\r\n                {answerTitle}\r\n            </Button>\r\n\r\n            {canEdit && !alreadyAdding && hovering && !isDisabled &&\r\n                <Button variant='link' size=\"sm\" className=\"ms-1 py-0 mx-1 text-secondary\"\r\n                    onClick={removeAnswer}\r\n                >\r\n                    <FontAwesomeIcon icon={faRemove} size='lg' />\r\n                </Button>\r\n            }\r\n        </div>\r\n\r\n    return (\r\n        <ListGroup.Item\r\n            key={id}\r\n            variant={\"info\"}\r\n            className=\"py-0 px-0\"\r\n            as=\"li\"\r\n        >\r\n            {/* <div class=\"d-lg-none\">hide on lg and wider screens</div> */}\r\n            {Row1}\r\n\r\n            <Modal\r\n                show={showReply}\r\n                onHide={handleClose}\r\n                animation={true}\r\n                centered\r\n                size=\"lg\"\r\n                className={`${isDarkMode ? \"bg\" : \"\"}`}\r\n                contentClassName={`${isDarkMode ? \"bg-info bg-gradient\" : \"\"}`}\r\n            >\r\n                <Modal.Header closeButton>\r\n                    Send Answer in a reply on Question\r\n                </Modal.Header>\r\n                <Modal.Body className=\"py-0\">\r\n                    <table className=\"table-info table-hover table-bordered w-100 h-100\">\r\n                        <tbody>\r\n                            <tr className=\"border-top-0\"><td>To:</td><td>{emailFromClient}</td></tr>\r\n                            <tr><td>Subject:</td><td>{questionTitle}</td></tr>\r\n                            <tr className=\"border-bottom-0\"><td>Body:</td><td>{answerTitle}</td></tr>\r\n                        </tbody>\r\n                    </table>\r\n                </Modal.Body>\r\n                <Modal.Footer>\r\n                    <Button variant=\"secondary\" size=\"sm\" onClick={handleClose}>Cancel</Button>\r\n                    <Button variant=\"primary\" size=\"sm\" onClick={sendEMail}>Send E-Mail</Button>\r\n                </Modal.Footer>\r\n            </Modal>\r\n\r\n        </ListGroup.Item>\r\n\r\n    );\r\n};\r\n\r\nexport default AssignedAnswer;\r\n","//import AnswerForm from \"groups/components/answers/AnswerForm\"; PRE\r\nimport { type IAnswer } from \"@/groups/types\";\r\n\r\ninterface IProps {\r\n    inLine: boolean,\r\n    closeModal: () => void,\r\n    onAnswerCreated: (answer: IAnswer) => void\r\n}\r\n\r\n// const Add = ({ kind, answer, inLine } : { kind: IKind, answer: IAnswer, inLine: boolean}) => {\r\nconst AddAnswer = ({ /*closeModal, onAnswerCreated*/ }: IProps) => {\r\n    // const globalState = useGlobalState();\r\n    //const { nickName } = globalState.authUser;\r\n    //const answer={...initialAnswer};\r\n\r\n    // const { createAnswer } = useCategoryContext();\r\n    // const [formValues] = useState(answer)\r\n\r\n    /*\r\n    const submitAnswer = async (answerObject: IAnswer) => {\r\n        //delete answerObject.id;  PROVERI\r\n        const object: IAnswer = {\r\n            ...answerObject,\r\n            //_id: undefined,\r\n            created: {\r\n                time: new Date(),\r\n                nickName: nickName\r\n            }\r\n        }\r\n        //const answer = await createAnswer(object);\r\n        //TODO vrati ovo\r\n        onAnswerCreated(answer)\r\n\r\n    }\r\n    */\r\n\r\n    return (\r\n        <span>Posle</span>\r\n        // <AnswerForm\r\n        //     answer={formValues}\r\n        //     mode={FormMode.adding}\r\n        //     submitForm={submitAnswer}\r\n        //     closeModal={closeModal}\r\n        //     showCloseButton={true}\r\n        // >\r\n        //     Create Answer\r\n        // </AnswerForm>\r\n    )\r\n}\r\n\r\nexport default AddAnswer\r\n","import { lazy, Suspense, useState } from \"react\";\r\nimport { Button, ListGroup, Modal } from \"react-bootstrap\";\r\nimport type { IAssignedAnswer, IAssignedAnswerKey, IQuestionKey } from \"@/categories/types\";\r\nimport { useCategoryContext } from \"@/categories/CategoryProvider\";\r\nimport { useGlobalContext } from \"@/global/GlobalProvider\";\r\nimport AssignedAnswer from \"./AssignedAnswer\";\r\n//import { AutoSuggestAnswers } from '@/global/Components/AutoSuggests/AutoSuggestAnswers';\r\nimport { type IAnswer } from \"@/groups/types\";\r\nimport AddAnswer from \"@/categories/components/questions/AddAnswer\"\r\n\r\nconst AutoSuggestAnswers = lazy(() =>\r\n    import(\"@/global/Components/AutoSuggests/AutoSuggestAnswers\").then((module) => ({ default: module.AutoSuggestAnswers }))\r\n);\r\n\r\ninterface IProps {\r\n    questionKey: IQuestionKey,\r\n    questionTitle: string,\r\n    assignedAnswers: IAssignedAnswer[],\r\n    isDisabled: boolean\r\n}\r\n\r\nconst AssignedAnswers = ({ questionKey, questionTitle, assignedAnswers, isDisabled }: IProps) => {\r\n\r\n    const { globalState, searchAnswers } = useGlobalContext();\r\n    const { isDarkMode, variant } = globalState;\r\n\r\n    const [showAdd, setShowAdd] = useState(false);\r\n    const handleClose = () => setShowAdd(false);\r\n\r\n    const closeModal = () => {\r\n        handleClose();\r\n    }\r\n\r\n    const { state, assignQuestionAnswer, getAnswerCount } = useCategoryContext();\r\n\r\n    const { allGroupRows } = state;\r\n    const [showAssign, setShowAssign] = useState(false);\r\n    const [errorMsg, setErrorMsg] = useState('');\r\n\r\n    const onSelectAnswer = async (assignedAnswerKey: IAssignedAnswerKey) => {\r\n        // TODO in next version do not update MongoDB immediately, wait until user presses Save\r\n        // User could have canceled question update\r\n        await assignQuestionAnswer('Assign', questionKey, assignedAnswerKey);\r\n        setShowAssign(false);\r\n    }\r\n\r\n    const onAnswerCreated = async (answer: IAnswer | null) => {\r\n        if (answer) {\r\n            await onSelectAnswer({ topId: answer.topId, id: answer.id } as IAssignedAnswerKey);\r\n        }\r\n        handleClose()\r\n    }\r\n\r\n    const unAssignAnswer = async (assignedAnswerKey: IAssignedAnswerKey) => {\r\n        // const unAssigned: IWhoWhen = {\r\n        //     time: new Date(),\r\n        //     nickName: globalState.authUser.nickName\r\n        // }\r\n        await assignQuestionAnswer('UnAssign', questionKey, assignedAnswerKey);\r\n\r\n        // User could have canceled question update\r\n        //setShowAssign(false);\r\n    }\r\n\r\n    const assignAnswer = async () => {\r\n        const count = await getAnswerCount();\r\n        if (count === 0) {\r\n            setErrorMsg('No answer available to assign. Please navigate to Answers and create an answer first.');\r\n            return;\r\n        }\r\n        setShowAssign(true);\r\n    }\r\n\r\n    // useEffect(() => {\r\n    //     if (!allGroupRowsLoaded) {\r\n    //         loadAndCacheAllGroupRows();\r\n    //     }\r\n    // }, [allGroupRowsLoaded, loadAndCacheAllGroupRows])\r\n\r\n    return (\r\n        <div className={'mx-0 my-0 px-1 py-1 border border-2 rounded-2 border-info bg-info'} >\r\n            <div>\r\n                <label className=\"text-muted bg-info fs-6\">Assigned Answers</label>\r\n                <ListGroup as=\"ul\" variant={variant} className='my-1'>\r\n                    {assignedAnswers.map((assignedAnswer: IAssignedAnswer) =>\r\n                        <AssignedAnswer\r\n                            key={assignedAnswer.id}\r\n                            questionTitle={questionTitle}\r\n                            assignedAnswer={assignedAnswer}\r\n                            groupInAdding={false}\r\n                            isDisabled={isDisabled}\r\n                            unAssignAnswer={unAssignAnswer}\r\n                        />)\r\n                    }\r\n                </ListGroup>\r\n                {state.error && <div>state.error</div>}\r\n                {/* {state.loading && <div>...loading</div>} */}\r\n            </div>\r\n            {true && // we expect no question will ever assign all the answers from the database\r\n                <>\r\n                    <div className=\"d-flex justify-content-start w-100 align-items-center py-1\">\r\n                        <Button\r\n                            size=\"sm\"\r\n                            className=\"button-edit py-0 rounded-1\"\r\n                            title=\"Assign a new Answer\"\r\n                            style={{ border: '1px solid silver', fontSize: '12px' }}\r\n                            variant={variant}\r\n                            disabled={isDisabled}\r\n                            onClick={assignAnswer} // event.preventDefault()}\r\n                        >\r\n                            Assign answer\r\n                        </Button>\r\n                        <Button\r\n                            size=\"sm\"\r\n                            className=\"button-edit py-0 rounded-1 mx-1\"\r\n                            title=\"Add and Assign a new Answer\"\r\n                            style={{ border: '1px solid silver', fontSize: '12px' }}\r\n                            variant={variant}\r\n                            disabled={isDisabled}\r\n                            onClick={\r\n                                async (e) => {\r\n                                    // if (!allGroupRowsGlobalLoaded) {\r\n                                    //     await loadAndCacheAllGroupRows();\r\n                                    // }\r\n                                    setShowAdd(true);\r\n                                    e.preventDefault()\r\n                                }\r\n                            }>\r\n                            Add a new answer\r\n                        </Button>\r\n\r\n                    </div>\r\n                    <div className=\"text-muted d-block\">\r\n                        {errorMsg && <span className=\"text-danger\">{errorMsg}</span>}\r\n                    </div>\r\n                </>\r\n            }\r\n\r\n            <Modal\r\n                show={showAdd}\r\n                onHide={handleClose}\r\n                animation={true}\r\n                centered\r\n                size=\"lg\"\r\n                className={`${isDarkMode ? \"\" : \"\"}`}\r\n                contentClassName={`${isDarkMode ? \"bg-info bg-gradient\" : \"\"}`}\r\n            >\r\n                <Modal.Header closeButton>\r\n                    <Modal.Title>{questionTitle}</Modal.Title>\r\n                </Modal.Header>\r\n                <Modal.Body>\r\n                    <AddAnswer\r\n                        inLine={true}\r\n                        closeModal={closeModal}\r\n                        onAnswerCreated={onAnswerCreated}\r\n                    />\r\n                </Modal.Body>\r\n            </Modal>\r\n\r\n            <Modal\r\n                show={showAssign}\r\n                onHide={() => setShowAssign(false)}\r\n                animation={true}\r\n                size=\"lg\"\r\n                centered\r\n                className={`${isDarkMode ? \"dark\" : \"\"}`}\r\n                contentClassName={`${isDarkMode ? \"dark\" : \"\"}`}>\r\n                <Modal.Header closeButton>\r\n                    <Modal.Title>Assign the answer</Modal.Title>\r\n                </Modal.Header>\r\n                <Modal.Body style={{ height: '40vh', width: '50vw' }} className=\"answers\">\r\n                    <Suspense fallback={<div>Loading...</div>}>\r\n                        <AutoSuggestAnswers\r\n                            tekst={'tekst'}\r\n                            onSelectAnswer={onSelectAnswer}\r\n                            allGroupRows={allGroupRows}\r\n                            searchAnswers={searchAnswers}\r\n                        />\r\n                    </Suspense>\r\n                </Modal.Body>\r\n            </Modal>\r\n        </div >\r\n    );\r\n};\r\n\r\nexport default AssignedAnswers;\r\n","\r\nimport { ListGroup, Button, Badge } from \"react-bootstrap\";\r\n\r\nimport { type IRelatedFilter } from '@/categories/types';\r\nimport { formatDate, formatDateShort } from \"@/common/utilities\";\r\nimport { useHover } from \"@uidotdev/usehooks\";\r\n\r\ninterface IProps {\r\n    relatedFilter: IRelatedFilter,\r\n    unAssignFilter: (relatedFilter: IRelatedFilter) => void\r\n}\r\n\r\nconst RelatedFilter = ({ relatedFilter/*, unAssignFilter*/ }: IProps) => {\r\n\r\n    const { filter, numOfUsages, created, lastUsed } = relatedFilter;\r\n\r\n    const { time, nickName } = created!;\r\n\r\n    const rowTitle = `Created by: ${nickName}, ${formatDate(new Date(time))}`\r\n\r\n    // const { authUser, canEdit, isDarkMode, variant, bg } = useGlobalState();\r\n    // const { state } = useCategoryContext();\r\n\r\n    const alreadyAdding = false;\r\n\r\n    // const del = () => {\r\n    //     unAssignFilter(relatedFilter);\r\n    // };\r\n\r\n    // const edit = (id: number) => {\r\n    //     // Load data from server and reinitialize answer\r\n    //     //editAnswer(id);\r\n    // }\r\n\r\n    const onSelectAnswer = (filter: string) => {\r\n        console.log('RelatedFilter onSelectAnswer', { filter });\r\n        // Load data from server and reinitialize answer\r\n        //viewAnswer(id);\r\n    }\r\n\r\n    const [hoverRef, hovering] = useHover();\r\n\r\n    const Row1 =\r\n        <div ref= {hoverRef} className=\"d-flex justify-content-start align-items-center w-100 text-light related-filter-row\">\r\n            <Button\r\n                variant='link'\r\n                size=\"sm\"\r\n                className=\"py-0 mx-0 title text-light text-wrap\"\r\n                title={rowTitle}\r\n                onClick={() => onSelectAnswer(filter)}\r\n                disabled={alreadyAdding}\r\n            >\r\n                {filter}\r\n            </Button>\r\n\r\n            <Badge pill bg=\"secondary\" className={`text-light ${numOfUsages === 0 ? 'd-none' : 'd-inline'}`}>\r\n                {numOfUsages}{numOfUsages === 1 ? ' usage' : ' usages'}\r\n                {/* <FontAwesomeIcon icon={faReply} size='sm' /> */}\r\n                {/* <img width=\"22\" height=\"18\" src={A} alt=\"Answer\"></img> */}\r\n            </Badge>\r\n\r\n            <span className=\"small ms-1\">\r\n                {formatDateShort(lastUsed!.time)}\r\n            </span>\r\n\r\n            {/* {canEdit && !alreadyAdding && hoverProps.hovering && !isDisabled &&\r\n                <Button variant='link' size=\"sm\" className=\"ms-1 py-0 mx-1 text-info\"\r\n                    onClick={del}\r\n                >\r\n                    <FontAwesomeIcon icon={faRemove} size='lg' />\r\n                </Button>\r\n            } */}\r\n\r\n             {hovering} \r\n        </div>\r\n\r\n    return (\r\n        <ListGroup.Item\r\n            key={filter}\r\n            //variant='secondary'\r\n            className=\"py-0 px-0\"\r\n            as=\"li\"\r\n        >\r\n            {/* <div class=\"d-lg-none\">hide on lg and wider screens</div> */}\r\n            {Row1}\r\n        </ListGroup.Item>\r\n\r\n    );\r\n};\r\n\r\nexport default RelatedFilter;\r\n","import { ListGroup } from \"react-bootstrap\";\r\nimport { type IQuestionKey } from \"@/categories/types\";\r\nimport { useCategoryContext } from \"@/categories/CategoryProvider\";\r\nimport { useGlobalContext } from \"@/global/GlobalProvider\";\r\nimport { type IRelatedFilter } from \"@/categories/types\";\r\nimport RelatedFilter from '@/categories/components/questions/RelatedFilter'\r\n\r\ninterface IProps {\r\n    questionKey: IQuestionKey,\r\n    questionTitle: string,\r\n    relatedFilters: IRelatedFilter[]\r\n}\r\n\r\nconst RelatedFilters = ({ relatedFilters }: IProps) => {\r\n\r\n    const { globalState } = useGlobalContext();\r\n    const { variant } = globalState;\r\n\r\n    //const [relatedFilters2, setAssignFilters2] = useState<IRelatedFilter[]>([]);\r\n\r\n    //const [showAdd, setShowAdd] = useState(false);\r\n    //const handleClose = () => setShowAdd(false);\r\n\r\n    // const closeModal = () => {\r\n    //     handleClose();\r\n    // }\r\n\r\n    // useEffect(() => {\r\n    //     (async () => {\r\n    //         if (relatedFilters.length > 0) {\r\n    //             //const arr = await joinRelatedFilters(relatedFilters);\r\n    //             setAssignFilters2(relatedFilters);\r\n    //         }\r\n    //     })()\r\n    // }, [relatedFilters])\r\n\r\n    const { state } = useCategoryContext();\r\n    //const [showAssign, setShowAssign] = useState(false);\r\n\r\n    const unAssignFilter = async (relatedFilter: IRelatedFilter) => {\r\n        console.log('RelatedFilters unAssignFilter', { relatedFilter });\r\n        // const unAssigned: IWhoWhen = {\r\n        //     time: new Date(),\r\n        //     nickName: globalState.authUser.nickName\r\n        // }\r\n        //await assignQuestionFilter('UnAssign', questionKey, answerKey, unAssigned);\r\n\r\n        // TODO in next version do not update MongoDB immediately, wait until users presses Save\r\n        // User could have canceled question update\r\n        //setShowAssign(false);\r\n    }\r\n\r\n    return (\r\n        <div className='mx-0 my-1 border rounded-2 px-1 py-1border-light fs-6 related-filters'>\r\n            <div>\r\n                <label className=\"text-muted\">Most frequently selected Filters (for the next Question in ChatBot)</label>\r\n                {relatedFilters.length > 0\r\n                    ? <ListGroup as=\"ul\" variant={variant} className='my-1'>\r\n                        {relatedFilters.map((relatedFilter: IRelatedFilter) =>\r\n                            <RelatedFilter\r\n                                key={relatedFilter.filter}\r\n                                relatedFilter={relatedFilter}\r\n                                unAssignFilter={unAssignFilter}\r\n                            />)\r\n\r\n                        }\r\n                    </ListGroup>\r\n                    : <div className='border text-light'>No filters</div>\r\n                }\r\n                {state.error && <div>state.error</div>}\r\n                {/* {state.loading && <div>...loading</div>} */}\r\n            </div>\r\n\r\n\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default RelatedFilters;\r\n","import { type ChangeEvent, type FormEvent, useState, useEffect, useRef } from \"react\";\r\nimport { useDebounce } from \"@uidotdev/usehooks\";\r\nimport * as Yup from \"yup\";\r\nimport { useFormik } from \"formik\";\r\nimport { Form, CloseButton, Row, Col, Stack } from \"react-bootstrap\";\r\nimport { CreatedModifiedForm } from \"@/common/CreateModifiedForm\"\r\nimport { FormButtons } from \"@/common/FormButtons\"\r\nimport type { ICategoryRow, IQuestion, IQuestionFormProps } from \"@/categories/types\";\r\nimport { ActionTypes } from \"@/categories/types\";\r\nimport { FormMode, QuestionKey } from \"@/categories/types\";\r\n\r\nimport { Select } from '@/common/components/Select';\r\nimport { sourceOptions, statusOptions } from '@/common/Options'\r\nimport CatList from '@/global/Components/SelectCategory/CatList'\r\n\r\nimport { useCategoryContext, useCategoryDispatch } from \"@/categories/CategoryProvider\";\r\nimport Dropdown from 'react-bootstrap/Dropdown';\r\nimport AssignedAnswers from './AssignedAnswers';\r\nimport RelatedFilters from './RelatedFilters';\r\n\r\nconst QuestionForm = ({ question, submitForm, children, showCloseButton, source = 0, closeModal }: IQuestionFormProps) => {\r\n\r\n  // const { globalState } = useGlobalContext();\r\n  // const { isDarkMode, variant, bg } = globalState;\r\n\r\n  const { state, onQuestionTitleChanged } = useCategoryContext();\r\n  let { formMode } = state;\r\n\r\n  // const AssignedAnswers = lazy(() =>\r\n  //   // named export\r\n  //   import(\"@/categories/components/questions/AssignedAnswers\").then((module) => ({ default: module.default }))\r\n  // );\r\n\r\n  const viewing = formMode === FormMode.ViewingQuestion;\r\n  const editing = formMode === FormMode.EditingQuestion;\r\n  const adding = formMode === FormMode.AddingQuestion;\r\n\r\n  const isDisabled = viewing;\r\n\r\n  const { topId, parentId, id, assignedAnswers, relatedFilters, title: qTitle } = question;\r\n  const questionKey = new QuestionKey(question).questionKey;\r\n  // const categoryKey: ICategoryKey = { topId, parentId, id: parentId! }; // proveri\r\n\r\n  const dispatch = useCategoryDispatch();\r\n\r\n  const closeForm = () => {\r\n    if (closeModal) {\r\n      closeModal();\r\n    }\r\n    else {\r\n      dispatch({ type: ActionTypes.CLOSE_QUESTION_FORM, payload: { question } })\r\n    }\r\n  }\r\n\r\n  const cancelForm = () => {\r\n    if (closeModal) {\r\n      closeModal();\r\n    }\r\n    else {\r\n      dispatch({ type: ActionTypes.CANCEL_QUESTION_FORM, payload: { question } })\r\n    }\r\n  }\r\n\r\n  const [searchTerm, setSearchTerm] = useState(qTitle);\r\n  const debouncedSearchTerm = useDebounce(searchTerm, 500);\r\n\r\n  //const [topRow] = useState<ICategoryRow>(topRows.find(c => c.id === topId)!);\r\n\r\n  // eslint-disable-next-line no-self-compare\r\n  const nameRef = useRef<HTMLTextAreaElement>(null);\r\n\r\n  const formik = useFormik({\r\n    enableReinitialize: true,\r\n    initialValues: question,\r\n    validationSchema: Yup.object().shape({\r\n      title: Yup.string().required(\"Required\"),\r\n      parentId: Yup.string().required(\"Required\").notOneOf(['000000000000000000000000'])\r\n    }),\r\n    onSubmit: (values: IQuestion) => {\r\n      // console.log('QuestionForm.onSubmit', JSON.stringify(values, null, 2))\r\n      submitForm(values)\r\n      //props.handleClose(false);\r\n      setSearchTerm(values.title);\r\n    }\r\n  });\r\n\r\n  useEffect(() => {\r\n    const goBre = async () => {\r\n      // console.log('QuestionForm.useEffect - onQuestionTitleChanged', { debouncedSearchTerm, title: formik.values.title });\r\n      if (/*debouncedSearchTerm &&*/ formik.values.title !== debouncedSearchTerm) {\r\n        /*await*/ onQuestionTitleChanged(topId, parentId, id, formik.values.title);\r\n      }\r\n    };\r\n    goBre();\r\n  }, [debouncedSearchTerm, formik.values.title, onQuestionTitleChanged, topId, id]);\r\n\r\n  \r\n\r\n  useEffect(() => {\r\n    nameRef.current!.focus();\r\n    if (source !== 0) {\r\n      formik.setFieldValue('source', source)\r\n    }\r\n  }, [formik, nameRef, source])\r\n\r\n\r\n  const handleChangeTitle = (event: ChangeEvent<HTMLTextAreaElement>) => {\r\n    formik.handleChange(event);\r\n    const value = event.target.value;\r\n    //if (value !== debouncedTitle)\r\n    //setTitle(value);\r\n    setSearchTerm(value);\r\n  };\r\n\r\n  const setParentId = (cat: ICategoryRow) => {\r\n    formik.setFieldValue('parentId', cat.id);\r\n    formik.setFieldValue('categoryTitle', cat.title);\r\n  }\r\n\r\n  //useEffect(() => {\r\n  //  setSearchTerm(qTitle);\r\n  //}, [qTitle]);\r\n\r\n  return (\r\n    <div className=\"form-wrapper px-3 py-1 my-0 my-1 w-100 question-form\" >\r\n      {/* data-bs-theme={`${isDarkMode ? 'dark' : 'light'}`} */}\r\n      {showCloseButton && <CloseButton onClick={closeForm} className=\"float-end\" />}\r\n      <Row className='text-center'>\r\n        <Form.Label>Question  {viewing ? 'Viewing' : editing ? 'Editing' : 'Adding'}</Form.Label>\r\n      </Row>\r\n      <Form onSubmit={formik.handleSubmit} className=\"question-form\">\r\n\r\n        <Stack direction=\"horizontal\" gap={0} className=\"\">\r\n          <div className=\"p-0\"><Form.Label>Category:</Form.Label></div>\r\n          <div className=\"p-1\">\r\n            <Form.Group controlId=\"parentId\" className=\"category-select form-select-sm w-90\">\r\n              <Dropdown>\r\n                <Dropdown.Toggle variant=\"light\" id=\"dropdown-basic\" className=\"px-2 py-0 text-primary border\" disabled={isDisabled}>\r\n                  <span className=\"text-wrap me-1\">{formik.values.categoryTitle}</span>\r\n                </Dropdown.Toggle>\r\n                <Dropdown.Menu className=\"p-0 border\" >\r\n                  <Dropdown.Item className=\"p-0 m-0 rounded-3\">\r\n                    <CatList\r\n                      selId={formik.values.parentId}\r\n                      categoryKey={null}  // TODO {categoryKey}\r\n                      level={1}\r\n                      setParentId={setParentId}\r\n                    />\r\n                  </Dropdown.Item>\r\n                </Dropdown.Menu>\r\n              </Dropdown>\r\n\r\n              <Form.Control\r\n                as=\"input\"\r\n                name=\"parentId\"\r\n                onChange={formik.handleChange}\r\n                //onBlur={formik.handleBlur}\r\n                // onBlur={(e: React.FocusEvent<HTMLTextAreaElement>): void => {\r\n                //   if (isEdit && formik.initialValues.title !== formik.values.title)\r\n                //     formik.submitForm();\r\n                // }}\r\n                value={formik.values.parentId ? formik.values.parentId : ''}\r\n                placeholder='Category'\r\n                className=\"text-primary w-100\"\r\n                disabled={isDisabled}\r\n                hidden={true}\r\n              />\r\n              <Form.Text className=\"text-danger\">\r\n                {formik.touched.parentId && formik.errors.parentId ? (\r\n                  <div className=\"text-danger\">{formik.errors.parentId ? 'required' : ''}</div>\r\n                ) : null}\r\n              </Form.Text>\r\n            </Form.Group>\r\n          </div>\r\n        </Stack>\r\n\r\n        <Form.Group controlId=\"title\">\r\n          <Form.Label>Title</Form.Label>\r\n          <Form.Control\r\n            as=\"textarea\"\r\n            name=\"title\"\r\n            placeholder={formik.values.title === \"new Question\" ? \"new Question\" : \"question text\"}\r\n            ref={nameRef}\r\n            onChange={handleChangeTitle}\r\n            // onBlur={formik.handleBlur}\r\n            // onBlur={(e: React.FocusEvent<HTMLTextAreaElement>): void => {\r\n            //   if (isEdit && formik.initialValues.title !== formik.values.title)\r\n            //     formik.submitForm();\r\n            // }}\r\n            value={formik.values.title}\r\n            rows={3}\r\n            className=\"text-primary w-100\"\r\n            disabled={isDisabled}\r\n          />\r\n          <Form.Text className=\"text-danger\">\r\n            {formik.touched.title && formik.errors.title ? (\r\n              <div className=\"text-danger\">{formik.errors.title}</div>\r\n            ) : null}\r\n          </Form.Text>\r\n        </Form.Group>\r\n\r\n        <Row>\r\n          <Col>\r\n            <Form.Group controlId=\"source\">\r\n              <Form.Label>Source</Form.Label>\r\n              <Select\r\n                id=\"source\"\r\n                name=\"source\"\r\n                options={sourceOptions}\r\n                onChange={(e: FormEvent<HTMLSelectElement>, value: any) => {\r\n                  e.preventDefault(); // ?\r\n                  formik.setFieldValue('source', value)\r\n                  // .then(() => { if (editing) formik.submitForm() })\r\n                }}\r\n                value={formik.values.source}\r\n                disabled={isDisabled}\r\n                classes=\"text-primary\"\r\n              />\r\n              <Form.Text className=\"text-danger\">\r\n                {formik.touched.source && formik.errors.source ? (\r\n                  <div className=\"text-danger\">{formik.errors.source}</div>\r\n                ) : null}\r\n              </Form.Text>\r\n            </Form.Group>\r\n          </Col>\r\n          <Col>\r\n            <Form.Group controlId=\"status\">\r\n              <Form.Label>Status</Form.Label>\r\n              <Select\r\n                id=\"status\"\r\n                name=\"status\"\r\n                options={statusOptions}\r\n                //onChange={formik.handleChange}\r\n                onChange={(e: FormEvent<HTMLSelectElement>, value: any) => {\r\n                  e.preventDefault(); // ?\r\n                  formik.setFieldValue('status', value)\r\n                  //.then(() => { if (editing) formik.submitForm() })\r\n                }}\r\n                value={formik.values.status}\r\n                disabled={isDisabled}\r\n                classes=\"text-primary\"\r\n              />\r\n              <Form.Text className=\"text-danger\">\r\n                {formik.touched.status && formik.errors.status ? (\r\n                  <div className=\"text-danger\">{formik.errors.status}</div>\r\n                ) : null}\r\n              </Form.Text>\r\n            </Form.Group>\r\n          </Col>\r\n        </Row>\r\n\r\n        {(viewing || editing) &&\r\n          <div className=\"my-1\">\r\n              <AssignedAnswers\r\n                questionKey={questionKey!}\r\n                questionTitle={searchTerm}\r\n                assignedAnswers={assignedAnswers}\r\n                isDisabled={isDisabled}\r\n              />\r\n\r\n            <RelatedFilters\r\n              questionKey={questionKey!}\r\n              questionTitle={searchTerm}\r\n              relatedFilters={relatedFilters}\r\n            />\r\n\r\n            <CreatedModifiedForm\r\n              created={question.created}\r\n              modified={question.modified}\r\n              classes=\"text-primary\"\r\n            />\r\n          </div>\r\n        }\r\n        {((formik.dirty && editing) || adding) &&\r\n          <FormButtons\r\n            cancelForm={cancelForm}\r\n            handleSubmit={formik.handleSubmit}\r\n            title={children}\r\n          />\r\n        }\r\n\r\n        {state.error && <div className=\"text-danger\">{state.error.message}</div>}\r\n\r\n      </Form>\r\n    </div >\r\n  );\r\n};\r\n\r\nexport default QuestionForm;","import { useCategoryContext } from '@/categories/CategoryProvider'\r\n\r\nimport QuestionForm from \"@/categories/components/questions/QuestionForm\";\r\nimport { type IQuestion } from \"@/categories/types\";\r\n\r\ninterface IProps {\r\n    closeModal?: () => void;\r\n    showCloseButton?: boolean;\r\n    source?: number;\r\n    setError?: (msg: string) => void;\r\n}\r\n\r\nconst AddQuestion = ({ closeModal, showCloseButton, source, setError }: IProps) => {\r\n\r\n    const { state, cancelAddQuestion, createQuestion } = useCategoryContext();\r\n    const { activeQuestion } = state;\r\n    const topId = activeQuestion\r\n        ? activeQuestion.topId\r\n        : '';\r\n\r\n    if (!closeModal) {\r\n        // const cat = state.topCategoryRows.find(c => c.id === questionRow.parentId)\r\n        // questionRow.categoryTitle = cat ? cat.title : '';\r\n    }\r\n\r\n    const cancelAdd = async () => {\r\n        await cancelAddQuestion();\r\n    }\r\n\r\n\r\n    const submitForm = async (questionObject: IQuestion) => {\r\n        const newQuestion: IQuestion = {\r\n            ...questionObject,\r\n            topId: topId!,\r\n            created: {\r\n                time: new Date(),\r\n                nickName: ''\r\n            },\r\n            modified: undefined\r\n        }\r\n        const q = await createQuestion(newQuestion, closeModal !== undefined);\r\n        if (q) {\r\n            if (q.message) {\r\n                setError!(q.message)\r\n            }\r\n            else if (closeModal) {\r\n                closeModal();\r\n                //dispatch({ type: ActionTypes.CLEAN_TREE, payload: { id: q.parentId } })\r\n                //await openNode({ topId: '', id: q.parentId, questionId: q.id });\r\n            }\r\n        }\r\n    }\r\n\r\n    if (!activeQuestion)\r\n        return null;\r\n\r\n    // activeQuestion.title += odakle\r\n    return (\r\n        <QuestionForm\r\n            question={activeQuestion!}\r\n            showCloseButton={showCloseButton ?? true}\r\n            source={source ?? 0}\r\n            closeModal={cancelAdd}\r\n            //formMode={FormMode.AddingQuestion}\r\n            submitForm={submitForm}\r\n        >\r\n            Create Question\r\n        </QuestionForm >\r\n    )\r\n}\r\n\r\nexport default AddQuestion\r\n\r\n\r\n","import { useCategoryContext } from '@/categories/CategoryProvider'\r\n//import { useGlobalContext, useGlobalState } from '@/global/GlobalProvider'\r\n\r\nimport QuestionForm from \"@/categories/components/questions/QuestionForm\";\r\nimport { type IQuestion } from \"@/categories/types\";\r\nimport { useEffect } from 'react';\r\n\r\nconst EditQuestion = ({ /*inLine*/ }: { inLine: boolean }) => {\r\n    const { state, updateQuestion, loadAllGroupRows } = useCategoryContext();\r\n    const { activeQuestion, allGroupRowsLoaded } = state;  // loadingQuestion: questionLoading, \r\n    if (!activeQuestion)\r\n        return null;\r\n\r\n    //const { topId } = activeQuestion!;\r\n\r\n\r\n    if (!activeQuestion) {\r\n        return <div>Loading question to edit...</div>\r\n    }\r\n\r\n    useEffect(() => {\r\n        (async () => {\r\n            if (allGroupRowsLoaded === undefined) {\r\n                await loadAllGroupRows();\r\n            }\r\n        })()\r\n    }, [ allGroupRowsLoaded, loadAllGroupRows ]);\r\n\r\n    const submitForm = async (questionObject: IQuestion) => {\r\n        const newQuestion: IQuestion = {\r\n            ...questionObject,\r\n            created: undefined,\r\n            modified: {\r\n                time: new Date(),\r\n                nickName: ''\r\n            }\r\n        }\r\n\r\n        const { parentId } = activeQuestion;\r\n        const categoryChanged = parentId !== newQuestion.parentId;\r\n        //const questionKey = new QuestionKey(activeQuestion).questionKey;\r\n        /*const question =*/ await updateQuestion(parentId!, newQuestion, categoryChanged);\r\n        /*\r\n        if (activeQuestion.parentId !== question.parentId) {\r\n             await loadAndCacheAllCategoryRows(); // reload, group could have been changed\r\n             await openNode({ topId: '', id: q.parentId, questionId: q.id });\r\n        }\r\n        */\r\n\r\n        // if (categoryChanged) {\r\n        //     setTimeout(() => dispatch({ type: ActionTypes.CLOSE_QUESTION_FORM, payload: { question: question } }), 1000);\r\n        // }\r\n    };\r\n\r\n    return (\r\n        <QuestionForm\r\n            question={activeQuestion!}\r\n            showCloseButton={true}\r\n            source={0}\r\n            submitForm={submitForm}\r\n        >\r\n            Update Question\r\n        </QuestionForm>\r\n    );\r\n};\r\n\r\nexport default EditQuestion;\r\n","import { useEffect, useState } from 'react';\r\nimport { useCategoryContext } from '@/categories/CategoryProvider'\r\nimport type { IQuestion } from \"@/categories/types\";\r\nimport QuestionForm from \"@/categories/components/questions/QuestionForm\";\r\n\r\nconst ViewQuestion = ({ inLine }: { inLine: boolean }) => {\r\n    console.log(inLine ? \"ViewQuestion inLine\" : \"ViewQuestion not inLine\");\r\n    const { state } = useCategoryContext();\r\n    const { activeQuestion } = state;\r\n    //const { topId, id, parentId } = activeQuestion!;\r\n\r\n    const [question, setQuestion] = useState<IQuestion | null>(null);\r\n\r\n    useEffect(() => {\r\n        //const q = category!.questions.find(q => q.inEditing)\r\n        //if (category) {\r\n        //const q = category!.questions.find(q => q.id === id)\r\n        console.log(\"#################################### ViewQuestion setQuestion ...\", { activeQuestion })\r\n        //if (q) {\r\n        setQuestion(activeQuestion);\r\n        //}\r\n        //}\r\n    }, [activeQuestion]) // questionLoading\r\n    // if (questionLoading)\r\n    //     return <div>Loading question...</div>\r\n    return (\r\n        <QuestionForm\r\n            question={question!}\r\n            showCloseButton={true}\r\n            source={0}\r\n            submitForm={() => { }}\r\n        >\r\n            View Question\r\n        </QuestionForm>\r\n    );\r\n}\r\n\r\nexport default ViewQuestion;\r\n","import { useEffect } from 'react';\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\nimport { faRemove } from '@fortawesome/free-solid-svg-icons'\r\n\r\nimport { ListGroup, Button, Badge } from \"react-bootstrap\";\r\n\r\nimport { useGlobalState } from '@/global/GlobalProvider'\r\nimport { FormMode, type ICategoryKey, type IQuestionRow } from \"@/categories/types\";\r\nimport { useCategoryContext } from '@/categories/CategoryProvider'\r\nimport { useHover } from \"@uidotdev/usehooks\";\r\n\r\nimport AddQuestion from \"@/categories/components/questions/AddQuestion\";\r\nimport EditQuestion from \"@/categories/components/questions/EditQuestion\";\r\nimport ViewQuestion from \"@/categories/components/questions/ViewQuestion\";\r\nimport Q from '@/assets/Q.png';\r\nimport QPlus from '@/assets/QPlus.png';\r\n\r\n\r\n//const QuestionRow = ({ question, categoryInAdding }: { ref: React.ForwardedRef<HTMLLIElement>, question: IQuestion, categoryInAdding: boolean | undefined }) => {\r\nconst QuestionRow = ({ questionRow, isSelected }: { questionRow: IQuestionRow, isSelected: boolean }) => {\r\n    const { id, topId, parentId, title, numOfAssignedAnswers } = questionRow; // , isSelected\r\n    //const questionKey: IQuestionKey = new QuestionKey(questionRow).questionKey!;\r\n    const categoryKey: ICategoryKey = { topId, parentId, id: parentId! } // proveri\r\n\r\n    const { canEdit, authUser } = useGlobalState();\r\n    const { state, viewQuestion, addQuestion, editQuestion, deleteQuestion } = useCategoryContext();\r\n\r\n    const { activeQuestion, formMode, loadingQuestion, questionLoaded } = state;\r\n    //const isSelected = useState(id === selectedQuestionId);\r\n\r\n    const showForm = activeQuestion !== null && activeQuestion.id === id;\r\n\r\n    //const [alreadyAdding] = useState(formMode === FormMode.AddingQuestion);\r\n    const alreadyAdding = formMode === FormMode.AddingQuestion;\r\n\r\n    const del = () => {\r\n        questionRow.modified = {\r\n            time: new Date(),\r\n            nickName: authUser.nickName\r\n        }\r\n        deleteQuestion(questionRow, showForm /* isActive */);\r\n    };\r\n\r\n    // const edit = async (Id: string) => {\r\n    //     // Load data from server and reinitialize question\r\n    //     await editQuestion(questionRow);\r\n    // }\r\n\r\n    const onSelectQuestion = async (id: string) => {\r\n        console.log('QuestionRow onSelectQuestion', { id });\r\n        if (canEdit)\r\n            await editQuestion(questionRow);\r\n        else\r\n            await viewQuestion(questionRow);\r\n    }\r\n\r\n    const [hoverRef, hovering] = useHover();\r\n\r\n    useEffect(() => {\r\n        (async () => {\r\n            if (isSelected && !loadingQuestion && !questionLoaded) {\r\n                switch (formMode) {\r\n                    case FormMode.ViewingQuestion:\r\n                        await viewQuestion(questionRow);\r\n                        break;\r\n                    case FormMode.EditingQuestion:\r\n                        console.log('Zovem from QuestionRow')\r\n                        canEdit\r\n                            ? await editQuestion(questionRow)\r\n                            : await viewQuestion(questionRow);\r\n                        break;\r\n                }\r\n                // hoverRef!.current?\r\n                const el = document.getElementById(`QuestionRow${id}`);\r\n                el?.scrollIntoView({ behavior: 'smooth', block: 'end' });\r\n            }\r\n        })()\r\n        // after using new Question() in getQuestion() editQuestion gets modified // viewQuestion, editQuestion\r\n    }, [canEdit, editQuestion, formMode, id, isSelected, loadingQuestion, questionLoaded, questionRow, viewQuestion]);\r\n\r\n    const Row1 =\r\n\r\n        <div id={`QuestionRow${id}`} className={`d-relative d-flex justify-content-start align-items-center w-100 mt-0 question-row${isSelected ? '-selected' : ''}`} style={{ marginTop: '1px' }} >\r\n            <Button\r\n                variant='link'\r\n                size=\"sm\"\r\n                className=\"d-flex align-items-center px-1 text-secondary\"\r\n            >\r\n                <img width=\"22\" height=\"18\" src={Q} alt=\"Question\" />\r\n            </Button>\r\n            <Button\r\n                variant='link'\r\n                size=\"sm\"\r\n                className={`p-0 px-1 m-1 ms-0 question-row-title ${showForm ? 'fw-bold' : ''}`}\r\n                title={`id:${id!.toString()}`}\r\n                onClick={() => onSelectQuestion(id!)}\r\n                disabled={alreadyAdding}\r\n            >\r\n                {title}\r\n            </Button>\r\n            <Badge pill bg=\"secondary\" className={`text-info ${numOfAssignedAnswers === 0 ? 'd-none' : 'd-inline'}`}>\r\n                {numOfAssignedAnswers}a\r\n                {/* <FontAwesomeIcon icon={faReply} size='sm' /> */}\r\n                {/* <img width=\"22\" height=\"18\" src={A} alt=\"Answer\"></img> */}\r\n            </Badge>\r\n\r\n            {/* {canEdit && !alreadyAdding && hovering &&\r\n                <Button variant='link' size=\"sm\" className=\"ms-1 py-0 px-1 text-secondary\"\r\n                    //onClick={() => { dispatch({ type: ActionTypes.EDIT, question }) }}>\r\n                    onClick={() => edit(_id!)}\r\n                >\r\n                    <FontAwesomeIcon icon={faEdit} size='lg' />\r\n                </Button>\r\n            } */}\r\n\r\n            {canEdit && !alreadyAdding && hovering &&\r\n                <div className=\"position-absolute text-nowrap d-flex align-items-center border border-0 border-warning p-0 end-0\">\r\n                    <Button\r\n                        variant='link'\r\n                        size=\"sm\"\r\n                        className=\"ms-1 p-0 text-secondary d-flex align-items-center\"\r\n                        title=\"Add Question\"\r\n                        onClick={() => {\r\n                            //const categoryInfo: ICategoryInfo = { categoryKey, level: 0 }\r\n                            addQuestion(categoryKey, true);\r\n                        }}\r\n                    >\r\n                        <img width=\"22\" height=\"18\" src={QPlus} alt=\"Add Question\" />\r\n                    </Button>\r\n                    <Button variant='link' size=\"sm\" className=\"ms-0 p-0 text-secondary\"\r\n                        onClick={del}\r\n                    >\r\n                        <FontAwesomeIcon icon={faRemove} size='lg' />\r\n                    </Button>\r\n\r\n                </div>\r\n            }\r\n        </div>\r\n\r\n    // console.log('---@@@@@@@@@@@@@ QuestionRow', { id, isSelected, formMode, questionLoaded })\r\n    return (\r\n        // border border-3 border-danger\"\r\n        // <div className=\"py-0 px-0 w-100 list-group-item border\">\r\n        <ListGroup.Item\r\n            // variant={\"primary\"}\r\n            className=\"py-0 px-0 w-100\"\r\n            as=\"li\"\r\n        >\r\n            {isSelected && formMode === FormMode.AddingQuestion &&\r\n                <>\r\n                    <div id='div-question' className=\"ms-0 d-md-none w-100\">\r\n                        <AddQuestion\r\n                            showCloseButton={true}\r\n                            source={0} />\r\n                    </div>\r\n                    <div ref={hoverRef} className=\"d-none d-md-block  border rounded-3\">\r\n                        {Row1}\r\n                    </div>\r\n                </>\r\n            }\r\n\r\n            {isSelected && formMode === FormMode.EditingQuestion &&\r\n                <>\r\n                    <div ref={hoverRef} className=\"\">\r\n                        {/* d-none d-md-block */}\r\n                        {Row1}\r\n                    </div>\r\n                    {/* <div class=\"d-lg-none\">hide on lg and wider screens</div> */}\r\n                    {/* <div id='div-question' className=\"ms-0 d-md-none w-100\"> */}\r\n                    <div id='div-question' className=\"ms-0 d-md-none w-100\">\r\n                        <EditQuestion inLine={true} />\r\n                    </div>\r\n                </>\r\n            }\r\n\r\n            {isSelected && formMode === FormMode.ViewingQuestion &&\r\n                <>\r\n                    <div ref={hoverRef} className=\"\">\r\n                        {/* d-none d-md-block */}\r\n                        {Row1}\r\n                    </div>\r\n                    {/* <div class=\"d-lg-none\">hide on lg and wider screens</div> */}\r\n                    <div ref={hoverRef} id='div-question' className=\"ms-0 d-md-none w-100\">\r\n                        <ViewQuestion inLine={true} />\r\n                    </div>\r\n                </>\r\n            }\r\n\r\n            {!isSelected &&\r\n                // d-none d-md-block\r\n                <div ref={hoverRef} className=\"\">\r\n                    {Row1}\r\n                </div>\r\n            }\r\n\r\n        </ListGroup.Item>\r\n    );\r\n};\r\n\r\nexport default QuestionRow;\r\n","import { CategoryKey, type ICategoryRow, type ILoadCategoryQuestions, type IQuestionRow } from \"@/categories/types\";\r\nimport { useCategoryContext } from \"@/categories/CategoryProvider\";\r\nimport useInfiniteScroll from \"react-infinite-scroll-hook\";\r\nimport { List, ListItem, Loading } from \"@/common/components/InfiniteList\";\r\nimport QuestionRow from \"@/categories/components/questions/QuestionRow\";\r\n\r\n//const QuestionList = ({ title, categoryRow, level }: IParentInfo) => {\r\nconst QuestionList = ({ categoryRow }: { categoryRow: ICategoryRow }) => {\r\n  const { state, loadCategoryQuestions } = useCategoryContext();\r\n  const { keyExpanded, loadingQuestion, error, selectedQuestionId } = state;\r\n  const { questionId } = keyExpanded!;\r\n  //? keyExpanded\r\n\r\n  categoryRow.level += 1;\r\n  const { questionRows } = categoryRow;\r\n  // console.log('@@@@@@@@@@@@@ QuestionList', { questionRows })\r\n\r\n  let hasMoreQuestions = false;\r\n\r\n  async function loadMore() {\r\n    try {\r\n      // const parentInfo: IParentInfo = {\r\n      //   categoryRow,\r\n      //   startCursor: questionRows.length,\r\n      //   includeQuestionId: questionId ?? null\r\n      // }\r\n\r\n      const x: ILoadCategoryQuestions = {\r\n        categoryKey: new CategoryKey(categoryRow).categoryKey!,\r\n        startCursor: questionRows!.length,\r\n        includeQuestionId: questionId ?? null\r\n      }\r\n      console.log('^^^^^^^^^^^^^ loadMore')\r\n      console.log('^^^^^^^^^^^^^', { x })\r\n      console.log('^^^^^^^^^^^^^ loadMore')\r\n      await loadCategoryQuestions(x);\r\n    }\r\n    catch (error) {\r\n    }\r\n    finally {\r\n    }\r\n  }\r\n\r\n  // useEffect(() => {\r\n  //   //if (numOfQuestions > 0 && questionRows.length === 0) { // TODO\r\n  //   if (questionRows.length === 0) { // TODO\r\n  //     loadMore();\r\n  //   }\r\n  // }, [numOfQuestions, questionRows])\r\n\r\n\r\n  const [infiniteRef, { rootRef }] = useInfiniteScroll({\r\n    loading: loadingQuestion,\r\n    hasNextPage: hasMoreQuestions!,\r\n    onLoadMore: loadMore,\r\n    disabled: Boolean(error),\r\n    rootMargin: '0px 0px 100px 0px',\r\n  });\r\n\r\n  // console.log(\"QQQQQQQQQQQQQQQQQQQQQQQQQQQQQ QuestionList\", questionRows)\r\n  // if (loadingQuestion)\r\n  //   return <div> ... loading</div>\r\n\r\n  return (\r\n    <div\r\n      ref={rootRef}\r\n      className=\"ms-0\" // border border-1 border-info rounded-2\"\r\n      // className=\"max-h-[500px] max-w-[500px] overflow-auto bg-slate-100\"\r\n      style={{ maxHeight: '400px', overflowY: 'auto' }}\r\n    >\r\n      <List>\r\n        {questionRows!.length === 0 &&\r\n          <label>No questions</label>\r\n        }\r\n        {questionRows!.map((questionRow: IQuestionRow) => {\r\n          return <QuestionRow key={questionRow.id} questionRow={questionRow} isSelected={questionRow.id === selectedQuestionId} />\r\n        })}\r\n        {hasMoreQuestions && (\r\n          <ListItem ref={infiniteRef}>\r\n            <Loading />\r\n          </ListItem>\r\n        )}\r\n      </List>\r\n      {error && <p>Error: {error.message}</p>}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default QuestionList;\r\n","import { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\nimport { faRemove, faThumbsUp, faPlus } from '@fortawesome/free-solid-svg-icons'\r\n\r\nimport { Button, Badge } from \"react-bootstrap\";\r\n\r\nimport { useGlobalState } from '@/global/GlobalProvider'\r\nimport { type ICategoryKey, FormMode } from \"@/categories/types\";\r\nimport { useCategoryContext } from '@/categories/CategoryProvider'\r\nimport { type IVariation } from '@/categories/types'\r\nimport { useHover } from \"@uidotdev/usehooks\";\r\n\r\n// import AddTag from \"categorys/components/tags/AddTag\";\r\n// import EditTag from \"categorys/components/tags/EditTag\";\r\n// import ViewTag from \"categorys/components/tags/ViewTag\";\r\n\r\n//const TagRow = ({ tag, categoryInAdding }: { ref: React.ForwardedRef<HTMLLIElement>, tag: IVariation, categoryInAdding: boolean | undefined }) => {\r\nconst VariationRow = ({ categoryKey, tag, categoryInAdding }: { categoryKey: ICategoryKey, tag: IVariation, categoryInAdding: boolean | undefined }) => {\r\n    //const { topId, id } = categoryKey;\r\n    const { name } = tag;\r\n    const { inViewing, inEditing, inAdding } = {\r\n        //parentId: '',\r\n        //level: 0,\r\n        inViewing: false,\r\n        inEditing: false,\r\n        inAdding: false,\r\n        //numOfTags: 4\r\n    };\r\n\r\n    const { canEdit } = useGlobalState();\r\n\r\n    // const { state, viewTag, editTag, deleteTag } = useCategoryContext();\r\n    const { state, deleteCategoryVariation } = useCategoryContext();\r\n    //const dispatch = useCategoryDispatch();\r\n\r\n    const alreadyAdding = false //state.mode === Mode.AddingTag;\r\n\r\n    const del = () => {\r\n        deleteCategoryVariation(categoryKey, name);\r\n    };\r\n\r\n    //const edit = (id: number) => {\r\n    // Load data from server and reinitialize tag\r\n    //editTag(id);\r\n    //}\r\n\r\n    //const onSelectTag = (id: number) => {\r\n    // Load data from server and reinitialize tag\r\n    //if (canEdit)\r\n    //editTag(id);\r\n    //else\r\n    //viewTag(id);\r\n    //}\r\n\r\n    const [hoverRef, hovering] = useHover();\r\n\r\n    const Row1 =\r\n        // <div ref={hoverRef} className=\"d-flex justify-content-start align-items-center text-secondary\">\r\n        <div ref={hoverRef} >\r\n\r\n            <Badge pill bg=\"secondary\">\r\n                {/* className={`text-info ${numOfTags === 0 ? 'd-none' : 'd-inline'}`} */}\r\n                {name}\r\n            </Badge>\r\n\r\n            {/* <Button\r\n                variant='link'\r\n                size=\"sm\"\r\n                className={`py-0 mx-0 text-decoration-none text-secondary ${(inViewing || inEditing) ? 'fw-bold' : ''}`}\r\n                title={`id:${id!.toString()}`}\r\n                onClick={() => onSelectTag(id!)}\r\n                disabled={alreadyAdding}\r\n            >\r\n                {name}\r\n            </Button> */}\r\n\r\n            {/* {canEdit && !alreadyAdding && hovering &&\r\n                <Button variant='link' size=\"sm\" className=\"ms-1 py-0 px-1 text-secondary\"\r\n                    //onClick={() => { dispatch({ type: ActionTypes.EDIT, tag }) }}>\r\n                    onClick={() => edit(_id!)}\r\n                >\r\n                    <FontAwesomeIcon icon={faEdit} size='lg' />\r\n                </Button>\r\n            } */}\r\n\r\n            {canEdit && !alreadyAdding && hovering &&\r\n                <Button variant='link' size=\"sm\" className=\"ms-0 py-0 mx-0 text-secondary\"\r\n                    onClick={del}\r\n                >\r\n                    <FontAwesomeIcon icon={faRemove} size='sm' />\r\n                </Button>\r\n            }\r\n\r\n            {false && canEdit && !alreadyAdding && hovering &&\r\n                <Button\r\n                    variant='link'\r\n                    size=\"sm\"\r\n                    className=\"ms-2 py-0 mx-1 text-secondary\"\r\n                    title=\"Add Tag\"\r\n                    onClick={() => {\r\n                        console.log('click q')\r\n                        //const categoryInfo: ICategoryInfo = { categoryKey: { topId, parentId, id }, level }\r\n                        //dispatch({ type: ActionTypes.ADD_ANSWER, payload: { categoryInfo } })\r\n                    }}\r\n                >\r\n                    <FontAwesomeIcon icon={faPlus} size='lg' />\r\n                    <FontAwesomeIcon icon={faThumbsUp} size='lg' style={{ marginLeft: '-5px' }} />\r\n                </Button>\r\n            }\r\n        </div>\r\n\r\n    return (\r\n\r\n        <div className=\"py-1 px-1\">\r\n            {inAdding && categoryInAdding && state.formMode === FormMode.AddingVariation\r\n                ? (\r\n                    // <AddTag tag={tag} inLine={true} showCloseButton={true} />\r\n                    <span>add tag</span>\r\n                )\r\n                : ((inEditing && state.formMode === FormMode.EditingVariation) ||\r\n                    (inViewing && state.formMode === FormMode.ViewingVariation)) ? (\r\n                    <>\r\n                        {/* <div class=\"d-lg-none\">hide on lg and wider screens</div> */}\r\n                        <div id='div-tag' className=\"ms-0 d-md-none w-100\">\r\n                            {/* {inEditing && <EditTag inLine={true} />}\r\n                            {inViewing && <ViewTag inLine={true} />} */}\r\n                        </div>\r\n                        <div className=\"d-none d-md-block\">\r\n                            {Row1}\r\n                        </div>\r\n                    </>\r\n                )\r\n                    : (\r\n                        Row1\r\n                    )\r\n            }\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default VariationRow;\r\n","import { useEffect } from \"react\";\r\nimport type { ICategoryKey, IVariation } from \"@/categories/types\";\r\nimport { useCategoryContext } from \"@/categories/CategoryProvider\";\r\n// import { useGlobalState } from \"@/global/GlobalProvider\";\r\n//import { List, ListItem, Loading } from \"common/components/InfiniteList\";\r\nimport VariationRow from \"@/categories/VariationRow\";\r\nimport { Stack } from \"react-bootstrap\";\r\n\r\nconst VariationList = ({ categoryKey, variations }: { categoryKey: ICategoryKey, variations: IVariation[] }) => {\r\n\r\n  //const { canEdit } = useGlobalState();\r\n\r\n  const { state } = useCategoryContext();\r\n  const { error } = state; // topRows: categories,\r\n\r\n\r\n  //const group = categories.find(c => c.id === parentId)!\r\n  // const { tags, numOfTags, hasMore } = group;\r\n\r\n  useEffect(() => {\r\n  }, [])\r\n\r\n\r\n  // useEffect(() => {\r\n  //   if (groupId != null) {\r\n  //     if (groupId === parentId!.toString() && tagId) {\r\n  //       setTimeout(() => {\r\n  //         if (canEdit)\r\n  //           editTag(parseInt(tagId))\r\n  //         else\r\n  //           viewTag(parseInt(tagId))\r\n  //       }, 3000)\r\n  //     }\r\n  //   }\r\n  // }, [viewTag, parentId, groupId, tagId, canEdit]);\r\n\r\n  // console.log('TagList render', tags, level)\r\n\r\n  return (\r\n    <div\r\n      className=\"ms-2\"\r\n    // className=\"max-h-[500px] max-w-[500px] overflow-auto bg-slate-100\"\r\n    // style={{ overflowX: 'auto' }}\r\n    >\r\n      <Stack direction=\"horizontal\" gap={2}>\r\n        {variations.length === 0 &&\r\n          <div>No</div>\r\n        }\r\n        {variations.length > 0 &&\r\n          variations.map((tag: IVariation) => {\r\n            return <VariationRow\r\n              categoryKey={categoryKey}\r\n              tag={tag}\r\n              categoryInAdding={undefined}\r\n            />\r\n          })}\r\n      </Stack>\r\n      {error && <p>Error: {error.message}</p>}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default VariationList;\r\n","import { useEffect, useRef, type ChangeEvent, type FormEvent, useState } from \"react\";\r\nimport * as Yup from \"yup\";\r\nimport { useFormik } from \"formik\";\r\nimport { Form, CloseButton, Row, Stack } from \"react-bootstrap\";\r\nimport { CreatedModifiedForm } from \"@/common/CreateModifiedForm\"\r\nimport { FormButtons } from \"@/common/FormButtons\"\r\nimport type { ICategoryFormProps, ICategory, IVariation, ICategoryKey } from \"@/categories/types\";\r\nimport { FormMode, CategoryKey } from \"@/categories/types\";\r\n\r\nimport { useCategoryContext } from \"@/categories/CategoryProvider\";\r\nimport QuestionList from \"@/categories/components/questions/QuestionList\";\r\nimport VariationList from \"@/categories/VariationList\";\r\nimport { Select } from \"@/common/components/Select\";\r\nimport { kindOptions } from \"@/common/Options\";\r\nimport { useDebounce } from \"@uidotdev/usehooks\";\r\n\r\nconst CategoryForm = ({ formMode, category, cancel, close, submitForm, children }: ICategoryFormProps) => {\r\n\r\n  //const { globalState } = useGlobalContext();\r\n  //const { isDarkMode, variant, bg } = globalState;\r\n\r\n  const { onCategoryTitleChanged } = useCategoryContext();\r\n\r\n  const viewing = formMode === FormMode.ViewingCategory;\r\n  const editing = formMode === FormMode.EditingCategory;\r\n  const adding = formMode === FormMode.AddingCategory;\r\n\r\n  const { topId, id, variations, questionRows, title: catTitle } = category;\r\n  console.log('CategoryForm render: ', { topId, id, catTitle, formMode, variations })\r\n  const categoryKey: ICategoryKey = new CategoryKey(category).categoryKey!;\r\n  //const categoryKeyExpanded: IQuestionKey = { topId, id, questionId };\r\n\r\n  if (!document.getElementById('div-details')) {\r\n\r\n  }\r\n  const showQuestions = questionRows && questionRows.length > 0 //!questions.find(q => q.inAdding);\r\n  /* \r\n  We have, at two places:\r\n    <EditCategory inLine={true} />\r\n    <EditCategory inLine={false} />\r\n    so we execute loadCategoryQuestions() twice in QuestionList, but OK\r\n  */\r\n\r\n  //const dispatch = useCategoryDispatch();\r\n\r\n  const closeForm = () => {\r\n    //dispatch({ type: ActionTypes.CLOSE_CATEGORY_FORM, payload: {} })\r\n    close();\r\n  }\r\n\r\n  const cancelForm = () => {\r\n    cancel();\r\n    //dispatch({ type: ActionTypes.CANCEL_CATEGORY_FORM, payload: {} })\r\n  }\r\n\r\n  const [searchTerm, setSearchTerm] = useState(catTitle);\r\n  const debouncedSearchTerm = useDebounce(searchTerm, 300);\r\n\r\n  const formik = useFormik({\r\n    enableReinitialize: true,\r\n    initialValues: category,\r\n    validationSchema: Yup.object().shape({\r\n      title: Yup.string().required(\"Required\"),\r\n      // email: Yup.string()\r\n      //   .email(\"You have enter an invalid email address\")\r\n      //   .required(\"Required\"),\r\n      // rollno: Yup.number()\r\n      //   .positive(\"Invalid roll number\")\r\n      //   .integer(\"Invalid roll number\")\r\n      //   .required(\"Required\"),\r\n    }),\r\n    onSubmit: (values: ICategory) => {\r\n      //alert(JSON.stringify(values, null, 2));\r\n      console.log('CategoryForm.onSubmit', JSON.stringify(values, null, 2))\r\n      submitForm(values);\r\n      //props.handleClose(false);\r\n      setSearchTerm(values.title);\r\n    }\r\n  });\r\n\r\n  useEffect(() => {\r\n    const goBre = async () => {\r\n      console.log('CategoryForm.useEffect - onCategoryTitleChanged', { debouncedSearchTerm, title: formik.values.title });\r\n      if (/*debouncedSearchTerm &&*/ formik.values.title !== debouncedSearchTerm) {\r\n        /*await*/ onCategoryTitleChanged(topId, id, formik.values.title);\r\n      }\r\n    };\r\n    goBre();\r\n  }, [debouncedSearchTerm, formik.values.title, onCategoryTitleChanged]);\r\n\r\n  const handleChangeTitle = (event: ChangeEvent<HTMLTextAreaElement>) => {\r\n    formik.handleChange(event);\r\n    const value = event.target.value;\r\n    //if (value !== debouncedTitle)\r\n    //setTitle(value);\r\n    setSearchTerm(value);\r\n  };\r\n\r\n  // eslint-disable-next-line no-self-compare\r\n  // const nameRef = useRef<HTMLAreaElement | null>(null);\r\n  const nameRef = useRef<HTMLTextAreaElement>(null);\r\n\r\n\r\n  //useEffect(() => {\r\n    //setTitle(category.title);\r\n    //nameRef.current!.focus()\r\n  //}, [nameRef])\r\n\r\n  const isDisabled = false;\r\n\r\n  console.log('CategoryForm render return: ', searchTerm);\r\n\r\n  return (\r\n    // data-bs-theme={`${isDarkMode ? 'dark' : 'light'}`}\r\n    <div className=\"form-wrapper p-2 category-form\" >\r\n      <CloseButton onClick={closeForm} className=\"float-end\" />\r\n      <Row className='text-center text-muted'>\r\n        <Form.Label>Category {viewing ? 'Viewing' : editing ? 'Editing' : 'Adding'}</Form.Label>\r\n      </Row>\r\n      <Form onSubmit={() => formik.handleSubmit} className=\"category-form\">\r\n\r\n        <Form.Group controlId=\"Variations\">\r\n          <Stack direction=\"horizontal\" gap={1}>\r\n            <div className=\"px-0\"><Form.Label>Variations:</Form.Label></div>\r\n            <div className=\"px-1 border border-1 border-secondary rounded\">\r\n              <VariationList\r\n                categoryKey={categoryKey}\r\n                variations={variations\r\n                  ? variations.map(variation => ({ name: variation } as IVariation))\r\n                  : []\r\n                }\r\n              />\r\n            </div>\r\n            <div className=\"ps-2\"><Form.Label>Kind:</Form.Label></div>\r\n            <div className=\"px-1 border border-1 border-secondary rounded\">\r\n              <Form.Group controlId=\"kind\">\r\n                {/* <Form.Label>Kind</Form.Label> */}\r\n                <Select\r\n                  id=\"kind\"\r\n                  name=\"kind\"\r\n                  options={kindOptions}\r\n                  onChange={(e: FormEvent<HTMLSelectElement>, value: any) => {\r\n                    e.preventDefault(); // ?\r\n                    formik.setFieldValue('kind', value)\r\n                    // .then(() => { if (editing) formik.submitForm() })\r\n                  }}\r\n                  value={formik.values.kind}\r\n                  disabled={isDisabled}\r\n                  classes=\"text-primary\"\r\n                />\r\n                <Form.Text className=\"text-danger\">\r\n                  {formik.touched.kind && formik.errors.kind ? (\r\n                    <div className=\"text-danger\">{formik.errors.kind}</div>\r\n                  ) : null}\r\n                </Form.Text>\r\n              </Form.Group>\r\n            </div>\r\n          </Stack>\r\n        </Form.Group>\r\n\r\n        <Form.Group controlId=\"title\">\r\n          <Form.Label>Title</Form.Label>\r\n          <Form.Control\r\n            as=\"textarea\"\r\n            name=\"title\"\r\n            placeholder={\"new Category\"}\r\n            value={searchTerm}\r\n            onChange={handleChangeTitle}\r\n            onFocus={(e) => { if (formMode === FormMode.AddingCategory) e.target.select()}}\r\n            ref={nameRef}\r\n            //onChange={handleChangeTitle}\r\n            // onChange={(e: any, value: any): {e: ChangeEvent<HTMLTextAreaElement>, value: string} => {\r\n            //         formik.handleChange(e, value);\r\n            //         console.log(value)\r\n            //       }}\r\n            //onBlur={formik.handleBlur}\r\n            // onBlur={(e: React.FocusEvent<HTMLTextAreaElement>): void => {\r\n            //   if (isEdit && formik.initialValues.title !== formik.values.title)\r\n            //     formik.submitForm();\r\n            // }}\r\n            rows={3}\r\n            className=\"text-primary w-100\"\r\n            disabled={viewing}\r\n          />\r\n          <Form.Text className=\"text-danger\">\r\n            {formik.touched.title && formik.errors.title ? (\r\n              <div className=\"text-danger\">{formik.errors.title}</div>\r\n            ) : null}\r\n          </Form.Text>\r\n        </Form.Group>\r\n\r\n\r\n        <Form.Group controlId=\"link\">\r\n          <Form.Label>Link</Form.Label>\r\n          {formik.values.hasSubCategories\r\n            ? <Form.Control\r\n              as=\"input\"\r\n              placeholder=\"/categories/...\"\r\n              name=\"link\"\r\n              onChange={formik.handleChange}\r\n              //onBlur={formik.handleBlur}\r\n              // onBlur={(e: React.FocusEvent<HTMLTextAreaElement>): void => {\r\n              //   if (isEdit && formik.initialValues.title !== formik.values.title)\r\n              //     formik.submitForm();\r\n              // }}\r\n              className=\"text-primary w-100\"\r\n              value={\"Can't have link (has sub categories)\"}\r\n              disabled={true}\r\n            />\r\n            : <>\r\n              <Form.Control\r\n                as=\"input\"\r\n                placeholder=\"/categories/...\"\r\n                name=\"link\"\r\n                onChange={formik.handleChange}\r\n                //onBlur={formik.handleBlur}\r\n                // onBlur={(e: React.FocusEvent<HTMLTextAreaElement>): void => {\r\n                //   if (isEdit && formik.initialValues.title !== formik.values.title)\r\n                //     formik.submitForm();\r\n                // }}\r\n                className=\"text-primary w-100\"\r\n                value={formik.values.link ?? ''}\r\n                disabled={viewing}\r\n              />\r\n              <Form.Text className=\"text-danger\">\r\n                {formik.touched.link && formik.errors.link ? (\r\n                  <div className=\"text-danger\">{formik.errors.link}</div>\r\n                ) : null}\r\n              </Form.Text>\r\n            </>\r\n          }\r\n        </Form.Group>\r\n\r\n        {/* <Form.Group>\r\n          <Form.Label>Number of Questions </Form.Label>\r\n          <div className=\"text-secondary\">{formik.values.numOfQuestions}</div>\r\n          // <div className=\"p-1 bg-dark text-white\">{createdBy}, {formatDate(created.date)}</div> \r\n        </Form.Group> */}\r\n\r\n        <Form.Group>\r\n          <Form.Label className=\"m-1 mb-0\">Questions ({`${formik.values.numOfQuestions}`}) </Form.Label>\r\n          {showQuestions &&\r\n            <QuestionList categoryRow={category} />  // ICategory extends ICategoryRow\r\n          }\r\n        </Form.Group>\r\n\r\n        {(viewing || editing) &&\r\n          <CreatedModifiedForm\r\n            created={category.created}\r\n            modified={category.modified}\r\n            classes=\"text-primary\"\r\n          />\r\n        }\r\n\r\n        {((formik.dirty && editing) || adding) &&\r\n          <FormButtons\r\n            cancelForm={cancelForm}\r\n            handleSubmit={formik.handleSubmit}\r\n            title={children}\r\n          />\r\n        }\r\n      </Form>\r\n    </div >\r\n  );\r\n};\r\n\r\nexport default CategoryForm;","import { useCategoryContext } from '@/categories/CategoryProvider'\r\nimport { useGlobalState } from '@/global/GlobalProvider'\r\n\r\nimport CategoryForm from \"@/categories/components/CategoryForm\";\r\nimport { FormMode, type ICategory } from \"@/categories/types\";\r\n\r\nconst EditCategory = ({ inLine }: { inLine: boolean }) => {\r\n    const globalState = useGlobalState();\r\n    const { nickName } = globalState.authUser;\r\n\r\n    const { state, cancelAddCategory, updateCategory } = useCategoryContext();\r\n\r\n    const { activeCategory, keyExpanded } = state;\r\n    const { questionId } = keyExpanded!;\r\n\r\n\r\n    const cancel = async () => {\r\n        await cancelAddCategory();\r\n    }\r\n\r\n    const close = async () => {\r\n        await cancelAddCategory();\r\n    }\r\n\r\n    const submitForm = async (categoryObject: ICategory) => {\r\n        const object: ICategory = {\r\n            ...categoryObject,\r\n            created: undefined,\r\n            modified: {\r\n                time: new Date(),\r\n                nickName: nickName\r\n            }\r\n        }\r\n        await updateCategory(object, true /* closeForm */)\r\n    };\r\n\r\n    return (\r\n        <CategoryForm\r\n            inLine={inLine}\r\n            category={{ ...activeCategory! }}\r\n            questionId={questionId}\r\n            formMode={FormMode.EditingCategory}\r\n            cancel={cancel}\r\n            close={close}\r\n            submitForm={submitForm}\r\n        >\r\n            Update Category\r\n        </CategoryForm>\r\n    );\r\n};\r\n\r\nexport default EditCategory;\r\n","\r\nimport { useCategoryContext } from '@/categories/CategoryProvider'\r\n\r\nimport { FormMode } from \"@/categories/types\";\r\nimport CategoryForm from \"@/categories/components/CategoryForm\";\r\n\r\nconst ViewCategory = ({ inLine }: { inLine: boolean }) => {\r\n    const { state, cancelAddCategory } = useCategoryContext();\r\n    const { activeCategory, keyExpanded } = state;\r\n    const { questionId } = keyExpanded!;\r\n\r\n    \r\n    const close = async () => {\r\n        await cancelAddCategory();\r\n    }\r\n\r\n    return (\r\n        <CategoryForm\r\n            inLine={inLine}\r\n            category={{ ...activeCategory! }}\r\n            questionId={questionId}\r\n            formMode={FormMode.ViewingCategory}\r\n            close={close}\r\n            cancel={close}\r\n            submitForm={() => { }}\r\n        >\r\n            View Category\r\n        </CategoryForm>\r\n    );\r\n}\r\n\r\nexport default ViewCategory;\r\n","import { useState } from \"react\";\r\nimport { useCategoryContext } from '@/categories/CategoryProvider'\r\nimport { useGlobalState } from '@/global/GlobalProvider'\r\n\r\nimport CategoryForm from \"@/categories/components/CategoryForm\";\r\nimport { FormMode, type ICategory } from \"@/categories/types\";\r\n\r\nconst AddCategory = ({ activeCategory }: { activeCategory: ICategory | null }) => {\r\n    const globalState = useGlobalState();\r\n    const { nickName } = globalState.authUser;\r\n    const { cancelAddCategory, createCategory } = useCategoryContext();\r\n    //const { activeCategory } = state;\r\n\r\n    const [formValues] = useState<ICategory>({ ...activeCategory! });\r\n\r\n\r\n    const cancel = async () => {\r\n        await cancelAddCategory();\r\n    }\r\n\r\n    const close = async () => {\r\n        await cancelAddCategory();\r\n    }\r\n\r\n\r\n    const submitForm = async (category: ICategory) => {\r\n        const cat: ICategory = {\r\n            ...category,\r\n            created: {\r\n                time: new Date(),\r\n                nickName: nickName\r\n            },\r\n            modified: undefined\r\n        }\r\n        console.log(\"**********object\", cat)\r\n        await createCategory(cat);\r\n    }\r\n    if (!activeCategory === null)\r\n        return null;\r\n\r\n    console.log('AddCategory render >>>>>:', activeCategory);\r\n    return (\r\n        <>\r\n            {/* {inLine ?\r\n                <InLineCategoryForm\r\n                    inLine={true}\r\n                    category={formValues}\r\n                    mode={FormMode.adding}\r\n                    submitForm={submitForm}\r\n                >\r\n                    Create\r\n                </InLineCategoryForm>\r\n                : */}\r\n            <CategoryForm\r\n                inLine={false}\r\n                category={formValues}\r\n                questionId={null}\r\n                formMode={FormMode.AddingCategory}\r\n                cancel={cancel}\r\n                close={close}\r\n                submitForm={submitForm}\r\n            >\r\n                Create Category\r\n            </CategoryForm >\r\n            {/* } */}\r\n        </>\r\n    )\r\n}\r\n\r\nexport default AddCategory\r\n","import { useEffect, useState } from 'react';\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\nimport { faRemove, faCaretRight, faCaretDown, faPlus, faFolder } from '@fortawesome/free-solid-svg-icons'\r\nimport QPlus from '@/assets/QPlus.png';\r\n\r\nimport { ListGroup, Button, Badge, Collapse } from \"react-bootstrap\";\r\n\r\nimport { useGlobalState } from '@/global/GlobalProvider'\r\nimport { type ICategoryKey, type ICategoryRow, FormMode, type IExpandInfo, CategoryKey } from \"@/categories/types\";\r\nimport { useCategoryContext, } from '@/categories/CategoryProvider'\r\n\r\nimport { useHover } from \"@uidotdev/usehooks\";\r\n\r\nimport CategoryList from \"@/categories/components/CategoryList\";\r\nimport EditCategory from \"@/categories/components/EditCategory\";\r\nimport ViewCategory from \"@/categories/components/ViewCategory\";\r\nimport QuestionList from './questions/QuestionList';\r\nimport AddCategory from './AddCategory';\r\n\r\nconst CategoryRow = ({ categoryRow, questionId }: { categoryRow: ICategoryRow, questionId: string | null }) => {\r\n\r\n    const { id, title, hasSubCategories, numOfQuestions, isExpanded, categoryRows } = categoryRow;\r\n    categoryRow.level += 1;\r\n\r\n    const categoryKey: ICategoryKey = new CategoryKey(categoryRow).categoryKey!;\r\n\r\n    // const [categoryKey] = useState<ICategoryKey>({ topId, id }); // otherwise reloads\r\n    // const [catKeyExpanded] = useState<IQuestionKey>({ topId, id, questionId }); // otherwise reloads\r\n\r\n    const { canEdit, authUser } = useGlobalState();\r\n\r\n    const { state, addCategory, viewCategory, editCategory, deleteCategory, expandCategory, collapseCategory, addQuestion } = useCategoryContext();\r\n    //const dispatch = useCategoryDispatch();\r\n\r\n    let { formMode, activeCategory, loadingCategory, categoryLoaded } = state;\r\n    const isSelected = activeCategory !== null && (activeCategory.id === id);\r\n\r\n    const inAdding = formMode === FormMode.AddingCategory;\r\n    // TODO proveri ovo\r\n    const showQuestions = isExpanded && numOfQuestions > 0 // || questions.find(q => q.inAdding) // && !questions.find(q => q.inAdding); // We don't have questions loaded\r\n\r\n    const deleteCategoryRow = () => {\r\n        categoryRow.modified = {\r\n            time: new Date(),\r\n            nickName: authUser.nickName\r\n        }\r\n        deleteCategory(categoryRow);\r\n    };\r\n\r\n    const handleExpandClick = async () => {\r\n        if (isExpanded) {\r\n            await collapseCategory(categoryRow);\r\n        }\r\n        else {\r\n            const expandInfo: IExpandInfo = {\r\n                categoryKey\r\n            }\r\n            await expandCategory(expandInfo);\r\n        }\r\n    }\r\n\r\n    // const edit = async () => {\r\n    //     // Load data from server and reinitialize category\r\n    //     await editCategory(categoryRow, questionId ?? 'null');\r\n    // }\r\n\r\n    const [open, setOpen] = useState<boolean>(false);\r\n    useEffect(() => {\r\n        //if (categoryRows.length > 0) \r\n        setOpen(true);\r\n    }, [categoryRows]);\r\n\r\n    const onSelectCategory = async (): Promise<any> => {\r\n        if (canEdit)\r\n            await editCategory(categoryRow, questionId ?? 'null');\r\n        else\r\n            await viewCategory(categoryRow, questionId ?? 'null');\r\n    }\r\n\r\n    const [queue, setQueue] = useState<boolean>(false);\r\n\r\n    useEffect(() => {\r\n        if (queue) {// && categoryRow.id === _generateId) {\r\n            addCategory(categoryRow);\r\n            setQueue(false);\r\n        }\r\n    }, [addCategory, categoryRow, queue]);\r\n\r\n\r\n    const [queue2, setQueue2] = useState<boolean>(false);\r\n    useEffect(() => {\r\n        if (queue2) {// && categoryRow.id === _generateId) {\r\n            // actegoryRow is after reducer update\r\n            addQuestion(categoryKey, isExpanded ?? false);\r\n            setQueue2(false);\r\n        }\r\n    }, [addQuestion, categoryKey, isExpanded, queue2]);\r\n\r\n\r\n    useEffect(() => {\r\n        (async () => {\r\n            if (isSelected && !loadingCategory && !categoryLoaded && !inAdding) {\r\n                console.log('CategoryRow formMode:', formMode)\r\n                switch (formMode) {\r\n                    case FormMode.ViewingCategory:\r\n                        await viewCategory(categoryRow, questionId ?? 'null');\r\n                        break;\r\n                    case FormMode.EditingCategory:\r\n                        canEdit\r\n                            ? await editCategory(categoryRow, questionId ?? 'null')\r\n                            : await viewCategory(categoryRow, questionId ?? 'null');\r\n                        break;\r\n                }\r\n            }\r\n        })()\r\n    }, [canEdit, categoryKey, categoryLoaded, categoryRow, editCategory, expandCategory, formMode, inAdding, isSelected, loadingCategory, questionId, viewCategory]);\r\n\r\n    const [hoverRef, hovering] = useHover();\r\n    //console.log(\"..........................: \", document.querySelectorAll(`#Row${id}`)!.length);\r\n\r\n    const Row1 =\r\n        <div>\r\n            <div id={`Row${id}`}\r\n                className={`d-relative d-flex justify-content-start align-items-center w-100 mt-1 category-row  ${isSelected ? 'selected' : ''}`}\r\n                style={{ marginTop: '1px' }} >\r\n                <Button\r\n                    variant='link'\r\n                    size=\"sm\"\r\n                    className=\"py-0 px-1\" //  bg-light\"\r\n                    aria-controls={id + '-2'}\r\n                    aria-expanded={open}\r\n                    onClick={(e) => { handleExpandClick(); e.stopPropagation() }}\r\n                    title=\"Expand\"\r\n                    disabled={inAdding || (!hasSubCategories && numOfQuestions === 0)}\r\n                >\r\n                    <FontAwesomeIcon icon={isExpanded ? faCaretDown : faCaretRight} size='lg' />\r\n                </Button>\r\n                <Button\r\n                    variant='link'\r\n                    size=\"sm\"\r\n                    className=\"py-0 px-1 bg-light\"\r\n                    // onClick={expand}\r\n                    title=\"Expand\"\r\n                    disabled={true} //{alreadyAdding || (!hasSubCategories && numOfQuestions === 0)}\r\n                >\r\n                    <FontAwesomeIcon icon={faFolder} size='sm' />\r\n                </Button>\r\n                <Button\r\n                    variant='link'\r\n                    size=\"sm\"\r\n                    className={`py-0 ms-0 me-1 title ${isSelected ? 'fw-bold text-white bg-transparent' : ''}`}\r\n                    title={id}\r\n                    onClick={onSelectCategory}\r\n                    disabled={inAdding}\r\n                >\r\n                    {title}\r\n                    {/* &nbsp;<span>{formMode.substring(0, 3)}</span>&nbsp;<span>{hovering?'hov':'jok'}</span> */}\r\n                </Button>\r\n\r\n                {numOfQuestions > 0 &&\r\n                    <Badge pill bg=\"secondary\" className={'d-inline bg-transparent'}>\r\n                        {numOfQuestions}Q\r\n                        {/* <FontAwesomeIcon icon={faQuestion} size='sm' /> */}\r\n                        {/* <img width=\"22\" height=\"18\" src={Q} alt=\"Question\" /> */}\r\n                    </Badge>\r\n                }\r\n\r\n                {!inAdding && canEdit && hovering && //numOfQuestions === 0 &&\r\n                    <div className=\"position-absolute text-nowrap d-flex align-items-center border border-0 border-warning p-0 end-0\">\r\n                        {numOfQuestions === 0 &&\r\n                            <div className=\"d-flex align-items-center\">\r\n                                <Button\r\n                                    variant='link'\r\n                                    size=\"sm\"\r\n                                    className=\"border-0 py-0 px-0 ms-0 text-success\"\r\n                                    title=\"Add SubCategory\"\r\n                                    onClick={async () => {\r\n                                        //dispatch({ type: ActionTypes.CLOSE_CATEGORY_FORM, payload: {} })\r\n                                        if (!isExpanded && (hasSubCategories || numOfQuestions > 0)) {\r\n                                            await handleExpandClick();\r\n                                        }\r\n                                        setTimeout(() => setQueue(true), 1000);\r\n                                    }}\r\n                                >\r\n                                    <FontAwesomeIcon icon={faPlus} size='lg' />\r\n                                </Button>\r\n                            </div>\r\n                        }\r\n\r\n                        {!hasSubCategories &&\r\n                            // top-0 end-0\r\n                            <div className=\"d-flex align-items-end\">\r\n                                <Button\r\n                                    variant='link'\r\n                                    size=\"sm\"\r\n                                    // className=\"p-0 mx-0 text-secondary d-flex align-items-center border border-0 border-warning\"\r\n                                    className=\"d-flex align-items-end border border-0 border-warning p-0\"\r\n                                    title=\"Add Question\"\r\n                                    onClick={async () => {\r\n                                        //const categoryInfo: ICategoryInfo = { categoryKey: { workspace: topId, id: categoryRow.id }, level: categoryRow.level }\r\n                                        if (!isExpanded && (numOfQuestions > 0)) {\r\n                                            await handleExpandClick();\r\n                                        }\r\n                                        setTimeout(() => setQueue2(true), 500);\r\n                                    }}\r\n                                >\r\n                                    <img width=\"22\" height=\"18\" src={QPlus} alt=\"Add Question\" />\r\n                                </Button>\r\n\r\n                                {numOfQuestions === 0 && <Button variant='link' size=\"sm\"\r\n                                    className=\"d-flex align-items-end border border-0 border-warning p-0\"\r\n                                    disabled={hasSubCategories || numOfQuestions > 0}\r\n                                    onClick={deleteCategoryRow}\r\n                                >\r\n                                    <FontAwesomeIcon icon={faRemove} size='lg' />\r\n                                </Button>\r\n                                }\r\n                            </div>\r\n                        }\r\n                    </div>\r\n                }\r\n            </div>\r\n            {showQuestions &&\r\n                <div className='ps-3'>\r\n                    <QuestionList categoryRow={categoryRow} />\r\n                </div>\r\n            }\r\n        </div>\r\n\r\n    // console.log({ title, isExpanded })\r\n\r\n    // if (category.level !== 1)\r\n    //     return (<div>CategoryRow {category.id}</div>)\r\n\r\n    // console.log('categoryRow:', { isSelected, formMode, id})\r\n    return (\r\n        <>\r\n            <ListGroup.Item\r\n                // variant={\"primary\"}\r\n                className=\"py-0 px-1 w-100 category-bg\"\r\n                as=\"li\"\r\n            >\r\n                {isSelected && formMode === FormMode.AddingCategory &&\r\n                    <div>\r\n                        <div ref={hoverRef} className=\"\">\r\n                            {Row1}\r\n                        </div>\r\n                        {/* ms-0 d-md-none w-100 */}\r\n                        <div className=\"ms-0 d-md-none w-100\">\r\n                            <AddCategory activeCategory={activeCategory} />\r\n                        </div>\r\n                    </div>\r\n                }\r\n\r\n                {isSelected && formMode === FormMode.EditingCategory &&\r\n                    <>\r\n                        {/* <div class=\"d-none d-md-block\">\r\n                            This content will be hidden on small screens and below, \r\n                            but visible on medium screens and above.</div> */}\r\n                        <div ref={hoverRef}>\r\n                            {Row1}\r\n                        </div>\r\n                        {/* <div id='divInLine' className=\"ms-0 d-md-none w-100\"> */}\r\n                        <div id='divInLine' className=\"ms-0 d-md-none w-100\">\r\n                            <EditCategory inLine={false} />\r\n                        </div>\r\n                    </>\r\n                }\r\n\r\n                {isSelected && formMode === FormMode.ViewingCategory &&\r\n                    <>\r\n                        {/* <div class=\"d-lg-none\">hide on lg and wider screens</div> */}\r\n                        <div ref={hoverRef}>\r\n                            {Row1}\r\n                        </div>\r\n                        {/* <div id='divInLine' className=\"ms-0 d-md-none w-100\"> */}\r\n                        <div id='divInLine' className=\"ms-0 d-md-none w-100\">\r\n                            <ViewCategory inLine={false} />\r\n                        </div>\r\n                    </>\r\n                }\r\n\r\n                {isSelected && formMode === FormMode.None &&\r\n                    <>\r\n                        {/* <div class=\"d-lg-none\">hide on lg and wider screens</div> */}\r\n                        <div ref={hoverRef}>\r\n                            {Row1}\r\n                        </div>\r\n                        {/* <div id='divInLine' className=\"ms-0 d-md-none w-100\"> */}\r\n                        <div id='divInLine' className=\"ms-0 d-md-none w-100\">\r\n                            <ViewCategory inLine={false} />\r\n                        </div>\r\n                    </>\r\n                }\r\n\r\n                {!isSelected &&\r\n                    <div ref={hoverRef}>\r\n                        {Row1}\r\n                    </div>\r\n                }\r\n\r\n                {/* {isSelected &&\r\n                    <div className=\"d-none d-md-block\">\r\n                        {Row1}\r\n                    </div>\r\n                } */}\r\n\r\n\r\n            </ListGroup.Item>\r\n\r\n            {state.error && state.whichRowId === id && <div className=\"text-danger\">{state.error.message}</div>}\r\n\r\n            {/* !inAdding && */}\r\n            {(isExpanded) && // Row2   //  || inAdding\r\n                <ListGroup.Item\r\n                    className=\"py-0 px-0 border-0 border-warning border-bottom-0 category-bg p-0 m-0\" // border border-3 \"\r\n                    variant={\"primary\"}\r\n                    as=\"li\"\r\n                >\r\n                    <div className=\"rambo\">\r\n                        {hasSubCategories &&\r\n                            <Collapse in={open}>\r\n                                <div id={id + '-2'} style={{ marginTop: '1px' }}>\r\n                                    {/* Wrap content in a div to prevent choppy animations caused by margins/padding */}\r\n                                    <div style={{ border: '1px solid #ddd', borderRadius: '4px' }}>\r\n                                        <CategoryList categoryRow={categoryRow} isExpanded={isExpanded} />\r\n                                    </div>\r\n                                </div>\r\n                            </Collapse>\r\n                        }\r\n                        {/* {showQuestions &&\r\n                                <QuestionList categoryRow={categoryRow} />\r\n                            } */}\r\n                    </div>\r\n                </ListGroup.Item>\r\n            }\r\n        </>\r\n    );\r\n};\r\n\r\nexport default CategoryRow;\r\n","import { ListGroup } from \"react-bootstrap\";\r\nimport CategoryRow from \"@/categories/components/CategoryRow\";\r\nimport type { ICategoryRow, IParentInfo } from \"@/categories/types\";\r\nimport { useCategoryContext } from \"@/categories/CategoryProvider\";\r\n\r\nconst CategoryList = ({ categoryRow }: IParentInfo) => {\r\n\r\n    const { level, categoryRows} = categoryRow;\r\n\r\n    const { state } = useCategoryContext();\r\n    let { keyExpanded } = state;\r\n    const { questionId } = keyExpanded ?? { topId: '', categoryId: '', questionId: null };\r\n\r\n    return (\r\n        <div className={level! > 1 ? 'ms-2' : ''} >\r\n            <ListGroup as=\"ul\" variant='dark' className=\"mb-0 category-bg\">\r\n                {categoryRows!.map((c: ICategoryRow) =>\r\n                    <CategoryRow\r\n                        //categoryRow={{ ...c, isSelected: c.id === id }}\r\n                        categoryRow={c}\r\n                        questionId={questionId === '' ? null : questionId}\r\n                        // {c.topId === topId && c.id === id ? questionId : null}\r\n                        key={c.id}\r\n                    />\r\n                )}\r\n            </ListGroup>\r\n            {/* {state.error && state.error} */}\r\n            {/* {state.loading && <div>...loading</div>} */}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default CategoryList;\r\n","import { useEffect, useState } from 'react'\r\nimport { Modal } from \"react-bootstrap\";\r\n\r\nimport { type IQuestionRow } from \"./types\";\r\n\r\nimport { useGlobalState } from \"@/global/GlobalProvider\";\r\n//import { useCategoryDispatch } from \"./CategoryProvider\";\r\n\r\nimport AddQuestion from './components/questions/AddQuestion';\r\n\r\ninterface IProps {\r\n    show: boolean,\r\n    onHide: () => void;\r\n    newQuestionRow: IQuestionRow\r\n}\r\n\r\nconst ModalAddQuestion = (props: IProps) => {\r\n\r\n    const { isDarkMode } = useGlobalState();\r\n\r\n    // const handleClose = () => {\r\n    //     setShowAddQuestion(false);\r\n    // }\r\n\r\n    const [createQuestionError, setCreateQuestionError] = useState(\"\");\r\n\r\n    //const dispatch = useCategoryDispatch();\r\n\r\n    useEffect(() => {\r\n        (async () => {\r\n\r\n        })()\r\n    }, [])\r\n\r\n    return (\r\n        <Modal\r\n            show={props.show}\r\n            onHide={props.onHide}\r\n            animation={true}\r\n            centered\r\n            size=\"lg\"\r\n            className=\"modal show\"\r\n            contentClassName={`${isDarkMode ? \"bg-secondary bg-gradient\" : \"bg-info bg-gradient\"}`}\r\n        >\r\n            <Modal.Header closeButton>\r\n                Store new Question to the Database\r\n            </Modal.Header>\r\n            <Modal.Body className=\"py-0\">\r\n                <AddQuestion\r\n                    closeModal={props.onHide}\r\n                    showCloseButton={false}\r\n                    source={1} /*gmail*/\r\n                    setError={(msg) => setCreateQuestionError(msg)}\r\n                />\r\n            </Modal.Body>\r\n            <Modal.Footer>\r\n                {createQuestionError}\r\n            </Modal.Footer>\r\n        </Modal>\r\n    );\r\n};\r\n\r\nexport default ModalAddQuestion;","import { useEffect, useState } from 'react'\r\nimport { Container, Row, Col, Button } from \"react-bootstrap\";\r\n\r\nimport { useParams } from 'react-router-dom';\r\n\r\nimport { ActionTypes, type ICategoryKey, type IQuestionKey, FormMode } from \"./types\";\r\n\r\nimport { useGlobalContext, useGlobalState } from '@/global/GlobalProvider';\r\n\r\nimport { CategoryProvider, useCategoryContext, useCategoryDispatch } from \"./CategoryProvider\";\r\n\r\nimport CategoryList from \"@/categories/components/CategoryList\";\r\nimport ViewCategory from \"@/categories/components/ViewCategory\";\r\nimport EditCategory from \"@/categories/components/EditCategory\";\r\nimport ViewQuestion from \"@/categories/components/questions/ViewQuestion\";\r\nimport EditQuestion from \"@/categories/components/questions/EditQuestion\";\r\n\r\nimport { initialCategory, initialQuestion } from \"@/categories/CategoryReducer\";\r\nimport ModalAddQuestion from './ModalAddQuestion';\r\nimport AddCategory from './components/AddCategory';\r\nimport { AutoSuggestQuestions } from './AutoSuggestQuestions';\r\nimport AddQuestion from './components/questions/AddQuestion';\r\n\r\ninterface IProps {\r\n    categoryId_questionId?: string;\r\n    fromChatBotDlg?: string;\r\n}\r\n\r\n\r\n// const AutoSuggestQuestions = lazy(() =>\r\n//     import(\"@/categories/AutoSuggestQuestions\").then((module) => ({ default: module.AutoSuggestQuestions }))\r\n// );\r\n\r\nconst Providered = ({ categoryId_questionId, fromChatBotDlg }: IProps) => {\r\n    const { state, expandNodesUpToTheTree, loadTopRows, addCategory } = useCategoryContext();\r\n    const {\r\n        allCategoryRows, //allCategoryRowsLoaded,\r\n        topRows, topRowsLoading, topRowsLoaded,\r\n        keyExpanded,\r\n        categoryId_questionId_done,\r\n        nodeOpening, nodeOpened,\r\n        activeCategory,\r\n        activeQuestion,\r\n        formMode,\r\n        loadingCategories, loadingCategory,\r\n        loadingQuestions, loadingQuestion\r\n    } = state;\r\n\r\n    const { searchQuestions, setLastRouteVisited, setChatBotDlgEnabled } = useGlobalContext();\r\n    const { isDarkMode, chatBotDlgEnabled, lastRouteVisited } = useGlobalState();\r\n\r\n    const [modalShow, setModalShow] = useState(false);\r\n    // const handleClose = () => {\r\n    //     setModalShow(false);\r\n    // }\r\n\r\n    const [newQuestion, setNewQuestion] = useState({ ...initialQuestion });\r\n\r\n    const dispatch = useCategoryDispatch();\r\n\r\n    const onSelectQuestion = async (questionKey: IQuestionKey) => {\r\n        //navigate(`/categories/${questionKey.topId}_${questionKey.id}`)\r\n        dispatch({ type: ActionTypes.SET_QUESTION_SELECTED, payload: { questionKey } })\r\n    }\r\n\r\n\r\n    let tekst = '';\r\n\r\n    useEffect(() => {\r\n        (async () => {\r\n            if (!topRowsLoading && !topRowsLoaded) {\r\n                console.log('ZOVEM 111 loadTopRows()')\r\n                await loadTopRows();\r\n            }\r\n        })()\r\n    }, [topRowsLoading, topRowsLoaded, loadTopRows]);\r\n\r\n\r\n    useEffect(() => {\r\n        (async () => {\r\n            if (!nodeOpening && topRowsLoaded && topRows.length > 0) {\r\n                if (categoryId_questionId) {\r\n                    if (categoryId_questionId === 'add_question') {\r\n                        const sNewQuestion = localStorage.getItem('New_Question');\r\n                        if (sNewQuestion) {\r\n                            const q = JSON.parse(sNewQuestion);\r\n                            setNewQuestion({ ...initialQuestion, categoryTitle: 'Select', ...q })\r\n                            setModalShow(true);\r\n                            localStorage.removeItem('New_Question');\r\n                            return null;\r\n                        }\r\n                    }\r\n                    else if (categoryId_questionId !== categoryId_questionId_done) { //} && !nodeOpened) {\r\n                        const arr = categoryId_questionId.split('_');\r\n                        const categoryId = arr[0];\r\n                        const questionId = arr[1];\r\n                        const catKey: ICategoryKey = { topId: '', id: categoryId, parentId: 'ROOT' };\r\n                        console.log('zovem expandNodesUpToTheTree 1111111111111111111)', { categoryId_questionId }, { categoryId_questionId_done })\r\n                        await expandNodesUpToTheTree(catKey, questionId !== 'null' ? questionId : null, fromChatBotDlg === 'from_chat')\r\n                        console.log('zavrsio expandNodeUpToTheTree 1111111111111111111 DONE)', { categoryId_questionId })\r\n                    }\r\n                }\r\n                else if (keyExpanded && !nodeOpened) {\r\n                    const { topId, categoryId, questionId } = keyExpanded;\r\n                    if (categoryId !== '') {\r\n                        const catKey: ICategoryKey = { topId, id: categoryId, parentId: 'ROOT' }\r\n                        console.log('zovem expandNodeUpToTheTree 2222222222222)', { keyExpanded, catKey })\r\n                        await expandNodesUpToTheTree(catKey, questionId);\r\n                        console.log('zavrsio expandNodeUpToTheTree 2222222222222 DONE)')\r\n                    }\r\n                }\r\n\r\n                if (!chatBotDlgEnabled) // show ChatBotDlg button\r\n                    setChatBotDlgEnabled();\r\n            }\r\n        })()\r\n    }, [categoryId_questionId, categoryId_questionId_done, topRowsLoaded, keyExpanded, nodeOpening, nodeOpened, expandNodesUpToTheTree, fromChatBotDlg, chatBotDlgEnabled, setChatBotDlgEnabled]);\r\n\r\n    const route = `/knowledge/categories`;\r\n    useEffect(() => {\r\n        if (lastRouteVisited !== route)\r\n            setLastRouteVisited(route);\r\n    }, [lastRouteVisited, setLastRouteVisited]); \r\n\r\n    if (categoryId_questionId !== 'add_question') {\r\n        if (/*keyExpanded ||*/ (categoryId_questionId && categoryId_questionId !== categoryId_questionId_done)) {\r\n            console.log(\"zzzzzz loading...\", { keyExpanded, categoryId_questionId, categoryId_questionId_done })\r\n            return <div>loading...</div>\r\n        }\r\n    }\r\n\r\n    //if (!nodeOpened)\r\n    //if (!allCategoryRowsLoaded || !topRowsLoaded || topRows.length === 0) {\r\n    if (!topRowsLoaded) {// || topRows.length === 0) {\r\n        console.log('===>>> Categories  VRATIO')\r\n        return null\r\n    }\r\n\r\n    console.log('===>>> Categories !!!!!!!!!!!!!!!!!', activeCategory)\r\n\r\n    return (\r\n        <>\r\n            <Container>\r\n                <h5 className=\"text-warning mx-auto w-75 fw-bold\"><span className='categories'>Categories / </span><span className='questions'>Questions</span></h5>\r\n\r\n                <Row className={`${isDarkMode ? \"dark\" : \"\"}`}>\r\n                    <Col>\r\n                        <div className=\"d-flex justify-content-start align-items-center\">\r\n                            <div className=\"w-75 my-1 questions\">\r\n                                <AutoSuggestQuestions\r\n                                    tekst={tekst}\r\n                                    onSelectQuestion={onSelectQuestion}\r\n                                    allCategoryRows={allCategoryRows}\r\n                                    searchQuestions={searchQuestions}\r\n                                />\r\n                            </div>\r\n                        </div>\r\n                    </Col>\r\n                </Row>\r\n\r\n                <Button variant=\"secondary\" size=\"sm\" type=\"button\" style={{ padding: '1px 4px' }}\r\n                    onClick={\r\n                        () => addCategory(null)\r\n                    }\r\n                >\r\n                    Add Category\r\n                </Button>\r\n\r\n                <Row className=\"my-1 h-auto\">\r\n                    <Col xs={12} md={5}>\r\n                        <div className=\"categories-border\" style={{ position: 'relative' }}>\r\n                            <CategoryList categoryRow={{...initialCategory, categoryRows: topRows }}  isExpanded={true} />\r\n                        </div>\r\n                    </Col>\r\n                    <Col xs={0} md={7}>\r\n                        {/* visible on medium screens and above. */}\r\n                        <div id='div-details' className=\"d-none d-md-block\">\r\n                            {activeCategory && formMode === FormMode.ViewingCategory && <ViewCategory inLine={false} />}\r\n                            {activeCategory && formMode === FormMode.EditingCategory &&\r\n                                <EditCategory inLine={false} />\r\n                            }\r\n                            {activeCategory && formMode === FormMode.AddingCategory && <AddCategory activeCategory={activeCategory} />}\r\n\r\n                            {activeQuestion && formMode === FormMode.ViewingQuestion && <ViewQuestion inLine={false} />}\r\n                            {activeQuestion && formMode === FormMode.EditingQuestion &&\r\n                                <EditQuestion inLine={false} />\r\n                            }\r\n                            {activeQuestion && formMode === FormMode.AddingQuestion && <AddQuestion />}\r\n                        </div>\r\n                    </Col>\r\n                </Row>\r\n            </Container>\r\n            {modalShow && activeQuestion &&\r\n                <ModalAddQuestion\r\n                    show={modalShow}\r\n                    onHide={() => { setModalShow(false) }}\r\n                    newQuestionRow={newQuestion}\r\n                />\r\n            }\r\n\r\n            {(loadingCategories || loadingQuestions) &&\r\n                <div className=\"d-flex justify-content-center align-items-center\" style={{ position: 'absolute', top: '40%', left: '20%' }}>\r\n                    <div className={`spinner-border ${loadingQuestions ? 'question' : 'category'}-spinner`} role=\"status\">\r\n                        <span className=\"visually-hidden\">Loading...</span>\r\n                    </div>\r\n                </div>\r\n            }\r\n\r\n            {loadingCategory &&\r\n                <div className=\"d-flex justify-content-center align-items-center\" style={{ position: 'absolute', top: '50%', left: '50%' }}>\r\n                    <div className=\"spinner-border category-spinner\" role=\"status\">\r\n                        <span className=\"visually-hidden\">Loading...</span>\r\n                    </div>\r\n                </div>\r\n            }\r\n\r\n            {loadingQuestion &&\r\n                <div className=\"d-flex justify-content-center align-items-center\" style={{ position: 'absolute', top: '50%', left: '50%' }}>\r\n                    <div className=\"spinner-border question-spinner\" role=\"status\">\r\n                        <span className=\"visually-hidden\">Loading...</span>\r\n                    </div>\r\n                </div>\r\n            }\r\n        </>\r\n    );\r\n};\r\n\r\ntype Params = {\r\n    categoryId_questionId?: string;\r\n    fromChatBotDlg?: string;\r\n};\r\n\r\nconst Categories = () => {\r\n\r\n    let { categoryId_questionId, fromChatBotDlg } = useParams<Params>();\r\n\r\n    if (categoryId_questionId && categoryId_questionId === 'categories')\r\n        categoryId_questionId = undefined;\r\n\r\n    if (categoryId_questionId) {\r\n        const arr = categoryId_questionId!.split('_');\r\n        console.assert(arr.length === 2, \"expected 'categoryId_questionId'\")\r\n    }\r\n    // const globalState = useGlobalState();\r\n    // const { isAuthenticated } = globalState;\r\n\r\n    // if (!isAuthenticated)\r\n    //     return <div>categories loading...</div>;\r\n\r\n    return (\r\n        <CategoryProvider>\r\n            <Providered categoryId_questionId={categoryId_questionId} fromChatBotDlg={fromChatBotDlg} />\r\n        </CategoryProvider>\r\n    )\r\n}\r\n\r\nexport default Categories;\r\n\r\n"],"file":"Categories.js"}