{"version":3,"mappings":"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","names":["ChatBotAnswer","assignedAnswer","topId","id","answerTitle","answerLink","useAI","question","setQuestion","useState","index","setIndex","setNewQuestion","q","hasMoreAnswers","firstChatBotAnswer","assignedAnswers","getCurrQuestion","useCallback","getNextChatBotAnswer","len","i","ChatBotDlg","show","onHide","tekst","useParams","autoSuggestionValue","setAutoSuggestionValue","selectedQuestion","setSelectedQuestion","autoSuggestId","setAutoSuggestId","showAnswer","setShowAnswer","chatBotAnswer","setChatBotAnswer","setHasMoreAnswers","getSubCats","getQuestion","addHistory","addHistoryFilter","searchQuestions","useGlobalContext","authUser","isDarkMode","allCategoryRows","catsLoaded","useGlobalState","catsSelected","showAutoSuggest","setShowAutoSuggest","catLevels","setCatLevels","pastEvents","setPastEvents","ChildType","onEntering","parentId","res","subCats","parentHeader","prevState","scrollableRef","useRef","AutoSuggestQuestions","lazy","__vitePreload","module","jsx","onSelectQuestion","questionKey","underFilter","questionCurr","historyFilter","QuestionKey","props","prevEvents","questionEx","onAnswerFixed","prevHistory","history","getNextAnswer","next","nextChatBotAnswer","QuestionComponent","txt","jsxs","Q","AnswerComponent","isDisabled","link","A","Button","AutoSuggestComponent","Suspense","Offcanvas","Container","Row","Col","childProps"],"ignoreList":[],"sources":["../../src/hooks/useAI.tsx","../../src/ChatBotDlg.tsx"],"sourcesContent":["import { useCallback, useState } from \"react\";\r\n\r\nimport type { IAssignedAnswer, IQuestion, IQuestionKey } from '@/categories/types';\r\nimport { type IWhoWhen } from \"@/global/types\";\r\n\r\nexport interface IChatBotAnswer {\r\n  questionKey?: IQuestionKey;\r\n  topId: string;\r\n  id: string;\r\n  answerTitle: string;\r\n  answerLink: string | null;\r\n  created: IWhoWhen,\r\n  modified: IWhoWhen | null\r\n}\r\n\r\nclass ChatBotAnswer {\r\n  constructor(assignedAnswer: IAssignedAnswer) {\r\n    const { topId, id, answerTitle, answerLink } = assignedAnswer; // , created, modified\r\n    this.chatBotAnswer = {\r\n      topId,\r\n      id,\r\n      answerTitle: answerTitle ?? '',\r\n      answerLink: answerLink ?? '',\r\n      created: assignedAnswer.created!,\r\n      modified: assignedAnswer.modified!\r\n    }\r\n  }\r\n  chatBotAnswer: IChatBotAnswer\r\n}\r\n\r\n\r\nexport interface INewQuestion {\r\n  firstChatBotAnswer: IChatBotAnswer | null;\r\n  hasMoreAnswers: boolean;\r\n}\r\n\r\nexport interface INextAnswer {\r\n  nextChatBotAnswer: IChatBotAnswer | null; //undefined;\r\n  hasMoreAnswers: boolean;\r\n}\r\n\r\nexport const useAI = (/*categories: ICategory[]*/): [\r\n  (question: IQuestion) => Promise<INewQuestion>,\r\n  () => Promise<IQuestion | null>,\r\n  () => Promise<INextAnswer>] => {\r\n\r\n\r\n  const [question, setQuestion] = useState<IQuestion | null>(null);\r\n  const [index, setIndex] = useState<number>(0);\r\n\r\n  const setNewQuestion = async (q: IQuestion): Promise<INewQuestion> => {\r\n    setQuestion(q);\r\n    let hasMoreAnswers = false;\r\n    let firstChatBotAnswer: IChatBotAnswer | null = null;\r\n    if (q) {\r\n      const { assignedAnswers } = q;\r\n      if (assignedAnswers && assignedAnswers.length > 0) {\r\n        const assignedAnswer = assignedAnswers[0];\r\n        firstChatBotAnswer = new ChatBotAnswer(assignedAnswer).chatBotAnswer;\r\n        hasMoreAnswers = assignedAnswers.length > 1;\r\n        setIndex(0);\r\n      }\r\n    }\r\n    return { firstChatBotAnswer, hasMoreAnswers };\r\n  }\r\n\r\n  const getCurrQuestion = useCallback(\r\n    async (): Promise<IQuestion | null> => {\r\n      return question\r\n    }, [question]);\r\n\r\n\r\n  const getNextChatBotAnswer = useCallback(\r\n    async (): Promise<INextAnswer> => {\r\n      const { assignedAnswers } = question!;\r\n      const len = assignedAnswers.length;\r\n      const i = index + 1;\r\n      if (index + 1 < len) {\r\n        setIndex(i);\r\n        return {\r\n          nextChatBotAnswer: new ChatBotAnswer(assignedAnswers[i]).chatBotAnswer,\r\n          hasMoreAnswers: i + 1 < len\r\n        }\r\n      }\r\n      return { nextChatBotAnswer: null, hasMoreAnswers: false }\r\n    }, [question, index]);\r\n\r\n  return [setNewQuestion, getCurrQuestion, getNextChatBotAnswer]\r\n  // useCallback(setNewQuestion, []), \r\n  // useCallback(getCurrQuestion, [question]), \r\n  // useCallback(getNextChatBotAnswer, [question])\r\n}\r\n","import { useState, useRef, lazy, Suspense } from 'react';\r\nimport { Container, Row, Col, Button, Offcanvas } from \"react-bootstrap\";\r\n//import { useNavigate } from \"react-router-dom\";\r\n\r\nimport { useGlobalContext, useGlobalState } from '@/global/GlobalProvider';\r\n\r\nimport { useParams } from 'react-router-dom' // useRouteMatch\r\n//import { AutoSuggestQuestions } from '@/categories/AutoSuggestQuestions';\r\n\r\n// import { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\n// import { faFolder } from '@fortawesome/free-solid-svg-icons'\r\n\r\nimport { type ICategoryRow, type IQuestion, type IQuestionEx, type IQuestionKey, QuestionKey } from '@/categories/types';\r\nimport type { IHistory, IHistoryFilter } from '@/global/types';\r\nimport { type IChatBotAnswer, type INewQuestion, type INextAnswer, useAI } from '@/hooks/useAI'\r\n\r\nimport Q from '@/assets/Q.png';\r\nimport A from '@/assets/A.png';\r\n// import { useCategoryDispatch } from '@/categories/CategoryProvider';\r\n\r\ntype ChatBotParams = {\r\n    source: string;\r\n    tekst: string;\r\n    email?: string;\r\n};\r\n\r\ntype ICatLevel = {\r\n    level: number;\r\n    catId: string | null;\r\n    header: string;\r\n    subCats: ICategoryRow[];\r\n    subCatIdSelected: string | null;\r\n}\r\n\r\ninterface IProps {\r\n    show: boolean,\r\n    onHide: () => void;\r\n}\r\n\r\n\r\nconst ChatBotDlg = ({ show, onHide }: IProps) => {\r\n    let { tekst } = useParams<ChatBotParams>();\r\n    const [autoSuggestionValue, setAutoSuggestionValue] = useState(tekst!)\r\n    const [setNewQuestion, getCurrQuestion, getNextChatBotAnswer] = useAI(/*[]*/);\r\n    const [selectedQuestion, setSelectedQuestion] = useState<IQuestion | null>(null);\r\n    const [autoSuggestId, setAutoSuggestId] = useState<number>(1);\r\n    const [showAnswer, setShowAnswer] = useState(false);\r\n    const [chatBotAnswer, setChatBotAnswer] = useState<IChatBotAnswer | null>(null);\r\n    const [hasMoreAnswers, setHasMoreAnswers] = useState<boolean>(false);\r\n\r\n    const { getSubCats, getQuestion, addHistory, addHistoryFilter, searchQuestions } = useGlobalContext();\r\n    const { authUser, isDarkMode, allCategoryRowsGlobal: allCategoryRows, allCategoryRowsGlobalLoaded: catsLoaded } = useGlobalState();\r\n    //const navigate = useNavigate();\r\n\r\n    const [catsSelected] = useState(true);\r\n    const [showAutoSuggest, setShowAutoSuggest] = useState(true); //false);\r\n\r\n    const [catLevels, setCatLevels] = useState<ICatLevel[]>([]);\r\n\r\n    const [pastEvents, setPastEvents] = useState<IChild[]>([]);\r\n\r\n    enum ChildType {\r\n        AUTO_SUGGEST,\r\n        QUESTION,\r\n        ANSWER\r\n    }\r\n\r\n    interface IChild {\r\n        type: ChildType;\r\n        isDisabled: boolean;\r\n        txt: string,\r\n        link: string | null,\r\n        hasMoreAnswers?: boolean\r\n    }\r\n    // const deca: JSX.Element[] = [];\r\n    // useEffect(() => {\r\n    // \t(async () => {\r\n    // \t\t//await loadCats();\r\n    // \t})()\r\n    // }, [])\r\n\r\n    const onEntering = async (/*node: HTMLElement, isAppearing: boolean*/): Promise<any> => {\r\n        setCatLevels([]);\r\n        const parentId = 'MTS';\r\n        const res = await getSubCats(parentId);\r\n        const { subCats, parentHeader } = res;\r\n        setCatLevels((prevState) => ([\r\n            ...prevState,\r\n            {\r\n                level: 1,\r\n                catId: parentId,\r\n                header: parentHeader,\r\n                subCats,\r\n                subCatIdSelected: null\r\n            }\r\n        ]))\r\n        console.log(catLevels)\r\n\r\n    }\r\n\r\n    const scrollableRef = useRef<HTMLDivElement>(null);\r\n\r\n    // useEffect(() => {\r\n    //     scrollToBottom();\r\n    // }, []);\r\n\r\n    const AutoSuggestQuestions = lazy(() =>\r\n        // named export\r\n        import(\"@/categories/AutoSuggestQuestions\").then((module) => ({ default: module.AutoSuggestQuestions }))\r\n    );\r\n\r\n    if (!catsLoaded) // || catsOptions.length === 0)\r\n        return <div>cats not loaded...</div>\r\n\r\n    /*\r\n    const onOptionChange = async (id: string, level: number, title: string) => {//event: React.ChangeEvent<HTMLInputElement>) => {\r\n        //const target = event.target;\r\n        //const { id, name } = target;\r\n        //const value = type === 'checkbox' ? target.checked : target.value;\r\n        //const level = parseInt(name as any);\r\n        // update the last level\r\n        const prev = catLevels.map(catLevel => catLevel.level === level\r\n            ? {\r\n                ...catLevel,\r\n                subCatIdSelected: id,\r\n                header: title\r\n            }\r\n            : catLevel\r\n        )\r\n\r\n        const res = await getSubCats(id);\r\n        const { subCats, parentHeader } = res;\r\n\r\n        console.log('///////////////////////////////////////////////////// id:', id, subCats)\r\n        setCatLevels((prevState) => ([\r\n            ...prev,\r\n            {\r\n                level: level + 1,\r\n                catId: id,\r\n                header: parentHeader,\r\n                subCats,\r\n                subCatIdSelected: null\r\n            }\r\n        ]))\r\n        //setShowUsage(true);\r\n        // setCatOptions((prevState) => ({ \r\n        // \tstateName: prevState.stateName + 1 \r\n        // }))\r\n        // this.setState({\r\n        // \t [name]: value\r\n        // });\r\n    }\r\n    */\r\n\r\n    const onSelectQuestion = async (questionKey: IQuestionKey, underFilter: string) => {\r\n        const questionCurr = await getCurrQuestion();\r\n        if (questionCurr) {\r\n            console.log({ questionCurr })\r\n            const historyFilter: IHistoryFilter = {\r\n                questionKey: new QuestionKey(questionCurr).questionKey!,\r\n                filter: underFilter,\r\n                created: { time: new Date(), nickName: authUser.nickName }\r\n            }\r\n            await addHistoryFilter(historyFilter);\r\n        }\r\n        // navigate(`/categories/${categoryId}_${questionId.toString()}`)\r\n        // const question = await getQuestion(questionId);\r\n\r\n        // salji kasnije kad klikne na Fixed\r\n        /* TODO proveri\r\n        if (answer) {\r\n            const history: IHistory = {\r\n                questionId: questionKey.id,\r\n                answerId: answer.id,\r\n                fixed: undefined,\r\n                created: { \r\n                    nickName: authUser.nickName, \r\n                    time: new Date() \r\n                }\r\n            }\r\n            addHistory(history);\r\n        }\r\n        */\r\n        if (chatBotAnswer) {\r\n            const props: IChild = {\r\n                type: ChildType.ANSWER,\r\n                isDisabled: true,\r\n                txt: chatBotAnswer.answerTitle,\r\n                link: chatBotAnswer.answerLink\r\n            }\r\n            setPastEvents((prevEvents) => [...prevEvents, props]);\r\n        }\r\n\r\n        const questionEx: IQuestionEx = await getQuestion(questionKey);\r\n        const { question } = questionEx;\r\n        if (!question) {\r\n            //alert(questionEx.msg)\r\n            return;\r\n        }\r\n        if (question.numOfRelatedFilters > 0) {\r\n            setAutoSuggestionValue(question.relatedFilters[0].filter)\r\n        }\r\n\r\n        const res: INewQuestion = await setNewQuestion(question);\r\n        let { firstChatBotAnswer, hasMoreAnswers } = res; // as unknown as INewQuestion;\r\n\r\n        if (question) {\r\n            const props: IChild = {\r\n                type: ChildType.QUESTION,\r\n                isDisabled: true,\r\n                txt: question.title,\r\n                link: null\r\n            }\r\n            setPastEvents((prevEvents) => [...prevEvents, props]);\r\n        }\r\n\r\n        setAutoSuggestId((autoSuggestId) => autoSuggestId + 1);\r\n        setShowAutoSuggest(false);\r\n        setSelectedQuestion(question);\r\n        setShowAnswer(true);\r\n        setHasMoreAnswers(hasMoreAnswers);\r\n        //setAnswerId((answerId) => answerId + 1);\r\n        setChatBotAnswer(firstChatBotAnswer);\r\n        // // salji kasnije kad klikne na Fixed\r\n        // if (firstAnswer) {\r\n        // \taddHistory(dbp, {\r\n        // \t\tconversation: conv,\r\n        // \t\tclient: authUser.nickName,\r\n        // \t\tquestionId: question!.id!,\r\n        // \t\tanswerId: firstAnswer.id!,\r\n        // \t\tfixed: undefined,\r\n        // \t\tcreated: new Date()\r\n        // \t})\r\n        // }\r\n    }\r\n\r\n    const onAnswerFixed = async () => {\r\n        const props: IChild = {\r\n            type: ChildType.ANSWER,\r\n            isDisabled: true,\r\n            txt: chatBotAnswer ? chatBotAnswer.answerTitle : 'no answer title',\r\n            link: chatBotAnswer ? chatBotAnswer.answerLink : 'no answer link',\r\n            hasMoreAnswers: true\r\n        }\r\n        setPastEvents((prevHistory) => [...prevHistory, props]);\r\n\r\n        const history: IHistory = {\r\n            questionKey: new QuestionKey(selectedQuestion!).questionKey!,\r\n            assignedAnswerKey: { topId: chatBotAnswer!.topId, id: chatBotAnswer!.id },\r\n            userAction: 'Fixed',\r\n            created: {\r\n                nickName: authUser.nickName,\r\n                time: new Date()\r\n            }\r\n        }\r\n        addHistory(history);\r\n\r\n        //\r\n        // TODO logic \r\n        //\r\n\r\n        setHasMoreAnswers(false);\r\n        //setAnswerId((answerId) => answerId + 1);\r\n        setChatBotAnswer(chatBotAnswer); //undefined);\r\n        setShowAnswer(false);\r\n    }\r\n\r\n    const getNextAnswer = async () => {\r\n        // past events\r\n        const props: IChild = {\r\n            type: ChildType.ANSWER,\r\n            isDisabled: true,\r\n            txt: chatBotAnswer ? chatBotAnswer.answerTitle : 'no answer',\r\n            link: chatBotAnswer ? chatBotAnswer.answerLink : 'no link',\r\n            hasMoreAnswers: true\r\n        }\r\n        setPastEvents((prevHistory) => [...prevHistory, props]);\r\n\r\n        const next: INextAnswer = await getNextChatBotAnswer();\r\n        const { nextChatBotAnswer, hasMoreAnswers } = next;\r\n\r\n        if (chatBotAnswer) {\r\n            const history: IHistory = {\r\n                questionKey: new QuestionKey(selectedQuestion!).questionKey!,\r\n                assignedAnswerKey: { topId: chatBotAnswer.topId, id: chatBotAnswer.id },\r\n                userAction: nextChatBotAnswer ? 'NotFixed' : 'NotClicked',\r\n                created: {\r\n                    nickName: authUser.nickName,\r\n                    time: new Date()\r\n                }\r\n            }\r\n            addHistory(history);\r\n        }\r\n\r\n        // salji gore\r\n        // if (nextAnswer) {\r\n        // \taddHistory(dbp, {\r\n        // \t\tconversation,\r\n        // \t\tclient: authUser.nickName,\r\n        // \t\tquestionId: selectedQuestion!.id!,\r\n        // \t\tanswerId: nextAnswer.id!,\r\n        // \t\tfixed: hasMoreAnswers ? undefined : false,\r\n        // \t\tcreated: new Date()\r\n        // \t})\r\n        // }\r\n        setHasMoreAnswers(hasMoreAnswers);\r\n        //setAnswerId((answerId) => answerId + 1); PPP\r\n        console.log('----->>>>', { nextChatBotAnswer })\r\n        setChatBotAnswer(nextChatBotAnswer);\r\n    }\r\n\r\n    /*const NavigLink = (link: string) => {\r\n        //dispatch({ type: ActionTypes.RESET_CATEGORY_QUESTION_DONE })\r\n        //dispatch({ type: ActionTypes.CLEAN_SUB_TREE, payload: { categoryKey: null } });\r\n        // new CategoryKey(parentCat).categoryKey } });\r\n        setTimeout(() => {\r\n            navigate(link + \"/true\")\r\n        }, 100);\r\n    }\r\n    */\r\n\r\n\r\n    const QuestionComponent = (props: IChild) => {\r\n        const { txt } = props;\r\n        return (\r\n            <div id={autoSuggestId.toString()} className=\"d-flex flex-row mx-0 justify-content-start align-items-center\">\r\n                <div className=\"d-flex flex-row mx-0 justify-content-start align-items-center\">\r\n                    <img width=\"22\" height=\"18\" src={Q} alt=\"Question\" className='ms-1' />\r\n                    <div className=\"p-1 bg-warning text-light flex-wrap text-wrap border rounded-1\">{txt}</div>\r\n                </div>\r\n            </div>\r\n        )\r\n    }\r\n\r\n    const AnswerComponent = (props: IChild) => {\r\n        console.log('--------------------------------------AnswerComponent', props)\r\n        const { isDisabled, txt, link } = props;\r\n        return (\r\n            <div\r\n                // id={answerId.toString()}   PPP\r\n                id={chatBotAnswer?.id}\r\n                className={`${isDarkMode ? \"dark\" : \"light\"} mt-1 mx-1 border border-0 rounded-1`}\r\n            >\r\n                {/* <Row>\r\n                    <Col xs={12} md={12} className={`${isDisabled ? 'secondary' : 'primary'} d-flex justify-content-start align-items-center p-0`}> */}\r\n\r\n                <div className=\"d-flex flex-row mx-0 justify-content-start align-items-center\">\r\n                    <div className=\"d-flex flex-row mx-0 justify-content-start align-items-center\">\r\n                        <img width=\"22\" height=\"18\" src={A} alt=\"Answer\" className='ms-1' />\r\n                        {link\r\n                            ? <div className=\"p-1 bg-info text-light flex-wrap text-wrap border rounded-1 \">\r\n                                <a\r\n                                    href={link!}\r\n                                    rel=\"noopener noreferrer\"\r\n                                    target=\"_blank\"\r\n                                    className=\"text-light text-decoration-underline\"\r\n                                >\r\n                                    {txt}\r\n                                </a>\r\n                            </div>\r\n                            : <div className=\"p-1 bg-info text-light flex-wrap text-wrap border rounded-1\">\r\n                                {txt}\r\n                            </div>\r\n\r\n                        }\r\n                    </div>\r\n\r\n                    {!isDisabled && chatBotAnswer &&\r\n                        <div>\r\n                            <Button\r\n                                size=\"sm\"\r\n                                type=\"button\"\r\n                                onClick={onAnswerFixed}\r\n                                disabled={!chatBotAnswer}\r\n                                className='align-middle ms-1 px-1  py-0'\r\n                                variant=\"success\"\r\n                            >\r\n                                Fixed\r\n                            </Button>\r\n                            <Button\r\n                                size=\"sm\"\r\n                                type=\"button\"\r\n                                onClick={getNextAnswer}\r\n                                disabled={!chatBotAnswer}\r\n                                className='align-middle ms-1 border border-1 rounded-1 px-1 py-0'\r\n                                variant=\"danger\"\r\n                            >\r\n                                Not fixed\r\n                            </Button>\r\n                        </div>\r\n                    }\r\n                </div>\r\n\r\n                {/* <div className=\"d-flex flex-row flex-wrap mx-0\"> */}\r\n                {/* <div className=\"card card-block  bg-info text-light\">\r\n                                <div className=\"card-body p-0\">\r\n                                    <div className=\"card-text d-flex justify-content-start align-items-center\">\r\n                                        \r\n                                        \r\n                                        {link ? <a href={link} target=\"_blank\" className=\"text-reset text-decoration-none fw-lighter fs-6\" >{link}</a> : null}\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"card card-block  border-0\">\r\n                                <div className=\"card-body p-0 border-0\">\r\n                                    <div className=\"card-text\">\r\n                                        {!isDisabled && chatBotAnswer &&\r\n                                            <div>\r\n                                                <Button\r\n                                                    size=\"sm\"\r\n                                                    type=\"button\"\r\n                                                    onClick={onAnswerFixed}\r\n                                                    disabled={!chatBotAnswer}\r\n                                                    className='align-middle ms-1 p-0'\r\n                                                    variant=\"success\"\r\n                                                >\r\n                                                    Fixed\r\n                                                </Button>\r\n                                                <Button\r\n                                                    size=\"sm\"\r\n                                                    type=\"button\"\r\n                                                    onClick={getNextAnswer}\r\n                                                    disabled={!chatBotAnswer}\r\n                                                    className='align-middle ms-1 border border-1 rounded-1 p-0'\r\n                                                    variant=\"danger\"\r\n                                                >\r\n                                                    Not fixed\r\n                                                </Button>\r\n                                            </div>\r\n                                        }\r\n                                    </div>\r\n                                </div>\r\n                            </div> */}\r\n\r\n                {/* </div> */}\r\n\r\n                {/* </Col>\r\n                </Row> */}\r\n            </div>\r\n        );\r\n    };\r\n\r\n    const AutoSuggestComponent = (props: IChild) => {\r\n        const { isDisabled, txt } = props;\r\n        return <div className=\"dark\">\r\n            <label className=\"text-warning\">Please enter the Question</label>\r\n            <div className=\"text-start\">\r\n                <div className=\"questions\">\r\n                    {isDisabled &&\r\n                        <div>\r\n                            {txt}\r\n                        </div>\r\n                    }\r\n                    {!isDisabled &&\r\n                        <Suspense fallback={<div>Loading...</div>}>\r\n                            <AutoSuggestQuestions\r\n                                tekst={txt}\r\n                                onSelectQuestion={onSelectQuestion}\r\n                                allCategoryRows={allCategoryRows}\r\n                                searchQuestions={searchQuestions}\r\n                            />\r\n                        </Suspense>\r\n                    }\r\n                </div>\r\n            </div>\r\n        </div>\r\n    }\r\n\r\n    // const scrollToBottom = () => {\r\n    //     scrollableRef.current?.scrollIntoView({ behavior: 'smooth', block: 'end' });\r\n    // };\r\n    console.log(\"=====================>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> rendering ChatBotDlg\")\r\n    return (\r\n        <div className=\"pe-6 overflow-auto chat-bot-dlg\">\r\n            {/* <Button variant=\"primary\" onClick={onHide}>\r\n                Toggle static offcanvas\r\n            </Button> */}\r\n\r\n            {/* backdrop=\"static\" */}\r\n            <Offcanvas show={show} onHide={onHide} placement='end' scroll={true} backdrop={true} onEntering={onEntering}> {/* backdropClassName='chat-bot-dlg' */}\r\n                <Offcanvas.Header closeButton>\r\n                    <Offcanvas.Title className=\"fs-6\">\r\n                        I am your Buddy\r\n                    </Offcanvas.Title>\r\n                </Offcanvas.Header>\r\n                <Offcanvas.Body className=\"p-0 border border-1 rounded-3\">\r\n                    <Container id='container' fluid className='text-primary'> {/* align-items-center\" */}\r\n                        <Row className=\"m-0\">\r\n                            <Col>\r\n                                {/* <p className='p-0 m-0 fw-lighter'>For test, Select:</p>\r\n                                <ul className=\"m-0\">\r\n                                    <li className='p-0 fw-lighter'>Sale</li>\r\n                                    <li className='mx-2 fw-lighter'>Phones, TV, ...</li>\r\n                                    <li className='mx-4 p-0 mb-4 fw-lighter'>Televisions, remote controllers, ...</li>\r\n                                </ul> */}\r\n                            </Col>\r\n                        </Row>\r\n                        {/* badge */}\r\n                        <Row className=\"m-0\">\r\n                            <Col className='border border-0 border-primary mx-1 text-white p-0'>\r\n                                {/* <div className=\"d-inline\"> */}\r\n                                {/* <div key='Welcome'>\r\n                                    <p><b>Welcome</b>, I am Buddy and I am here to help You</p>\r\n                                </div> */}\r\n\r\n                                {/* <div className='border border-0 border-primary mx-0 text-white'>\r\n                                    {catLevels.map((catLevel) =>\r\n                                        <CatLevelComponent key={catLevel.level} {...catLevel} />\r\n                                    )}\r\n                                </div> */}\r\n\r\n                                <div key='history' className='history'>\r\n                                    {\r\n                                        pastEvents.map(childProps => {\r\n                                            switch (childProps.type) {\r\n                                                case ChildType.AUTO_SUGGEST:\r\n                                                    return <AutoSuggestComponent {...childProps} />;\r\n                                                case ChildType.QUESTION:\r\n                                                    return <QuestionComponent {...childProps} />;\r\n                                                case ChildType.ANSWER:\r\n                                                    return <AnswerComponent {...childProps} />;\r\n                                                default:\r\n                                                    return <div>unknown</div>\r\n                                            }\r\n                                        })\r\n                                    }\r\n                                </div>\r\n\r\n                                {showAnswer &&\r\n                                    <div key=\"answer\">\r\n                                        <AnswerComponent\r\n                                            type={ChildType.ANSWER}\r\n                                            isDisabled={false}\r\n                                            txt={chatBotAnswer ? chatBotAnswer.answerTitle : 'no answers'}\r\n                                            hasMoreAnswers={hasMoreAnswers}\r\n                                            link={chatBotAnswer ? chatBotAnswer.answerLink : ''}\r\n                                        />\r\n                                    </div>\r\n                                }\r\n\r\n                                {catsSelected && !showAutoSuggest &&\r\n                                    <Button\r\n                                        key=\"newQuestion\"\r\n                                        variant=\"secondary\"\r\n                                        size=\"sm\"\r\n                                        type=\"button\"\r\n                                        onClick={() => {\r\n                                            setAutoSuggestId(autoSuggestId + 1);\r\n                                            setShowAutoSuggest(true);\r\n                                        }}\r\n                                        className='m-1 border border-1 rounded-1 py-0'\r\n                                    >\r\n                                        New Question\r\n                                    </Button>\r\n                                }\r\n\r\n                                {showAutoSuggest &&\r\n                                    <div className=\"pb-35 questions\">\r\n                                        <AutoSuggestComponent\r\n                                            type={ChildType.AUTO_SUGGEST}\r\n                                            isDisabled={false}\r\n                                            txt={autoSuggestionValue!}\r\n                                            link={null}\r\n                                        />\r\n                                    </div>\r\n                                }\r\n                                {/* </div> */}\r\n                                <div ref={scrollableRef}>dno dna</div>\r\n                            </Col>\r\n                        </Row>\r\n                    </Container>\r\n                </Offcanvas.Body>\r\n            </Offcanvas>\r\n\r\n        </div>\r\n    )\r\n};\r\n\r\nexport default ChatBotDlg;"],"file":"ChatBotDlg-BP5OauUj.js"}