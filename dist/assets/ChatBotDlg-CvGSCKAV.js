import{r,u as _,m as e,aq as N,ar as ue,as as xe,s as me,n as he,at as A,t as we,R as U,p as z,B as Q,au as ge,q as fe,j as E}from"./index-BDI7IlMk.js";import{A as pe}from"./AutoSuggestQuestions-CEqcrsc2.js";import"./lib-CGQHTf8E.js";class H{constructor(a){const{topId:d,id:i,answerTitle:u,answerLink:m}=a;this.chatBotAnswer={topId:d,id:i,answerTitle:u??"",answerLink:m??"",created:a.created,modified:a.modified}}chatBotAnswer}const ye=()=>{const[t,a]=r.useState(null),[d,i]=r.useState(0),u=async w=>{a(w);let g=!1,f=null;if(w){const{assignedAnswers:p}=w;if(p&&p.length>0){const b=p[0];f=new H(b).chatBotAnswer,g=p.length>1,i(0)}}return{firstChatBotAnswer:f,hasMoreAnswers:g}},m=r.useCallback(async()=>t,[t]),h=r.useCallback(async()=>{const{assignedAnswers:w}=t,g=w.length,f=d+1;return d+1<g?(i(f),{nextChatBotAnswer:new H(w[f]).chatBotAnswer,hasMoreAnswers:f+1<g}):{nextChatBotAnswer:null,hasMoreAnswers:!1}},[t,d]);return[u,m,h]},be="rgba(255, 192, 203, 0.6)",je="rgb(224, 207, 252)";function Ae({children:t,eventKey:a,hasSubCategories:d,callback:i}){const{activeEventKey:u}=r.useContext(ue),m=xe(String(a??""),()=>i&&i(a)),h=u===a;return e.jsx("button",{type:"button",className:d?"accordionButton":"",style:{backgroundColor:h?be:je},onClick:m,children:t})}const Ne=({row:t})=>e.jsxs(N.Item,{eventKey:t.id,children:[e.jsx(N.Header,{children:e.jsx(Ae,{eventKey:t.id,hasSubCategories:t.hasSubCategories,children:t.title})}),t.hasSubCategories&&e.jsx(N.Collapse,{eventKey:t.id,children:t.hasSubCategories&&e.jsx(V,{rows:t.categoryRows})})]},t.id),V=({rows:t})=>e.jsx(e.Fragment,{children:t.map(a=>e.jsx(Ne,{row:a},a.id))}),Se=async(t,a)=>{console.log("onSelectCategory",{eventKey:t,e:a})},Ce=r.forwardRef(({topRows:t},a)=>{const{allCategoryRowsGlobal:d}=_(),i=r.useCallback(async u=>{const{id:m}=u;d.forEach(async h=>{h.id!==m&&h.parentId===m&&(await i(h),u.categoryRows.push(h))})},[d]);return r.useImperativeHandle(a,()=>({loadSubTree:u=>i(u)}),[i]),e.jsx(N,{defaultActiveKey:"0",alwaysOpen:!0,onSelect:Se,children:e.jsx(V,{rows:t})})}),Qe=({show:t,onHide:a})=>{let{tekst:d}=me();const[i,u]=r.useState(d),[m,h,w]=ye(),[g,f]=r.useState(null),[p,b]=r.useState(1),[W,T]=r.useState(!1),[n,S]=r.useState(null),[$,C]=r.useState(!1),{loadAllCategoryRowsGlobal:I,getQuestion:P,addHistory:R,addHistoryFilter:J,searchQuestions:X}=he(),{authUser:k,isDarkMode:Y,allCategoryRowsGlobalLoaded:v,allCategoryRowsGlobal:D}=_(),[Z]=r.useState(!0),[K,q]=r.useState(!0),[ee,M]=r.useState([]),G=r.useRef(null),[se,j]=r.useState([]);let L;(s=>{s[s.AUTO_SUGGEST=0]="AUTO_SUGGEST",s[s.QUESTION=1]="QUESTION",s[s.ANSWER=2]="ANSWER"})(L||(L={})),r.useEffect(()=>{(async()=>v||await I())()},[v,I]);const te=async()=>{M([]);const s=performance.now();D.forEach(async x=>{x.parentId===null&&(x.categoryRows=[],await G?.current?.loadSubTree(x),M(c=>[...c,x]))});const o=performance.now()-s;console.log(`Execution time: ${o} milliseconds`)},ne=r.useRef(null);if(!v)return e.jsx("div",{children:"Loading ..."});const re=async(s,l)=>{const o=await h();if(o){console.log({questionCurr:o});const y={questionKey:new E(o).questionKey,filter:l,created:{time:new Date,nickName:k.nickName}};await J(y)}if(n){const y={type:2,isDisabled:!0,txt:n.answerTitle,link:n.answerLink};j(B=>[...B,y])}const x=await P(s),{question:c}=x;if(!c)return;c.numOfRelatedFilters>0&&u(c.relatedFilters[0].filter);const le=await m(c);let{firstChatBotAnswer:ce,hasMoreAnswers:de}=le;if(c){const y={type:1,isDisabled:!0,txt:c.title,link:null};j(B=>[...B,y])}b(y=>y+1),q(!1),f(c),T(!0),C(de),S(ce)},ae=async()=>{const s={type:2,isDisabled:!0,txt:n?n.answerTitle:"no answer title",link:n?n.answerLink:"no answer link",hasMoreAnswers:!0};j(o=>[...o,s]);const l={questionKey:new E(g).questionKey,assignedAnswerKey:{topId:n.topId,id:n.id},userAction:"Fixed",created:{nickName:k.nickName,time:new Date}};R(l),C(!1),S(n),T(!1)},oe=async()=>{const s={type:2,isDisabled:!0,txt:n?n.answerTitle:"no answer",link:n?n.answerLink:"no link",hasMoreAnswers:!0};j(c=>[...c,s]);const l=await w(),{nextChatBotAnswer:o,hasMoreAnswers:x}=l;if(n){const c={questionKey:new E(g).questionKey,assignedAnswerKey:{topId:n.topId,id:n.id},userAction:o?"NotFixed":"NotClicked",created:{nickName:k.nickName,time:new Date}};R(c)}C(x),console.log("----->>>>",{nextChatBotAnswer:o}),S(o)},ie=s=>{const{txt:l}=s;return e.jsx("div",{id:p.toString(),className:"d-flex flex-row mx-0 justify-content-start align-items-center",children:e.jsxs("div",{className:"d-flex flex-row mx-0 justify-content-start align-items-center",children:[e.jsx("img",{width:"22",height:"18",src:fe,alt:"Question",className:"ms-1"}),e.jsx("div",{className:"p-1 bg-warning text-light flex-wrap text-wrap border rounded-1",children:l})]})})},F=s=>{console.log("--------------------------------------AnswerComponent",s);const{isDisabled:l,txt:o,link:x}=s;return e.jsx("div",{id:n?.id,className:`${Y?"dark":"light"} mt-1 mx-1 border border-0 rounded-1`,children:e.jsxs("div",{className:"d-flex flex-row mx-0 justify-content-start align-items-center",children:[e.jsxs("div",{className:"d-flex flex-row mx-0 justify-content-start align-items-center",children:[e.jsx("img",{width:"22",height:"18",src:ge,alt:"Answer",className:"ms-1"}),x?e.jsx("div",{className:"p-1 bg-info text-light flex-wrap text-wrap border rounded-1 ",children:e.jsx("a",{href:x,rel:"noopener noreferrer",target:"_blank",className:"text-light text-decoration-underline",children:o})}):e.jsx("div",{className:"p-1 bg-info text-light flex-wrap text-wrap border rounded-1",children:o})]}),!l&&n&&e.jsxs("div",{children:[e.jsx(Q,{size:"sm",type:"button",onClick:ae,disabled:!n,className:"align-middle ms-1 px-1  py-0",variant:"success",children:"Fixed"}),e.jsx(Q,{size:"sm",type:"button",onClick:oe,disabled:!n,className:"align-middle ms-1 border border-1 rounded-1 px-1 py-0",variant:"danger",children:"Not fixed"})]})]})})},O=s=>{const{isDisabled:l,txt:o}=s;return e.jsxs("div",{className:"dark",children:[e.jsx("label",{className:"text-warning",children:"Please enter the Question"}),e.jsx("div",{className:"text-start",children:e.jsxs("div",{className:"questions",children:[l&&e.jsx("div",{children:o}),!l&&e.jsx(pe,{tekst:o,onSelectQuestion:re,allCategoryRows:D,searchQuestions:X})]})})]})};return console.log("=====================>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> rendering ChatBotDlg"),e.jsxs("div",{className:"pe-6 overflow-auto chat-bot-dlg",children:[e.jsx("style",{children:`
                .card-header {
                    padding: 0.0rem 0.03rem;
                    font-size: 0.8rem;
                }
                .card-header button  {
                    border: 0.3px solid silver;
                    border-radius: 3px;
                    text-align: left;
                }

                .card-body {
                    padding: 0.0rem 0.5rem;
                    font-size: 0.8rem;
                }

                .accordion-body {
                    padding: 0.3rem 0.3rem;
                    font-size: 0.7rem;
                }

                .accordion-button  {
                    padding: 0.3rem 0.3rem;
                    border: 0.3px solid silver;
                    border-radius: 3px;
                    text-align: left;
                }
                    
                ul {
                    list-style-type: none;
                }

            `}),e.jsxs(A,{show:t,onHide:a,placement:"end",scroll:!0,backdrop:!0,onEntering:te,children:[" ",e.jsx(A.Header,{closeButton:!0,children:e.jsx(A.Title,{className:"fs-6",children:"I am your Buddy"})}),e.jsx(A.Body,{className:"p-0 border border-1 rounded-3",children:e.jsxs(we,{id:"container",fluid:!0,className:"text-primary",children:[" ",e.jsx(U,{className:"m-0",children:e.jsx(z,{children:e.jsx(Ce,{topRows:ee,ref:G})})}),e.jsx(U,{className:"m-0",children:e.jsxs(z,{className:"border border-0 border-primary mx-1 text-white p-0",children:[e.jsx("div",{className:"history",children:se.map(s=>{switch(s.type){case 0:return e.jsx(O,{...s});case 1:return e.jsx(ie,{...s});case 2:return e.jsx(F,{...s});default:return e.jsx("div",{children:"unknown"})}})},"history"),W&&e.jsx("div",{children:e.jsx(F,{type:2,isDisabled:!1,txt:n?n.answerTitle:"no answers",hasMoreAnswers:$,link:n?n.answerLink:""})},"answer"),Z&&!K&&e.jsx(Q,{variant:"secondary",size:"sm",type:"button",onClick:()=>{b(p+1),q(!0)},className:"m-1 border border-1 rounded-1 py-0",children:"New Question"},"newQuestion"),K&&e.jsx("div",{className:"pb-35 questions",children:e.jsx(O,{type:0,isDisabled:!1,txt:i,link:null})}),e.jsx("div",{ref:ne,children:"dno dna"})]})})]})})]})]})};export{Qe as default};
//# sourceMappingURL=ChatBotDlg-CvGSCKAV.js.map
