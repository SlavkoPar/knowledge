import{r as a,s as le,n as ce,u as de,m as e,aq as y,t as ue,R as K,p as F,B,ar as xe,q as we,j as Q}from"./index-DaKHXlkp.js";import{A as he}from"./AutoSuggestQuestions-D6t-fky2.js";import"./lib-D4_UPh-i.js";class U{constructor(x){const{topId:w,id:g,answerTitle:f,answerLink:p}=x;this.chatBotAnswer={topId:w,id:g,answerTitle:f??"",answerLink:p??"",created:x.created,modified:x.modified}}chatBotAnswer}const me=()=>{const[u,x]=a.useState(null),[w,g]=a.useState(0),f=async i=>{x(i);let l=!1,c=null;if(i){const{assignedAnswers:h}=i;if(h&&h.length>0){const A=h[0];c=new U(A).chatBotAnswer,l=h.length>1,g(0)}}return{firstChatBotAnswer:c,hasMoreAnswers:l}},p=a.useCallback(async()=>u,[u]),b=a.useCallback(async()=>{const{assignedAnswers:i}=u,l=i.length,c=w+1;return w+1<l?(g(c),{nextChatBotAnswer:new U(i[c]).chatBotAnswer,hasMoreAnswers:c+1<l}):{nextChatBotAnswer:null,hasMoreAnswers:!1}},[u,w]);return[f,p,b]},Ae=({show:u,onHide:x})=>{let{tekst:w}=le();const[g,f]=a.useState(w),[p,b,i]=me(),[l,c]=a.useState(null),[h,A]=a.useState(1),[O,I]=a.useState(!1),[t,N]=a.useState(null),[H,S]=a.useState(!1),{loadAllCategoryRowsGlobal:D,getSubCats:z,getQuestion:_,addHistory:E,addHistoryFilter:V,searchQuestions:W}=ce(),{authUser:k,isDarkMode:$,allCategoryRowsGlobal:J,allCategoryRowsGlobalLoaded:C}=de(),[P]=a.useState(!0),[M,q]=a.useState(!0),[X,R]=a.useState([]),[Y,j]=a.useState([]);let L;(s=>{s[s.AUTO_SUGGEST=0]="AUTO_SUGGEST",s[s.QUESTION=1]="QUESTION",s[s.ANSWER=2]="ANSWER"})(L||(L={})),a.useEffect(()=>{(async()=>C||await D())()},[C,D]);const Z=async()=>{R([]);const s="MTS",r=await z(s),{subCats:n,parentHeader:d}=r;R(o=>[...o,{level:1,catId:s,header:d,subCats:n,subCatIdSelected:null}]),console.log(X)},ee=a.useRef(null);if(!C)return e.jsx("div",{children:"Loading ..."});const se=async(s,r)=>{const n=await b();if(n){console.log({questionCurr:n});const m={questionKey:new Q(n).questionKey,filter:r,created:{time:new Date,nickName:k.nickName}};await V(m)}if(t){const m={type:2,isDisabled:!0,txt:t.answerTitle,link:t.answerLink};j(v=>[...v,m])}const d=await _(s),{question:o}=d;if(!o)return;o.numOfRelatedFilters>0&&f(o.relatedFilters[0].filter);const re=await p(o);let{firstChatBotAnswer:oe,hasMoreAnswers:ie}=re;if(o){const m={type:1,isDisabled:!0,txt:o.title,link:null};j(v=>[...v,m])}A(m=>m+1),q(!1),c(o),I(!0),S(ie),N(oe)},te=async()=>{const s={type:2,isDisabled:!0,txt:t?t.answerTitle:"no answer title",link:t?t.answerLink:"no answer link",hasMoreAnswers:!0};j(n=>[...n,s]);const r={questionKey:new Q(l).questionKey,assignedAnswerKey:{topId:t.topId,id:t.id},userAction:"Fixed",created:{nickName:k.nickName,time:new Date}};E(r),S(!1),N(t),I(!1)},ne=async()=>{const s={type:2,isDisabled:!0,txt:t?t.answerTitle:"no answer",link:t?t.answerLink:"no link",hasMoreAnswers:!0};j(o=>[...o,s]);const r=await i(),{nextChatBotAnswer:n,hasMoreAnswers:d}=r;if(t){const o={questionKey:new Q(l).questionKey,assignedAnswerKey:{topId:t.topId,id:t.id},userAction:n?"NotFixed":"NotClicked",created:{nickName:k.nickName,time:new Date}};E(o)}S(d),console.log("----->>>>",{nextChatBotAnswer:n}),N(n)},ae=s=>{const{txt:r}=s;return e.jsx("div",{id:h.toString(),className:"d-flex flex-row mx-0 justify-content-start align-items-center",children:e.jsxs("div",{className:"d-flex flex-row mx-0 justify-content-start align-items-center",children:[e.jsx("img",{width:"22",height:"18",src:we,alt:"Question",className:"ms-1"}),e.jsx("div",{className:"p-1 bg-warning text-light flex-wrap text-wrap border rounded-1",children:r})]})})},T=s=>{console.log("--------------------------------------AnswerComponent",s);const{isDisabled:r,txt:n,link:d}=s;return e.jsx("div",{id:t?.id,className:`${$?"dark":"light"} mt-1 mx-1 border border-0 rounded-1`,children:e.jsxs("div",{className:"d-flex flex-row mx-0 justify-content-start align-items-center",children:[e.jsxs("div",{className:"d-flex flex-row mx-0 justify-content-start align-items-center",children:[e.jsx("img",{width:"22",height:"18",src:xe,alt:"Answer",className:"ms-1"}),d?e.jsx("div",{className:"p-1 bg-info text-light flex-wrap text-wrap border rounded-1 ",children:e.jsx("a",{href:d,rel:"noopener noreferrer",target:"_blank",className:"text-light text-decoration-underline",children:n})}):e.jsx("div",{className:"p-1 bg-info text-light flex-wrap text-wrap border rounded-1",children:n})]}),!r&&t&&e.jsxs("div",{children:[e.jsx(B,{size:"sm",type:"button",onClick:te,disabled:!t,className:"align-middle ms-1 px-1  py-0",variant:"success",children:"Fixed"}),e.jsx(B,{size:"sm",type:"button",onClick:ne,disabled:!t,className:"align-middle ms-1 border border-1 rounded-1 px-1 py-0",variant:"danger",children:"Not fixed"})]})]})})},G=s=>{const{isDisabled:r,txt:n}=s;return e.jsxs("div",{className:"dark",children:[e.jsx("label",{className:"text-warning",children:"Please enter the Question"}),e.jsx("div",{className:"text-start",children:e.jsxs("div",{className:"questions",children:[r&&e.jsx("div",{children:n}),!r&&e.jsx(he,{tekst:n,onSelectQuestion:se,allCategoryRows:J,searchQuestions:W})]})})]})};return console.log("=====================>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> rendering ChatBotDlg"),e.jsx("div",{className:"pe-6 overflow-auto chat-bot-dlg",children:e.jsxs(y,{show:u,onHide:x,placement:"end",scroll:!0,backdrop:!0,onEntering:Z,children:[" ",e.jsx(y.Header,{closeButton:!0,children:e.jsx(y.Title,{className:"fs-6",children:"I am your Buddy"})}),e.jsx(y.Body,{className:"p-0 border border-1 rounded-3",children:e.jsxs(ue,{id:"container",fluid:!0,className:"text-primary",children:[" ",e.jsx(K,{className:"m-0",children:e.jsx(F,{})}),e.jsx(K,{className:"m-0",children:e.jsxs(F,{className:"border border-0 border-primary mx-1 text-white p-0",children:[e.jsx("div",{className:"history",children:Y.map(s=>{switch(s.type){case 0:return e.jsx(G,{...s});case 1:return e.jsx(ae,{...s});case 2:return e.jsx(T,{...s});default:return e.jsx("div",{children:"unknown"})}})},"history"),O&&e.jsx("div",{children:e.jsx(T,{type:2,isDisabled:!1,txt:t?t.answerTitle:"no answers",hasMoreAnswers:H,link:t?t.answerLink:""})},"answer"),P&&!M&&e.jsx(B,{variant:"secondary",size:"sm",type:"button",onClick:()=>{A(h+1),q(!0)},className:"m-1 border border-1 rounded-1 py-0",children:"New Question"},"newQuestion"),M&&e.jsx("div",{className:"pb-35 questions",children:e.jsx(G,{type:0,isDisabled:!1,txt:g,link:null})}),e.jsx("div",{ref:ee,children:"dno dna"})]})})]})})]})})};export{Ae as default};
//# sourceMappingURL=ChatBotDlg-CfUt7u5j.js.map
