const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AssignedAnswers-CRiLiDEB.js","assets/index-BDI7IlMk.js","assets/index-CykrPP6v.css","assets/Options-D0MXAH3M.js","assets/lib-CGQHTf8E.js","assets/AutoSuggestAnswers-Cshp9Fvc.js","assets/AutoSuggestAnswers-vl2QUoNQ.css","assets/AutoSuggestQuestions-CEqcrsc2.js","assets/AutoSuggestQuestions-DN6HBK-e.css"])))=>i.map(i=>d[i]);
import{A as s,d as ft,a as xt,b as wt,F as f,I as Ee,u as se,r as m,C as me,c as fe,e as re,f as ke,g as ht,Q as Le,h as de,i as Ct,j as he,k as Rt,l as Tt,m as e,B as z,n as qe,_ as St,o as Ge,R as ue,D as xe,p as ce,q as _t,s as It,t as Nt}from"./index-BDI7IlMk.js";import{L as ee,F as ie,f as Fe,a as Ue,u as Ce,B as Re,b as Me,c as Pe,d as Be,e as Se,g as v,S as Ne,h as _e,s as vt,i as jt,C as $e,j as Ve,Q as Ke,k as ve,l as Ot,m as Qt,n as At,o as bt,p as Dt,M as we}from"./Options-D0MXAH3M.js";import{f as kt,a as Lt}from"./lib-CGQHTf8E.js";import{A as qt}from"./AutoSuggestQuestions-CEqcrsc2.js";const Ie={topId:"",parentId:"null",id:"generateId",categoryTitle:"",title:"",assignedAnswers:[],numOfAssignedAnswers:0,relatedFilters:[],numOfRelatedFilters:0,source:0,status:0,included:!1},ze={topId:"null",parentId:"null",id:"define at BackEnd",kind:0,title:"",link:"",header:"",level:0,variations:[],hasSubCategories:!1,categoryRows:[],questionRows:[],numOfQuestions:0,hasMoreQuestions:!1,isExpanded:!1,doc1:""},Gt=(t,l)=>{console.log("------------------------------->"),console.log("------------------------------->",l.type),console.log("------------------------------->");const{categoryRow:i}=l.payload;if(l.type===s.SET_FROM_LOCAL_STORAGE){const{keyExpanded:y}=l.payload;return{...t,keyExpanded:y}}let n=i?!ft.includes(l.type):!1;const{topRows:o}=t,g=xt.includes(l.type)?{...t}:Ft(t,l);if(n&&i){let y;const{topId:x,id:T}=i;if(T===x)y=o.map(r=>r.id===x?new H(i).categoryRow:new H(r).categoryRow);else{const r=o.find(C=>C.id===x);H.idToSet=T,H.newCategoryRow=i;const R=new H(r).categoryRow;y=o.map(C=>C.id===x?R:new H(C).categoryRow),H.idToSet=""}g.topRows=y}if(wt.includes(l.type)){const{keyExpanded:y}=g,x={keyExpanded:y};localStorage.setItem("CATEGORIES_STATE",JSON.stringify(x))}return console.log("CategoryReducer newState",g),g},Ft=(t,l)=>{switch(l.type){case s.SET_TOP_ROWS_LOADING:return{...t,loadingCategories:!0,topRowsLoading:!0};case s.SET_TOP_ROWS:{const{topRows:n}=l.payload;return console.log("=> CategoriesReducer ActionTypes.SET_TOP_ROWS",t.topRows,n),{...t,topRows:n,topRowsLoading:!1,topRowsLoaded:!0,loadingCategories:!1}}case s.SET_ALL_CATEGORY_ROWS:{const{allCategoryRows:n}=l.payload;return{...t,allCategoryRows:n,allCategoryRowsLoaded:Date.now()}}case s.SET_NODE_EXPANDING_UP_THE_TREE:{const{fromChatBotDlg:n}=l.payload,{keyExpanded:o,activeCategory:g,activeQuestion:y}=t;return{...t,nodeOpening:!0,loadingCategories:!0,nodeOpened:!1,keyExpanded:n?null:{...o},activeCategory:n?null:g,activeQuestion:n?null:y}}case s.SET_NODE_EXPANDED_UP_THE_TREE:{const{category:n,formMode:o,catKey:g,questionId:y,question:x}=l.payload,{id:T}=g;return{...t,activeCategory:n,activeQuestion:x,selectedQuestionId:y,formMode:o,categoryId_questionId_done:`${T}_${y}`,nodeOpening:!1,nodeOpened:!0,loadingCategories:!1}}case s.SET_LOADING_CATEGORY:return{...t,loadingCategory:!0,categoryLoaded:!1};case s.FORCE_OPEN_NODE:const{keyExpanded:i}=l.payload;return{...t,topRows:t.topRows.filter(n=>n.parentId===null),keyExpanded:i,nodeOpened:!1,activeCategory:null,activeQuestion:null,selectedQuestionId:null};case s.SET_SUB_CATEGORIES:return{...t,loadingCategory:!1};case s.SET_ERROR:{const{error:n,whichRowId:o}=l.payload;return{...t,error:n,whichRowId:o,loadingCategories:!1,loadingQuestions:!1,loadingCategory:!1,categoryLoaded:!1,loadingQuestion:!1,questionLoaded:!1}}case s.ADD_SUB_CATEGORY:{const{categoryKey:n,level:o}=l.payload,{topId:g}=n,y={...ze,topId:g,level:o,parentId:""};return{...t,activeCategory:y,formMode:f.AddingCategory}}case s.SET_CATEGORY:{const{categoryRow:n}=l.payload;return console.assert(Ee(n)),{...t,loadingCategory:!1,categoryLoaded:!0,activeCategory:n,activeQuestion:null,selectedQuestionId:null}}case s.SET_ROW_EXPANDING:return{...t,rowExpanding:!0,rowExpanded:!1,loadingCategories:!0};case s.SET_ROW_EXPANDED:{const{categoryRow:n}=l.payload,{topId:o,id:g}=n,{keyExpanded:y}=t,x=y?y.questionId:null;return{...t,loadingCategories:!1,keyExpanded:{topId:o,categoryId:g,questionId:x},activeQuestion:null,selectedQuestionId:x,loadingQuestion:!1,questionLoaded:!1,rowExpanding:!1,rowExpanded:!0}}case s.SET_ROW_COLLAPSED:{const{categoryRow:n}=l.payload,{topId:o,parentId:g}=n;return{...t,loadingCategories:!1,keyExpanded:{topId:o,categoryId:g??"",questionId:null},rowExpanding:!1,rowExpanded:!0,activeCategory:null,activeQuestion:null,selectedQuestionId:null}}case s.SET_CATEGORY_TO_VIEW:{const{categoryRow:n}=l.payload;console.assert(Ee(n));const g={...n,isExpanded:!1};return{...t,formMode:f.ViewingCategory,loadingCategory:!1,activeCategory:g,activeQuestion:null,selectedQuestionId:null}}case s.SET_CATEGORY_TO_ADD_TOP:{const{newCategoryRow:n}=l.payload;return{...t,loadingCategory:!1,categoryLoaded:!0,activeCategory:{...n,doc1:""},activeQuestion:null,selectedQuestionId:null,topRows:[n,...t.topRows],formMode:f.AddingCategory}}case s.SET_CATEGORY_TO_ADD:{const{newCategoryRow:n}=l.payload;return{...t,loadingCategory:!1,categoryLoaded:!0,activeCategory:{...n,doc1:""},activeQuestion:null,selectedQuestionId:null,formMode:f.AddingCategory}}case s.SET_CATEGORY_ADDED:{const{categoryRow:n}=l.payload;console.assert(Ee(n));const g={...n,isExpanded:!1},{topId:y,id:x}=g;return{...t,formMode:f.EditingCategory,loadingCategory:!1,categoryLoaded:!1,activeCategory:g,activeQuestion:null,selectedQuestionId:null,keyExpanded:{topId:y,categoryId:x,questionId:null},nodeOpened:!1}}case s.SET_CATEGORY_TO_EDIT:case s.SET_CATEGORY_UPDATED:{const{categoryRow:n,category:o}=l.payload;console.assert(Ee(n));const{topId:g,id:y}=o;return{...t,formMode:f.EditingCategory,loadingCategory:!1,categoryLoaded:!0,keyExpanded:{topId:g,categoryId:y,questionId:null},activeCategory:o,activeQuestion:null,selectedQuestionId:null}}case s.SET_CATEGORY_QUESTIONS_LOADING:return{...t,loadingQuestions:!0,questionLoaded:!1};case s.CATEGORY_QUESTIONS_LOADED:return{...t,loadingQuestions:!1};case s.DELETE_CATEGORY:return{...t,activeCategory:null,formMode:f.None,error:void 0,whichRowId:void 0};case s.CANCEL_CATEGORY_FORM:case s.CLOSE_CATEGORY_FORM:return{...t,activeCategory:null,formMode:f.None};case s.CANCEL_ADD_SUB_CATEGORY:return{...t,activeCategory:null,activeQuestion:null,selectedQuestionId:null,formMode:f.None};case s.SET_LOADING_QUESTION:return{...t,loadingQuestion:!0,questionLoaded:!1};case s.CANCEL_ADD_QUESTION:return{...t,formMode:f.None,activeQuestion:null,selectedQuestionId:null};case s.SET_QUESTION_SELECTED:{const{questionKey:n}=l.payload,{topId:o,parentId:g,id:y}=n;return{...t,topRows:t.topRows.filter(x=>x.parentId===null),keyExpanded:{topId:o,categoryId:g,questionId:y},nodeOpened:!1,activeCategory:null,activeQuestion:null,selectedQuestionId:null}}case s.ADD_NEW_QUESTION_TO_ROW:{const{newQuestionRow:n}=l.payload;return{...t,selectedQuestionId:n.id}}case s.SET_QUESTION:{const{question:n,formMode:o}=l.payload;return console.log(s.SET_QUESTION,n),{...t,activeCategory:null,activeQuestion:n,formMode:o,error:void 0,loadingCategory:!1,loadingQuestion:!1,questionLoaded:!0}}case s.SET_QUESTION_AFTER_ASSIGN_ANSWER:{const{question:n}=l.payload;return{...t,activeQuestion:n,loadingQuestion:!1,questionLoaded:!0}}case s.SET_QUESTION_TO_VIEW:{const{question:n}=l.payload,{keyExpanded:o}=t;return{...t,formMode:f.ViewingQuestion,keyExpanded:o,activeQuestion:n,loadingQuestion:!1,questionLoaded:!0}}case s.SET_QUESTION_TO_EDIT:{const{question:n}=l.payload,{topId:o,id:g,parentId:y}=n;return{...t,keyExpanded:{topId:o,categoryId:y,questionId:g},activeQuestion:n,formMode:f.EditingQuestion,selectedQuestionId:n.id,loadingQuestion:!1,questionLoaded:!0}}case s.QUESTION_DELETED:return{...t,activeQuestion:null,selectedQuestionId:null,formMode:f.None,loadingQuestion:!1,questionLoaded:!0};case s.CANCEL_QUESTION_FORM:case s.CLOSE_QUESTION_FORM:return{...t,formMode:f.None,activeQuestion:null,selectedQuestionId:null};default:return alert(`Action ${l.type} not allowed`),{...t}}};class H{static idToSet;static newCategoryRow;constructor(l){const{topId:i,id:n,parentId:o,title:g,link:y,kind:x,header:T,level:r,variations:R,numOfQuestions:C,hasSubCategories:Q,categoryRows:N,created:D,modified:G,questionRows:q,isExpanded:S}=l,A=N.map(U=>(console.log("DeepClone >>>>>>>>>>>>>>>",U.id),U.id===H.idToSet?{...H.newCategoryRow}:new H(U).categoryRow));this.categoryRow={topId:i,parentId:o,id:n,kind:x,title:g,link:y,header:T,level:r,hasSubCategories:Q,categoryRows:A,numOfQuestions:C,questionRows:q,variations:R??[],created:D,modified:G,isExpanded:S}}categoryRow}const Ye=m.createContext({}),We=m.createContext(()=>null),Ut={formMode:f.None,allCategoryRows:new Map,allCategoryRowsLoaded:void 0,topRows:[],topRowsLoading:!1,topRowsLoaded:!1,nodeOpening:!1,nodeOpened:!1,keyExpanded:null,categoryId_questionId_done:void 0,activeCategory:null,activeQuestion:null,selectedQuestionId:null,loadingCategories:!1,loadingQuestions:!1,loadingCategory:!1,categoryLoaded:!1,loadingQuestion:!1,questionLoaded:!1,error:void 0,rowExpanding:!1,rowExpanded:!1},Mt=({children:t})=>{const l=se(),{KnowledgeAPI:i,isAuthenticated:n,workspace:o,authUser:g,canEdit:y}=l,{nickName:x}=g,[T,r]=m.useReducer(Gt,Ut),{formMode:R,activeCategory:C,activeQuestion:Q,keyExpanded:N,topRows:D,allCategoryRows:G,allCategoryRowsLoaded:q}=T;console.log("----->>> ----->>> ----->>> CategoryProvider"),m.useEffect(()=>{let d=o==="SLINDZA"?{topId:"QUESTIONS",categoryId:"QUESTIONS",questionId:"qqqqqq111"}:{topId:"MTS",categoryId:"REMOTECTRLS",questionId:"qqqqqq111"};if("localStorage"in window){let a=localStorage.getItem("CATEGORIES_STATE");if(console.log("CATEGORIES_STATE loaded before signIn",a),a!==null){const p=JSON.parse(a);p.keyExpanded!==null&&(d=p.keyExpanded)}}r({type:s.SET_FROM_LOCAL_STORAGE,payload:{keyExpanded:d}})},[o]);const S=m.useCallback(async(d,a,p=null,c=void 0)=>{const u=localStorage.getItem("accessToken");if(u)try{console.log("------Execute endpoint:",a);let E=null;const w=new Headers,_=`Bearer ${u}`;w.append("Authorization",_),p&&w.append("Content-Type","application/json");let b={method:d,headers:w,body:p?JSON.stringify(p):null};if(E=await fetch(a,b),E.ok){if(E.status===200||E.status===201){let M=null;try{M=await E.json()}catch{r({type:s.SET_ERROR,payload:{error:new Error(`Response status: ${E.status}`),whichRowId:c}})}finally{return M}}}else{const{errors:M}=await E.json(),W=new Error(M?.map(J=>J.message).join(`
`)??"unknown");r({type:s.SET_ERROR,payload:{error:W,whichRowId:c}})}}catch(E){console.log("-------------->>> execute",d,a,E),r({type:s.SET_ERROR,payload:{error:new Error("fetch eror"),whichRowId:c}})}return null},[]),A=m.useCallback(async()=>new Promise(async d=>{try{console.time();const a=`${i.endpointCategoryRow}/${o}`;await S("GET",a,null).then(p=>{const c=new Map;console.timeEnd(),p.forEach(u=>c.set(u.Id,new me(u).categoryRow)),c.forEach(u=>{let{id:E,parentId:w}=u,_=E,b=w;for(;b;){const M=c.get(b);_=M.id+" / "+_,b=M.parentId}u.titlesUpTheTree=_,c.set(E,u)}),r({type:s.SET_ALL_CATEGORY_ROWS,payload:{allCategoryRows:c}})})}catch(a){console.log(a),r({type:s.SET_ERROR,payload:{error:a}})}d(!0)}),[S,i.endpointCategoryRow,o]),U=m.useCallback(async d=>{try{return G.get(d)}catch(a){console.log(a),r({type:s.SET_ERROR,payload:{error:a}})}},[G]);m.useEffect(()=>{(async()=>q===void 0&&await A())()},[q,A]);const V=m.useCallback(async d=>{try{let a="";const p=[];return G.forEach((c,u)=>{u===d?a="":c.parentId===d&&p.push(c)}),{subCats:p,parentHeader:a}}catch(a){return console.log(a),r({type:s.SET_ERROR,payload:{error:a}}),{subCats:[],parentHeader:"Kiks subCats"}}},[G]),I=m.useCallback(async()=>new Promise(async d=>{try{r({type:s.SET_TOP_ROWS_LOADING,payload:{}});const a=`${i.endpointCategoryRow}/${o}/null/topRows/all`;console.log("CategoryProvider loadTopRows url:",a),console.log("loadTopRows AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"),console.time(),await S("GET",a).then(p=>{console.timeEnd(),console.log("loadTopRows BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB");const c=p.map(u=>(u.IsExpanded=N?u.Id===N.categoryId:!1,new me(u).categoryRow));r({type:s.SET_TOP_ROWS,payload:{topRows:c}}),d(!0)})}catch(a){console.log(a),r({type:s.SET_ERROR,payload:{error:a}})}}),[S,i.endpointCategoryRow,N,o]),P=m.useCallback(async(d,a)=>{const{topId:p,id:c}=d;return console.log({categoryKey:d,includeQuestionId:a}),new Promise(async u=>{try{const E=`${i.endpointCategory}/${o}/${p}/${c}/${ge}/${a}`;console.time(),console.log("================ getCategory ======================="),await S("GET",E).then(w=>{console.timeEnd();const{categoryDto:_,msg:b}=w;u(_?new fe(_).category:new Error(b))})}catch(E){console.log(E),u(E)}})},[S,i.endpointCategory,o]),k=m.useCallback((d,a)=>{if(d.topId===a)return d;const{categoryRows:p}=d;let c=p.find(u=>u.id===(a??"null"));if(!c)try{p.forEach(u=>{if(console.log(a,u.id),c=k(u,a),c)throw new Error("Stop the loop")})}catch{}return c},[]),B=m.useCallback(async(d,a,p="false")=>new Promise(async()=>{try{let{topId:c,parentId:u,id:E}=d;if(console.assert(E!==null,"id ne sme biti null u expandNodesUpToTheTree"),E){const M=G.get(E);M?(d.topId=M.topId,d.parentId=M.parentId):alert("reload all categoryRow:"+E)}r({type:s.SET_NODE_EXPANDING_UP_THE_TREE,payload:{fromChatBotDlg:p==="true"}}),console.time();const w={topId:c,id:E,parentId:null},_=new re(w).toQuery(o),b=`${i.endpointCategoryRow}?${_}&pageSize=${ge}&includeQuestionId=${a??null}`;await S("GET",b).then(async M=>{const{categoryRowDto:W}=M;if(console.timeEnd(),W){let J=null,le=null,ae=new me(W).categoryRow;if(u!==null){const pe=k(ae,E);if(J={...pe,doc1:""},a){const be=pe.questionRows.find(De=>De.id===a&&De.included);be&&(J=null,le={...be,assignedAnswers:[],numOfAssignedAnswers:0,numOfRelatedFilters:0,relatedFilters:[],source:0,status:0})}}console.log(">>> expandNodeUpToTheTree categoryRow",{categoryRow:ae,questionId:"'"+(a??"jok")+"'"+(a??"JOK")});const Te=a?y?f.EditingQuestion:f.ViewingQuestion:y?f.EditingCategory:f.ViewingCategory;r({type:s.SET_NODE_EXPANDED_UP_THE_TREE,payload:{catKey:d,categoryRow:ae,category:J,questionId:a??null,question:le,formMode:Te,fromChatBotDlg:p==="true"}})}})}catch(c){console.log(c),r({type:s.SET_ERROR,payload:{error:c}})}}),[o,i.endpointCategoryRow,S,G,k,y]),L=m.useCallback(async(d,a=!1,p=null)=>{const c=new re(d).toQuery(o);return new Promise(async u=>{try{const E=`${i.endpointCategoryRow}/${a}/${ge}/${p}?${c}`;console.time(),await S("GET",E).then(w=>{console.timeEnd();const{categoryRowDto:_,msg:b}=w;u(_?new me(_).categoryRow:new Error(b))})}catch(E){console.log(E),u(E)}})},[S,i.endpointCategoryRow,o]),j=m.useCallback(async({categoryKey:d,includeQuestionId:a,newQuestionRow:p,formMode:c})=>{try{r({type:s.SET_ROW_EXPANDING,payload:{}});const u=await L(d,!0,a);if(u instanceof Error)r({type:s.SET_ERROR,payload:{error:u}}),console.error({cat:u});else{let E;return a&&u.questionRows.filter(w=>w.included).length>0&&(E=a),p&&(u.questionRows=[p,...u.questionRows]),u.isExpanded=!0,console.log("@@@@@@@@@@@@@@@@@ expandCategory:",c,a),c===f.None&&a&&(c=y?f.EditingQuestion:f.ViewingQuestion),r({type:s.SET_ROW_EXPANDED,payload:{categoryRow:u,formMode:c,selectedQuestionId:E}}),u}}catch(u){return console.log("error",u),r({type:s.SET_ERROR,payload:{error:u}}),null}},[y,L]),te=m.useCallback(async d=>{const{topId:a,id:p}=d,c=D.find(E=>E.id===a);d={...c.id===p?c:k(c,p),isExpanded:!1,categoryRows:[],questionRows:[]},r({type:s.SET_ROW_COLLAPSED,payload:{categoryRow:d}})},[k,D]),X=m.useCallback(async d=>{try{r({type:s.CLOSE_CATEGORY_FORM,payload:{}});const{topId:a,id:p,parentId:c,level:u}=d??{topId:"generateId",id:"generateId",parentId:null,level:0},E={...ze,topId:a,parentId:d?p:c,id:"generateId",level:u+1,title:"",isExpanded:!1};if(d===null)r({type:s.SET_CATEGORY_TO_ADD_TOP,payload:{newCategoryRow:E}});else{const w={...d,level:u+1,categoryRows:[E,...d.categoryRows],hasSubCategories:!0,isExpanded:!0};r({type:s.SET_CATEGORY_TO_ADD,payload:{categoryRow:w,newCategoryRow:E}})}}catch(a){console.log("error",a),r({type:s.SET_ERROR,payload:{error:a}})}},[]),h=m.useCallback(async()=>{try{const{topId:d,id:a,parentId:p}=C,u={categoryKey:{topId:d,parentId:p,id:a},formMode:f.None},E=await j(u);E&&r({type:s.CANCEL_ADD_SUB_CATEGORY,payload:{categoryRow:E}})}catch(d){console.log("error",d),r({type:s.SET_ERROR,payload:{error:d}})}},[C,j]),oe=m.useCallback(async d=>{const{id:a}=d;r({type:s.SET_LOADING_CATEGORY,payload:{}});try{const p=new ke(d,o).categoryDto;console.log("categoryDto",{categoryDto:p});const c=`${i.endpointCategory}`;console.time(),await S("POST",c,p,a).then(async u=>{console.timeEnd();const{categoryDto:E}=u;if(E){const w=new fe(E).category;console.log("Category successfully created",{category:w}),await A().then(async()=>{await I(),w.parentId===null?r({type:s.SET_CATEGORY_ADDED,payload:{categoryRow:w}}):r({type:s.SET_CATEGORY_ADDED,payload:{categoryRow:w}})})}})}catch(p){console.log(p),r({type:s.SET_ERROR,payload:{error:new Error("Server Error"),whichRowId:a}})}},[S,i.endpointCategory,A,I,o]),F=m.useCallback(async()=>{try{const{topId:d,parentId:a}=Q,c={categoryKey:{topId:d,parentId:a,id:a},formMode:f.None},u=await j(c);u&&r({type:s.CANCEL_ADD_QUESTION,payload:{categoryRow:u}})}catch(d){console.log("error",d),r({type:s.SET_ERROR,payload:{error:d}})}},[Q,j]),O=m.useCallback(async(d,a)=>{R===f.AddingQuestion?await F():R===f.AddingCategory&&await h(),r({type:s.SET_LOADING_CATEGORY,payload:{categoryRow:d}});const p=new re(d).categoryKey,c=await P(p,a);c instanceof Error?r({type:s.SET_ERROR,payload:{error:c}}):(c.topId=d.topId,r({type:s.SET_CATEGORY_TO_VIEW,payload:{categoryRow:c}}))},[h,F,R,P]),K=m.useCallback(async(d,a)=>{R===f.AddingQuestion?await F():R===f.AddingCategory&&await h(),r({type:s.SET_LOADING_CATEGORY,payload:{}});const p=new re(d).categoryKey,c=await P(p,a);if(c instanceof Error)r({type:s.SET_ERROR,payload:{error:c}});else{const u={...c,isExpanded:!1,categoryRows:[],questionRows:[]};r({type:s.SET_CATEGORY_TO_EDIT,payload:{categoryRow:u,category:c}})}},[h,F,R,P]),Y=m.useCallback(async d=>{r({type:s.SET_LOADING_CATEGORY,payload:{}});try{const a=new ke(d,o).categoryDto,p=`${i.endpointCategory}`;console.time(),await S("PUT",p,a).then(c=>{console.timeEnd();const{categoryDto:u,msg:E}=c;if(u){const w=new fe(u).category,{topId:_}=w;w.isExpanded=!1,w.topId=_,r({type:s.SET_CATEGORY_UPDATED,payload:{category:w}})}else r({type:s.SET_ERROR,payload:{error:new Error(`${E}`)}})})}catch(a){return console.log(a),r({type:s.SET_ERROR,payload:{error:new Error("Karambol")}}),a}},[S,i.endpointCategory,o]),ne=m.useCallback(async d=>{try{const{topId:a,parentId:p}=d,c=new ht(d,o).categoryRowDto,u=`${i.endpointCategory}`;console.time(),await S("DELETE",u,c).then(async E=>{console.timeEnd();const{categoryDto:w,msg:_}=E;_==="OK"?(console.log("Category successfully deleted",{categoryRow:d}),await A().then(async()=>{const b={categoryKey:{topId:a,parentId:"",id:p},formMode:f.None};p?await I():await j(b).then(()=>{})})):r(_==="HasSubCategories"?{type:s.SET_ERROR,payload:{error:new Error("First remove sub categories"),whichRowId:w.Id}}:_==="HasQuestions"?{type:s.SET_ERROR,payload:{error:new Error("First remove category questions"),whichRowId:w.Id}}:{type:s.SET_ERROR,payload:{error:new Error(_),whichRowId:w.Id}})})}catch(a){return console.log(a),a}},[S,i.endpointCategory,j,A,I,o]),at=async(d,a)=>{try{console.log("Deleting Category Tag...",{categoryKey:d,variationName:a}),console.log("Category Tag successfully deleted")}catch(p){console.log("error",p),r({type:s.SET_ERROR,payload:{error:p}})}},ge=12,rt=m.useCallback(async({categoryKey:d,startCursor:a,includeQuestionId:p})=>{try{const{topId:c,id:u}=d;r({type:s.SET_CATEGORY_QUESTIONS_LOADING,payload:{}});try{const E=`${i.endpointQuestion}/${o}/${c}/${u}/${a}/${ge}/${p}`;console.time(),await S("GET",E).then(w=>{console.timeEnd();const{categoryDto:_}=w;if(_!==null){const b=new fe(_).category;r({type:s.CATEGORY_QUESTIONS_LOADED,payload:{categoryRow:b}})}})}catch(E){console.log(E),r({type:s.SET_ERROR,payload:{error:E}})}}catch(c){console.log(c),r({type:s.SET_ERROR,payload:c})}},[S,i.endpointQuestion,o]),it=m.useCallback(async(d,a)=>{try{const{topId:p,id:c}=d;let u=await U(c);if(!u){alert(`Not found ${c}. Reload all Categories`);return}const E={topId:p,parentId:d.id,id:"generateId",title:"question text",categoryTitle:u.title,numOfAssignedAnswers:0,included:!0},w={...Ie,...E,title:""};if(console.assert(a),a){const _=T.topRows.find(M=>M.id===p),b=k(_,c);b.questionRows=[E,...b.questionRows],r({type:s.ADD_NEW_QUESTION_TO_ROW,payload:{categoryRow:b,newQuestionRow:E}}),r({type:s.SET_QUESTION,payload:{question:w,formMode:f.AddingQuestion}})}}catch(p){console.log("error",p),r({type:s.SET_ERROR,payload:{error:p}})}},[j,k,U,T.topRows]),lt=m.useCallback(async d=>{const{topId:a,id:p,parentId:c}=d;r({type:s.SET_LOADING_CATEGORY,payload:{}});try{d.created.nickName=x;const u=new Le(d,o).questionDto,E=`${i.endpointQuestion}`;console.time(),console.log(">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> createQuestion",u),await S("POST",E,u).then(async w=>{if(console.timeEnd(),w){console.log("::::::::::::::::::::",{questionDtoEx:w});const{questionDto:_}=w;if(_){const b=new de(_).question;b.topId=a,console.log("Question successfully created"),await A().then(async()=>{const W={categoryKey:{topId:a,parentId:c,id:c},formMode:f.EditingQuestion};await j(W).then(()=>{r({type:s.SET_QUESTION,payload:{formMode:f.EditingQuestion,question:b}})})})}}})}catch(u){console.log(u),r({type:s.SET_ERROR,payload:{error:new Error("Server Error"),whichRowId:p}})}},[S,i.endpointQuestion,j,A,x,o]),dt=m.useCallback(async(d,a,p)=>{const{id:c}=a;try{a.modified.nickName=x;const u=new Le(a,o).questionDto,E=`${i.endpointQuestion}`;console.time(),u.oldParentId=d,console.log(">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> updateQuestion",u);let w=null;return await S("PUT",E,u).then(async _=>{console.timeEnd();const{questionDto:b,msg:M}=_;if(b){w=new de(b).question,console.log("Question successfully updated: ",w);const{topId:W,parentId:J}=w;if(p){const{topId:le,parentId:ae,id:Te}=w,pe={topId:le,categoryId:ae,questionId:Te};r({type:s.FORCE_OPEN_NODE,payload:{keyExpanded:pe}})}else{const ae={categoryKey:{topId:W,parentId:J,id:J},formMode:f.EditingQuestion};await j(ae).then(()=>{r({type:s.SET_QUESTION,payload:{formMode:f.EditingQuestion,question:w}})})}}else r({type:s.SET_ERROR,payload:{error:new Error(M)}})}),w}catch(u){console.log(u),r({type:s.SET_ERROR,payload:{error:new Error("Server Error"),whichRowId:c}})}},[S,i.endpointQuestion,j,x,o]),ct=m.useCallback(async(d,a)=>{const{id:p,parentId:c,topId:u}=d;r({type:s.SET_LOADING_QUESTION,payload:{}});try{const E=new Ct(d,o).questionRowDto,w=`${i.endpointQuestion}`;console.time(),await S("DELETE",w,E).then(async _=>{const{questionDto:b}=_;if(console.timeEnd(),b){const M=new de(b).question;console.log("Question successfully deleted"),a&&r({type:s.QUESTION_DELETED,payload:{question:M}});const J={categoryKey:{topId:u,parentId:c,id:c},formMode:f.None};await j(J).then(()=>{})}else console.error(_),r({type:s.SET_ERROR,payload:{error:new Error("Server Error"),whichRowId:p}})})}catch(E){console.log(E),r({type:s.SET_ERROR,payload:{error:new Error("Server Error"),whichRowId:p}})}},[S,i.endpointQuestion,j,o]),ye=m.useCallback(async d=>new Promise(async a=>{try{const p=new he(d).toQuery(o),c=`${i.endpointQuestion}?${p}`;console.time(),console.log("getQuestion",d),await S("GET",c).then(u=>{console.timeEnd();const{questionDto:E,msg:w}=u;if(E){const _={question:new de(E).question,msg:w};a(_)}else a({question:null,msg:w})})}catch(p){console.log(p),a({question:null,msg:"Problemos"})}}),[S,i.endpointQuestion,o]),ut=m.useCallback(async d=>{const a=new he(d).questionKey;r({type:s.SET_LOADING_QUESTION,payload:{}});const p=await ye(a);R===f.AddingQuestion?await F():R===f.AddingCategory&&await h();const{question:c,msg:u}=p;c?(c.topId=d.topId,r({type:s.SET_QUESTION_TO_VIEW,payload:{question:c}})):r({type:s.SET_ERROR,payload:{error:new Error(u)}})},[h,F,R,ye]),gt=m.useCallback(async d=>{const a=new he(d).questionKey;R===f.AddingQuestion?await F():R===f.AddingCategory&&await h(),r({type:s.SET_LOADING_QUESTION,payload:{}}),console.log("editQuestion:",a);const p=await ye(a),{question:c,msg:u}=p;c?(c.topId=d.topId,r({type:s.CLOSE_QUESTION_FORM,payload:{question:c}}),r({type:s.SET_QUESTION_TO_EDIT,payload:{question:c}})):r({type:s.SET_ERROR,payload:{error:new Error(u)}})},[h,F,R,ye]),yt=m.useCallback(async(d,a,p)=>{try{var{topId:c,id:u}=p,E={topId:c,id:u,created:{time:new Date,nickName:x}};const w=new Rt(E).assignedAnswerDto;w.QuestionKeyDto=new Tt(a,o).dto;let _=null;const b=`${i.endpointQuestionAnswer}/${d}`;console.time(),await S("POST",b,w).then(async M=>{console.timeEnd();const{questionDto:W}=M;console.log("::::::::::::::::::::",{questionDtoEx:M}),W&&(_=new de(W).question,console.log("Question successfully modified"))}),_&&r({type:s.SET_QUESTION_AFTER_ASSIGN_ANSWER,payload:{question:_}})}catch(w){console.log("error",w),r({type:s.SET_ERROR,payload:{error:w}})}},[S,i.endpointQuestionAnswer,x,o]),pt=m.useCallback((d,a)=>{console.log("Provider onCategoryTitleChanged:",a),r({type:s.CATEGORY_TITLE_CHANGED,payload:{categoryRow:{...d,title:a}}})},[]),Et=m.useCallback((d,a,p)=>{const{parentId:c,id:u}=a,E=k(d,c);if(E){const w=E.questionRows.find(_=>_.id===u);w.title=p,console.log("onQuestionTitleChanged+++>>>",u,E),r({type:s.QUESTION_TITLE_CHANGED,payload:{categoryRow:E}})}},[k]),mt={state:T,loadAllCategoryRows:A,getSubCats:V,getCat:U,expandNodesUpToTheTree:B,loadTopRows:I,addSubCategory:X,cancelAddCategory:h,createCategory:oe,viewCategory:O,editCategory:K,updateCategory:Y,deleteCategory:ne,deleteCategoryVariation:at,expandCategory:j,collapseCategory:te,onCategoryTitleChanged:pt,loadCategoryQuestions:rt,addQuestion:it,cancelAddQuestion:F,createQuestion:lt,viewQuestion:ut,editQuestion:gt,updateQuestion:dt,deleteQuestion:ct,onQuestionTitleChanged:Et,assignQuestionAnswer:yt};return!n||!q||N===null?null:e.jsx(Ye.Provider,{value:mt,children:e.jsx(We.Provider,{value:r,children:t})})};function $(){return m.useContext(Ye)}const je=()=>m.useContext(We);var Z=(t=>(t.SET_LOADING="SET_LOADING",t.SET_SUB_CATS="SET_SUB_CATS",t.SET_ERROR="SET_ERROR",t.SET_EXPANDED="SET_EXPANDED",t.SET_PARENT_CAT="SET_PARENT_CAT",t))(Z||{});const Pt=({cat:t,dispatch:l,setParentCat:i,selId:n})=>{const{topId:o,parentId:g,id:y,title:x,level:T,isExpanded:r}=t,R={topId:o,parentId:g,id:y},C=D=>{l({type:Z.SET_EXPANDED,payload:{id:y,expanding:!r}})},Q=D=>{i(D)},N=e.jsxs("div",{className:"d-flex justify-content-start align-items-center w-100 text-primary",children:[e.jsx(z,{variant:"link",size:"sm",className:"py-0 px-1",onClick:D=>{C(),D.stopPropagation(),D.preventDefault()},title:"Expand",children:e.jsx(ie,{icon:r?Fe:Ue,size:"lg"})}),e.jsx(z,{variant:"link",size:"sm",className:"py-0 mx-0 text-decoration-none",title:y,onClick:()=>Q(t),children:x})]});return e.jsxs(e.Fragment,{children:[e.jsx(ee.Item,{variant:"primary",className:"py-0 px-1 w-100",as:"li",children:N}),r&&e.jsx(ee.Item,{className:"py-0 px-0",variant:"primary",as:"li",children:e.jsx(Xe,{selId:n,level:T+1,categoryKey:R,setParentId:i})})]})},Bt={loading:!1,parentId:null,title:"",cats:[]},$t=(t,l)=>{switch(l.type){case Z.SET_LOADING:return{...t,loading:!0};case Z.SET_SUB_CATS:{const{subCats:i}=l.payload;return{...t,cats:t.cats.concat(i),loading:!1}}case Z.SET_ERROR:{const{error:i}=l.payload;return{...t,error:i,loading:!1}}case Z.SET_EXPANDED:{const{id:i,expanding:n}=l.payload;let{cats:o}=t;if(!n){const g=He(o,i);console.log("clean:",g),g.length>0&&(o=o.filter(y=>!g.includes(y.id)))}return{...t,cats:t.cats.map(g=>g.id===i?{...g,isExpanded:n}:g)}}case Z.SET_PARENT_CAT:{const{cat:i}=l.payload,{id:n,title:o}=i;return{...t,parentId:n,title:o}}default:return t}};function He(t,l){let i=t.filter(n=>n.parentId===l).map(n=>n.id);return i.forEach(n=>{const o=n?He(t,n):[];i=i.concat(o)}),i}const Xe=({selId:t,categoryKey:l,level:i,setParentId:n})=>{const[o,g]=m.useReducer($t,Bt),{getSubCats:y}=$(),{id:x}=l??{id:null},[T]=m.useState(l);m.useEffect(()=>{(async()=>{const C=await y(x),{subCats:Q}=C;g({type:Z.SET_SUB_CATS,payload:{subCats:Q}})})()},[y,T,x]);const r=o.cats.filter(C=>C.parentId===x),R=C=>{g({type:Z.SET_PARENT_CAT,payload:{cat:C}}),n(C)};return e.jsxs("div",{className:i>1?"border  border-7 ms-4 h-25":"border border-7  h-25",style:{overflowY:"auto"},children:[e.jsx(ee,{as:"ul",variant:"dark",className:"mb-0",children:r.filter(C=>C.id!==t).map(C=>e.jsx(Pt,{cat:C,selId:t,dispatch:g,setParentCat:R},C.id))}),o.error&&o.error.message]})},Vt=({relatedFilter:t})=>{const{filter:l,numOfUsages:i,created:n,lastUsed:o}=t,{time:g,nickName:y}=n,x=`Created by: ${y}, ${kt(new Date(g))}`,T=!1,r=N=>{console.log("RelatedFilter onSelectAnswer",{filter:N})},[R,C]=Ce(),Q=e.jsxs("div",{ref:R,className:"d-flex justify-content-start align-items-center w-100 text-light related-filter-row",children:[e.jsx(z,{variant:"link",size:"sm",className:"py-0 mx-0 title text-light text-wrap",title:x,onClick:()=>r(l),disabled:T,children:l}),e.jsxs(Re,{pill:!0,bg:"secondary",className:`text-light ${i===0?"d-none":"d-inline"}`,children:[i,i===1?" usage":" usages"]}),e.jsx("span",{className:"small ms-1",children:Lt(o.time)}),C]});return e.jsx(ee.Item,{className:"py-0 px-0",as:"li",children:Q},l)},Kt=({relatedFilters:t})=>{const{globalState:l}=qe(),{variant:i}=l,{state:n}=$(),o=async g=>{console.log("RelatedFilters unAssignFilter",{relatedFilter:g})};return e.jsx("div",{className:"mx-0 my-1 border rounded-2 px-1 py-1border-light fs-6 related-filters",children:e.jsxs("div",{children:[e.jsx("label",{className:"text-muted",children:"Most frequently selected Filters (for the next Question in ChatBot)"}),t.length>0?e.jsx(ee,{as:"ul",variant:i,className:"my-1",children:t.map(g=>e.jsx(Vt,{relatedFilter:g,unAssignFilter:o},g.filter))}):e.jsx("div",{className:"border text-light",children:"No filters"}),n.error&&e.jsx("div",{children:"state.error"})]})})},Oe=({question:t,submitForm:l,children:i,showCloseButton:n,source:o=0,closeModal:g})=>{const{state:y,onQuestionTitleChanged:x}=$();let{formMode:T,topRows:r}=y;const R=m.lazy(()=>St(()=>import("./AssignedAnswers-CRiLiDEB.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8])).then(O=>({default:O.default}))),C=T===f.ViewingQuestion,Q=T===f.EditingQuestion,N=T===f.AddingQuestion,D=C,{topId:G,id:q,assignedAnswers:S,relatedFilters:A,title:U}=t,V=new he(t).questionKey,I=je(),P=()=>{g?g():I({type:s.CLOSE_QUESTION_FORM,payload:{question:t}})},k=()=>{g?g():I({type:s.CANCEL_QUESTION_FORM,payload:{question:t}})},[B,L]=m.useState(q+"/"+U),j=Me(B,500),[te]=m.useState(r.find(O=>O.id===G)),X=m.useRef(null),h=Pe({enableReinitialize:!0,initialValues:t,validationSchema:Be().shape({title:Se().required("Required"),parentId:Se().required("Required").notOneOf(["000000000000000000000000"])}),onSubmit:O=>{l(O),L(O.id+"/"+O.title)}});m.useEffect(()=>{(async()=>{const K=j.split("/"),Y=K[0];if(h.values.id===Y){console.log("QuestionForm.useEffect - onQuestioTitleChanged",{debouncedSearchTerm:j,searchTerm:B,title:h.values.title});const ne=K[1];await x(te,h.values,ne)}})()},[j,h.values,x,B,te]),m.useEffect(()=>{X.current.focus(),o!==0&&h.setFieldValue("source",o)},[h,X,o]);const oe=O=>{h.handleChange(O);const K=O.target.value;L(q+"/"+K)},F=O=>{h.setFieldValue("parentId",O.id),h.setFieldValue("categoryTitle",O.title)};return console.log("@@@@@@@@@@@@@@@@@@@@@ QuestionForm.render: ",{searchTerm:B,qTitle:U,debouncedSearchTerm:j}),e.jsxs("div",{className:"form-wrapper px-3 py-1 my-0 my-1 w-100 question-form",children:[n&&e.jsx(Ge,{onClick:P,className:"float-end"}),e.jsx(ue,{className:"text-center",children:e.jsxs(v.Label,{children:["Question  ",C?"Viewing":Q?"Editing":"Adding"]})}),e.jsxs(v,{onSubmit:h.handleSubmit,children:[e.jsxs(Ne,{direction:"horizontal",gap:0,className:"border",children:[e.jsx("div",{className:"p-0",children:e.jsx(v.Label,{children:"Category:"})}),e.jsx("div",{className:"p-1",children:e.jsxs(v.Group,{controlId:"parentId",className:"category-select form-select-sm w-90",children:[e.jsxs(xe,{children:[e.jsx(xe.Toggle,{variant:"light",id:"dropdown-basic",className:"px-2 py-0 text-primary border",disabled:D,children:e.jsx("span",{className:"text-wrap me-1",children:h.values.categoryTitle})}),e.jsx(xe.Menu,{className:"p-0 border",children:e.jsx(xe.Item,{className:"p-0 m-0 rounded-3",children:e.jsx(Xe,{selId:h.values.parentId,categoryKey:null,level:1,setParentId:F})})})]}),e.jsx(v.Control,{as:"input",name:"parentId",onChange:h.handleChange,value:h.values.parentId?h.values.parentId:"",placeholder:"Category",className:"text-primary w-100",disabled:D,hidden:!0}),e.jsx(v.Text,{className:"text-danger",children:h.touched.parentId&&h.errors.parentId?e.jsx("div",{className:"text-danger",children:h.errors.parentId?"required":""}):null})]})})]}),e.jsxs(v.Group,{controlId:"title",children:[e.jsx(v.Label,{children:"Title"}),e.jsx(v.Control,{as:"textarea",name:"title",placeholder:h.values.title==="new Question"?"new Question":"question text",ref:X,onChange:oe,value:h.values.title,rows:3,className:"text-primary w-100",disabled:D}),e.jsx(v.Text,{className:"text-danger",children:h.touched.title&&h.errors.title?e.jsx("div",{className:"text-danger",children:h.errors.title}):null})]}),e.jsxs(ue,{children:[e.jsx(ce,{children:e.jsxs(v.Group,{controlId:"source",children:[e.jsx(v.Label,{children:"Source"}),e.jsx(_e,{id:"source",name:"source",options:vt,onChange:(O,K)=>{O.preventDefault(),h.setFieldValue("source",K)},value:h.values.source,disabled:D,classes:"text-primary"}),e.jsx(v.Text,{className:"text-danger",children:h.touched.source&&h.errors.source?e.jsx("div",{className:"text-danger",children:h.errors.source}):null})]})}),e.jsx(ce,{children:e.jsxs(v.Group,{controlId:"status",children:[e.jsx(v.Label,{children:"Status"}),e.jsx(_e,{id:"status",name:"status",options:jt,onChange:(O,K)=>{O.preventDefault(),h.setFieldValue("status",K)},value:h.values.status,disabled:D,classes:"text-primary"}),e.jsx(v.Text,{className:"text-danger",children:h.touched.status&&h.errors.status?e.jsx("div",{className:"text-danger",children:h.errors.status}):null})]})})]}),(C||Q)&&e.jsxs("div",{className:"my-1",children:[e.jsx(m.Suspense,{fallback:e.jsx("div",{children:"Loading..."}),children:e.jsx(R,{questionKey:V,questionTitle:B,assignedAnswers:S,isDisabled:D})}),e.jsx(Kt,{questionKey:V,questionTitle:B,relatedFilters:A}),e.jsx($e,{created:t.created,modified:t.modified,classes:"text-primary"})]}),(h.dirty&&Q||N)&&e.jsx(Ve,{cancelForm:k,handleSubmit:h.handleSubmit,title:i}),y.error&&e.jsx("div",{className:"text-danger",children:y.error.message})]})]})},Qe=({closeModal:t,showCloseButton:l,source:i,setError:n})=>{const{state:o,cancelAddQuestion:g,createQuestion:y}=$(),{activeQuestion:x}=o,T=x?x.topId:"",r=async()=>{await g()},R=async C=>{const Q={...C,topId:T,created:{time:new Date,nickName:""},modified:void 0},N=await y(Q,t!==void 0);N&&(N.message?n(N.message):t&&t())};return x?e.jsx(Oe,{question:x,showCloseButton:l??!0,source:i??0,closeModal:r,submitForm:R,children:"Create Question"}):null},Je=({})=>{const{state:t,updateQuestion:l}=$(),{activeQuestion:i}=t;if(!i)return null;if(!i)return e.jsx("div",{children:"Loading question to edit..."});const n=async o=>{const g={...o,created:void 0,modified:{time:new Date,nickName:""}},{parentId:y}=i,x=y!==g.parentId;await l(y,g,x)};return e.jsx(Oe,{question:i,showCloseButton:!0,source:0,submitForm:n,children:"Update Question"})},Ze=({inLine:t})=>{console.log(t?"ViewQuestion inLine":"ViewQuestion not inLine");const{state:l}=$(),{activeQuestion:i}=l,[n,o]=m.useState(null);return m.useEffect(()=>{console.log("#################################### ViewQuestion setQuestion ...",{activeQuestion:i}),o(i)},[i]),e.jsx(Oe,{question:n,showCloseButton:!0,source:0,submitForm:()=>{},children:"View Question"})},zt=({questionRow:t,isSelected:l})=>{const{id:i,topId:n,parentId:o,title:g,numOfAssignedAnswers:y}=t,x={topId:n,parentId:o,id:o},{canEdit:T,authUser:r}=se(),{state:R,viewQuestion:C,addQuestion:Q,editQuestion:N,deleteQuestion:D}=$(),{activeQuestion:G,formMode:q,loadingQuestion:S,questionLoaded:A}=R,U=G!==null&&G.id===i,V=q===f.AddingQuestion,I=()=>{t.modified={time:new Date,nickName:r.nickName},D(t,U)},P=async j=>{console.log("QuestionRow onSelectQuestion",{id:j}),T?await N(t):await C(t)},[k,B]=Ce();m.useEffect(()=>{(async()=>{if(l&&!S&&!A){switch(q){case f.ViewingQuestion:await C(t);break;case f.EditingQuestion:console.log("Zovem from QuestionRow"),T?await N(t):await C(t);break}document.getElementById(`QuestionRow${i}`)?.scrollIntoView({behavior:"smooth",block:"end"})}})()},[T,N,q,i,l,S,A,t,C]);const L=e.jsxs("div",{id:`QuestionRow${i}`,className:`d-relative d-flex justify-content-start align-items-center w-100 mt-1 question-row${l?"-selected":""}`,style:{marginTop:"1px"},children:[e.jsx(z,{variant:"link",size:"sm",className:"d-flex align-items-center px-1 text-secondary",children:e.jsx("img",{width:"22",height:"18",src:_t,alt:"Question"})}),e.jsx(z,{variant:"link",size:"sm",className:`p-0 px-1 m-1 ms-0 question-row-title ${U?"fw-bold":""}`,title:`id:${i.toString()}`,onClick:()=>P(i),disabled:V,children:g}),e.jsxs(Re,{pill:!0,bg:"secondary",className:`text-info ${y===0?"d-none":"d-inline"}`,children:[y,"a"]}),T&&!V&&B&&e.jsxs("div",{className:"position-absolute text-nowrap d-flex align-items-center border border-0 border-warning p-0 end-0",children:[e.jsx(z,{variant:"link",size:"sm",className:"ms-1 p-0 text-secondary d-flex align-items-center",title:"Add Question",onClick:()=>{Q(x,!0)},children:e.jsx("img",{width:"22",height:"18",src:Ke,alt:"Add Question"})}),e.jsx(z,{variant:"link",size:"sm",className:"ms-0 p-0 text-secondary",onClick:I,children:e.jsx(ie,{icon:ve,size:"lg"})})]})]});return e.jsxs(ee.Item,{className:"py-0 px-0 w-100",as:"li",children:[l&&q===f.AddingQuestion&&e.jsxs(e.Fragment,{children:[e.jsx("div",{id:"div-question",className:"ms-0 d-md-none w-100",children:e.jsx(Qe,{showCloseButton:!0,source:0})}),e.jsx("div",{ref:k,className:"d-none d-md-block  border rounded-3",children:L})]}),l&&q===f.EditingQuestion&&e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:k,className:"",children:L}),e.jsx("div",{id:"div-question",className:"ms-0 d-md-none w-100",children:e.jsx(Je,{inLine:!0})})]}),l&&q===f.ViewingQuestion&&e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:k,className:"",children:L}),e.jsx("div",{ref:k,id:"div-question",className:"ms-0 d-md-none w-100",children:e.jsx(Ze,{inLine:!0})})]}),!l&&e.jsx("div",{ref:k,className:"",children:L})]})},et=({categoryRow:t})=>{const{state:l,loadCategoryQuestions:i}=$(),{keyExpanded:n,loadingQuestion:o,error:g,selectedQuestionId:y}=l,{questionId:x}=n;t.level+=1;const{questionRows:T}=t;let r=!1;async function R(){try{const N={categoryKey:new re(t).categoryKey,startCursor:T.length,includeQuestionId:x??null};console.log("^^^^^^^^^^^^^ loadMore"),console.log("^^^^^^^^^^^^^",{x:N}),console.log("^^^^^^^^^^^^^ loadMore"),await i(N)}catch{}finally{}}const[C,{rootRef:Q}]=Ot({loading:o,hasNextPage:r,onLoadMore:R,disabled:!!g,rootMargin:"0px 0px 100px 0px"});return e.jsxs("div",{ref:Q,className:"ms-0",style:{maxHeight:"400px",overflowY:"auto"},children:[e.jsxs(Qt,{children:[T.length===0&&e.jsx("label",{children:"No questions"}),T.map(N=>e.jsx(zt,{questionRow:N,isSelected:N.id===y},N.id)),r]}),g&&e.jsxs("p",{children:["Error: ",g.message]})]})},Yt=({categoryKey:t,tag:l,categoryInAdding:i})=>{const{name:n}=l,{canEdit:o}=se(),{state:g,deleteCategoryVariation:y}=$(),x=()=>{y(t,n)},[T,r]=Ce(),R=e.jsxs("div",{ref:T,children:[e.jsx(Re,{pill:!0,bg:"secondary",children:n}),o&&!0&&r&&e.jsx(z,{variant:"link",size:"sm",className:"ms-0 py-0 mx-0 text-secondary",onClick:x,children:e.jsx(ie,{icon:ve,size:"sm"})}),!1]});return e.jsx("div",{className:"py-1 px-1",children:R})},Wt=({categoryKey:t,variations:l})=>{const{state:i}=$(),{error:n}=i;return m.useEffect(()=>{},[]),e.jsxs("div",{className:"ms-2",children:[e.jsxs(Ne,{direction:"horizontal",gap:2,children:[l.length===0&&e.jsx("div",{children:"No variations"}),l.length>0&&l.map(o=>e.jsx(Yt,{categoryKey:t,tag:o,categoryInAdding:void 0}))]}),n&&e.jsxs("p",{children:["Error: ",n.message]})]})},Ae=({formMode:t,category:l,submitForm:i,children:n})=>{const{onCategoryTitleChanged:o}=$(),g=t===f.ViewingCategory,y=t===f.EditingCategory,x=t===f.AddingCategory,{topId:T,id:r,variations:R,questionRows:C,title:Q}=l;console.log("CategoryForm render: ",{topId:T,id:r,catTitle:Q,formMode:t});const N=new re(l).categoryKey;document.getElementById("div-details");const D=C&&C.length>0,G=je(),q=()=>{G({type:s.CLOSE_CATEGORY_FORM,payload:{}})},S=()=>{G({type:s.CANCEL_CATEGORY_FORM,payload:{}})},[A,U]=m.useState(Q),V=Me(A,300),I=Pe({enableReinitialize:!0,initialValues:l,validationSchema:Be().shape({title:Se().required("Required")}),onSubmit:L=>{console.log("CategoryForm.onSubmit",JSON.stringify(L,null,2)),i(L),U(L.title)}});m.useEffect(()=>{(async()=>{console.log("CategoryForm.useEffect - onCategoryTitleChanged",{debouncedSearchTerm:V,title:I.values.title}),await o(I.values,V)})()},[V,I.values,o]);const P=L=>{I.handleChange(L);const j=L.target.value;U(j)},k=m.useRef(null);m.useEffect(()=>{k.current.focus()},[l.title,k]);const B=!1;return console.log("CategoryForm render return: ",A),e.jsxs("div",{className:"form-wrapper p-2 category-form",children:[e.jsx(Ge,{onClick:q,className:"float-end"}),e.jsx(ue,{className:"text-center text-muted",children:e.jsxs(v.Label,{children:["Category ",g?"Viewing":y?"Editing":"Adding"]})}),e.jsxs(v,{onSubmit:()=>I.handleSubmit,children:[e.jsx(v.Group,{controlId:"Variations",children:e.jsxs(Ne,{direction:"horizontal",gap:1,children:[e.jsx("div",{className:"px-0",children:e.jsx(v.Label,{children:"Variations:"})}),e.jsx("div",{className:"px-1 border border-1 border-secondary rounded",children:e.jsx(Wt,{categoryKey:N,variations:R?R.map(L=>({name:L})):[]})}),e.jsx("div",{className:"ps-2",children:e.jsx(v.Label,{children:"Kind:"})}),e.jsx("div",{className:"px-1 border border-1 border-secondary rounded",children:e.jsxs(v.Group,{controlId:"kind",children:[e.jsx(_e,{id:"kind",name:"kind",options:At,onChange:(L,j)=>{L.preventDefault(),I.setFieldValue("kind",j)},value:I.values.kind,disabled:B,classes:"text-primary"}),e.jsx(v.Text,{className:"text-danger",children:I.touched.kind&&I.errors.kind?e.jsx("div",{className:"text-danger",children:I.errors.kind}):null})]})})]})}),e.jsxs(v.Group,{controlId:"title",children:[e.jsx(v.Label,{children:"Title"}),e.jsx(v.Control,{as:"textarea",name:"title",placeholder:I.values.title==="new Category"?"new Category":"category text",value:A,onChange:P,ref:k,rows:3,className:"text-primary w-100",disabled:g}),e.jsx(v.Text,{className:"text-danger",children:I.touched.title&&I.errors.title?e.jsx("div",{className:"text-danger",children:I.errors.title}):null})]}),e.jsxs(v.Group,{controlId:"link",children:[e.jsx(v.Label,{children:"Link"}),I.values.hasSubCategories?e.jsx(v.Control,{as:"input",placeholder:"/categories/...",name:"link",onChange:I.handleChange,className:"text-primary w-100",value:"Can't have link (has sub categories)",disabled:!0}):e.jsxs(e.Fragment,{children:[e.jsx(v.Control,{as:"input",placeholder:"/categories/...",name:"link",onChange:I.handleChange,className:"text-primary w-100",value:I.values.link??"",disabled:g}),e.jsx(v.Text,{className:"text-danger",children:I.touched.link&&I.errors.link?e.jsx("div",{className:"text-danger",children:I.errors.link}):null})]})]}),e.jsxs(v.Group,{children:[e.jsxs(v.Label,{className:"m-1 mb-0",children:["Questions (",`${I.values.numOfQuestions}`,") "]}),D&&e.jsx(et,{categoryRow:l})]}),(g||y)&&e.jsx($e,{created:l.created,modified:l.modified,classes:"text-primary"}),(I.dirty&&y||x)&&e.jsx(Ve,{cancelForm:S,handleSubmit:I.handleSubmit,title:n})]})]})},tt=({inLine:t})=>{const l=se(),{nickName:i}=l.authUser,{state:n,updateCategory:o}=$(),{activeCategory:g,keyExpanded:y}=n,{questionId:x}=y,T=async r=>{const R={...r,created:void 0,modified:{time:new Date,nickName:i}};await o(R,!0)};return e.jsx(Ae,{inLine:t,category:{...g},questionId:x,formMode:f.EditingCategory,submitForm:T,children:"Update Category"})},ot=({inLine:t})=>{const{state:l}=$(),{activeCategory:i,keyExpanded:n}=l,{questionId:o}=n;return e.jsx(Ae,{inLine:t,category:{...i},questionId:o,formMode:f.ViewingCategory,submitForm:()=>{},children:"View Category"})},st=({activeCategory:t})=>{const l=se(),{nickName:i}=l.authUser,{createCategory:n}=$(),[o]=m.useState({...t}),g=async y=>{const x={...y,created:{time:new Date,nickName:i},modified:void 0};console.log("**********object",x),await n(x)};return!t===null?null:(console.log("AddCategory render >>>>>:",t),e.jsx(e.Fragment,{children:e.jsx(Ae,{inLine:!1,category:o,questionId:null,formMode:f.AddingCategory,submitForm:g,children:"Create Category"})}))},Ht=({categoryRow:t,questionId:l})=>{const{id:i,title:n,hasSubCategories:o,numOfQuestions:g,isExpanded:y}=t;t.level+=1;const x=new re(t).categoryKey,{canEdit:T,authUser:r}=se(),{state:R,addSubCategory:C,viewCategory:Q,editCategory:N,deleteCategory:D,expandCategory:G,collapseCategory:q,addQuestion:S}=$();let{formMode:A,activeCategory:U,loadingCategory:V,categoryLoaded:I}=R;const P=U!==null&&U.id===i,k=A===f.AddingCategory,B=y&&g>0,L=()=>{t.modified={time:new Date,nickName:r.nickName},D(t)},j=async()=>{if(y)await q(t);else{const ne={categoryKey:x,byClick:!0,formMode:T?f.EditingCategory:f.ViewingCategory};await G(ne)}},te=async()=>{T?await N(t,l??"null"):await Q(t,l??"null")},[X,h]=m.useState(!1);m.useEffect(()=>{X&&(C(t),h(!1))},[C,t,X]);const[oe,F]=m.useState(!1);m.useEffect(()=>{oe&&(S(x,y??!1),F(!1))},[S,x,y,oe]),m.useEffect(()=>{(async()=>{if(P&&!V&&!I&&!k)switch(console.log("CategoryRow formMode:",A),A){case f.ViewingCategory:await Q(t,l??"null");break;case f.EditingCategory:T?await N(t,l??"null"):await Q(t,l??"null");break}})()},[T,x,I,t,N,G,A,k,P,V,l,Q]);const[O,K]=Ce(),Y=e.jsxs("div",{children:[e.jsxs("div",{id:`Row${i}`,className:`d-relative d-flex justify-content-start align-items-center w-100 mt-1 category-row${P?"-selected":""}`,style:{marginTop:"1px"},children:[e.jsx(z,{variant:"link",size:"sm",className:"py-0 px-1",onClick:ne=>{j(),ne.stopPropagation()},title:"Expand",disabled:k||!o&&g===0,children:e.jsx(ie,{icon:y?Fe:Ue,size:"lg"})}),e.jsx(z,{variant:"link",size:"sm",className:"py-0 px-1 bg-light",title:"Expand",disabled:!0,children:e.jsx(ie,{icon:bt,size:"sm"})}),e.jsx(z,{variant:"link",size:"sm",className:`py-0 ms-0 me-1 category-row-title ${P?"fw-bold text-white bg-transparent":""}`,title:i,onClick:te,disabled:k,children:n}),g>0&&e.jsxs(Re,{pill:!0,bg:"secondary",className:"d-inline bg-transparent",children:[g,"Q"]}),T&&K&&e.jsxs("div",{className:"position-absolute text-nowrap d-flex align-items-center border border-0 border-warning p-0 end-0",children:[e.jsx("div",{className:"d-flex align-items-center",children:e.jsx(z,{variant:"link",size:"sm",className:"border-0 py-0 px-0 ms-0 text-success",title:"Add SubCategory",onClick:async()=>{!y&&(o||g>0)&&await j(),setTimeout(()=>h(!0),500)},children:e.jsx(ie,{icon:Dt,size:"lg"})})}),!k&&!o&&e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(z,{variant:"link",size:"sm",className:"p-0 mx-0 text-secondary d-flex align-items-center border border-0 border-warning1",title:"Add Question",onClick:async()=>{!y&&(o||g>0)&&await j(),setTimeout(()=>F(!0),500)},children:e.jsx("img",{width:"22",height:"18",src:Ke,alt:"Add Question"})}),e.jsx(z,{variant:"link",size:"sm",className:"d-flex align-items-center border border-0 border-warning p-0",disabled:o||g>0,onClick:L,children:e.jsx(ie,{icon:ve,size:"lg"})})]})]})]}),B&&e.jsx("div",{className:"ps-3",children:e.jsx(et,{categoryRow:t})})]});return e.jsxs(e.Fragment,{children:[e.jsxs(ee.Item,{className:"py-0 px-1 w-100 category-bg",as:"li",children:[P&&A===f.AddingCategory&&e.jsxs("div",{children:[e.jsx("div",{ref:O,className:"",children:Y}),e.jsx("div",{className:"ms-0 d-md-none w-100",children:e.jsx(st,{activeCategory:U})})]}),P&&A===f.EditingCategory&&e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:O,className:"",children:Y}),e.jsx("div",{id:"divInLine",className:"ms-0 d-md-none w-100",children:e.jsx(tt,{inLine:!1})})]}),P&&A===f.ViewingCategory&&e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:O,className:"",children:Y}),e.jsx("div",{id:"divInLine",className:"ms-0 d-md-none w-100",children:e.jsx(ot,{inLine:!1})})]}),!P&&e.jsx("div",{ref:O,className:"",children:Y})]}),R.error&&R.whichRowId===i&&e.jsx("div",{className:"text-danger",children:R.error.message}),y&&e.jsx(ee.Item,{className:"py-0 px-0 border-0 border-warning border-bottom-0 category-bg",variant:"primary",as:"li",children:y&&e.jsx(e.Fragment,{children:o&&e.jsx(nt,{categoryRow:t,title:n,isExpanded:y})})})]})},nt=({categoryRow:t,title:l})=>{const{state:i}=$();let{keyExpanded:n}=i;const{questionId:o}=n??{questionId:null};let g=1,y=[];return l==="ROOT"?y=i.topRows:(y=t.categoryRows,g=t.level),e.jsx("div",{className:g>1?"ms-2":"",children:e.jsx(ee,{as:"ul",variant:"dark",className:"mb-0 category-bg",children:y.map(x=>e.jsx(Ht,{categoryRow:x,questionId:o},x.id))})})},Xt=t=>{const{isDarkMode:l}=se(),[i,n]=m.useState("");return m.useEffect(()=>{},[]),e.jsxs(we,{show:t.show,onHide:t.onHide,animation:!0,centered:!0,size:"lg",className:"modal show",contentClassName:`${l?"bg-secondary bg-gradient":"bg-info bg-gradient"}`,children:[e.jsx(we.Header,{closeButton:!0,children:"Store new Question to the Database"}),e.jsx(we.Body,{className:"py-0",children:e.jsx(Qe,{closeModal:t.onHide,showCloseButton:!1,source:1,setError:o=>n(o)})}),e.jsx(we.Footer,{children:i})]})},Jt=({categoryId_questionId:t,fromChatBotDlg:l})=>{const{state:i,expandNodesUpToTheTree:n,loadTopRows:o,addSubCategory:g}=$(),{allCategoryRows:y,topRows:x,topRowsLoading:T,topRowsLoaded:r,keyExpanded:R,categoryId_questionId_done:C,nodeOpening:Q,nodeOpened:N,activeCategory:D,activeQuestion:G,formMode:q,loadingCategories:S,loadingCategory:A,loadingQuestions:U,loadingQuestion:V}=i,{searchQuestions:I,setLastRouteVisited:P}=qe(),{isDarkMode:k}=se(),[B,L]=m.useState(!1),[j,te]=m.useState({...Ie}),X=je(),h=async F=>{X({type:s.SET_QUESTION_SELECTED,payload:{questionKey:F}})};let oe="";return m.useEffect(()=>{(async()=>!T&&!r&&(console.log("ZOVEM 111 loadTopRows()"),await o()))()},[T,r,o]),m.useEffect(()=>{(async()=>{if(!Q&&x.length>0){if(t){if(t==="add_question"){const F=localStorage.getItem("New_Question");if(F){const O=JSON.parse(F);return te({...Ie,categoryTitle:"Select",...O}),L(!0),localStorage.removeItem("New_Question"),null}}else if(t!==C){const F=t.split("_"),O=F[0],K=F[1],Y={topId:"",id:O,parentId:"ROOT"};console.log("zovem expandNodesUpToTheTree 1111111111111111111)",{categoryId_questionId:t},{categoryId_questionId_done:C}),await n(Y,K,l??"false").then(()=>null)}}else if(R&&!N){const{topId:F,categoryId:O,questionId:K}=R;if(O!==""){const Y={topId:F,id:O,parentId:"ROOT"};console.log("zovem expandNodeUpToTheTree 2222222222222)",{keyExpanded:R,catKey:Y}),await n(Y,K).then(()=>null)}}}})()},[R,Q,N,n,t,C,x,l]),m.useEffect(()=>{P("/categories")},[P]),t!=="add_question"&&t&&t!==C?(console.log("zzzzzz loading...",{keyExpanded:R,categoryId_questionId:t,categoryId_questionId_done:C}),e.jsx("div",{children:"loading..."})):!r||x.length===0?(console.log("===>>> Categories  VRATIO"),null):(console.log("===>>> Categories !!!!!!!!!!!!!!!!!",D),e.jsxs(e.Fragment,{children:[e.jsxs(Nt,{children:[e.jsxs("h5",{className:"text-warning mx-auto w-75 fw-bold",children:[e.jsx("span",{className:"categories",children:"Categories / "}),e.jsx("span",{className:"questions",children:"Questions"})]}),e.jsx(ue,{className:`${k?"dark":""}`,children:e.jsx(ce,{children:e.jsx("div",{className:"d-flex justify-content-start align-items-center",children:e.jsx("div",{className:"w-75 my-1 questions",children:e.jsx(qt,{tekst:oe,onSelectQuestion:h,allCategoryRows:y,searchQuestions:I})})})})}),e.jsx(z,{variant:"secondary",size:"sm",type:"button",style:{padding:"1px 4px"},onClick:()=>g(null),children:"Add Category"}),e.jsxs(ue,{className:"my-1 h-auto",children:[e.jsx(ce,{xs:12,md:5,children:e.jsx("div",{className:"categories-border",style:{position:"relative"},children:e.jsx(nt,{categoryRow:null,title:"ROOT",isExpanded:!0})})}),e.jsx(ce,{xs:0,md:7,children:e.jsxs("div",{id:"div-details",className:"d-none d-md-block",children:[D&&q===f.ViewingCategory&&e.jsx(ot,{inLine:!1}),D&&q===f.EditingCategory&&e.jsx(tt,{inLine:!1}),D&&q===f.AddingCategory&&e.jsx(st,{activeCategory:D}),G&&q===f.ViewingQuestion&&e.jsx(Ze,{inLine:!1}),G&&q===f.EditingQuestion&&e.jsx(Je,{inLine:!1}),G&&q===f.AddingQuestion&&e.jsx(Qe,{})]})})]})]}),B&&G&&e.jsx(Xt,{show:B,onHide:()=>{L(!1)},newQuestionRow:j}),(S||U)&&e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{position:"absolute",top:"40%",left:"20%"},children:e.jsx("div",{className:`spinner-border ${U?"question":"category"}-spinner`,role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})}),A&&e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{position:"absolute",top:"50%",left:"50%"},children:e.jsx("div",{className:"spinner-border category-spinner",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})}),V&&e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{position:"absolute",top:"50%",left:"50%"},children:e.jsx("div",{className:"spinner-border question-spinner",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})})]}))},Zt=()=>{let{categoryId_questionId:t,fromChatBotDlg:l}=It();if(t&&t==="categories"&&(t=void 0),t){const i=t.split("_");console.assert(i.length===2,"expected 'categoryId_questionId'")}return e.jsx(Mt,{children:e.jsx(Jt,{categoryId_questionId:t,fromChatBotDlg:l})})},no=Object.freeze(Object.defineProperty({__proto__:null,default:Zt},Symbol.toStringTag,{value:"Module"}));export{no as C,$ as u};
//# sourceMappingURL=Categories-BtJHztc9.js.map
