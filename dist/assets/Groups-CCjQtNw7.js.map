{"version":3,"file":"Groups-CCjQtNw7.js","sources":["../../src/groups/GroupReducer.tsx","../../src/groups/GroupProvider.tsx","../../src/assets/APlus.png","../../src/global/Components/SelectGroup/types.ts","../../src/global/Components/SelectGroup/GrpRow.tsx","../../src/global/Components/SelectGroup/GrpReducer.tsx","../../src/global/Components/SelectGroup/GrpList.tsx","../../src/groups/components/answers/AnswerForm.tsx","../../src/groups/components/answers/AddAnswer.tsx","../../src/groups/components/answers/EditAnswer.tsx","../../src/groups/components/answers/ViewAnswer.tsx","../../src/groups/components/answers/AnswerRow.tsx","../../src/groups/components/answers/AnswerList.tsx","../../src/groups/VariationRow.tsx","../../src/groups/VariationList.tsx","../../src/groups/components/GroupForm.tsx","../../src/groups/components/EditGroup.tsx","../../src/groups/components/ViewGroup.tsx","../../src/groups/components/AddGroup.tsx","../../src/groups/components/GroupRow.tsx","../../src/groups/components/GroupList.tsx","../../src/groups/ModalAddAnswer.tsx","../../src/groups/Groups.tsx"],"sourcesContent":["import { type Reducer } from 'react'\r\nimport {\r\n  ActionTypes, type Actions, type ILocStorage, IsGroup,\r\n  type IGroupsState, type IGroup, type IGroupRow, type IAnswer,\r\n  actionStoringToLocalStorage, FormMode, doNotModifyTree, doNotCallInnerReducerActions\r\n} from \"@/groups/types\";\r\n\r\nexport const subGrpRow: IGroupRow = {\r\n  topId: 'generateId', // for top rows: topId = ToUpperCase(id)\r\n  id: 'generateId',\r\n  parentId: null,\r\n  level: 1,\r\n  isExpanded: false,\r\n  groupRows: [],\r\n  kind: 0,\r\n  title: '',\r\n  link: null,\r\n  header: '',\r\n  hasSubGroups: false,\r\n  variations: [],\r\n  numOfAnswers: 0,\r\n  answerRows: []\r\n}\r\n\r\nexport const initialAnswer: IAnswer = {\r\n  topId: '',\r\n  parentId: 'null',\r\n  id: 'generateId', //  keep 'generateId', it is expected at BackEnd\r\n  groupTitle: '',\r\n  title: '',\r\n  source: 0,\r\n  status: 0,\r\n  included: false\r\n}\r\n\r\nexport const initialGroup: IGroup = {\r\n  topId: 'null',\r\n  parentId: 'null',\r\n  id: 'define at BackEnd',\r\n  kind: 0,\r\n  title: '',\r\n  link: '',\r\n  header: '',\r\n  level: 0,\r\n  variations: [],\r\n  hasSubGroups: false,\r\n  groupRows: [],\r\n  answerRows: [],\r\n  numOfAnswers: 0,\r\n  hasMoreAnswers: false,\r\n  isExpanded: false,\r\n  doc1: ''\r\n}\r\n\r\nexport const GroupReducer: Reducer<IGroupsState, Actions> = (state, action) => {\r\n\r\n  console.log('------------------------------->')\r\n  console.log('----------------------- GroupReducer >', action.type)\r\n  console.log('------------------------------->')\r\n  // ----------------------------------------------------------------------\r\n  // Rubljov: \"By giving the right name, you reveal the essence of things\"\r\n  // ----------------------------------------------------------------------\r\n  //\r\n  // - firstLevelGroupRow AAA\r\n  // ------> groupRow AAA.1\r\n  // --------- > groupRow AAA 1.1\r\n  // --------- > ...\r\n  //\r\n  // ------> groupRow AAA.2\r\n  // --------- > groupRow AAA 2.1\r\n  // --------- > groupRow AAA 2.2\r\n  // ------------ > Group Row AAA 2.2.1\r\n  // ------------ > groupRow AAA 2.2.2\r\n  // --------------- > groupRow AAA 2.2.2.1\r\n  // --------------- > groupRow AAA 2.2.2.2\r\n  //\r\n  // --------- > groupRow AAA 2.3\r\n  //\r\n  // - firstLevelGroupRow BBB\r\n  // - ...\r\n\r\n  const { groupRow } = action.payload;\r\n  // const isGroup = IsGroup(groupRow); // IGroup rather than IGroupRow\r\n\r\n  if (action.type === ActionTypes.SET_FROM_LOCAL_STORAGE) {\r\n    const { keyExpanded } = action.payload;\r\n    return {\r\n      ...state,\r\n      keyExpanded\r\n    }\r\n  }\r\n\r\n  let modifyTree = groupRow\r\n    ? doNotModifyTree.includes(action.type) ? false : true\r\n    : false;\r\n\r\n  const { topRows } = state;\r\n\r\n\r\n  const newState = doNotCallInnerReducerActions.includes(action.type)\r\n    ? { ...state }\r\n    : innerReducer(state, action);\r\n\r\n  // return { ...state } // calling this, state would be destroyed, because of shallow copy\r\n  // Action that modify Tree\r\n  // Actually part topRows of state\r\n  if (modifyTree && groupRow) { //} && groupRow.topId !== 'ROOT') {\r\n    let newTopRows: IGroupRow[];\r\n    const { topId, id } = groupRow!;\r\n    if (id === topId) {\r\n      // actually topRows is from previous state\r\n      newTopRows = topRows.map(c => c.id === topId\r\n        ? new DeepClone(groupRow!).groupRow\r\n        : new DeepClone(c).groupRow\r\n      );\r\n    }\r\n    else {\r\n      // actually topRows is from previous state\r\n      const topRow: IGroupRow = topRows.find(c => c.id === topId)!;\r\n      DeepClone.idToSet = id;\r\n      DeepClone.newGroupRow = groupRow!;\r\n      const newTopRow = new DeepClone(topRow).groupRow;\r\n      newTopRows = topRows.map(c => c.id === topId\r\n        ? newTopRow\r\n        : new DeepClone(c).groupRow\r\n      );\r\n      DeepClone.idToSet = '';\r\n    }\r\n    newState.topRows = newTopRows;\r\n  }\r\n  else {\r\n    // just clone to enable time-travel debugging\r\n  }\r\n\r\n  if (actionStoringToLocalStorage.includes(action.type)) {\r\n    const { keyExpanded } = newState;\r\n    const locStorage: ILocStorage = {\r\n      keyExpanded\r\n    }\r\n    localStorage.setItem('GROUPS_STATE', JSON.stringify(locStorage));\r\n  }\r\n\r\n  console.log('GroupReducer newState', newState)\r\n  return newState;\r\n}\r\n\r\nconst innerReducer = (state: IGroupsState, action: Actions): IGroupsState => {\r\n  switch (action.type) {\r\n\r\n    //////////////////////////////////////////////////\r\n    // Rows Level: 1\r\n\r\n    case ActionTypes.SET_TOP_ROWS_LOADING:\r\n      return {\r\n        ...state,\r\n        loadingGroups: true,\r\n        topRowsLoading: true,\r\n        //topRowsLoaded: false\r\n      }\r\n\r\n    case ActionTypes.SET_TOP_ROWS: {\r\n      const { topRows } = action.payload;\r\n      console.log('=> GroupsReducer ActionTypes.SET_TOP_ROWS', state.topRows, topRows)\r\n      return {\r\n        ...state,\r\n        topRows,\r\n        topRowsLoading: false,\r\n        topRowsLoaded: true,\r\n        loadingGroups: false\r\n      };\r\n    }\r\n\r\n    case ActionTypes.SET_ALL_GROUP_ROWS: {\r\n      const { allGroupRows } = action.payload;\r\n      return {\r\n        ...state,\r\n        allGroupRows,\r\n        allGroupRowsLoaded: Date.now()\r\n      };\r\n    }\r\n\r\n\r\n    case ActionTypes.SET_NODE_EXPANDING_UP_THE_TREE: {\r\n      const { fromChatBotDlg } = action.payload;\r\n      const { keyExpanded, activeGroup, activeAnswer } = state;\r\n      return {\r\n        ...state,\r\n        nodeOpening: true,\r\n        loadingGroups: true,\r\n        nodeOpened: false,\r\n        keyExpanded: fromChatBotDlg ? null : { ...keyExpanded! },\r\n        activeGroup: fromChatBotDlg ? null : activeGroup,\r\n        activeAnswer: fromChatBotDlg ? null : activeAnswer\r\n      }\r\n    }\r\n\r\n    case ActionTypes.SET_NODE_EXPANDED_UP_THE_TREE: {\r\n      const { group, formMode, grpKey, answerId, answer } = action.payload;\r\n      const { id } = grpKey; //;\r\n      return {\r\n        ...state,\r\n        activeGroup: group,\r\n        activeAnswer: answer,\r\n        selectedAnswerId: answerId,\r\n        formMode,\r\n        groupId_answerId_done: `${id}_${answerId}`,\r\n        nodeOpening: false,\r\n        nodeOpened: true,\r\n        loadingGroups: false,\r\n      };\r\n    }\r\n\r\n    case ActionTypes.SET_LOADING_GROUP:\r\n      return {\r\n        ...state,\r\n        //activeGroup: null,\r\n        loadingGroup: true,\r\n        groupLoaded: false\r\n      }\r\n\r\n\r\n    // case ActionTypes.FORCE_OPEN_NODE:\r\n    //   const { keyExpanded } = action.payload;\r\n    //   return {\r\n    //     ...state,\r\n    //     nodeOpening: false,\r\n    //     nodeOpened: false,\r\n    //     topRows: [],\r\n    //     topRowsLoaded: false,\r\n    //     keyExpanded\r\n    //   }\r\n\r\n    case ActionTypes.FORCE_GROUP_OPEN_NODE:\r\n      const { keyExpanded } = action.payload;\r\n      return {\r\n        ...state,\r\n        topRows: state.topRows.filter(row => row.parentId === null),\r\n        keyExpanded,\r\n        nodeOpened: false, // keep topRows, and openNode\r\n        activeGroup: null,\r\n        activeAnswer: null,\r\n        selectedAnswerId: null\r\n      }\r\n\r\n    // case ActionTypes.RESET_GROUP_ANSWER_DONE: {\r\n    //   return {\r\n    //     ...state,\r\n    //     groupId_answerId_done: undefined,\r\n    //     groupNodeLoaded: false\r\n    //   };\r\n    // }\r\n\r\n    case ActionTypes.SET_SUB_GROUPS: {\r\n      //const { groupRows } = action.payload;\r\n      //const { topRows } = state;\r\n      //groupRows.forEach((groupRow: IGroupRow) => {\r\n      //const { id, hasSubGroups, numOfAnswers } = groupRow;\r\n      //})\r\n      return {\r\n        ...state,\r\n        loadingGroup: false,\r\n        //groupLoaded: false proveri\r\n      };\r\n    }\r\n\r\n\r\n    case ActionTypes.SET_GROUP_ERROR: {\r\n      const { error, whichRowId } = action.payload; // group.id or answer.id\r\n      return {\r\n        ...state,\r\n        error,\r\n        whichRowId,\r\n        loadingGroups: false,\r\n        loadingAnswers: false,\r\n        loadingGroup: false, groupLoaded: false,\r\n        loadingAnswer: false, answerLoaded: false\r\n      };\r\n    }\r\n\r\n    case ActionTypes.ADD_SUB_GROUP: {\r\n      const { groupKey, level } = action.payload;\r\n      const { topId } = groupKey;\r\n      const group: IGroup = {\r\n        ...initialGroup,\r\n        topId,\r\n        level,\r\n        parentId: '' //null\r\n      }\r\n      return {\r\n        ...state,\r\n        activeGroup: group,\r\n        formMode: FormMode.AddingGroup\r\n      };\r\n    }\r\n\r\n    /*\r\n    case ActionTypes.SET_GROUP_ADDED: {\r\n      const { groupRow } = action.payload;\r\n      return {\r\n        ...state,\r\n        // TODO Popravi\r\n        formMode: FormMode.None,\r\n        activeGroup: groupRow!,\r\n        loading: false\r\n      }\r\n    }\r\n      */\r\n\r\n\r\n    // case ActionTypes.SET_GROUP_ROW: {\r\n    //   const { groupRow } = action.payload; // group doesn't contain  inAdding \r\n    //   console.assert(IsGroup(groupRow));\r\n    //   const groupKey = new GroupKey(groupRow).groupKey!;\r\n    //   return {\r\n    //     ...state,\r\n    //     // keep mode\r\n    //     loadingGroup: false,\r\n    //     //keyExpanded: { ...groupKey },\r\n    //     activeGroup: groupRow,\r\n    //     activeAnswer: null\r\n    //   }\r\n    // }\r\n\r\n    case ActionTypes.SET_GROUP: {\r\n      const { groupRow } = action.payload; // group doesn't contain  inAdding \r\n      console.assert(IsGroup(groupRow));\r\n      //const groupKey = new GroupKey(groupRow).groupKey!;\r\n      return {\r\n        ...state,\r\n        // keep mode\r\n        loadingGroup: false,\r\n        groupLoaded: true,\r\n        //keyExpanded: { ...groupKey },\r\n        activeGroup: groupRow,\r\n        activeAnswer: null,\r\n        selectedAnswerId: null,\r\n\r\n      }\r\n    }\r\n\r\n    case ActionTypes.SET_ROW_EXPANDING: {\r\n      return {\r\n        ...state,\r\n        rowExpanding: true,\r\n        rowExpanded: false,\r\n        loadingGroups: true\r\n      }\r\n    }\r\n\r\n    case ActionTypes.SET_ROW_EXPANDED: {\r\n      const { groupRow } = action.payload; // , selectedAnswerId\r\n      const { topId, id } = groupRow;\r\n      const { keyExpanded } = state;\r\n      const answerId = keyExpanded ? keyExpanded.answerId : null; // (topId === keyExpanded?.topId && id === keyExpanded.groupId)\r\n      //? keyExpanded.answerId\r\n      //: null;\r\n      // Do not work with groupRow, \r\n      // groupRow will be proccesed in GroupReducer, rather than in innerReducer\r\n      return {\r\n        ...state,\r\n        // keep mode\r\n        loadingGroups: false,\r\n        keyExpanded: {\r\n          topId,\r\n          groupId: id,\r\n          answerId\r\n        },\r\n        //activeGroup: null,\r\n        activeAnswer: null,\r\n        selectedAnswerId: answerId, //selectedAnswerId ?? null,\r\n        loadingAnswer: false,\r\n        answerLoaded: false,\r\n        rowExpanding: false,\r\n        rowExpanded: true\r\n        //formMode\r\n      }\r\n    }\r\n\r\n    // case ActionTypes.SET_ROW_COLLAPSING: {\r\n    //   return {\r\n    //     ...state,\r\n    //     // keep mode\r\n    //     loadingGroups: true, \r\n    //     rowExpanding: true, // actually collapsing\r\n    //     rowExpanded: false\r\n    //   }\r\n    // }\r\n\r\n\r\n    case ActionTypes.SET_ROW_COLLAPSED: {\r\n      const { groupRow } = action.payload; // group doesn't contain  inAdding \r\n      const { topId, parentId } = groupRow;\r\n      //const groupKey = new GroupKey(groupRow).groupKey\r\n      return {\r\n        ...state,\r\n        // keep mode\r\n        loadingGroups: false,\r\n        keyExpanded: { topId, groupId: parentId ?? '', answerId: null },\r\n        rowExpanding: false, // actually collapsing\r\n        rowExpanded: true,\r\n        activeGroup: null,\r\n        activeAnswer: null,\r\n        selectedAnswerId: null\r\n      }\r\n    }\r\n\r\n\r\n    case ActionTypes.SET_GROUP_TO_VIEW: {\r\n      const { groupRow } = action.payload;\r\n      console.assert(IsGroup(groupRow))\r\n      const group: IGroup = groupRow as IGroup;\r\n      const activeGroup: IGroup = { ...group, isExpanded: false }\r\n      //const { topId, id, parentId } = group;\r\n      return {\r\n        ...state,\r\n        formMode: FormMode.ViewingGroup,\r\n        loadingGroup: false,\r\n        //keyExpanded: { ...state.keyExpanded, answerId: null },\r\n        activeGroup,\r\n        activeAnswer: null,\r\n        selectedAnswerId: null\r\n      };\r\n    }\r\n\r\n    case ActionTypes.SET_GROUP_TO_ADD_TOP: {\r\n      const { newGroupRow } = action.payload; // IGroup extends IGroupRow\r\n      //const { topId } = group;\r\n      //console.assert(IsGroup(groupRow))\r\n      // TODO what about instanceof?\r\n      return {\r\n        ...state,\r\n        loadingGroup: false,\r\n        groupLoaded: true,\r\n        activeGroup: { ...newGroupRow, doc1: '' },\r\n        activeAnswer: null,\r\n        selectedAnswerId: null,\r\n        topRows: [newGroupRow!, ...state.topRows],\r\n        formMode: FormMode.AddingGroup,\r\n      };\r\n    }\r\n\r\n    case ActionTypes.SET_GROUP_TO_ADD: {\r\n      const { newGroupRow } = action.payload; // IGroup extends IGroupRow\r\n      //const { topId } = group;\r\n      //console.assert(IsGroup(groupRow))\r\n      // TODO what about instanceof?\r\n      return {\r\n        ...state,\r\n        loadingGroup: false,\r\n        groupLoaded: true,\r\n        activeGroup: { ...newGroupRow!, doc1: '' },\r\n        activeAnswer: null,\r\n        selectedAnswerId: null,\r\n        formMode: FormMode.AddingGroup\r\n      };\r\n    }\r\n\r\n    case ActionTypes.SET_GROUP_ADDED: {\r\n      const { groupRow } = action.payload; // IGroup extends IGroupRow\r\n      console.assert(IsGroup(groupRow))\r\n      // TODO what about instanceof?\r\n      const group: IGroup = groupRow as IGroup;\r\n      const activeGroup: IGroup = { ...group, isExpanded: false }\r\n      const { topId, id } = activeGroup;\r\n      //const { parentId } = group;\r\n      //const topRowsLoaded = parentId ? true : false;\r\n      return {\r\n        ...state,\r\n        formMode: FormMode.EditingGroup, // none\r\n        loadingGroup: false,\r\n        groupLoaded: false,\r\n        //topRowsLoaded,\r\n        //groupKeyExpanded: state.groupKeyExpanded ? { ...state.groupKeyExpanded, answerId: null } : null,\r\n        activeGroup,\r\n        activeAnswer: null,\r\n        selectedAnswerId: null,\r\n        keyExpanded: { topId, groupId: id, answerId: null }, // set id to call openNode from groups\r\n        nodeOpened: false\r\n      };\r\n    }\r\n\r\n    case ActionTypes.SET_GROUP_TO_EDIT:   // doesn't modify Tree\r\n    case ActionTypes.SET_GROUP_UPDATED: { // modifies Tree\r\n      const { groupRow, group } = action.payload; // IGroup extends IGroupRow\r\n      console.assert(IsGroup(groupRow))\r\n      // TODO what about instanceof?\r\n      //const activeGroup: IGroup = { ...group, isExpanded: false }\r\n      const { topId, id } = group;\r\n      return {\r\n        ...state,\r\n        formMode: FormMode.EditingGroup,\r\n        loadingGroup: false,\r\n        groupLoaded: true,\r\n        keyExpanded: { topId, groupId: id, answerId: null },\r\n        //keyExpanded: null, //{ topId, groupId: parentId!, answerId: null },\r\n        //groupKeyExpanded: state.groupKeyExpanded ? { ...state.groupKeyExpanded, answerId: null } : null,\r\n        activeGroup: group,\r\n        activeAnswer: null,\r\n        selectedAnswerId: null,\r\n      };\r\n    }\r\n\r\n    case ActionTypes.SET_ANSWERS_LOADING:\r\n      //const { loadingAnswer } = action.payload; // group doesn't contain inAdding \r\n      return {\r\n        ...state,\r\n        loadingAnswers: true,\r\n        answerLoaded: false\r\n      }\r\n\r\n    case ActionTypes.GROUP_ANSWERS_LOADED: {\r\n      // const { groupRow } = action.payload;\r\n      //const { id, topId: topId, answerRows, hasMoreAnswers } = groupRow;\r\n      return {\r\n        ...state,\r\n        //loadingAnswer: false,\r\n        loadingAnswers: false\r\n      }\r\n    }\r\n\r\n    case ActionTypes.DELETE_GROUP: {\r\n      //const { id } = action.payload;\r\n      // TODO Popravi\r\n      return {\r\n        ...state,\r\n        activeGroup: null,\r\n        formMode: FormMode.None,\r\n        error: undefined,\r\n        whichRowId: undefined\r\n      };\r\n    }\r\n\r\n    case ActionTypes.CANCEL_GROUP_FORM:\r\n    case ActionTypes.CLOSE_GROUP_FORM: {\r\n      return {\r\n        ...state,\r\n        activeGroup: null,\r\n        formMode: FormMode.None\r\n      };\r\n    }\r\n\r\n\r\n    // First we add a new answer to the group.guestions\r\n    // After user clicks Save, we call createAnswer \r\n    /*\r\n    case ActionTypes.ADD_ANSWER: {\r\n      const { groupInfo } = action.payload;\r\n      const { groupKey, level } = groupInfo;\r\n      const { topId, id } = groupKey;\r\n      const answer: IAnswer = {\r\n        ...initialAnswer,\r\n        topId: id ?? '',\r\n        parentId: id,\r\n        inAdding: true\r\n      }\r\n      return {\r\n        ...state,\r\n        mode: Mode.AddingAnswer,\r\n        activeAnswer: answer\r\n      };\r\n    }\r\n    */\r\n\r\n    case ActionTypes.CANCEL_ADD_SUB_GROUP: {\r\n      return {\r\n        ...state,\r\n        activeGroup: null,\r\n        activeAnswer: null,\r\n        selectedAnswerId: null,\r\n        formMode: FormMode.None\r\n      };\r\n    }\r\n\r\n    case ActionTypes.SET_LOADING_ANSWER:\r\n      return {\r\n        ...state,\r\n        loadingAnswer: true,\r\n        answerLoaded: false\r\n      }\r\n\r\n    case ActionTypes.CANCEL_ADD_ANSWER: {\r\n      return {\r\n        ...state,\r\n        formMode: FormMode.None,\r\n        activeAnswer: null,\r\n        selectedAnswerId: null\r\n      };\r\n    }\r\n\r\n    case ActionTypes.SET_ANSWER_SELECTED: { // from Groups / AutoSuggestAnswer\r\n      const { answerKey } = action.payload;\r\n      const { topId, parentId: groupId, id: answerId } = answerKey;\r\n      return {\r\n        ...state,\r\n        topRows: state.topRows.filter(row => row.parentId === null),\r\n        keyExpanded: {\r\n          topId,\r\n          groupId: groupId,\r\n          answerId\r\n        },\r\n        nodeOpened: false, // keep topRows, and openNode\r\n        activeGroup: null,\r\n        activeAnswer: null,\r\n        selectedAnswerId: null\r\n      };\r\n    }\r\n\r\n\r\n    case ActionTypes.ADD_NEW_ANSWER_TO_ROW: {\r\n      const { newAnswerRow } = action.payload;\r\n      return {\r\n        ...state,\r\n        selectedAnswerId: newAnswerRow.id\r\n      };\r\n    }\r\n\r\n\r\n    case ActionTypes.SET_ANSWER: {\r\n      const { answer, formMode } = action.payload;\r\n      console.log(ActionTypes.SET_ANSWER, answer)\r\n      return {\r\n        ...state,\r\n        activeGroup: null,\r\n        activeAnswer: answer,\r\n        formMode,\r\n        error: undefined,\r\n        loadingGroup: false,\r\n        loadingAnswer: false,\r\n        answerLoaded: true\r\n      };\r\n    }\r\n\r\n    case ActionTypes.SET_ANSWER_AFTER_ASSIGN_ANSWER: {\r\n      const { answer } = action.payload;\r\n      //const { parentId, id } = answer;\r\n      //const inAdding = state.formMode === FormMode.AddingAnswer;\r\n\r\n      // for inAdding, _id is IDBValidKey('000000000000000000000000')\r\n      // thats why we look for q.inAdding instead of q._id === _id\r\n      // const x = state.groups.filter(c => c.id === parentId).filter(q=>q.id === id);\r\n      // console.error('SET_ANSWER_AFTER_ASSIGN_ANSWER', {x})\r\n\r\n      // TODO Popravi\r\n      // const rootRows = newTopRows.map((c: IGroup) => c.id === parentId\r\n      //   ? {\r\n      //     ...c,\r\n      //     answerRows: inAdding\r\n      //       ? c.answerRows.map(q => q.inAdding ? { ...answer, inAdding: q.inAdding } : q)\r\n      //       : c.answerRows.map(q => q.id === id ? { ...answer } : q), // TODO sta, ako je inViewing\r\n      //     inAdding: c.inAdding\r\n      //   }\r\n      //   : c\r\n      // );\r\n      return {\r\n        ...state,\r\n        //formMode: state.formMode, // keep mode\r\n        activeAnswer: answer,\r\n        loadingAnswer: false,\r\n        answerLoaded: true\r\n      };\r\n    }\r\n\r\n\r\n    case ActionTypes.SET_ANSWER_TO_VIEW: {\r\n      const { answer } = action.payload;\r\n      //const { topId, id, parentId } = answer;\r\n      const { keyExpanded } = state;\r\n      return {\r\n        ...state,\r\n        formMode: FormMode.ViewingAnswer,\r\n        keyExpanded,\r\n        activeAnswer: answer,\r\n        loadingAnswer: false,\r\n        answerLoaded: true\r\n      }\r\n    }\r\n\r\n    case ActionTypes.SET_ANSWER_TO_EDIT: {\r\n      const { answer } = action.payload;\r\n      const { topId, id, parentId } = answer;\r\n      //const { keyExpanded } = state;\r\n      return {\r\n        ...state,\r\n        // groupKeyExpanded: groupKeyExpanded\r\n        //   ? { ...groupKeyExpanded, answerId: groupKeyExpanded.id === parentId ? id : null }\r\n        //   : null,\r\n        keyExpanded: { topId, groupId: parentId, answerId: id },\r\n        activeAnswer: answer,\r\n        formMode: FormMode.EditingAnswer,\r\n        selectedAnswerId: answer.id,\r\n        loadingAnswer: false,\r\n        answerLoaded: true\r\n      }\r\n    }\r\n\r\n    case ActionTypes.ANSWER_DELETED: {\r\n      //const { answer } = action.payload;\r\n      //const { parentId, id } = answer;\r\n      return {\r\n        ...state, // Popravi\r\n        activeAnswer: null,\r\n        selectedAnswerId: null,\r\n        formMode: FormMode.None,\r\n        loadingAnswer: false,\r\n        answerLoaded: true\r\n      }\r\n    }\r\n\r\n    case ActionTypes.CANCEL_ANSWER_FORM:\r\n    case ActionTypes.CLOSE_ANSWER_FORM: {\r\n      //const { answer } = action.payload;\r\n      return {\r\n        ...state,\r\n        formMode: FormMode.None,\r\n        activeAnswer: null,\r\n        selectedAnswerId: null\r\n      };\r\n    }\r\n\r\n    default:\r\n      alert(`Action ${action.type} not allowed`)\r\n      return {\r\n        ...state\r\n      }\r\n  }\r\n};\r\n\r\n\r\n\r\n/* -----------------------------\r\n   Deep Clone\r\n----------------------------- */\r\nexport class DeepClone {\r\n  static idToSet: string;\r\n  static newGroupRow: IGroupRow;\r\n  constructor(groupRow: IGroupRow) {\r\n    const { topId, id, parentId, title, link, kind, header, level, variations, numOfAnswers,\r\n      hasSubGroups, groupRows, created, modified, answerRows, isExpanded } = groupRow;\r\n\r\n    const subGrpRows = groupRows.map((catRow: IGroupRow) => {\r\n      console.log('DeepClone >>>>>>>>>>>>>>>', catRow.id)\r\n      if (catRow.id === DeepClone.idToSet) {\r\n        return { ...DeepClone.newGroupRow }\r\n      }\r\n      else {\r\n        return new DeepClone(catRow).groupRow\r\n      }\r\n    });\r\n\r\n    this.groupRow = {\r\n      topId,\r\n      parentId,\r\n      id,\r\n      kind,\r\n      title,\r\n      link,\r\n      header,\r\n      level,\r\n      hasSubGroups,\r\n      groupRows: subGrpRows,\r\n      numOfAnswers,\r\n      answerRows,\r\n      variations: variations ?? [],\r\n      created,\r\n      modified,\r\n      isExpanded\r\n    }\r\n  }\r\n  groupRow: IGroupRow;\r\n}\r\n\r\n\r\n","import { useGlobalState } from '@/global/GlobalProvider'\r\nimport React, { createContext, useContext, useReducer, useCallback, type Dispatch, useEffect } from 'react';\r\n\r\nimport type {\r\n  IGroup, IAnswer, IGroupsContext,\r\n  IGroupDtoEx, IGroupKey,\r\n  IAnswerDtoEx, IAnswerEx, IAnswerKey, IAnswerRow,\r\n  IGroupRow,\r\n  IGroupRowDtoEx,\r\n  IGroupRowDto,\r\n  ILoadGroupAnswers,\r\n  IExpandInfo,\r\n  IKeyExpanded,\r\n  IGroupsState,\r\n  ILocStorage\r\n} from '@/groups/types';\r\n\r\n\r\nimport {\r\n  ActionTypes,\r\n  GroupKey, Group, GroupDto,\r\n  Answer,\r\n  AnswerDto,\r\n  AnswerRowDto,\r\n  GroupRow,\r\n  AnswerKey,\r\n  FormMode,\r\n  GroupRowDto\r\n} from '@/groups/types';\r\n\r\nimport { GroupReducer, initialAnswer, initialGroup } from '@/groups/GroupReducer';\r\n\r\nconst GroupsContext = createContext<IGroupsContext>({} as any);\r\nconst GroupDispatchContext = createContext<Dispatch<any>>(() => null);\r\n\r\ntype IProps = {\r\n  children: React.ReactNode\r\n}\r\n\r\nexport const initialState: IGroupsState = {\r\n  formMode: FormMode.None,\r\n\r\n  allGroupRows: new Map<string, IGroupRow>(),\r\n  allGroupRowsLoaded: undefined,\r\n\r\n  topRows: [],\r\n  topRowsLoading: false,\r\n  topRowsLoaded: false,\r\n\r\n  nodeOpening: false,\r\n  nodeOpened: false,\r\n\r\n  keyExpanded: null,\r\n\r\n  groupId_answerId_done: undefined,\r\n\r\n  activeGroup: null,\r\n  activeAnswer: null,\r\n  selectedAnswerId: null,\r\n\r\n  loadingGroups: false,\r\n  loadingAnswers: false,\r\n  loadingGroup: false, groupLoaded: false,\r\n  loadingAnswer: false, answerLoaded: false,\r\n\r\n  error: undefined,\r\n\r\n  rowExpanding: false,\r\n  rowExpanded: false\r\n}\r\n\r\nexport const GroupProvider: React.FC<IProps> = ({ children }) => {\r\n\r\n  const globalState = useGlobalState();\r\n  const { KnowledgeAPI, isAuthenticated, workspace, authUser, canEdit } = globalState;\r\n  const { nickName } = authUser;\r\n\r\n  const [state, dispatch] = useReducer(GroupReducer, initialState);\r\n\r\n  const { formMode, activeGroup, activeAnswer, keyExpanded, topRows, allGroupRows, allGroupRowsLoaded } = state;\r\n\r\n  console.log('----->>> ----->>> ----->>> GroupProvider')\r\n\r\n  useEffect(() => {\r\n\r\n    let keyExpanded: IKeyExpanded = workspace === 'SLINDZA'\r\n      ? { topId: \"MTS\", groupId: \"MTS\", answerId: \"aaaaaa111\" }\r\n      : { topId: \"MTS\", groupId: \"REMOTECTRLS\", answerId: \"aaaaaa111\" }\r\n\r\n    /* DOK TESTIRAM ANSWERS*/\r\n    if ('localStorage' in window) {\r\n      let s = localStorage.getItem('GROUPS_STATE');\r\n      console.log('GROUPS_STATE loaded before signIn', s)\r\n      if (s !== null) {\r\n        const locStorage: ILocStorage = JSON.parse(s);\r\n        if (locStorage.keyExpanded !== null)\r\n          keyExpanded = locStorage.keyExpanded!;\r\n      }\r\n    }\r\n    /**/\r\n    dispatch({ type: ActionTypes.SET_FROM_LOCAL_STORAGE, payload: { keyExpanded } });\r\n  }, [workspace]);\r\n\r\n\r\n  const Execute = useCallback(\r\n    async (\r\n      method: string,\r\n      endpoint: string,\r\n      data: Object | null = null,\r\n      whichRowId: string | undefined = undefined\r\n    ): Promise<any> => {\r\n      const accessToken = localStorage.getItem(\"accessToken\");\r\n      if (accessToken) {\r\n        try {\r\n          console.log(\"------Execute endpoint:\", endpoint)\r\n          let response = null;\r\n\r\n          const headers = new Headers();\r\n          const bearer = `Bearer ${accessToken}`;\r\n          headers.append(\"Authorization\", bearer);\r\n\r\n          if (data) headers.append('Content-Type', 'application/json');\r\n\r\n          let options = {\r\n            method: method,\r\n            headers: headers,\r\n            body: data ? JSON.stringify(data) : null,\r\n          };\r\n\r\n          response = (await fetch(endpoint, options));\r\n          if (response.ok) {\r\n            if ((response.status === 200 || response.status === 201)) {\r\n              let responseData = null; //response;\r\n              try {\r\n                responseData = await response.json();\r\n              }\r\n              catch (error) {\r\n                dispatch({\r\n                  type: ActionTypes.SET_GROUP_ERROR, payload: {\r\n                    error: new Error(`Response status: ${response.status}`),\r\n                    whichRowId\r\n                  }\r\n                });\r\n              }\r\n              finally {\r\n                return responseData;\r\n              }\r\n            }\r\n          }\r\n          else {\r\n            const { errors } = await response.json();\r\n            const error = new Error(\r\n              errors?.map((e: { message: any; }) => e.message).join('\\n') ?? 'unknown',\r\n            )\r\n            dispatch({ type: ActionTypes.SET_GROUP_ERROR, payload: { error, whichRowId } });\r\n          }\r\n        }\r\n        catch (e) {\r\n          console.log('-------------->>> execute', method, endpoint, e)\r\n          dispatch({ type: ActionTypes.SET_GROUP_ERROR, payload: { error: new Error(`fetch eror`), whichRowId } });\r\n        }\r\n      }\r\n      return null;\r\n    }, []);\r\n\r\n\r\n  // ---------------------------\r\n  // load all groupRows\r\n  // ---------------------------\r\n  const loadAllGroupRows = useCallback(async (): Promise<any> => {\r\n    return new Promise(async (resolve) => {\r\n      try {\r\n        console.time();\r\n        const url = `${KnowledgeAPI.endpointGroupRow}/${workspace}`;\r\n        await Execute(\"GET\", url, null)\r\n          .then((catRowDtos: IGroupRowDto[]) => {   //  | Response\r\n            const allGroupRows = new Map<string, IGroupRow>();\r\n            console.timeEnd();\r\n            catRowDtos.forEach((rowDto: IGroupRowDto) => allGroupRows.set(rowDto.Id, new GroupRow(rowDto).groupRow));\r\n            allGroupRows.forEach(cat => {\r\n              let { id, parentId } = cat; // , title, variations, hasSubGroups, level, kind\r\n              let titlesUpTheTree = id;\r\n              let parentCat = parentId;\r\n              while (parentCat) {\r\n                const cat2 = allGroupRows.get(parentCat)!;\r\n                titlesUpTheTree = cat2!.id + ' / ' + titlesUpTheTree;\r\n                parentCat = cat2.parentId;\r\n              }\r\n              cat.titlesUpTheTree = titlesUpTheTree;\r\n              allGroupRows.set(id, cat);\r\n            })\r\n            dispatch({ type: ActionTypes.SET_ALL_GROUP_ROWS, payload: { allGroupRows } });\r\n            resolve(true)\r\n          });\r\n      }\r\n      catch (error: any) {\r\n        console.log(error)\r\n        dispatch({ type: ActionTypes.SET_GROUP_ERROR, payload: { error } });\r\n      }\r\n      resolve(true);\r\n    });\r\n  }, [Execute, KnowledgeAPI.endpointGroupRow, workspace]);\r\n\r\n  const getGrp = useCallback(async (id: string): Promise<IGroupRow | undefined> => {\r\n    try {\r\n      const cat: IGroupRow | undefined = allGroupRows.get(id);  // globalState.cats is Map<string, ICat>\r\n      return cat;\r\n    }\r\n    catch (error: any) {\r\n      console.log(error)\r\n      dispatch({ type: ActionTypes.SET_GROUP_ERROR, payload: { error } });\r\n    }\r\n    return undefined;\r\n  }, [allGroupRows]);\r\n\r\n\r\n  useEffect(() => {\r\n    (async () => {\r\n      if (allGroupRowsLoaded === undefined) {\r\n        await loadAllGroupRows();\r\n      }\r\n    })()\r\n  }, [allGroupRowsLoaded, loadAllGroupRows]);\r\n\r\n  const getSubGrps = useCallback(async (groupId: string | null) => {\r\n    try {\r\n      let parentHeader = \"\";\r\n      const subCats: IGroupRow[] = [];\r\n      allGroupRows.forEach((cat, id) => {  // globalState.cats is Map<string, ICat>\r\n        if (id === groupId) {\r\n          parentHeader = \"\"; //cat.header!;\r\n        }\r\n        else if (cat.parentId === groupId) {\r\n          subCats.push(cat);\r\n        }\r\n      })\r\n      return { subCats, parentHeader };\r\n    }\r\n    catch (error: any) {\r\n      console.log(error)\r\n      dispatch({ type: ActionTypes.SET_GROUP_ERROR, payload: { error } });\r\n      return { subCats: [], parentHeader: 'Kiks subCats' }\r\n    }\r\n  }, [allGroupRows]);\r\n\r\n  const loadTopRows = useCallback(async () => {\r\n    return new Promise(async (resolve) => {\r\n      //const { keyExpanded } = state;\r\n      try {\r\n        dispatch({ type: ActionTypes.SET_TOP_ROWS_LOADING, payload: {} });\r\n        const url = `${KnowledgeAPI.endpointGroupRow}/${workspace}/null/topRows/all`;\r\n        console.log('GroupProvider loadTopRows url:', url)\r\n        console.log('loadTopRows AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA')\r\n        console.time();\r\n        await Execute(\"GET\", url)\r\n          .then((dtos: IGroupRowDto[]) => {\r\n            console.timeEnd();\r\n            console.log('loadTopRows BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB')\r\n            const topRows = dtos!.map((dto: IGroupRowDto) => {\r\n              dto.IsExpanded = keyExpanded\r\n                ? dto.Id === keyExpanded.groupId\r\n                : false;\r\n              //dto.TopId = dto.AnswerId;\r\n              return new GroupRow(dto).groupRow;\r\n            })\r\n            dispatch({ type: ActionTypes.SET_TOP_ROWS, payload: { topRows } });\r\n            resolve(true);\r\n          });\r\n      }\r\n      catch (error: any) {\r\n        console.log(error)\r\n        dispatch({ type: ActionTypes.SET_GROUP_ERROR, payload: { error } });\r\n      }\r\n    })\r\n  }, [Execute, KnowledgeAPI.endpointGroupRow, keyExpanded, workspace]); // state, \r\n\r\n\r\n  // get group With subgroupRows and answerRows\r\n  const getGroup = useCallback(\r\n    async (groupKey: IGroupKey, includeAnswerId: string | null): Promise<any> => {\r\n      const { topId, id } = groupKey;\r\n      console.log({ groupKey, includeAnswerId })\r\n      return new Promise(async (resolve) => {\r\n        try {\r\n          const url = `${KnowledgeAPI.endpointGroup}/${workspace}/${topId}/${id}/${PAGE_SIZE}/${includeAnswerId}`;\r\n          console.time()\r\n          console.log('================ getGroup =======================')\r\n          await Execute(\"GET\", url)\r\n            .then((groupDtoEx: IGroupDtoEx) => {\r\n              console.timeEnd();\r\n              const { groupDto, msg } = groupDtoEx;\r\n              if (groupDto) {\r\n                resolve(new Group(groupDto).group);\r\n              }\r\n              else {\r\n                resolve(new Error(msg));\r\n              }\r\n            });\r\n        }\r\n        catch (error: any) {\r\n          console.log(error)\r\n          resolve(error);\r\n        }\r\n      })\r\n    }, [Execute, KnowledgeAPI.endpointGroup, workspace]);\r\n\r\n\r\n  const findGroupRow = useCallback(\r\n    (groupRow: IGroupRow, id: string): IGroupRow | undefined => {\r\n      if (groupRow.topId === id)\r\n        return groupRow;\r\n      const { groupRows } = groupRow;\r\n      let cat: IGroupRow | undefined = groupRows.find(c => c.id === (id ?? 'null'));\r\n      if (!cat) {\r\n        try {\r\n          groupRows.forEach(c => {\r\n            console.log(id, c.id)\r\n            cat = findGroupRow(c, id);\r\n            if (cat) {\r\n              throw new Error(\"Stop the loop\");\r\n            }\r\n          })\r\n        }\r\n        catch (e) {\r\n          // console.log(\"Loop stopped\");\r\n        }\r\n      }\r\n      return cat;\r\n    }, []);\r\n\r\n\r\n  const expandNodesUpToTheTree = useCallback(\r\n    async (grpKey: IGroupKey, answerId: string | null, fromChatBotDlg: string = 'false'): Promise<any> => {\r\n      return new Promise(async () => {\r\n        try {\r\n          let { topId, parentId, id } = grpKey;\r\n          console.assert(id !== null, 'id ne sme biti null u expandNodesUpToTheTree');\r\n          if (id) {\r\n            const groupRow: IGroupRow | undefined = allGroupRows.get(id);\r\n            if (groupRow) {\r\n              grpKey.topId = groupRow.topId;\r\n              grpKey.parentId = groupRow.parentId;\r\n            }\r\n            else {\r\n              alert('reload all groupRow:' + id)\r\n              //return\r\n            }\r\n          }\r\n          dispatch({ type: ActionTypes.SET_NODE_EXPANDING_UP_THE_TREE, payload: { fromChatBotDlg: fromChatBotDlg === 'true' } })\r\n          // ---------------------------------------------------------------------------\r\n          console.time();\r\n          const groupKey: IGroupKey = { topId, id, parentId: null }; // proveri ROOT\r\n          /*\r\n          const group: IGroup = await getGroup(grpKey, answerId);\r\n          //const { hasSubGroups, numOfAnswers } = group;\r\n          dispatch({\r\n            type: ActionTypes.SET_NODE_OPENED, payload: {\r\n              grpKey,\r\n              //groupRow,\r\n              canEdit,\r\n              group,\r\n              answerId: answerId ?? null,\r\n              fromChatBotDlg: fromChatBotDlg === 'true'\r\n            }\r\n          })\r\n            */\r\n          const query = new GroupKey(groupKey).toQuery(workspace);\r\n          const url = `${KnowledgeAPI.endpointGroupRow}?${query}&pageSize=${PAGE_SIZE}&includeAnswerId=${answerId ?? null}`;\r\n          await Execute(\"GET\", url)\r\n            .then(async (groupRowDtoEx: IGroupRowDtoEx) => {\r\n              //dispatch({ type: ActionTypes.CLEAN_SUB_TREE, payload: { groupKey: groupKey! } });\r\n              const { groupRowDto } = groupRowDtoEx;\r\n              console.timeEnd();\r\n              if (groupRowDto) {\r\n                let group: IGroup | null = null;\r\n                let answer: IAnswer | null = null;\r\n                let groupRow: IGroupRow | null = new GroupRow(groupRowDto).groupRow;\r\n                if (parentId !== null) {\r\n                  const row = findGroupRow(groupRow, id!)!;\r\n                  group = { ...row, doc1: '' };\r\n                  if (answerId) {\r\n                    const answerRow = row.answerRows.find(q => q.id === answerId && q.included)!;\r\n                    if (answerRow) {\r\n                      group = null;\r\n                      answer = {\r\n                        ...answerRow,\r\n                        source: 0,\r\n                        status: 0\r\n                      }\r\n                    }\r\n                  }\r\n                }\r\n                console.log('>>> expandNodeUpToTheTree groupRow', { groupRow, answerId: \"'\" + (answerId ?? 'jok') + \"'\" + (answerId ?? \"JOK\") })\r\n                const formMode = answerId\r\n                  ? canEdit\r\n                    ? FormMode.EditingAnswer\r\n                    : FormMode.ViewingAnswer\r\n                  : canEdit\r\n                    ? FormMode.EditingGroup\r\n                    : FormMode.ViewingGroup;\r\n\r\n                dispatch({\r\n                  type: ActionTypes.SET_NODE_EXPANDED_UP_THE_TREE, payload: {\r\n                    grpKey,\r\n                    groupRow,\r\n                    group: group!,\r\n                    answerId: answerId ?? null,\r\n                    answer,\r\n                    formMode,\r\n                    fromChatBotDlg: fromChatBotDlg === 'true'\r\n                  }\r\n                })\r\n                //resolve(true)\r\n              }\r\n              else {\r\n                //resolve(false)\r\n              }\r\n            });\r\n        }\r\n        catch (error: any) {\r\n          console.log(error)\r\n          dispatch({ type: ActionTypes.SET_GROUP_ERROR, payload: { error } });\r\n        }\r\n      })\r\n    }, [workspace, KnowledgeAPI.endpointGroupRow, Execute, allGroupRows, findGroupRow, canEdit]);\r\n\r\n\r\n  const getGroupRow = useCallback(\r\n    async (groupKey: IGroupKey, hidrate: boolean = false, includeAnswerId: string | null = null): Promise<any> => {\r\n      const query = new GroupKey(groupKey).toQuery(workspace);\r\n      return new Promise(async (resolve) => {\r\n        try {\r\n          const url = `${KnowledgeAPI.endpointGroupRow}/${hidrate}/${PAGE_SIZE}/${includeAnswerId}?${query}`;\r\n          console.time()\r\n          await Execute(\"GET\", url)\r\n            .then((groupRowDtoEx: IGroupRowDtoEx) => {\r\n              console.timeEnd();\r\n              const { groupRowDto, msg } = groupRowDtoEx;\r\n              if (groupRowDto) {\r\n                //groupRowDto.TopId = topId;\r\n                resolve(new GroupRow(groupRowDto).groupRow);\r\n              }\r\n              else {\r\n                resolve(new Error(msg));\r\n              }\r\n            });\r\n        }\r\n        catch (error: any) {\r\n          console.log(error)\r\n          resolve(error);\r\n        }\r\n      })\r\n    }, [Execute, KnowledgeAPI.endpointGroupRow, workspace]);\r\n\r\n\r\n  const expandGroup = useCallback(\r\n    async ({ groupKey, includeAnswerId, newAnswerRow, formMode }: IExpandInfo): Promise<any> => {\r\n      try {\r\n        //const { keyExpanded } = state;\r\n        dispatch({ type: ActionTypes.SET_ROW_EXPANDING, payload: {} });\r\n        const groupRow: IGroupRow = await getGroupRow(groupKey, true, includeAnswerId); // to reload Group\r\n        if (groupRow instanceof Error) {\r\n          dispatch({ type: ActionTypes.SET_GROUP_ERROR, payload: { error: groupRow } });\r\n          console.error({ cat: groupRow })\r\n        }\r\n        else {\r\n          let selectedAnswerId: string | undefined = undefined;\r\n          if (includeAnswerId && groupRow.answerRows.filter((row: IAnswerRow) => row.included).length > 0) {\r\n            selectedAnswerId = includeAnswerId;\r\n          }\r\n          // if (newGroupRow) {\r\n          //   groupRow.groupRows = [newGroupRow, ...groupRow.groupRows];\r\n          // }\r\n          if (newAnswerRow) {\r\n            groupRow.answerRows = [newAnswerRow, ...groupRow.answerRows];\r\n          }\r\n          groupRow.isExpanded = true;\r\n          console.log('@@@@@@@@@@@@@@@@@ expandGroup:', formMode, includeAnswerId)\r\n          if (formMode === FormMode.None && includeAnswerId) {\r\n            formMode = canEdit ? FormMode.EditingAnswer : FormMode.ViewingAnswer\r\n          }\r\n          dispatch({ type: ActionTypes.SET_ROW_EXPANDED, payload: { groupRow, formMode: formMode!, selectedAnswerId } });\r\n          return groupRow;\r\n        }\r\n      }\r\n      catch (error: any) {\r\n        console.log('error', error);\r\n        dispatch({ type: ActionTypes.SET_GROUP_ERROR, payload: { error } });\r\n        return null;\r\n      }\r\n    }, [canEdit, getGroupRow]);\r\n\r\n\r\n  const collapseGroup = useCallback(\r\n    async (groupRow: IGroupRow) => {\r\n      const { topId, id } = groupRow;\r\n      //const { topRows } = state;\r\n      const topRow: IGroupRow = topRows.find(c => c.id === topId)!;\r\n      //const groupRow: IGroupRow = findGroupRow(topRow.groupRows, id)!;\r\n      const catRow: IGroupRow = (topRow.id === id)\r\n        ? topRow\r\n        : findGroupRow(topRow, id)!;\r\n      groupRow = { ...catRow, isExpanded: false, groupRows: [], answerRows: [] }\r\n      // rerender\r\n      dispatch({ type: ActionTypes.SET_ROW_COLLAPSED, payload: { groupRow } })\r\n    }, [findGroupRow, topRows]);\r\n\r\n\r\n  const addSubGroup = useCallback(\r\n    async (parentGroupRow: IGroupRow | null) => {\r\n      try {\r\n        //if (formMode !== FormMode.None) {\r\n        dispatch({ type: ActionTypes.CLOSE_GROUP_FORM, payload: {} })\r\n        //}\r\n        //const id = 'generateId';\r\n        const { topId, id, parentId, level } = parentGroupRow ?? { topId: 'generateId', id: 'generateId', parentId: null, level: 0 };\r\n        const newGroupRow: IGroupRow = {\r\n          ...initialGroup,\r\n          topId,\r\n          parentId: parentGroupRow ? id : parentId,\r\n          id: 'generateId',\r\n          level: level + 1,\r\n          title: '',\r\n          isExpanded: false\r\n        }\r\n        if (parentGroupRow === null) { // add topRow\r\n          dispatch({\r\n            type: ActionTypes.SET_GROUP_TO_ADD_TOP, payload: {\r\n              //groupRow: { groupRow, groupRows: [newGroupRow, ...groupRow.groupRows]\r\n              newGroupRow\r\n            }\r\n          });\r\n        }\r\n        else {\r\n          // if (id !== null) {\r\n          //   const topRow: IGroupRow = state.topRows.find(c => c.id === topId)!;\r\n          //   parentGroupRow = findGroupRow(topRow, id)!;\r\n          // }\r\n          const groupRow: IGroupRow = {\r\n            ...parentGroupRow,\r\n            level: level + 1,\r\n            groupRows: [newGroupRow, ...parentGroupRow.groupRows],\r\n            hasSubGroups: true,\r\n            isExpanded: true\r\n          }\r\n          dispatch({\r\n            type: ActionTypes.SET_GROUP_TO_ADD, payload: {\r\n              groupRow,\r\n              newGroupRow\r\n            }\r\n          })\r\n          // dispatch({\r\n          //   type: ActionTypes.SET_GROUP, payload: {\r\n          //     groupRow: { ...newGroupRow, doc1: ''}\r\n          //   }\r\n          // })\r\n          //const groupKey: IGroupKey = { topId, parentId, id };\r\n          // const newGroupRow: IGroupRow = {\r\n          //   ...initialGroup,\r\n          //   topId,\r\n          //   parentId,\r\n          //   id: 'generateId',\r\n          //   level,\r\n          //   title: '' // new Group\r\n          // }\r\n          /*\r\n          if (isExpanded) {\r\n            groupRows.map(g => g.isExpanded = false);\r\n            const groupRow2: IGroupRow = {\r\n              ...groupRow,\r\n              groupRows: [newGroupRow, ...groupRows],\r\n            }\r\n            dispatch({ type: ActionTypes.SET_ROW_EXPANDED, payload: { groupRow: groupRow2, formMode: FormMode.AddingGroup } });\r\n            dispatch({ type: ActionTypes.SET_GROUP, payload: { groupRow: { ...newGroupRow, doc1: '' } } });\r\n          }\r\n          else {\r\n            const expandInfo: IExpandInfo = {\r\n              groupKey,\r\n              formMode: FormMode.AddingGroup,\r\n              newGroupRow\r\n            }\r\n            const row: IGroupRow | null = await expandGroup(expandInfo);\r\n            if (row) {\r\n              const group: IGroup = {\r\n                ...newGroupRow,\r\n                doc1: ''\r\n              }\r\n              dispatch({ type: ActionTypes.SET_GROUP, payload: { groupRow: group } });\r\n            }\r\n          }\r\n            */\r\n        }\r\n      }\r\n      catch (error: any) {\r\n        console.log('error', error);\r\n        dispatch({ type: ActionTypes.SET_GROUP_ERROR, payload: { error } });\r\n      }\r\n    }, []);\r\n\r\n\r\n  const cancelAddGroup = useCallback(\r\n    async () => {\r\n      try {\r\n        const { topId, id, parentId } = activeGroup!;\r\n        const groupKey: IGroupKey = { topId, parentId, id }; // TODO proveri\r\n\r\n        const expandInfo: IExpandInfo = {\r\n          groupKey,\r\n          formMode: FormMode.None\r\n        }\r\n        const groupRow: IGroupRow | null = await expandGroup(expandInfo);\r\n        if (groupRow) {\r\n          dispatch({ type: ActionTypes.CANCEL_ADD_SUB_GROUP, payload: { groupRow } });\r\n        }\r\n      }\r\n      catch (error: any) {\r\n        console.log('error', error);\r\n        dispatch({ type: ActionTypes.SET_GROUP_ERROR, payload: { error } });\r\n      }\r\n    }, [activeGroup, expandGroup]);\r\n\r\n\r\n  const createGroup = useCallback(\r\n    async (group: IGroup) => {\r\n      const { id } = group;\r\n      dispatch({ type: ActionTypes.SET_LOADING_GROUP, payload: {} });\r\n      try {\r\n        const groupDto = new GroupDto(group, workspace).groupDto;\r\n        console.log(\"groupDto\", { groupDto })\r\n        const url = `${KnowledgeAPI.endpointGroup}`; //\r\n        console.time()\r\n        await Execute(\"POST\", url, groupDto, id)\r\n          .then(async (groupDtoEx: IGroupDtoEx) => {   //  | null\r\n            console.timeEnd();\r\n            const { groupDto } = groupDtoEx;\r\n            if (groupDto) {\r\n              //groupDto.TopId = topId!;\r\n              const group = new Group(groupDto).group;\r\n              console.log('Group successfully created', { group })\r\n\r\n              await loadAllGroupRows()\r\n                .then(async () => { // done: boolean\r\n                  await loadTopRows();\r\n                  if (group.parentId === null) {\r\n                    dispatch({ type: ActionTypes.SET_GROUP_ADDED, payload: { groupRow: group } }); // IGroup extends IGroup Row\r\n                  }\r\n                  else {\r\n                    // const parentGroupKey: IGroupKey = {\r\n                    //   topId: group.topId,\r\n                    //   parentId: \"doesn't matter\",\r\n                    //   id: group.parentId!\r\n                    // };\r\n                    // const expandInfo: IExpandInfo = {\r\n                    //   groupKey: parentGroupKey,\r\n                    //   formMode: FormMode.AddingGroup\r\n                    // }\r\n                    // alert('zovem expa')\r\n                    // await expandGroup(expandInfo).then(() => {\r\n                    //   dispatch({ type: ActionTypes.SET_GROUP_ADDED, payload: { groupRow: group } }); // IGroup extends IGroup Row\r\n                    // });\r\n                    dispatch({ type: ActionTypes.SET_GROUP_ADDED, payload: { groupRow: group } }); // IGroup extends IGroup Row\r\n                  }\r\n                })\r\n            }\r\n          });\r\n      }\r\n      catch (error: any) {\r\n        console.log(error)\r\n        dispatch({ type: ActionTypes.SET_GROUP_ERROR, payload: { error: new Error('Server Error'), whichRowId: id } });\r\n      }\r\n    }, [Execute, KnowledgeAPI.endpointGroup, loadAllGroupRows, loadTopRows, workspace]);\r\n\r\n\r\n  const cancelAddAnswer = useCallback(\r\n    async () => {\r\n      try {\r\n        const { topId, parentId } = activeAnswer!;\r\n        const groupKey: IGroupKey = { topId, parentId, id: parentId! };\r\n        const expandInfo: IExpandInfo = {\r\n          groupKey,\r\n          formMode: FormMode.None\r\n        }\r\n        const groupRow: IGroupRow | null = await expandGroup(expandInfo);\r\n        if (groupRow) {\r\n          dispatch({ type: ActionTypes.CANCEL_ADD_ANSWER, payload: { groupRow } });\r\n        }\r\n      }\r\n      catch (error: any) {\r\n        console.log('error', error);\r\n        dispatch({ type: ActionTypes.SET_GROUP_ERROR, payload: { error } });\r\n      }\r\n    }, [activeAnswer, expandGroup]);\r\n\r\n  const viewGroup = useCallback(async (groupRow: IGroupRow, includeAnswerId: string | null) => {\r\n    if (formMode === FormMode.AddingAnswer) {\r\n      await cancelAddAnswer();\r\n    }\r\n    else if (formMode === FormMode.AddingGroup) {\r\n      await cancelAddGroup();\r\n    }\r\n\r\n    dispatch({ type: ActionTypes.SET_LOADING_GROUP, payload: { groupRow } });\r\n    const groupKey = new GroupKey(groupRow).groupKey!;\r\n    const group: IGroup = await getGroup(groupKey, includeAnswerId);\r\n    if (group instanceof Error)\r\n      dispatch({ type: ActionTypes.SET_GROUP_ERROR, payload: { error: group } });\r\n    else {\r\n      group.topId = groupRow.topId;\r\n      dispatch({ type: ActionTypes.SET_GROUP_TO_VIEW, payload: { groupRow: group } });\r\n    }\r\n  }, [cancelAddGroup, cancelAddAnswer, formMode, getGroup]);\r\n\r\n\r\n  const editGroup = useCallback(async (groupRow: IGroupRow, includeAnswerId: string | null) => {\r\n    // includeAnswerId = null;\r\n    //const { topId, parentId } = groupRow;\r\n    if (formMode === FormMode.AddingAnswer) {\r\n      await cancelAddAnswer();\r\n    }\r\n    else if (formMode === FormMode.AddingGroup) {\r\n      await cancelAddGroup();\r\n    }\r\n    dispatch({ type: ActionTypes.SET_LOADING_GROUP, payload: {} });\r\n    const groupKey = new GroupKey(groupRow).groupKey!;\r\n    const group: IGroup = await getGroup(groupKey, includeAnswerId);\r\n    if (group instanceof Error)\r\n      dispatch({ type: ActionTypes.SET_GROUP_ERROR, payload: { error: group } });\r\n    else {\r\n      const catRow: IGroupRow = { ...group, isExpanded: false, groupRows: [], answerRows: [] }\r\n      dispatch({ type: ActionTypes.SET_GROUP_TO_EDIT, payload: { groupRow: catRow, group } });\r\n      /*\r\n      if (parentId === null) { // topRow\r\n        group.topId = groupRow.topId;\r\n        dispatch({ type: ActionTypes.SET_GROUP_TO_EDIT, payload: { groupRow: group } });\r\n      }\r\n      else {\r\n        const parentKey: IGroupKey = { topId, parentId, id: parentId }\r\n        // get acurate info from server (children will be collapsed)\r\n        const expandInfo: IExpandInfo = {\r\n          groupKey: parentKey,\r\n          formMode: FormMode.EditingGroup\r\n        }\r\n        await expandGroup(expandInfo).then(() => {\r\n          group.topId = groupRow.topId;\r\n          dispatch({ type: ActionTypes.SET_GROUP_TO_EDIT, payload: { groupRow: group } });\r\n        })\r\n      }\r\n        */\r\n    }\r\n  }, [cancelAddGroup, cancelAddAnswer, formMode, getGroup]);\r\n\r\n\r\n  const updateGroup = useCallback(\r\n    async (group: IGroup) => { // , closeForm: boolean\r\n      //const { topId, id, variations, title, kind, modified } = group;\r\n      dispatch({ type: ActionTypes.SET_LOADING_GROUP, payload: {} });\r\n      try {\r\n        const groupDto = new GroupDto(group, workspace).groupDto;\r\n        const url = `${KnowledgeAPI.endpointGroup}`;\r\n        console.time()\r\n        await Execute(\"PUT\", url, groupDto)\r\n          .then((groupDtoEx: IGroupDtoEx) => {\r\n            console.timeEnd();\r\n            const { groupDto, msg } = groupDtoEx;\r\n            if (groupDto) {\r\n              const group = new Group(groupDto).group;\r\n              const { topId } = group;\r\n              group.isExpanded = false;\r\n              group.topId = topId;\r\n              dispatch({ type: ActionTypes.SET_GROUP_UPDATED, payload: { /*groupRow: group, */group } });\r\n              // if (closeForm) {\r\n              //   dispatch({ type: ActionTypes.CLOSE_GROUP_FORM, payload: {} })\r\n              // }\r\n            }\r\n            else {\r\n              dispatch({ type: ActionTypes.SET_GROUP_ERROR, payload: { error: new Error(`${msg}`) } });\r\n            }\r\n          });\r\n      }\r\n      catch (error: any) {\r\n        console.log(error)\r\n        dispatch({ type: ActionTypes.SET_GROUP_ERROR, payload: { error: new Error(\"Karambol\") } });\r\n        return error;\r\n      }\r\n    }, [Execute, KnowledgeAPI.endpointGroup, workspace]);\r\n\r\n\r\n  const deleteGroup = useCallback(async (groupRow: IGroupRow) => {\r\n    //dispatch({ type: ActionTypes.SET_GROUP_LOADING, payload: { id, loading: false } });\r\n    try {\r\n      const { topId, parentId } = groupRow;\r\n      const groupDto = new GroupRowDto(groupRow, workspace).groupRowDto;\r\n      const url = `${KnowledgeAPI.endpointGroup}`;\r\n      console.time()\r\n      await Execute(\"DELETE\", url, groupDto)    //Modified: {  Time: new Date(), NickName: globalState.authUser.nickName }\r\n        .then(async (groupDtoEx: IGroupDtoEx) => {\r\n          console.timeEnd();\r\n          const { groupDto, msg } = groupDtoEx;\r\n          if (msg === \"OK\") {\r\n            // await loadAndCacheAllGroupRows(); // reload\r\n            console.log('Group successfully deleted', { groupRow })\r\n            await loadAllGroupRows()\r\n              .then(async () => {\r\n                const expandInfo: IExpandInfo = {\r\n                  groupKey: { topId, parentId: '', id: parentId! },\r\n                  formMode: FormMode.None\r\n                }\r\n                if (parentId) {\r\n                  await loadTopRows();\r\n                }\r\n                else {\r\n                  await expandGroup(expandInfo).then(() => {\r\n                    // dispatch({ type: ActionTypes.DELETE_GROUP, payload: { id: groupDto!.Id } });\r\n                    // dispatch({ type: ActionTypes.SET_GROUP, payload: { groupRow: group } }); // IGroup extends IGroup Row\r\n                  });\r\n                }\r\n              })\r\n          }\r\n          else if (msg === \"HasSubGroups\") {\r\n            dispatch({ type: ActionTypes.SET_GROUP_ERROR, payload: { error: new Error(\"First remove sub groups\"), whichRowId: groupDto!.Id } });\r\n          }\r\n          else if (msg === \"HasAnswers\") {\r\n            dispatch({ type: ActionTypes.SET_GROUP_ERROR, payload: { error: new Error(\"First remove group answers\"), whichRowId: groupDto!.Id } });\r\n          }\r\n          else {\r\n            dispatch({ type: ActionTypes.SET_GROUP_ERROR, payload: { error: new Error(msg), whichRowId: groupDto!.Id } });\r\n          }\r\n        })\r\n    }\r\n    catch (error: any) {\r\n      console.log(error)\r\n      return error;\r\n    }\r\n  }, [Execute, KnowledgeAPI.endpointGroup, expandGroup, loadAllGroupRows, loadTopRows, workspace]);\r\n\r\n\r\n  const deleteGroupVariation = async (groupKey: IGroupKey, variationName: string) => {\r\n    try {\r\n      console.log(\"Deleting Group Tag...\", { groupKey, variationName });\r\n      // const group = await dbp!.get('Groups', id);\r\n      // const obj: IGroup = {\r\n      //   ...group,\r\n      //   variations: group.variations.filter((variation: string) => variation !== variationName),\r\n      //   modified: {\r\n      //     Time: new Date(),\r\n      //     by: {\r\n      //       nickName: globalState.authUser.nickName\r\n      //     }\r\n      //   }\r\n      // }\r\n      // POPRAVI TODO\r\n      //updateGroup(obj, false);\r\n      console.log(\"Group Tag successfully deleted\");\r\n    }\r\n    catch (error: any) {\r\n      console.log('error', error);\r\n      dispatch({ type: ActionTypes.SET_GROUP_ERROR, payload: { error } });\r\n    }\r\n  };\r\n\r\n\r\n  ////////////////////////////////////\r\n  // Answers\r\n  //\r\n\r\n  const PAGE_SIZE = 12;\r\n  const loadGroupAnswers = useCallback(async ({ groupKey, startCursor, includeAnswerId }: ILoadGroupAnswers): Promise<any> => {\r\n    try {\r\n      const { topId, id } = groupKey;\r\n      dispatch({ type: ActionTypes.SET_ANSWERS_LOADING, payload: {} })\r\n      try {\r\n        const url = `${KnowledgeAPI.endpointAnswer}/${workspace}/${topId}/${id}/${startCursor}/${PAGE_SIZE}/${includeAnswerId}`;\r\n        console.time()\r\n        await Execute!(\"GET\", url).then((groupDtoEx: IGroupDtoEx) => {\r\n          console.timeEnd();\r\n          const { groupDto } = groupDtoEx;\r\n          if (groupDto !== null) {\r\n            const group = new Group(groupDto).group;\r\n            // const { Title, AnswerRowDtos, HasMoreAnswers } = groupDto;\r\n            // AnswerRowDtos!.forEach((answerRowDto: IAnswerRowDto) => {\r\n            //   if (includeAnswerId && answerRowDto.Id === includeAnswerId) {\r\n            //     answerRowDto.Included = true;\r\n            //   }\r\n            //   answerRowDto.GroupTitle = Title; // TODO treba li\r\n            //   answerRowDtos.push(answerRowDto);\r\n            // })\r\n            // const answerRows: IAnswerRow[] = answerRowDtos.map(dto => new AnswerRow(dto).answerRow);\r\n            // dispatch({\r\n            //   type: ActionTypes.GROUP_ANSWERS_LOADED,\r\n            //   payload: { id, answerRows, hasMoreAnswers: HasMoreAnswers! }\r\n            // });\r\n            dispatch({\r\n              type: ActionTypes.GROUP_ANSWERS_LOADED,\r\n              payload: { groupRow: group }\r\n            });\r\n          }\r\n        });\r\n      }\r\n      catch (error: any) {\r\n        console.log(error)\r\n        dispatch({ type: ActionTypes.SET_GROUP_ERROR, payload: { error } });\r\n      }\r\n    }\r\n    catch (error: any) {\r\n      console.log(error);\r\n      dispatch({ type: ActionTypes.SET_GROUP_ERROR, payload: error });\r\n    }\r\n  }, [Execute, KnowledgeAPI.endpointAnswer, workspace]);\r\n\r\n\r\n  const addAnswer = useCallback(\r\n    async (groupKey: IGroupKey, isExpanded: boolean) => {\r\n      try {\r\n        const { topId, id } = groupKey;\r\n        let groupRow = await getGrp(id!);\r\n        if (!groupRow) {\r\n          alert(`Not found ${id}. Reload all Groups`)\r\n          return;\r\n        }\r\n        const newAnswerRow: IAnswerRow = {\r\n          topId,\r\n          parentId: groupKey.id,\r\n          id: 'generateId', // do not change\r\n          title: 'answer text',\r\n          groupTitle: groupRow.title,\r\n          included: true\r\n        }\r\n        const answer: IAnswer = {\r\n          ...initialAnswer,\r\n          ...newAnswerRow,\r\n          title: ''\r\n        }\r\n        console.assert(isExpanded);\r\n        if (isExpanded) {\r\n          const topRow: IGroupRow = state.topRows.find(c => c.id === topId)!;\r\n          const catRow: IGroupRow = findGroupRow(topRow, id)!;\r\n          catRow.answerRows = [newAnswerRow, ...catRow.answerRows];\r\n          dispatch({ type: ActionTypes.ADD_NEW_ANSWER_TO_ROW, payload: { groupRow: catRow, newAnswerRow } });\r\n          dispatch({ type: ActionTypes.SET_ANSWER, payload: { answer, formMode: FormMode.AddingAnswer } });\r\n        }\r\n        // else {\r\n        //   const expandInfo: IExpandInfo = {\r\n        //     groupKey,\r\n        //     formMode: FormMode.AddingAnswer,\r\n        //     newAnswerRow\r\n        //   }\r\n        //   await expandGroup(expandInfo);\r\n        //   dispatch({ type: ActionTypes.SET_ANSWER, payload: { answer, formMode: FormMode.AddingAnswer } });\r\n        // }\r\n\r\n      }\r\n      catch (error: any) {\r\n        console.log('error', error);\r\n        dispatch({ type: ActionTypes.SET_GROUP_ERROR, payload: { error } });\r\n      }\r\n    }, [expandGroup, findGroupRow, getGrp, state.topRows]);\r\n\r\n\r\n  const createAnswer = useCallback(\r\n    async (answer: IAnswer) => {\r\n      const { topId, id, parentId } = answer; // title, modified, \r\n      // TODO\r\n      dispatch({ type: ActionTypes.SET_LOADING_GROUP, payload: {} });\r\n      try {\r\n        answer.created!.nickName = nickName;\r\n        const answerDto = new AnswerDto(answer, workspace).answerDto;\r\n        const url = `${KnowledgeAPI.endpointAnswer}`;\r\n        console.time()\r\n        console.log('>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> createAnswer', answerDto)\r\n        await Execute(\"POST\", url, answerDto)\r\n          .then(async (answerDtoEx: IAnswerDtoEx | null) => {\r\n            console.timeEnd();\r\n            if (answerDtoEx) {\r\n              console.log(\"::::::::::::::::::::\", { answerDtoEx });\r\n              const { answerDto } = answerDtoEx;\r\n              if (answerDto) {\r\n                const answer = new Answer(answerDto).answer;\r\n                answer.topId = topId;\r\n                console.log('Answer successfully created')\r\n                //dispatch({ type: ActionTypes.CLOSE_ANSWER_FORM })\r\n                await loadAllGroupRows() // numOfAnswers changed\r\n                  .then(async () => {\r\n                    const parentGroupKey: IGroupKey = { topId, parentId, id: parentId! };\r\n                    const expandInfo: IExpandInfo = {\r\n                      groupKey: parentGroupKey,\r\n                      formMode: FormMode.EditingAnswer\r\n                    }\r\n                    await expandGroup(expandInfo).then(() => {\r\n                      dispatch({ type: ActionTypes.SET_ANSWER, payload: { formMode: FormMode.EditingAnswer, answer } });\r\n                    });\r\n                  })\r\n              }\r\n            }\r\n          });\r\n      }\r\n      catch (error: any) {\r\n        console.log(error)\r\n        dispatch({ type: ActionTypes.SET_GROUP_ERROR, payload: { error: new Error('Server Error'), whichRowId: id } });\r\n      }\r\n    }, [Execute, KnowledgeAPI.endpointAnswer, expandGroup, loadAllGroupRows, nickName, workspace]);\r\n\r\n\r\n  const updateAnswer = useCallback(\r\n    async (oldParentId: string, answer: IAnswer, groupChanged: boolean) => {\r\n      const { id } = answer; // , title, modified, parentId\r\n      // dispatch({ type: ActionTypes.SET_GROUP_LOADING, payload: { id: parentId!, loading: false } });\r\n      try {\r\n        answer.modified!.nickName = nickName;\r\n        const answerDto = new AnswerDto(answer, workspace).answerDto;\r\n        const url = `${KnowledgeAPI.endpointAnswer}`;\r\n        console.time()\r\n        answerDto.oldParentId = oldParentId;\r\n        console.log('>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> updateAnswer', answerDto)\r\n        let answerRet: IAnswer | null = null;\r\n        await Execute(\"PUT\", url, answerDto)\r\n          .then(async (answerDtoEx: IAnswerDtoEx) => {\r\n            console.timeEnd();\r\n            const { answerDto, msg } = answerDtoEx;\r\n            if (answerDto) {\r\n              answerRet = new Answer(answerDto).answer!;\r\n              console.log('Answer successfully updated: ', answerRet)\r\n              const { topId, parentId } = answerRet;\r\n              if (groupChanged) {\r\n                // nema koristi\r\n                // dispatch({ type: ActionTypes.SET_ANSWER, payload: { answer: answerRet } })\r\n                const { topId, parentId, id } = answerRet;\r\n                const keyExpanded: IKeyExpanded = {\r\n                  topId,\r\n                  groupId: parentId!,\r\n                  answerId: id\r\n                }\r\n                dispatch({ type: ActionTypes.FORCE_GROUP_OPEN_NODE, payload: { keyExpanded } })\r\n              }\r\n              else {\r\n                const parentGroupKey: IGroupKey = { topId, parentId, id: parentId! }; // proveri\r\n                const expandInfo: IExpandInfo = {\r\n                  groupKey: parentGroupKey,\r\n                  formMode: FormMode.EditingAnswer\r\n                }\r\n                await expandGroup(expandInfo).then(() => {\r\n                  dispatch({ type: ActionTypes.SET_ANSWER, payload: { formMode: FormMode.EditingAnswer, answer: answerRet! } });\r\n                });\r\n              }\r\n            }\r\n            else {\r\n              dispatch({ type: ActionTypes.SET_GROUP_ERROR, payload: { error: new Error(msg) } });\r\n            }\r\n          });\r\n        return answerRet;\r\n      }\r\n      catch (error: any) {\r\n        console.log(error)\r\n        dispatch({ type: ActionTypes.SET_GROUP_ERROR, payload: { error: new Error('Server Error'), whichRowId: id } });\r\n      }\r\n    }, [Execute, KnowledgeAPI.endpointAnswer, expandGroup, nickName, workspace]);\r\n\r\n\r\n  const deleteAnswer = useCallback(\r\n    async (answerRow: IAnswerRow, isActive: boolean) => {\r\n      const { id, parentId, topId } = answerRow;\r\n      dispatch({ type: ActionTypes.SET_LOADING_ANSWER, payload: {} });\r\n      try {\r\n        const answerDto = new AnswerRowDto(answerRow, workspace).answerRowDto;\r\n        const url = `${KnowledgeAPI.endpointAnswer}`;\r\n        console.time()\r\n        await Execute(\"DELETE\", url, answerDto)\r\n          .then(async (answerDtoEx: IAnswerDtoEx) => {\r\n            const { answerDto } = answerDtoEx;\r\n            console.timeEnd();\r\n            if (answerDto) {\r\n              const answer = new Answer(answerDto).answer;\r\n              console.log('Answer successfully deleted')\r\n              if (isActive) {\r\n                dispatch({ type: ActionTypes.ANSWER_DELETED, payload: { answer } });\r\n              }\r\n              /*\r\n              //dispatch({ type: ActionTypes.CLOSE_ANSWER_FORM })\r\n              await loadAndCacheAllGroupRows(); // reload\r\n              */\r\n              const parentGroupKey: IGroupKey = { topId, parentId, id: parentId! }; // proveri\r\n              const expandInfo: IExpandInfo = {\r\n                groupKey: parentGroupKey,\r\n                formMode: FormMode.None\r\n              }\r\n              await expandGroup(expandInfo).then(() => {\r\n                // dispatch({ type: ActionTypes.SET_GROUP, payload: { groupRow: group } }); // IGroup extends IGroup Row\r\n              })\r\n            }\r\n            else {\r\n              console.error(answerDtoEx);\r\n              dispatch({ type: ActionTypes.SET_GROUP_ERROR, payload: { error: new Error('Server Error'), whichRowId: id } });\r\n            }\r\n          });\r\n      }\r\n      catch (error: any) {\r\n        console.log(error)\r\n        dispatch({ type: ActionTypes.SET_GROUP_ERROR, payload: { error: new Error('Server Error'), whichRowId: id } });\r\n      }\r\n    }, [Execute, KnowledgeAPI.endpointAnswer, expandGroup, workspace]);\r\n\r\n\r\n  const getAnswer = useCallback(\r\n    async (answerKey: IAnswerKey): Promise<any> => {\r\n      return new Promise(async (resolve) => {\r\n        try {\r\n          const query = new AnswerKey(answerKey).toQuery(workspace);\r\n          const url = `${KnowledgeAPI.endpointAnswer}?${query}`;\r\n          console.time()\r\n          console.log('getAnswer', answerKey)\r\n          await Execute(\"GET\", url)\r\n            .then((answerDtoEx: IAnswerDtoEx) => {\r\n              console.timeEnd();\r\n              const { answerDto, msg } = answerDtoEx;\r\n              if (answerDto) {\r\n                const answerEx: IAnswerEx = {\r\n                  answer: new Answer(answerDto).answer,\r\n                  msg\r\n                }\r\n                resolve(answerEx);\r\n              }\r\n              else {\r\n                const answerEx: IAnswerEx = {\r\n                  answer: null,\r\n                  msg\r\n                }\r\n                resolve(answerEx);\r\n              }\r\n              //}\r\n            });\r\n        }\r\n        catch (error: any) {\r\n          console.log(error);\r\n          const answerEx: IAnswerEx = {\r\n            answer: null,\r\n            msg: \"Problemos\"\r\n          }\r\n          resolve(answerEx);\r\n        }\r\n      })\r\n    }, [Execute, KnowledgeAPI.endpointAnswer, workspace]);\r\n\r\n\r\n  const viewAnswer = useCallback(async (answerRow: IAnswerRow) => {\r\n    const answerKey = new AnswerKey(answerRow).answerKey;\r\n    dispatch({ type: ActionTypes.SET_LOADING_ANSWER, payload: {} });\r\n    const answerEx: IAnswerEx = await getAnswer(answerKey!);\r\n    if (formMode === FormMode.AddingAnswer) {\r\n      await cancelAddAnswer();\r\n    }\r\n    else if (formMode === FormMode.AddingGroup) {\r\n      await cancelAddGroup();\r\n    }\r\n    const { answer, msg } = answerEx;\r\n    if (answer) {\r\n      answer.topId = answerRow.topId;\r\n      dispatch({ type: ActionTypes.SET_ANSWER_TO_VIEW, payload: { answer } });\r\n    }\r\n    else\r\n      dispatch({ type: ActionTypes.SET_GROUP_ERROR, payload: { error: new Error(msg) } });\r\n  }, [cancelAddGroup, cancelAddAnswer, formMode, getAnswer]);\r\n\r\n\r\n  // const editAnswer = useCallback(async (answerRow: IAnswerRow) => {\r\n  //   const answerKey: IAnswerKey = new AnswerKey(answerRow).answerKey!;\r\n  //   if (formMode === FormMode.AddingAnswer) {\r\n  //     await cancelAddAnswer();\r\n  //   }\r\n  //   else if (formMode === FormMode.AddingGroup) {\r\n  //     await cancelAddGroup();\r\n  //   }\r\n  //   dispatch({ type: ActionTypes.SET_LOADING_ANSWER, payload: {} });\r\n  //   console.log(\"editAnswer:\", answerKey)\r\n  //   const answer = initialAnswer;\r\n  //   if (answer) {\r\n  //     // we don't reload groupRows, just use isSelected from activeAnswer\r\n  //     answer.topId = answerRow.topId;\r\n  //     dispatch({ type: ActionTypes.SET_ANSWER_TO_EDIT, payload: { answer } });\r\n  //   }\r\n  // }, [cancelAddGroup, cancelAddAnswer, formMode]);\r\n\r\n\r\n  const editAnswer = useCallback(async (answerRow: IAnswerRow) => {\r\n    const answerKey: IAnswerKey = new AnswerKey(answerRow).answerKey!;\r\n    if (formMode === FormMode.AddingAnswer) {\r\n      await cancelAddAnswer();\r\n    }\r\n    else if (formMode === FormMode.AddingGroup) {\r\n      await cancelAddGroup();\r\n    }\r\n    dispatch({ type: ActionTypes.SET_LOADING_ANSWER, payload: {} });\r\n    console.log(\"editAnswer:\", answerKey)\r\n    const answerEx: IAnswerEx = await getAnswer(answerKey!);\r\n    const { answer, msg } = answerEx;\r\n    if (answer) {\r\n      // we don't reload groupRows, just use isSelected from activeAnswer\r\n      answer.topId = answerRow.topId;\r\n\r\n      // const topRow: IGroupRow = state.topRows.find(c => c.id === answerRow.topId)!;\r\n      // const groupRow: IGroupRow = findGroupRow(topRow, answerRow.parentId)!;\r\n      //dispatch({ type: ActionTypes.SET_ANSWER_TO_EDIT, payload: { groupRow, answer } });\r\n      dispatch({ type: ActionTypes.CLOSE_ANSWER_FORM, payload: { answer } }); // to reset AnswerForm\r\n      dispatch({ type: ActionTypes.SET_ANSWER_TO_EDIT, payload: { answer } });\r\n    }\r\n    else\r\n      dispatch({ type: ActionTypes.SET_GROUP_ERROR, payload: { error: new Error(msg) } });\r\n  }, [cancelAddGroup, cancelAddAnswer, formMode, getAnswer]);\r\n\r\n\r\n\r\n  const onGroupTitleChanged = useCallback(\r\n    // (topRow: IGroupRow, id: string, title: string): void => {\r\n    (group: IGroup, title: string): void => {\r\n      //const { topRows } = state;\r\n      //const topRow: IGroupRow = topRows.find(c => c.id === topId)!;\r\n      //const groupRow: IGroupRow = findGroupRow(topRow.groupRows, id)!;\r\n      // if (!activeGroup || loadingGroup) { // just in case\r\n      //   console.log('Provider>>>>>>00000')\r\n      //   return;\r\n      // }\r\n      // const groupRow: IGroupRow = (topRow.id === id)\r\n      //   ? topRow\r\n      //   : findGroupRow(topRow.groupRows, id)!;\r\n      //let groupRow: IGroupRow | null = findGroupRow(topRow, id)!;\r\n      // console.log('Provider onGroupTitleChanged >>>>>>:', group)\r\n      //if (group && group.title !== title) {\r\n      console.log('Provider onGroupTitleChanged:', title)\r\n      //group.title = title;\r\n      // rerender\r\n      //console.log(ActionTypes.GROUP_TITLE_CHANGED, 'Sent>>>>>>>>>>:', groupRow.title)\r\n      dispatch({\r\n        type: ActionTypes.GROUP_TITLE_CHANGED, payload: {\r\n          groupRow: {\r\n            ...group, title //: group.title\r\n          }\r\n        }\r\n      })\r\n      //}\r\n    }, []);\r\n\r\n  const onAnswerTitleChanged = useCallback(\r\n    (topRow: IGroupRow, answer: IAnswer, title: string): void => {\r\n      //(answer: IAnswerRow, title: string): void => {\r\n      const { parentId, id } = answer;\r\n      //const { topRows } = state;\r\n      //const topRow: IGroupRow = topRows.find(c => c.id === topId)!;\r\n      //const groupRow: IGroupRow = findGroupRow(topRow.groupRows, id)!;\r\n      // if (!activeGroup || loadingGroup) { // just in case\r\n      //   console.log('Provider>>>>>>00000')\r\n      //   return;\r\n      // }\r\n      //const topRow: IGroupRow = topRows.find(c => c.id === topId)!;\r\n      const groupRow: IGroupRow = findGroupRow(topRow, parentId)!;\r\n      if (groupRow) {\r\n        const answerRow = groupRow.answerRows.find(q => q.id === id)!;\r\n        answerRow.title = title;\r\n        // rerender\r\n        console.log('onAnswerTitleChanged+++>>>', id, groupRow)\r\n        dispatch({ type: ActionTypes.ANSWER_TITLE_CHANGED, payload: { groupRow } })\r\n      }\r\n      // console.log('Provider onGroupTitleChanged >>>>>>:', group)\r\n      //if (group && group.title !== title) {\r\n      //console.log('Provider onGroupTitleChanged:', title)\r\n      //group.title = title;\r\n      //console.log(ActionTypes.GROUP_TITLE_CHANGED, 'Sent>>>>>>>>>>:', groupRow.title)\r\n      // rerender\r\n      // dispatch({ type: ActionTypes.ANSWER_TITLE_CHANGED, payload: { groupRow } })\r\n      //}\r\n    }, [findGroupRow]);\r\n\r\n  // const onAnswerTitleChanged = useCallback(\r\n  //   (topRow: IGroupRow, groupId: string, id: string, title: string): void => {\r\n  //     //const { groupRows } = topRow;\r\n  //     //const groupRow: IGroupRow = findGroupRow(groupRows, groupId)!;\r\n  //     const groupRow: IGroupRow = (topRow.id === groupId)\r\n  //       ? topRow\r\n  //       : findGroupRow(topRow, groupId)!;\r\n  //     if (groupRow) {\r\n  //       const answerRow = groupRow.answerRows.find(q => q.id === id)!;\r\n  //       console.log(groupRow.answerRows, id)\r\n  //       answerRow.title = title;\r\n  //     }\r\n  //     // rerender\r\n  //     dispatch({ type: ActionTypes.ANSWER_TITLE_CHANGED, payload: { groupRow } })\r\n  //   }, [findGroupRow])\r\n\r\n  const contextValue: IGroupsContext = {\r\n    state, loadAllGroupRows, getSubGrps, getGrp,\r\n    expandNodesUpToTheTree,\r\n    loadTopRows,\r\n    addSubGroup, cancelAddGroup, createGroup,\r\n    viewGroup, editGroup, updateGroup, deleteGroup, deleteGroupVariation,\r\n    expandGroup, collapseGroup, onGroupTitleChanged,\r\n    loadGroupAnswers,\r\n    addAnswer, cancelAddAnswer, createAnswer,\r\n    viewAnswer, editAnswer, updateAnswer, deleteAnswer, onAnswerTitleChanged\r\n  }\r\n\r\n  if (!isAuthenticated || !allGroupRowsLoaded || keyExpanded === null)\r\n    return null;\r\n\r\n  return (\r\n    <GroupsContext.Provider value={contextValue}>\r\n      <GroupDispatchContext.Provider value={dispatch}>\r\n        {children}\r\n      </GroupDispatchContext.Provider>\r\n    </GroupsContext.Provider>\r\n  );\r\n}\r\n\r\nexport function useGroupContext() {\r\n  return useContext(GroupsContext);\r\n}\r\n\r\nexport const useGroupDispatch = () => {\r\n  return useContext(GroupDispatchContext)\r\n};\r\n\r\n","export default \"__VITE_ASSET__CuG1kYAC__\"","import type { IGroupKey, IGroupRow } from '@/groups/types';\r\n\r\nimport type { ActionMap } from \"@/global/types\";\r\n\r\n/////////////////////////////////////////////////////////////////////////\r\n// DropDown Select Group\r\n\r\nexport interface IGrpState {\r\n\tloading: boolean,\r\n\tparentId: string | null,\r\n\ttitle: string,\r\n\tcats: IGroupRow[], // drop down groups\r\n\terror?: Error;\r\n}\r\n\r\nexport interface IGrpInfo {\r\n\tselId: string | null;\r\n\tgroupKey: IGroupKey | null,\r\n\tlevel: number,\r\n\tsetParentId: (cat: IGroupRow) => void;\r\n}\r\n\r\nexport enum GrpActionTypes {\r\n\tSET_LOADING = 'SET_LOADING',\r\n\tSET_SUB_CATS = 'SET_SUB_CATS',\r\n\tSET_ERROR = 'SET_ERROR',\r\n\tSET_EXPANDED = 'SET_EXPANDED',\r\n\tSET_PARENT_CAT = 'SET_PARENT_CAT'\r\n}\r\n\r\nexport type GrpsPayload = {\r\n\t[GrpActionTypes.SET_LOADING]: false;\r\n\r\n\t[GrpActionTypes.SET_SUB_CATS]: {\r\n\t\tsubGrps: IGroupRow[];\r\n\t};\r\n\r\n\t[GrpActionTypes.SET_EXPANDED]: {\r\n\t\tid: string;\r\n\t\texpanding: boolean;\r\n\t}\r\n\r\n\t[GrpActionTypes.SET_ERROR]: {\r\n\t\terror: Error;\r\n\t};\r\n\r\n\t[GrpActionTypes.SET_PARENT_CAT]: {\r\n\t\tcat: IGroupRow;\r\n\t};\r\n\r\n};\r\n\r\nexport type GrpsActions =\r\n\tActionMap<GrpsPayload>[keyof ActionMap<GrpsPayload>];\r\n\r\n\r\n\r\nexport type GrpActions = ActionMap<GrpsPayload>[keyof ActionMap<GrpsPayload>];","import React from 'react';\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\nimport { faCaretRight, faCaretDown } from '@fortawesome/free-solid-svg-icons'\r\n\r\nimport { ListGroup, Button } from \"react-bootstrap\";\r\n\r\nimport { type IGroupRow } from \"@/groups/types\";\r\n\r\nimport GrpList from \"@/global/Components/SelectGroup/GrpList\";\r\nimport { type GrpsActions, GrpActionTypes } from './types';\r\n\r\ninterface IGrpRow {\r\n    cat: IGroupRow;\r\n    selId: string | null;\r\n    dispatch: React.Dispatch<GrpsActions>;\r\n    setParentGrp: (cat: IGroupRow) => void;\r\n}\r\n\r\nconst GrpRow = ({ cat, dispatch, setParentGrp, selId }: IGrpRow) => {\r\n    const { topId, parentId, id, title, level, isExpanded } = cat;\r\n    const groupKey = { topId, parentId, id };\r\n\r\n    //const { isDarkMode, variant, bg } = useGlobalState();\r\n\r\n    const expand = (_id: IDBValidKey) => {\r\n        dispatch({ type: GrpActionTypes.SET_EXPANDED, payload: { id, expanding: !isExpanded } });\r\n    }\r\n\r\n    const onSelectGrp = (cat: IGroupRow) => {\r\n        // Load data from server and reinitialize group\r\n        // viewGroup(id);\r\n        setParentGrp(cat);\r\n    }\r\n\r\n    const Row1 =\r\n        <div className=\"d-flex justify-content-start align-items-center w-100 text-primary\">\r\n            <Button\r\n                variant='link'\r\n                size=\"sm\"\r\n                className=\"py-0 px-1\"\r\n                onClick={(e) => {\r\n                    expand(id!);\r\n                    e.stopPropagation();\r\n                    e.preventDefault();\r\n                }}\r\n                title=\"Expand\"\r\n            >\r\n                <FontAwesomeIcon icon={isExpanded ? faCaretDown : faCaretRight} size='lg' />\r\n            </Button>\r\n            <Button\r\n                variant='link'\r\n                size=\"sm\"\r\n                className={`py-0 mx-0 text-decoration-none`}\r\n                title={id}\r\n                onClick={() => onSelectGrp(cat)}\r\n            >\r\n                {title}\r\n            </Button>\r\n        </div>\r\n\r\n    return (\r\n        <>\r\n            <ListGroup.Item\r\n                variant={\"primary\"}\r\n                className=\"py-0 px-1 w-100\"\r\n                as=\"li\"\r\n            >\r\n                {Row1}\r\n            </ListGroup.Item>\r\n\r\n            {isExpanded && // Row2\r\n                <ListGroup.Item\r\n                    className=\"py-0 px-0\"\r\n                    variant={\"primary\"}\r\n                    as=\"li\"\r\n                >\r\n                    <GrpList\r\n                        selId={selId}\r\n                        level={level + 1}\r\n                        groupKey={groupKey}\r\n                        setParentId={setParentGrp}\r\n                    />\r\n                </ListGroup.Item>\r\n            }\r\n\r\n        </>\r\n    );\r\n};\r\n\r\nexport default GrpRow;\r\n","import { type Reducer } from 'react'\r\nimport { type IGroupRow } from \"@/groups/types\";\r\nimport  { type GrpsActions, GrpActionTypes, type IGrpState } from './types';\r\n\r\nexport const initialState: IGrpState = {\r\n  loading: false,\r\n  parentId: null,\r\n  title: '',\r\n  cats: []\r\n}\r\n\r\nexport const GrpReducer: Reducer<IGrpState, GrpsActions> = (state, action) => {\r\n\r\n  switch (action.type) {\r\n    case GrpActionTypes.SET_LOADING:\r\n      return {\r\n        ...state,\r\n        loading: true\r\n      }\r\n\r\n    case GrpActionTypes.SET_SUB_CATS: {\r\n      const { subGrps } = action.payload;\r\n      return {\r\n        ...state,\r\n        cats: state.cats.concat(subGrps),\r\n        loading: false\r\n      }\r\n    }\r\n\r\n    case GrpActionTypes.SET_ERROR: {\r\n      const { error } = action.payload;\r\n      return { ...state, error, loading: false };\r\n    }\r\n\r\n    case GrpActionTypes.SET_EXPANDED: {\r\n      const { id, expanding } = action.payload;\r\n      let { cats } = state;\r\n      if (!expanding) {\r\n        const ids = markForClean(cats, id!)\r\n        console.log('clean:', ids)\r\n        if (ids.length > 0) {\r\n          cats = cats.filter(c => !ids.includes(c.id))\r\n        }\r\n      }\r\n      return {\r\n        ...state,\r\n        cats: state.cats.map(c => c.id === id\r\n          ? { ...c, isExpanded: expanding }\r\n          : c\r\n        )\r\n      };\r\n    }\r\n\r\n    case GrpActionTypes.SET_PARENT_CAT: {\r\n      const { cat } = action.payload;\r\n      const { id, title } = cat;\r\n      return {\r\n        ...state,\r\n        parentId: id!,\r\n        title\r\n      };\r\n    }\r\n\r\n    default:\r\n      return state;  // TODO throw error\r\n  }\r\n};\r\n\r\n\r\nfunction markForClean(cats: IGroupRow[], id: string | null) {\r\n  let deca = cats\r\n    .filter(c => c.parentId === id)\r\n    .map(c => c.id)\r\n\r\n  deca.forEach(id => {\r\n    const unuci = id ? markForClean(cats, id) : [];\r\n    deca = deca.concat(unuci);\r\n  })\r\n  return deca\r\n}","import { useEffect, useReducer, useState } from \"react\";\r\nimport { ListGroup } from \"react-bootstrap\";\r\nimport GrpRow from \"@/global/Components/SelectGroup/GrpRow\";\r\nimport { GrpReducer, initialState } from \"@/global/Components/SelectGroup/GrpReducer\";\r\n//import { useGlobalContext } from \"@/global/GlobalProvider\";\r\nimport { GrpActionTypes, type IGrpInfo } from \"./types\";\r\nimport type { IGroupKey, IGroupRow } from \"@/groups/types\";\r\nimport { useGroupContext } from \"@/groups/GroupProvider\";\r\n\r\nconst GrpList = ({ selId, groupKey, level, setParentId }: IGrpInfo) => {\r\n    const [state, dispatch] = useReducer(GrpReducer, initialState);\r\n    const { getSubGrps } = useGroupContext();\r\n\r\n    const { id } = groupKey ?? { id: null };\r\n    const [catKey] = useState<IGroupKey | null>(groupKey)\r\n\r\n    useEffect(() => {\r\n        (async () => {\r\n            const res = await getSubGrps(id);\r\n            const { subGrps } = res;\r\n            dispatch({ type: GrpActionTypes.SET_SUB_CATS, payload: { subGrps } });\r\n        })()\r\n    }, [getSubGrps, catKey, id]);\r\n\r\n    const mySubGrps = state.cats.filter(c => c.parentId === id);\r\n\r\n    const setParentGrp = (cat: IGroupRow) => {\r\n        dispatch({ type: GrpActionTypes.SET_PARENT_CAT, payload: { cat } })\r\n        setParentId!(cat);\r\n    }\r\n\r\n    return (\r\n        <div className={level > 1 ? 'border  border-7 ms-4 h-25' : 'border border-7  h-25'} style={{ overflowY: 'auto' }}>\r\n            <ListGroup as=\"ul\" variant='dark' className=\"mb-0\">\r\n                {mySubGrps.filter(c => c.id !== selId).map((cat: IGroupRow) =>\r\n                    <GrpRow\r\n                        cat={cat}\r\n                        selId={selId}\r\n                        dispatch={dispatch}\r\n                        setParentGrp={setParentGrp}\r\n                        key={cat.id}\r\n                    />\r\n                )\r\n                }\r\n            </ListGroup>\r\n\r\n            {state.error && state.error.message}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default GrpList;\r\n","import { type ChangeEvent, type FormEvent, useState, useEffect, useRef } from \"react\";\r\nimport { useDebounce } from \"@uidotdev/usehooks\";\r\nimport * as Yup from \"yup\";\r\nimport { useFormik } from \"formik\";\r\nimport { Form, CloseButton, Row, Col, Stack } from \"react-bootstrap\";\r\nimport { CreatedModifiedForm } from \"@/common/CreateModifiedForm\"\r\nimport { FormButtons } from \"@/common/FormButtons\"\r\nimport type { IGroupRow, IAnswer, IAnswerFormProps } from \"@/groups/types\";\r\nimport { ActionTypes } from \"@/groups/types\";\r\nimport { FormMode } from \"@/groups/types\";\r\n\r\nimport { Select } from '@/common/components/Select';\r\nimport { sourceOptions, statusOptions } from '@/common/Options';\r\nimport GrpList from '@/global/Components/SelectGroup/GrpList'\r\n\r\nimport { useGroupContext, useGroupDispatch } from \"@/groups/GroupProvider\";\r\nimport Dropdown from 'react-bootstrap/Dropdown';\r\n\r\nconst AnswerForm = ({ answer, submitForm, children, showCloseButton, source = 0, closeModal }: IAnswerFormProps) => {\r\n\r\n  // const { globalState } = useGlobalContext();\r\n  // const { isDarkMode, variant, bg } = globalState;\r\n\r\n  const { state, onAnswerTitleChanged } = useGroupContext();\r\n  let { formMode, topRows } = state;\r\n\r\n  const viewing = formMode === FormMode.ViewingAnswer;\r\n  const editing = formMode === FormMode.EditingAnswer;\r\n  const adding = formMode === FormMode.AddingAnswer;\r\n\r\n  const isDisabled = viewing;\r\n\r\n  const { topId, id, title: qTitle } = answer;\r\n  //const answerKey = new AnswerKey(answer).answerKey;\r\n  // const groupKey: IGroupKey = { topId, parentId, id: parentId! }; // proveri\r\n\r\n  const dispatch = useGroupDispatch();\r\n\r\n  const closeForm = () => {\r\n    if (closeModal) {\r\n      closeModal();\r\n    }\r\n    else {\r\n      dispatch({ type: ActionTypes.CLOSE_ANSWER_FORM, payload: { answer } })\r\n    }\r\n  }\r\n\r\n  const cancelForm = () => {\r\n    if (closeModal) {\r\n      closeModal();\r\n    }\r\n    else {\r\n      dispatch({ type: ActionTypes.CANCEL_ANSWER_FORM, payload: { answer } })\r\n    }\r\n  }\r\n\r\n  const [searchTerm, setSearchTerm] = useState(id + '/' + qTitle);\r\n  const debouncedSearchTerm = useDebounce(searchTerm, 500);\r\n\r\n  const [topRow] = useState<IGroupRow>(topRows.find(c => c.id === topId)!);\r\n\r\n  // eslint-disable-next-line no-self-compare\r\n  const nameRef = useRef<HTMLTextAreaElement>(null);\r\n\r\n  const formik = useFormik({\r\n    enableReinitialize: true,\r\n    initialValues: answer,\r\n    validationSchema: Yup.object().shape({\r\n      title: Yup.string().required(\"Required\"),\r\n      parentId: Yup.string().required(\"Required\").notOneOf(['000000000000000000000000'])\r\n    }),\r\n    onSubmit: (values: IAnswer) => {\r\n      // console.log('AnswerForm.onSubmit', JSON.stringify(values, null, 2))\r\n      submitForm(values)\r\n      //props.handleClose(false);\r\n      setSearchTerm(values.id + '/' + values.title);\r\n    }\r\n  });\r\n\r\n  useEffect(() => {\r\n    const goBre = async () => {\r\n      //if (debouncedSearchTerm && formik.values.title !== debouncedSearchTerm) {\r\n      //if (debouncedSearchTerm && searchTerm !== debouncedSearchTerm) {\r\n      const old = debouncedSearchTerm.split('/');\r\n      const Id = old[0];\r\n      if (formik.values.id === Id) {\r\n        console.log('AnswerForm.useEffect - onQuestioTitleChanged', { debouncedSearchTerm, searchTerm, title: formik.values.title });\r\n        const Title = old[1]\r\n        await onAnswerTitleChanged(topRow, formik.values, Title);\r\n      }\r\n    };\r\n    goBre();\r\n  }, [debouncedSearchTerm, formik.values, onAnswerTitleChanged, searchTerm, topRow]);\r\n\r\n  useEffect(() => {\r\n    nameRef.current!.focus();\r\n    if (source !== 0) {\r\n      formik.setFieldValue('source', source)\r\n    }\r\n  }, [formik, nameRef, source])\r\n\r\n\r\n  const handleChangeTitle = (event: ChangeEvent<HTMLTextAreaElement>) => {\r\n    formik.handleChange(event);\r\n    const value = event.target.value;\r\n    //if (value !== debouncedTitle)\r\n    //setTitle(value);\r\n    setSearchTerm(id + '/' + value);\r\n  };\r\n\r\n  const setParentId = (cat: IGroupRow) => {\r\n    formik.setFieldValue('parentId', cat.id);\r\n    formik.setFieldValue('groupTitle', cat.title);\r\n  }\r\n\r\n  console.log('@@@@@@@@@@@@@@@@@@@@@ AnswerForm.render: ', { searchTerm, qTitle, debouncedSearchTerm });\r\n  //useEffect(() => {\r\n  //  setSearchTerm(qTitle);\r\n  //}, [qTitle]);\r\n\r\n  return (\r\n    <div className=\"form-wrapper px-3 py-1 my-0 my-1 w-100 answer-form\" >\r\n      {/* data-bs-theme={`${isDarkMode ? 'dark' : 'light'}`} */}\r\n      {showCloseButton && <CloseButton onClick={closeForm} className=\"float-end\" />}\r\n      <Row className='text-center'>\r\n        <Form.Label>Answer  {viewing ? 'Viewing' : editing ? 'Editing' : 'Adding'}</Form.Label>\r\n      </Row>\r\n      <Form onSubmit={formik.handleSubmit}>\r\n\r\n        <Stack direction=\"horizontal\" gap={0} className=\"border\">\r\n          <div className=\"p-0\"><Form.Label>Group:</Form.Label></div>\r\n          <div className=\"p-1\">\r\n            <Form.Group controlId=\"parentId\" className=\"group-select form-select-sm w-90\">\r\n              <Dropdown>\r\n                <Dropdown.Toggle variant=\"light\" id=\"dropdown-basic\" className=\"px-2 py-0 text-primary border\" disabled={isDisabled}>\r\n                  <span className=\"text-wrap me-1\">{formik.values.groupTitle}</span>\r\n                </Dropdown.Toggle>\r\n                <Dropdown.Menu className=\"p-0 border\" >\r\n                  <Dropdown.Item className=\"p-0 m-0 rounded-3\">\r\n                    <GrpList\r\n                      selId={formik.values.parentId}\r\n                      groupKey={null}  // TODO {groupKey}\r\n                      level={1}\r\n                      setParentId={setParentId}\r\n                    />\r\n                  </Dropdown.Item>\r\n                </Dropdown.Menu>\r\n              </Dropdown>\r\n\r\n              <Form.Control\r\n                as=\"input\"\r\n                name=\"parentId\"\r\n                onChange={formik.handleChange}\r\n                //onBlur={formik.handleBlur}\r\n                // onBlur={(e: React.FocusEvent<HTMLTextAreaElement>): void => {\r\n                //   if (isEdit && formik.initialValues.title !== formik.values.title)\r\n                //     formik.submitForm();\r\n                // }}\r\n                value={formik.values.parentId ? formik.values.parentId : ''}\r\n                placeholder='Group'\r\n                className=\"text-primary w-100\"\r\n                disabled={isDisabled}\r\n                hidden={true}\r\n              />\r\n              <Form.Text className=\"text-danger\">\r\n                {formik.touched.parentId && formik.errors.parentId ? (\r\n                  <div className=\"text-danger\">{formik.errors.parentId ? 'required' : ''}</div>\r\n                ) : null}\r\n              </Form.Text>\r\n            </Form.Group>\r\n          </div>\r\n        </Stack>\r\n\r\n        <Form.Group controlId=\"title\">\r\n          <Form.Label>Title</Form.Label>\r\n          <Form.Control\r\n            as=\"textarea\"\r\n            name=\"title\"\r\n            placeholder={formik.values.title === \"new Answer\" ? \"new Answer\" : \"answer text\"}\r\n            ref={nameRef}\r\n            onChange={handleChangeTitle}\r\n            // onBlur={formik.handleBlur}\r\n            // onBlur={(e: React.FocusEvent<HTMLTextAreaElement>): void => {\r\n            //   if (isEdit && formik.initialValues.title !== formik.values.title)\r\n            //     formik.submitForm();\r\n            // }}\r\n            value={formik.values.title}\r\n            rows={3}\r\n            className=\"text-primary w-100\"\r\n            disabled={isDisabled}\r\n          />\r\n          <Form.Text className=\"text-danger\">\r\n            {formik.touched.title && formik.errors.title ? (\r\n              <div className=\"text-danger\">{formik.errors.title}</div>\r\n            ) : null}\r\n          </Form.Text>\r\n        </Form.Group>\r\n\r\n        <Row>\r\n          <Col>\r\n            <Form.Group controlId=\"source\">\r\n              <Form.Label>Source</Form.Label>\r\n              <Select\r\n                id=\"source\"\r\n                name=\"source\"\r\n                options={sourceOptions}\r\n                onChange={(e: FormEvent<HTMLSelectElement>, value: any) => {\r\n                  e.preventDefault(); // ?\r\n                  formik.setFieldValue('source', value)\r\n                  // .then(() => { if (editing) formik.submitForm() })\r\n                }}\r\n                value={formik.values.source}\r\n                disabled={isDisabled}\r\n                classes=\"text-primary\"\r\n              />\r\n              <Form.Text className=\"text-danger\">\r\n                {formik.touched.source && formik.errors.source ? (\r\n                  <div className=\"text-danger\">{formik.errors.source}</div>\r\n                ) : null}\r\n              </Form.Text>\r\n            </Form.Group>\r\n          </Col>\r\n          <Col>\r\n            <Form.Group controlId=\"status\">\r\n              <Form.Label>Status</Form.Label>\r\n              <Select\r\n                id=\"status\"\r\n                name=\"status\"\r\n                options={statusOptions}\r\n                //onChange={formik.handleChange}\r\n                onChange={(e: FormEvent<HTMLSelectElement>, value: any) => {\r\n                  e.preventDefault(); // ?\r\n                  formik.setFieldValue('status', value)\r\n                  //.then(() => { if (editing) formik.submitForm() })\r\n                }}\r\n                value={formik.values.status}\r\n                disabled={isDisabled}\r\n                classes=\"text-primary\"\r\n              />\r\n              <Form.Text className=\"text-danger\">\r\n                {formik.touched.status && formik.errors.status ? (\r\n                  <div className=\"text-danger\">{formik.errors.status}</div>\r\n                ) : null}\r\n              </Form.Text>\r\n            </Form.Group>\r\n          </Col>\r\n        </Row>\r\n\r\n        {(viewing || editing) &&\r\n          <div className=\"my-1\">\r\n\r\n            <CreatedModifiedForm\r\n              created={answer.created}\r\n              modified={answer.modified}\r\n              classes=\"text-primary\"\r\n            />\r\n          </div>\r\n        }\r\n        {((formik.dirty && editing) || adding) &&\r\n          <FormButtons\r\n            cancelForm={cancelForm}\r\n            handleSubmit={formik.handleSubmit}\r\n            title={children}\r\n          />\r\n        }\r\n\r\n        {state.error && <div className=\"text-danger\">{state.error.message}</div>}\r\n\r\n      </Form>\r\n    </div >\r\n  );\r\n};\r\n\r\nexport default AnswerForm;","import { useGroupContext } from '@/groups/GroupProvider'\r\n\r\nimport AnswerForm from \"@/groups/components/answers/AnswerForm\";\r\nimport { type IAnswer } from \"@/groups/types\";\r\n\r\ninterface IProps {\r\n    closeModal?: () => void;\r\n    showCloseButton?: boolean;\r\n    source?: number;\r\n    setError?: (msg: string) => void;\r\n}\r\n\r\nconst AddAnswer = ({ closeModal, showCloseButton, source, setError }: IProps) => {\r\n\r\n    const { state, cancelAddAnswer, createAnswer } = useGroupContext();\r\n    const { activeAnswer } = state;\r\n    const topId = activeAnswer\r\n        ? activeAnswer.topId\r\n        : '';\r\n\r\n    if (!closeModal) {\r\n        // const cat = state.topGroupRows.find(c => c.id === answerRow.parentId)\r\n        // answerRow.groupTitle = cat ? cat.title : '';\r\n    }\r\n\r\n    const cancelAdd = async () => {\r\n        await cancelAddAnswer();\r\n    }\r\n\r\n\r\n    const submitForm = async (answerObject: IAnswer) => {\r\n        const newAnswer: IAnswer = {\r\n            ...answerObject,\r\n            topId: topId!,\r\n            created: {\r\n                time: new Date(),\r\n                nickName: ''\r\n            },\r\n            modified: undefined\r\n        }\r\n        const q = await createAnswer(newAnswer, closeModal !== undefined);\r\n        if (q) {\r\n            if (q.message) {\r\n                setError!(q.message)\r\n            }\r\n            else if (closeModal) {\r\n                closeModal();\r\n                //dispatch({ type: ActionTypes.CLEAN_TREE, payload: { id: q.parentId } })\r\n                //await openNode({ topId: '', id: q.parentId, answerId: q.id });\r\n            }\r\n        }\r\n    }\r\n\r\n    if (!activeAnswer)\r\n        return null;\r\n\r\n    // activeAnswer.title += odakle\r\n    return (\r\n        <AnswerForm\r\n            answer={activeAnswer!}\r\n            showCloseButton={showCloseButton ?? true}\r\n            source={source ?? 0}\r\n            closeModal={cancelAdd}\r\n            //formMode={FormMode.AddingAnswer}\r\n            submitForm={submitForm}\r\n        >\r\n            Create Answer\r\n        </AnswerForm >\r\n    )\r\n}\r\n\r\nexport default AddAnswer\r\n\r\n\r\n","import { useGroupContext } from '@/groups/GroupProvider'\r\n//import { useGlobalContext, useGlobalState } from '@/global/GlobalProvider'\r\n\r\nimport AnswerForm from \"@/groups/components/answers/AnswerForm\";\r\nimport { type IAnswer } from \"@/groups/types\";\r\n\r\nconst EditAnswer = ({ /*inLine*/ }: { inLine: boolean }) => {\r\n    const { state, updateAnswer } = useGroupContext();\r\n    const { activeAnswer } = state;  // loadingAnswer: answerLoading, \r\n    if (!activeAnswer)\r\n        return null;\r\n\r\n    //const { topId } = activeAnswer!;\r\n\r\n\r\n    if (!activeAnswer) {\r\n        return <div>Loading answer to edit...</div>\r\n    }\r\n\r\n    const submitForm = async (answerObject: IAnswer) => {\r\n        const newAnswer: IAnswer = {\r\n            ...answerObject,\r\n            created: undefined,\r\n            modified: {\r\n                time: new Date(),\r\n                nickName: ''\r\n            }\r\n        }\r\n\r\n        const { parentId } = activeAnswer;\r\n        const groupChanged = parentId !== newAnswer.parentId;\r\n        //const answerKey = new AnswerKey(activeAnswer).answerKey;\r\n        /*const answer =*/ await updateAnswer(parentId!, newAnswer, groupChanged);\r\n        /*\r\n        if (activeAnswer.parentId !== answer.parentId) {\r\n             await loadAndCacheAllGroupRows(); // reload, group could have been changed\r\n             await openNode({ topId: '', id: q.parentId, answerId: q.id });\r\n        }\r\n        */\r\n\r\n        // if (groupChanged) {\r\n        //     setTimeout(() => dispatch({ type: ActionTypes.CLOSE_ANSWER_FORM, payload: { answer: answer } }), 1000);\r\n        // }\r\n    };\r\n\r\n    return (\r\n        <AnswerForm\r\n            answer={activeAnswer!}\r\n            showCloseButton={true}\r\n            source={0}\r\n            submitForm={submitForm}\r\n        >\r\n            Update Answer\r\n        </AnswerForm>\r\n    );\r\n};\r\n\r\nexport default EditAnswer;\r\n","import { useEffect, useState } from 'react';\r\nimport { useGroupContext } from '@/groups/GroupProvider'\r\nimport type { IAnswer } from \"@/groups/types\";\r\nimport AnswerForm from \"@/groups/components/answers/AnswerForm\";\r\n\r\nconst ViewAnswer = ({ inLine }: { inLine: boolean }) => {\r\n    console.log(inLine ? \"ViewAnswer inLine\" : \"ViewAnswer not inLine\");\r\n    const { state } = useGroupContext();\r\n    const { activeAnswer } = state;\r\n    //const { topId, id, parentId } = activeAnswer!;\r\n\r\n    const [answer, setAnswer] = useState<IAnswer | null>(null);\r\n\r\n    useEffect(() => {\r\n        //const q = group!.answers.find(q => q.inEditing)\r\n        //if (group) {\r\n        //const q = group!.answers.find(q => q.id === id)\r\n        console.log(\"#################################### ViewAnswer setAnswer ...\", { activeAnswer })\r\n        //if (q) {\r\n        setAnswer(activeAnswer);\r\n        //}\r\n        //}\r\n    }, [activeAnswer]) // answerLoading\r\n    // if (answerLoading)\r\n    //     return <div>Loading answer...</div>\r\n    return (\r\n        <AnswerForm\r\n            answer={answer!}\r\n            showCloseButton={true}\r\n            source={0}\r\n            submitForm={() => { }}\r\n        >\r\n            View Answer\r\n        </AnswerForm>\r\n    );\r\n}\r\n\r\nexport default ViewAnswer;\r\n","import { useEffect } from 'react';\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\nimport { faRemove } from '@fortawesome/free-solid-svg-icons'\r\n\r\nimport { ListGroup, Button } from \"react-bootstrap\";\r\n\r\nimport { useGlobalState } from '@/global/GlobalProvider'\r\nimport { FormMode, type IGroupKey, type IAnswerRow } from \"@/groups/types\";\r\nimport { useGroupContext } from '@/groups/GroupProvider'\r\nimport { useHover } from \"@uidotdev/usehooks\";\r\n\r\nimport AddAnswer from \"@/groups/components/answers/AddAnswer\";\r\nimport EditAnswer from \"@/groups/components/answers/EditAnswer\";\r\nimport ViewAnswer from \"@/groups/components/answers/ViewAnswer\";\r\nimport Q from '@/assets/Q.png';\r\nimport QPlus from '@/assets/QPlus.png';\r\n\r\n\r\n//const AnswerRow = ({ answer, groupInAdding }: { ref: React.ForwardedRef<HTMLLIElement>, answer: IAnswer, groupInAdding: boolean | undefined }) => {\r\nconst AnswerRow = ({ answerRow, isSelected }: { answerRow: IAnswerRow, isSelected: boolean }) => {\r\n    const { id, topId, parentId, title } = answerRow; // , isSelected\r\n    //const answerKey: IAnswerKey = new AnswerKey(answerRow).answerKey!;\r\n    const groupKey: IGroupKey = { topId, parentId, id: parentId! } // proveri\r\n\r\n    const { canEdit, authUser } = useGlobalState();\r\n    const { state, viewAnswer, addAnswer, editAnswer, deleteAnswer } = useGroupContext();\r\n\r\n    const { activeAnswer, formMode, loadingAnswer, answerLoaded } = state;\r\n    //const isSelected = useState(id === selectedAnswerId);\r\n\r\n    const showForm = activeAnswer !== null && activeAnswer.id === id;\r\n\r\n    //const [alreadyAdding] = useState(formMode === FormMode.AddingAnswer);\r\n    const alreadyAdding = formMode === FormMode.AddingAnswer;\r\n\r\n    const del = () => {\r\n        answerRow.modified = {\r\n            time: new Date(),\r\n            nickName: authUser.nickName\r\n        }\r\n        deleteAnswer(answerRow, showForm /* isActive */);\r\n    };\r\n\r\n    // const edit = async (Id: string) => {\r\n    //     // Load data from server and reinitialize answer\r\n    //     await editAnswer(answerRow);\r\n    // }\r\n\r\n    const onSelectAnswer = async (id: string) => {\r\n        console.log('AnswerRow onSelectAnswer', { id });\r\n        if (canEdit)\r\n            await editAnswer(answerRow);\r\n        else\r\n            await viewAnswer(answerRow);\r\n    }\r\n\r\n    const [hoverRef, hovering] = useHover();\r\n\r\n    useEffect(() => {\r\n        (async () => {\r\n            if (isSelected && !loadingAnswer && !answerLoaded) {\r\n                switch (formMode) {\r\n                    case FormMode.ViewingAnswer:\r\n                        await viewAnswer(answerRow);\r\n                        break;\r\n                    case FormMode.EditingAnswer:\r\n                        console.log('Zovem from AnswerRow')\r\n                        canEdit\r\n                            ? await editAnswer(answerRow)\r\n                            : await viewAnswer(answerRow);\r\n                        break;\r\n                }\r\n                // hoverRef!.current?\r\n                const el = document.getElementById(`AnswerRow${id}`);\r\n                el?.scrollIntoView({ behavior: 'smooth', block: 'end' });\r\n            }\r\n        })()\r\n        // after using new Answer() in getAnswer() editAnswer gets modified // viewAnswer, editAnswer\r\n    }, [canEdit, editAnswer, formMode, id, isSelected, loadingAnswer, answerLoaded, answerRow, viewAnswer]);\r\n\r\n    const Row1 =\r\n        <div id={`AnswerRow${id}`} className={`p-0 d-flex justify-content-start align-items-center w-100 position-relative answer-row${isSelected ? '-selected' : ''}`}>\r\n            <Button\r\n                variant='link'\r\n                size=\"sm\"\r\n                className=\"d-flex align-items-center px-1 text-secondary\"\r\n            >\r\n                <img width=\"22\" height=\"18\" src={Q} alt=\"Answer\" />\r\n            </Button>\r\n            <Button\r\n                variant='link'\r\n                size=\"sm\"\r\n                className={`p-0 px-1 m-1 ms-0 answer-row-title ${showForm ? 'fw-bold' : ''}`}\r\n                title={`id:${id!.toString()}`}\r\n                onClick={() => onSelectAnswer(id!)}\r\n                disabled={alreadyAdding}\r\n            >\r\n                {title}\r\n            </Button>\r\n            \r\n            {/* {canEdit && !alreadyAdding && hovering &&\r\n                <Button variant='link' size=\"sm\" className=\"ms-1 py-0 px-1 text-secondary\"\r\n                    //onClick={() => { dispatch({ type: ActionTypes.EDIT, answer }) }}>\r\n                    onClick={() => edit(_id!)}\r\n                >\r\n                    <FontAwesomeIcon icon={faEdit} size='lg' />\r\n                </Button>\r\n            } */}\r\n\r\n            {canEdit && !alreadyAdding && hovering &&\r\n                <div className=\"position-absolute d-flex align-items-center top-0 end-0\">\r\n                    <Button variant='link' size=\"sm\" className=\"ms-0 p-0 text-secondary\"\r\n                        onClick={del}\r\n                    >\r\n                        <FontAwesomeIcon icon={faRemove} size='lg' />\r\n                    </Button>\r\n                    <Button\r\n                        variant='link'\r\n                        size=\"sm\"\r\n                        className=\"ms-1 p-0 text-secondary d-flex align-items-center\"\r\n                        title=\"Add Answer\"\r\n                        onClick={() => {\r\n                            //const groupInfo: IGroupInfo = { groupKey, level: 0 }\r\n                            addAnswer(groupKey, true);\r\n                        }}\r\n                    >\r\n                        <img width=\"22\" height=\"18\" src={QPlus} alt=\"Add Answer\" />\r\n                    </Button>\r\n                </div>\r\n            }\r\n        </div>\r\n\r\n    // console.log('---@@@@@@@@@@@@@ AnswerRow', { id, isSelected, formMode, answerLoaded })\r\n    return (\r\n        // border border-3 border-danger\"\r\n        // <div className=\"py-0 px-0 w-100 list-group-item border\">\r\n        <ListGroup.Item\r\n            // variant={\"primary\"}\r\n            className=\"py-0 px-0 w-100\"\r\n            as=\"li\"\r\n        >\r\n            {isSelected && formMode === FormMode.AddingAnswer &&\r\n                <>\r\n                    <div id='div-answer' className=\"ms-0 d-md-none w-100\">\r\n                        <AddAnswer\r\n                            showCloseButton={true}\r\n                            source={0} />\r\n                    </div>\r\n                    <div ref={hoverRef} className=\"d-none d-md-block  border rounded-3\">\r\n                        {Row1}\r\n                    </div>\r\n                </>\r\n            }\r\n\r\n            {isSelected && formMode === FormMode.EditingAnswer &&\r\n                <>\r\n                    <div ref={hoverRef} className=\"\">\r\n                        {/* d-none d-md-block */}\r\n                        {Row1}\r\n                    </div>\r\n                    {/* <div class=\"d-lg-none\">hide on lg and wider screens</div> */}\r\n                    {/* <div id='div-answer' className=\"ms-0 d-md-none w-100\"> */}\r\n                    <div id='div-answer' className=\"ms-0 d-md-none w-100\">\r\n                        <EditAnswer inLine={true} />\r\n                    </div>\r\n                </>\r\n            }\r\n\r\n            {isSelected && formMode === FormMode.ViewingAnswer &&\r\n                <>\r\n                    <div ref={hoverRef} className=\"\">\r\n                        {/* d-none d-md-block */}\r\n                        {Row1}\r\n                    </div>\r\n                    {/* <div class=\"d-lg-none\">hide on lg and wider screens</div> */}\r\n                    <div ref={hoverRef} id='div-answer' className=\"ms-0 d-md-none w-100\">\r\n                        <ViewAnswer inLine={true} />\r\n                    </div>\r\n                </>\r\n            }\r\n\r\n            {!isSelected &&\r\n                // d-none d-md-block\r\n                <div ref={hoverRef} className=\"\">\r\n                    {Row1}\r\n                </div>\r\n            }\r\n\r\n        </ListGroup.Item>\r\n    );\r\n};\r\n\r\nexport default AnswerRow;\r\n","import { GroupKey, type IGroupRow, type ILoadGroupAnswers, type IAnswerRow } from \"@/groups/types\";\r\nimport { useGroupContext } from \"@/groups/GroupProvider\";\r\nimport useInfiniteScroll from \"react-infinite-scroll-hook\";\r\nimport { List, ListItem, Loading } from \"@/common/components/InfiniteList\";\r\nimport AnswerRow from \"@/groups/components/answers/AnswerRow\";\r\n\r\n//const AnswerList = ({ title, groupRow, level }: IParentInfo) => {\r\nconst AnswerList = ({ groupRow }: { groupRow: IGroupRow }) => {\r\n  const { state, loadGroupAnswers } = useGroupContext();\r\n  const { keyExpanded, loadingAnswer, error, selectedAnswerId } = state;\r\n  const { answerId } = keyExpanded!;\r\n  //? keyExpanded\r\n\r\n  groupRow.level += 1;\r\n  const { answerRows } = groupRow;\r\n  // console.log('@@@@@@@@@@@@@ AnswerList', { answerRows })\r\n\r\n  let hasMoreAnswers = false;\r\n\r\n  async function loadMore() {\r\n    try {\r\n      // const parentInfo: IParentInfo = {\r\n      //   groupRow,\r\n      //   startCursor: answerRows.length,\r\n      //   includeAnswerId: answerId ?? null\r\n      // }\r\n\r\n      const x: ILoadGroupAnswers = {\r\n        groupKey: new GroupKey(groupRow).groupKey!,\r\n        startCursor: answerRows.length,\r\n        includeAnswerId: answerId ?? null\r\n      }\r\n      console.log('^^^^^^^^^^^^^ loadMore')\r\n      console.log('^^^^^^^^^^^^^', { x })\r\n      console.log('^^^^^^^^^^^^^ loadMore')\r\n      await loadGroupAnswers(x);\r\n    }\r\n    catch (error) {\r\n    }\r\n    finally {\r\n    }\r\n  }\r\n\r\n  // useEffect(() => {\r\n  //   //if (numOfAnswers > 0 && answerRows.length === 0) { // TODO\r\n  //   if (answerRows.length === 0) { // TODO\r\n  //     loadMore();\r\n  //   }\r\n  // }, [numOfAnswers, answerRows])\r\n\r\n\r\n  const [infiniteRef, { rootRef }] = useInfiniteScroll({\r\n    loading: loadingAnswer,\r\n    hasNextPage: hasMoreAnswers!,\r\n    onLoadMore: loadMore,\r\n    disabled: Boolean(error),\r\n    rootMargin: '0px 0px 100px 0px',\r\n  });\r\n\r\n  // console.log(\"QQQQQQQQQQQQQQQQQQQQQQQQQQQQQ AnswerList\", answerRows)\r\n  // if (loadingAnswer)\r\n  //   return <div> ... loading</div>\r\n\r\n  return (\r\n    <div\r\n      ref={rootRef}\r\n      className=\"ms-0\" // border border-1 border-info rounded-2\"\r\n      // className=\"max-h-[500px] max-w-[500px] overflow-auto bg-slate-100\"\r\n      style={{ maxHeight: '400px', overflowY: 'auto' }}\r\n    >\r\n      <List>\r\n        {answerRows.length === 0 &&\r\n          <label>No answers</label>\r\n        }\r\n        {answerRows.map((answerRow: IAnswerRow) => {\r\n          return <AnswerRow key={answerRow.id} answerRow={answerRow} isSelected={answerRow.id === selectedAnswerId} />\r\n        })}\r\n        {hasMoreAnswers && (\r\n          <ListItem ref={infiniteRef}>\r\n            <Loading />\r\n          </ListItem>\r\n        )}\r\n      </List>\r\n      {error && <p>Error: {error.message}</p>}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AnswerList;\r\n","import { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\nimport { faRemove, faThumbsUp, faPlus } from '@fortawesome/free-solid-svg-icons'\r\n\r\nimport { Button, Badge } from \"react-bootstrap\";\r\n\r\nimport { useGlobalState } from '@/global/GlobalProvider'\r\nimport { type IGroupKey, FormMode } from \"@/groups/types\";\r\nimport { useGroupContext } from '@/groups/GroupProvider'\r\nimport { type IVariation } from '@/groups/types'\r\nimport { useHover } from \"@uidotdev/usehooks\";\r\n\r\n// import AddTag from \"groups/components/tags/AddTag\";\r\n// import EditTag from \"groups/components/tags/EditTag\";\r\n// import ViewTag from \"groups/components/tags/ViewTag\";\r\n\r\n//const TagRow = ({ tag, groupInAdding }: { ref: React.ForwardedRef<HTMLLIElement>, tag: IVariation, groupInAdding: boolean | undefined }) => {\r\nconst VariationRow = ({ groupKey, tag, groupInAdding }: { groupKey: IGroupKey, tag: IVariation, groupInAdding: boolean | undefined }) => {\r\n    //const { topId, id } = groupKey;\r\n    const { name } = tag;\r\n    const { inViewing, inEditing, inAdding } = {\r\n        //parentId: '',\r\n        //level: 0,\r\n        inViewing: false,\r\n        inEditing: false,\r\n        inAdding: false,\r\n        //numOfTags: 4\r\n    };\r\n\r\n    const { canEdit } = useGlobalState();\r\n\r\n    // const { state, viewTag, editTag, deleteTag } = useGroupContext();\r\n    const { state, deleteGroupVariation } = useGroupContext();\r\n    //const dispatch = useGroupDispatch();\r\n\r\n    const alreadyAdding = false //state.mode === Mode.AddingTag;\r\n\r\n    const del = () => {\r\n        deleteGroupVariation(groupKey, name);\r\n    };\r\n\r\n    //const edit = (id: number) => {\r\n    // Load data from server and reinitialize tag\r\n    //editTag(id);\r\n    //}\r\n\r\n    //const onSelectTag = (id: number) => {\r\n    // Load data from server and reinitialize tag\r\n    //if (canEdit)\r\n    //editTag(id);\r\n    //else\r\n    //viewTag(id);\r\n    //}\r\n\r\n    const [hoverRef, hovering] = useHover();\r\n\r\n    const Row1 =\r\n        // <div ref={hoverRef} className=\"d-flex justify-content-start align-items-center text-secondary\">\r\n        <div ref={hoverRef} >\r\n\r\n            <Badge pill bg=\"secondary\">\r\n                {/* className={`text-info ${numOfTags === 0 ? 'd-none' : 'd-inline'}`} */}\r\n                {name}\r\n            </Badge>\r\n\r\n            {/* <Button\r\n                variant='link'\r\n                size=\"sm\"\r\n                className={`py-0 mx-0 text-decoration-none text-secondary ${(inViewing || inEditing) ? 'fw-bold' : ''}`}\r\n                title={`id:${id!.toString()}`}\r\n                onClick={() => onSelectTag(id!)}\r\n                disabled={alreadyAdding}\r\n            >\r\n                {name}\r\n            </Button> */}\r\n\r\n            {/* {canEdit && !alreadyAdding && hovering &&\r\n                <Button variant='link' size=\"sm\" className=\"ms-1 py-0 px-1 text-secondary\"\r\n                    //onClick={() => { dispatch({ type: ActionTypes.EDIT, tag }) }}>\r\n                    onClick={() => edit(_id!)}\r\n                >\r\n                    <FontAwesomeIcon icon={faEdit} size='lg' />\r\n                </Button>\r\n            } */}\r\n\r\n            {canEdit && !alreadyAdding && hovering &&\r\n                <Button variant='link' size=\"sm\" className=\"ms-0 py-0 mx-0 text-secondary\"\r\n                    onClick={del}\r\n                >\r\n                    <FontAwesomeIcon icon={faRemove} size='sm' />\r\n                </Button>\r\n            }\r\n\r\n            {false && canEdit && !alreadyAdding && hovering &&\r\n                <Button\r\n                    variant='link'\r\n                    size=\"sm\"\r\n                    className=\"ms-2 py-0 mx-1 text-secondary\"\r\n                    title=\"Add Tag\"\r\n                    onClick={() => {\r\n                        console.log('click q')\r\n                        //const groupInfo: IGroupInfo = { groupKey: { topId, parentId, id }, level }\r\n                        //dispatch({ type: ActionTypes.ADD_ANSWER, payload: { groupInfo } })\r\n                    }}\r\n                >\r\n                    <FontAwesomeIcon icon={faPlus} size='lg' />\r\n                    <FontAwesomeIcon icon={faThumbsUp} size='lg' style={{ marginLeft: '-5px' }} />\r\n                </Button>\r\n            }\r\n        </div>\r\n\r\n    return (\r\n\r\n        <div className=\"py-1 px-1\">\r\n            {inAdding && groupInAdding && state.formMode === FormMode.AddingVariation\r\n                ? (\r\n                    // <AddTag tag={tag} inLine={true} showCloseButton={true} />\r\n                    <span>add tag</span>\r\n                )\r\n                : ((inEditing && state.formMode === FormMode.EditingVariation) ||\r\n                    (inViewing && state.formMode === FormMode.ViewingVariation)) ? (\r\n                    <>\r\n                        {/* <div class=\"d-lg-none\">hide on lg and wider screens</div> */}\r\n                        <div id='div-tag' className=\"ms-0 d-md-none w-100\">\r\n                            {/* {inEditing && <EditTag inLine={true} />}\r\n                            {inViewing && <ViewTag inLine={true} />} */}\r\n                        </div>\r\n                        <div className=\"d-none d-md-block\">\r\n                            {Row1}\r\n                        </div>\r\n                    </>\r\n                )\r\n                    : (\r\n                        Row1\r\n                    )\r\n            }\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default VariationRow;\r\n","import { useEffect } from \"react\";\r\nimport type { IGroupKey, IVariation } from \"@/groups/types\";\r\nimport { useGroupContext } from \"@/groups/GroupProvider\";\r\n// import { useGlobalState } from \"@/global/GlobalProvider\";\r\n//import { List, ListItem, Loading } from \"common/components/InfiniteList\";\r\nimport VariationRow from \"@/groups/VariationRow\";\r\nimport { Stack } from \"react-bootstrap\";\r\n\r\nconst VariationList = ({ groupKey, variations }: { groupKey: IGroupKey, variations: IVariation[] }) => {\r\n\r\n  //const { canEdit } = useGlobalState();\r\n\r\n  const { state } = useGroupContext();\r\n  const { error } = state; // topRows: groups,\r\n\r\n\r\n  //const group = groups.find(c => c.id === parentId)!\r\n  // const { tags, numOfTags, hasMore } = group;\r\n\r\n  useEffect(() => {\r\n  }, [])\r\n\r\n\r\n  // useEffect(() => {\r\n  //   if (groupId != null) {\r\n  //     if (groupId === parentId!.toString() && tagId) {\r\n  //       setTimeout(() => {\r\n  //         if (canEdit)\r\n  //           editTag(parseInt(tagId))\r\n  //         else\r\n  //           viewTag(parseInt(tagId))\r\n  //       }, 3000)\r\n  //     }\r\n  //   }\r\n  // }, [viewTag, parentId, groupId, tagId, canEdit]);\r\n\r\n  // console.log('TagList render', tags, level)\r\n\r\n  return (\r\n    <div\r\n      className=\"ms-2\"\r\n    // className=\"max-h-[500px] max-w-[500px] overflow-auto bg-slate-100\"\r\n    // style={{ overflowX: 'auto' }}\r\n    >\r\n      <Stack direction=\"horizontal\" gap={2}>\r\n        {variations.length === 0 &&\r\n          <div>No variations</div>\r\n        }\r\n        {variations.length > 0 &&\r\n          variations.map((tag: IVariation) => {\r\n            return <VariationRow\r\n              groupKey={groupKey}\r\n              tag={tag}\r\n              groupInAdding={undefined}\r\n            />\r\n          })}\r\n      </Stack>\r\n      {error && <p>Error: {error.message}</p>}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default VariationList;\r\n","import { useEffect, useRef, type ChangeEvent, type FormEvent, useState } from \"react\";\r\nimport * as Yup from \"yup\";\r\nimport { useFormik } from \"formik\";\r\nimport { Form, CloseButton, Row, Stack } from \"react-bootstrap\";\r\nimport { CreatedModifiedForm } from \"@/common/CreateModifiedForm\"\r\nimport { FormButtons } from \"@/common/FormButtons\"\r\nimport type { IGroupFormProps, IGroup, IVariation, IGroupKey } from \"@/groups/types\";\r\nimport { FormMode, ActionTypes, GroupKey } from \"@/groups/types\";\r\n\r\nimport { useGroupContext, useGroupDispatch } from \"@/groups/GroupProvider\";\r\nimport AnswerList from \"@/groups/components/answers/AnswerList\";\r\nimport VariationList from \"@/groups/VariationList\";\r\nimport { Select } from \"@/common/components/Select\";\r\nimport { kindOptions } from \"@/common/Options\";\r\nimport { useDebounce } from \"@uidotdev/usehooks\";\r\n\r\nconst GroupForm = ({ formMode, group, submitForm, children }: IGroupFormProps) => {\r\n\r\n  //const { globalState } = useGlobalContext();\r\n  //const { isDarkMode, variant, bg } = globalState;\r\n\r\n  const { onGroupTitleChanged } = useGroupContext();\r\n\r\n  const viewing = formMode === FormMode.ViewingGroup;\r\n  const editing = formMode === FormMode.EditingGroup;\r\n  const adding = formMode === FormMode.AddingGroup;\r\n\r\n  const { topId, id, variations, answerRows, title: catTitle } = group;\r\n  console.log('GroupForm render: ', { topId, id, catTitle, formMode })\r\n  const groupKey: IGroupKey = new GroupKey(group).groupKey!;\r\n  //const groupKeyExpanded: IAnswerKey = { topId, id, answerId };\r\n\r\n  if (!document.getElementById('div-details')) {\r\n\r\n  }\r\n  const showAnswers = answerRows && answerRows.length > 0 //!answers.find(q => q.inAdding);\r\n  /* \r\n  We have, at two places:\r\n    <EditGroup inLine={true} />\r\n    <EditGroup inLine={false} />\r\n    so we execute loadGroupAnswers() twice in AnswerList, but OK\r\n  */\r\n\r\n  const dispatch = useGroupDispatch();\r\n\r\n  const closeForm = () => {\r\n    dispatch({ type: ActionTypes.CLOSE_GROUP_FORM, payload: {} })\r\n  }\r\n\r\n  const cancelForm = () => {\r\n    dispatch({ type: ActionTypes.CANCEL_GROUP_FORM, payload: {} })\r\n  }\r\n\r\n  const [searchTerm, setSearchTerm] = useState(catTitle);\r\n  const debouncedSearchTerm = useDebounce(searchTerm, 300);\r\n\r\n  const formik = useFormik({\r\n    enableReinitialize: true,\r\n    initialValues: group,\r\n    validationSchema: Yup.object().shape({\r\n      title: Yup.string().required(\"Required\"),\r\n      // email: Yup.string()\r\n      //   .email(\"You have enter an invalid email address\")\r\n      //   .required(\"Required\"),\r\n      // rollno: Yup.number()\r\n      //   .positive(\"Invalid roll number\")\r\n      //   .integer(\"Invalid roll number\")\r\n      //   .required(\"Required\"),\r\n    }),\r\n    onSubmit: (values: IGroup) => {\r\n      //alert(JSON.stringify(values, null, 2));\r\n      console.log('GroupForm.onSubmit', JSON.stringify(values, null, 2))\r\n      submitForm(values);\r\n      //props.handleClose(false);\r\n      setSearchTerm(values.title);\r\n    }\r\n  });\r\n\r\n  useEffect(() => {\r\n    const goBre = async () => {\r\n      console.log('GroupForm.useEffect - onGroupTitleChanged', { debouncedSearchTerm, title: formik.values.title });\r\n      //if (debouncedSearchTerm && formik.values.title !== debouncedSearchTerm) {\r\n      await onGroupTitleChanged(formik.values, debouncedSearchTerm);\r\n      //}\r\n    };\r\n    goBre();\r\n  }, [debouncedSearchTerm, formik.values, onGroupTitleChanged]);\r\n\r\n  const handleChangeTitle = (event: ChangeEvent<HTMLTextAreaElement>) => {\r\n    formik.handleChange(event);\r\n    const value = event.target.value;\r\n    //if (value !== debouncedTitle)\r\n    //setTitle(value);\r\n    setSearchTerm(value);\r\n  };\r\n\r\n  // eslint-disable-next-line no-self-compare\r\n  // const nameRef = useRef<HTMLAreaElement | null>(null);\r\n  const nameRef = useRef<HTMLTextAreaElement>(null);\r\n\r\n\r\n  useEffect(() => {\r\n    //setTitle(group.title);\r\n    nameRef.current!.focus()\r\n  }, [group.title, nameRef])\r\n\r\n  const isDisabled = false;\r\n\r\n  console.log('GroupForm render return: ', searchTerm);\r\n\r\n  return (\r\n    // data-bs-theme={`${isDarkMode ? 'dark' : 'light'}`}\r\n    <div className=\"form-wrapper p-2 group-form\" >\r\n      <CloseButton onClick={closeForm} className=\"float-end\" />\r\n      <Row className='text-center text-muted'>\r\n        <Form.Label>Group {viewing ? 'Viewing' : editing ? 'Editing' : 'Adding'}</Form.Label>\r\n      </Row>\r\n      <Form onSubmit={() => formik.handleSubmit}>\r\n\r\n        <Form.Group controlId=\"Variations\">\r\n          <Stack direction=\"horizontal\" gap={1}>\r\n            <div className=\"px-0\"><Form.Label>Variations:</Form.Label></div>\r\n            <div className=\"px-1 border border-1 border-secondary rounded\">\r\n              <VariationList\r\n                groupKey={groupKey}\r\n                variations={variations\r\n                  ? variations.map(variation => ({ name: variation } as IVariation))\r\n                  : []\r\n                }\r\n              />\r\n            </div>\r\n            <div className=\"ps-2\"><Form.Label>Kind:</Form.Label></div>\r\n            <div className=\"px-1 border border-1 border-secondary rounded\">\r\n              <Form.Group controlId=\"kind\">\r\n                {/* <Form.Label>Kind</Form.Label> */}\r\n                <Select\r\n                  id=\"kind\"\r\n                  name=\"kind\"\r\n                  options={kindOptions}\r\n                  onChange={(e: FormEvent<HTMLSelectElement>, value: any) => {\r\n                    e.preventDefault(); // ?\r\n                    formik.setFieldValue('kind', value)\r\n                    // .then(() => { if (editing) formik.submitForm() })\r\n                  }}\r\n                  value={formik.values.kind}\r\n                  disabled={isDisabled}\r\n                  classes=\"text-primary\"\r\n                />\r\n                <Form.Text className=\"text-danger\">\r\n                  {formik.touched.kind && formik.errors.kind ? (\r\n                    <div className=\"text-danger\">{formik.errors.kind}</div>\r\n                  ) : null}\r\n                </Form.Text>\r\n              </Form.Group>\r\n            </div>\r\n          </Stack>\r\n        </Form.Group>\r\n\r\n        <Form.Group controlId=\"title\">\r\n          <Form.Label>Title</Form.Label>\r\n          <Form.Control\r\n            as=\"textarea\"\r\n            name=\"title\"\r\n            placeholder={formik.values.title === \"new Group\" ? \"new Group\" : \"group text\"}\r\n            value={searchTerm}\r\n            onChange={handleChangeTitle}\r\n            ref={nameRef}\r\n            //onChange={handleChangeTitle}\r\n            // onChange={(e: any, value: any): {e: ChangeEvent<HTMLTextAreaElement>, value: string} => {\r\n            //         formik.handleChange(e, value);\r\n            //         console.log(value)\r\n            //       }}\r\n            //onBlur={formik.handleBlur}\r\n            // onBlur={(e: React.FocusEvent<HTMLTextAreaElement>): void => {\r\n            //   if (isEdit && formik.initialValues.title !== formik.values.title)\r\n            //     formik.submitForm();\r\n            // }}\r\n            rows={3}\r\n            className=\"text-primary w-100\"\r\n            disabled={viewing}\r\n          />\r\n          <Form.Text className=\"text-danger\">\r\n            {formik.touched.title && formik.errors.title ? (\r\n              <div className=\"text-danger\">{formik.errors.title}</div>\r\n            ) : null}\r\n          </Form.Text>\r\n        </Form.Group>\r\n\r\n\r\n        <Form.Group controlId=\"link\">\r\n          <Form.Label>Link</Form.Label>\r\n          {formik.values.hasSubGroups\r\n            ? <Form.Control\r\n              as=\"input\"\r\n              placeholder=\"/groups/...\"\r\n              name=\"link\"\r\n              onChange={formik.handleChange}\r\n              //onBlur={formik.handleBlur}\r\n              // onBlur={(e: React.FocusEvent<HTMLTextAreaElement>): void => {\r\n              //   if (isEdit && formik.initialValues.title !== formik.values.title)\r\n              //     formik.submitForm();\r\n              // }}\r\n              className=\"text-primary w-100\"\r\n              value={\"Can't have link (has sub groups)\"}\r\n              disabled={true}\r\n            />\r\n            : <>\r\n              <Form.Control\r\n                as=\"input\"\r\n                placeholder=\"/groups/...\"\r\n                name=\"link\"\r\n                onChange={formik.handleChange}\r\n                //onBlur={formik.handleBlur}\r\n                // onBlur={(e: React.FocusEvent<HTMLTextAreaElement>): void => {\r\n                //   if (isEdit && formik.initialValues.title !== formik.values.title)\r\n                //     formik.submitForm();\r\n                // }}\r\n                className=\"text-primary w-100\"\r\n                value={formik.values.link ?? ''}\r\n                disabled={viewing}\r\n              />\r\n              <Form.Text className=\"text-danger\">\r\n                {formik.touched.link && formik.errors.link ? (\r\n                  <div className=\"text-danger\">{formik.errors.link}</div>\r\n                ) : null}\r\n              </Form.Text>\r\n            </>\r\n          }\r\n        </Form.Group>\r\n\r\n        {/* <Form.Group>\r\n          <Form.Label>Number of Answers </Form.Label>\r\n          <div className=\"text-secondary\">{formik.values.numOfAnswers}</div>\r\n          // <div className=\"p-1 bg-dark text-white\">{createdBy}, {formatDate(created.date)}</div> \r\n        </Form.Group> */}\r\n\r\n        <Form.Group>\r\n          <Form.Label className=\"m-1 mb-0\">Answers ({`${formik.values.numOfAnswers}`}) </Form.Label>\r\n          {showAnswers &&\r\n            <AnswerList groupRow={group} />  // IGroup extends IGroupRow\r\n          }\r\n        </Form.Group>\r\n\r\n        {(viewing || editing) &&\r\n          <CreatedModifiedForm\r\n            created={group.created}\r\n            modified={group.modified}\r\n            classes=\"text-primary\"\r\n          />\r\n        }\r\n\r\n        {((formik.dirty && editing) || adding) &&\r\n          <FormButtons\r\n            cancelForm={cancelForm}\r\n            handleSubmit={formik.handleSubmit}\r\n            title={children}\r\n          />\r\n        }\r\n      </Form>\r\n    </div >\r\n  );\r\n};\r\n\r\nexport default GroupForm;","import { useGroupContext } from '@/groups/GroupProvider'\r\nimport { useGlobalState } from '@/global/GlobalProvider'\r\n\r\nimport GroupForm from \"@/groups/components/GroupForm\";\r\nimport { FormMode, type IGroup } from \"@/groups/types\";\r\n\r\nconst EditGroup = ({ inLine }: { inLine: boolean }) => {\r\n    const globalState = useGlobalState();\r\n    const { nickName } = globalState.authUser;\r\n\r\n    const { state, updateGroup } = useGroupContext();\r\n\r\n    const { activeGroup, keyExpanded } = state;\r\n    const { answerId } = keyExpanded!;\r\n\r\n    const submitForm = async (groupObject: IGroup) => {\r\n        const object: IGroup = {\r\n            ...groupObject,\r\n            created: undefined,\r\n            modified: {\r\n                time: new Date(),\r\n                nickName: nickName\r\n            }\r\n        }\r\n        await updateGroup(object, true /* closeForm */)\r\n    };\r\n\r\n    return (\r\n        <GroupForm\r\n            inLine={inLine}\r\n            group={{ ...activeGroup! }}\r\n            answerId={answerId}\r\n            formMode={FormMode.EditingGroup}\r\n            submitForm={submitForm}\r\n        >\r\n            Update Group\r\n        </GroupForm>\r\n    );\r\n};\r\n\r\nexport default EditGroup;\r\n","\r\nimport { useGroupContext } from '@/groups/GroupProvider'\r\n\r\nimport { FormMode } from \"@/groups/types\";\r\nimport GroupForm from \"@/groups/components/GroupForm\";\r\n\r\nconst ViewGroup = ({ inLine }: { inLine: boolean }) => {\r\n    const { state } = useGroupContext();\r\n    const { activeGroup, keyExpanded } = state;\r\n    const { answerId } = keyExpanded!;\r\n    return (\r\n        <GroupForm\r\n            inLine={inLine}\r\n            group={{ ...activeGroup! }}\r\n            answerId={answerId}\r\n            formMode={FormMode.ViewingGroup}\r\n            submitForm={() => { }}\r\n        >\r\n            View Group\r\n        </GroupForm>\r\n    );\r\n}\r\n\r\nexport default ViewGroup;\r\n","import { useState } from \"react\";\r\nimport { useGroupContext } from '@/groups/GroupProvider'\r\nimport { useGlobalState } from '@/global/GlobalProvider'\r\n\r\nimport GroupForm from \"@/groups/components/GroupForm\";\r\nimport { FormMode, type IGroup } from \"@/groups/types\";\r\n\r\nconst AddGroup = ({ activeGroup }: { activeGroup: IGroup | null }) => {\r\n    const globalState = useGlobalState();\r\n    const { nickName } = globalState.authUser;\r\n    const { createGroup } = useGroupContext();\r\n    //const { activeGroup } = state;\r\n\r\n    const [formValues] = useState<IGroup>({ ...activeGroup! });\r\n\r\n    const submitForm = async (group: IGroup) => {\r\n        const cat: IGroup = {\r\n            ...group,\r\n            created: {\r\n                time: new Date(),\r\n                nickName: nickName\r\n            },\r\n            modified: undefined\r\n        }\r\n        console.log(\"**********object\", cat)\r\n        await createGroup(cat);\r\n    }\r\n    if (!activeGroup === null)\r\n        return null;\r\n\r\n    console.log('AddGroup render >>>>>:', activeGroup);\r\n    return (\r\n        <>\r\n            {/* {inLine ?\r\n                <InLineGroupForm\r\n                    inLine={true}\r\n                    group={formValues}\r\n                    mode={FormMode.adding}\r\n                    submitForm={submitForm}\r\n                >\r\n                    Create\r\n                </InLineGroupForm>\r\n                : */}\r\n            <GroupForm\r\n                inLine={false}\r\n                group={formValues}\r\n                answerId={null}\r\n                formMode={FormMode.AddingGroup}\r\n                submitForm={submitForm}\r\n            >\r\n                Create Group\r\n            </GroupForm >\r\n            {/* } */}\r\n        </>\r\n    )\r\n}\r\n\r\nexport default AddGroup\r\n","import { useEffect, useState } from 'react';\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\nimport { faRemove, faCaretRight, faCaretDown, faPlus, faFolder } from '@fortawesome/free-solid-svg-icons'\r\nimport APlus from '@/assets/APlus.png';\r\n\r\nimport { ListGroup, Button, Badge } from \"react-bootstrap\";\r\n\r\nimport { useGlobalState } from '@/global/GlobalProvider'\r\nimport { type IGroupKey, type IGroupRow, FormMode, type IExpandInfo, GroupKey } from \"@/groups/types\";\r\nimport { useGroupContext, } from '@/groups/GroupProvider'\r\n\r\nimport { useHover } from \"@uidotdev/usehooks\";\r\n\r\nimport GroupList from \"@/groups/components/GroupList\";\r\nimport EditGroup from \"@/groups/components/EditGroup\";\r\nimport ViewGroup from \"@/groups/components/ViewGroup\";\r\nimport AnswerList from './answers/AnswerList';\r\nimport AddGroup from './AddGroup';\r\n\r\nconst GroupRow = ({ groupRow, answerId }: { groupRow: IGroupRow, answerId: string | null }) => {\r\n\r\n    const { id, title, hasSubGroups, numOfAnswers, isExpanded } = groupRow;\r\n    groupRow.level += 1;\r\n\r\n    const groupKey: IGroupKey = new GroupKey(groupRow).groupKey!;\r\n\r\n    // const [groupKey] = useState<IGroupKey>({ topId, id }); // otherwise reloads\r\n    // const [catKeyExpanded] = useState<IAnswerKey>({ topId, id, answerId }); // otherwise reloads\r\n\r\n    const { canEdit, authUser } = useGlobalState();\r\n\r\n    const { state, addSubGroup, viewGroup, editGroup, deleteGroup, expandGroup, collapseGroup, addAnswer } = useGroupContext();\r\n    //const dispatch = useGroupDispatch();\r\n\r\n    let { formMode, activeGroup, loadingGroup, groupLoaded } = state;\r\n    const isSelected = activeGroup !== null && (activeGroup.id === id);\r\n\r\n    const inAdding = formMode === FormMode.AddingGroup;\r\n    // TODO proveri ovo\r\n    const showAnswers = isExpanded && numOfAnswers > 0 // || answers.find(q => q.inAdding) // && !answers.find(q => q.inAdding); // We don't have answers loaded\r\n\r\n    const deleteGroupRow = () => {\r\n        groupRow.modified = {\r\n            time: new Date(),\r\n            nickName: authUser.nickName\r\n        }\r\n        deleteGroup(groupRow);\r\n    };\r\n\r\n    const handleExpandClick = async () => {\r\n        if (isExpanded) {\r\n            await collapseGroup(groupRow);\r\n        }\r\n        else {\r\n            const expandInfo: IExpandInfo = {\r\n                groupKey,\r\n                byClick: true,\r\n                formMode: canEdit ? FormMode.EditingGroup : FormMode.ViewingGroup\r\n            }\r\n            await expandGroup(expandInfo);\r\n        }\r\n    }\r\n\r\n    // const edit = async () => {\r\n    //     // Load data from server and reinitialize group\r\n    //     await editGroup(groupRow, answerId ?? 'null');\r\n    // }\r\n\r\n\r\n    const onSelectGroup = async (): Promise<any> => {\r\n        if (canEdit)\r\n            await editGroup(groupRow, answerId ?? 'null');\r\n        else\r\n            await viewGroup(groupRow, answerId ?? 'null');\r\n    }\r\n\r\n    const [queue, setQueue] = useState<boolean>(false);\r\n\r\n    useEffect(() => {\r\n        if (queue) {// && groupRow.id === 'generateId') {\r\n            addSubGroup(groupRow);\r\n            setQueue(false);\r\n        }\r\n    }, [addSubGroup, groupRow, queue]);\r\n\r\n\r\n    const [queue2, setQueue2] = useState<boolean>(false);\r\n    useEffect(() => {\r\n        if (queue2) {// && groupRow.id === 'generateId') {\r\n            addAnswer(groupKey, isExpanded ?? false);\r\n            setQueue2(false);\r\n        }\r\n    }, [addAnswer, groupKey, isExpanded, queue2]);\r\n\r\n\r\n    useEffect(() => {\r\n        (async () => {\r\n            if (isSelected && !loadingGroup && !groupLoaded && !inAdding) {\r\n                console.log('GroupRow formMode:', formMode)\r\n                switch (formMode) {\r\n                    case FormMode.ViewingGroup:\r\n                        await viewGroup(groupRow, answerId ?? 'null');\r\n                        break;\r\n                    case FormMode.EditingGroup:\r\n                        canEdit\r\n                            ? await editGroup(groupRow, answerId ?? 'null')\r\n                            : await viewGroup(groupRow, answerId ?? 'null');\r\n                        break;\r\n                }\r\n            }\r\n        })()\r\n    }, [canEdit, groupKey, groupLoaded, groupRow, editGroup, expandGroup, formMode, inAdding, isSelected, loadingGroup, answerId, viewGroup]);\r\n\r\n    const [hoverRef, hovering] = useHover();\r\n    //console.log(\"..........................: \", document.querySelectorAll(`#Row${id}`)!.length);\r\n\r\n    const Row1 =\r\n        <div>\r\n            <div id={`Row${id}`} className={`d-relative d-flex justify-content-start align-items-center w-100 group-row${isSelected ? '-selected' : ''}`} style={{ marginTop: '1px' }}>\r\n                <Button\r\n                    variant='link'\r\n                    size=\"sm\"\r\n                    className=\"py-0 px-1\" //  bg-light\"\r\n                    onClick={(e) => { handleExpandClick(); e.stopPropagation() }}\r\n                    title=\"Expand\"\r\n                    disabled={inAdding || (!hasSubGroups && numOfAnswers === 0)}\r\n                >\r\n                    <FontAwesomeIcon icon={isExpanded ? faCaretDown : faCaretRight} size='lg' />\r\n                </Button>\r\n                <Button\r\n                    variant='link'\r\n                    size=\"sm\"\r\n                    className=\"py-0 px-1 bg-light\"\r\n                    // onClick={expand}\r\n                    title=\"Expand\"\r\n                    disabled={true} //{alreadyAdding || (!hasSubGroups && numOfAnswers === 0)}\r\n                >\r\n                    <FontAwesomeIcon icon={faFolder} size='sm' />\r\n                </Button>\r\n                <Button\r\n                    variant='link'\r\n                    size=\"sm\"\r\n                    className={`py-0 ms-0 me-1 group-row-title ${isSelected ? 'fw-bold text-white bg-transparent' : ''}`}\r\n                    title={id}\r\n                    onClick={onSelectGroup}\r\n                    disabled={inAdding}\r\n                >\r\n                    {title}\r\n                    {/* &nbsp;<span>{formMode.substring(0, 3)}</span>&nbsp;<span>{hovering?'hov':'jok'}</span> */}\r\n                </Button>\r\n\r\n                {numOfAnswers > 0 &&\r\n                    <Badge pill bg=\"secondary\" className={'d-inline bg-transparent'}>\r\n                        {numOfAnswers}Q\r\n                        {/* <FontAwesomeIcon icon={faThumbsUp} size='sm' /> */}\r\n                        {/* <img width=\"22\" height=\"18\" src={Q} alt=\"Answer\" /> */}\r\n                    </Badge>\r\n                }\r\n\r\n\r\n                {canEdit && hovering && // && !alreadyAdding\r\n                    <div className=\"position-absolute text-nowrap d-flex align-items-center border border-0 border-warning p-0 end-0\">\r\n                        <div className=\"d-flex align-items-center\">\r\n                            <Button\r\n                                variant='link'\r\n                                size=\"sm\"\r\n                                className=\"border-0 py-0 px-0 ms-0 text-success\"\r\n                                title=\"Add SubCategory\"\r\n                                onClick={async () => {\r\n                                    //dispatch({ type: ActionTypes.CLOSE_CATEGORY_FORM, payload: {} })\r\n                                    if (!isExpanded && (hasSubGroups || numOfAnswers > 0)) {\r\n                                        await handleExpandClick();\r\n                                    }\r\n                                    setTimeout(() => setQueue(true), 500);\r\n                                }}\r\n                            >\r\n                                <FontAwesomeIcon icon={faPlus} size='lg' />\r\n                            </Button>\r\n                        </div>\r\n\r\n                        {!inAdding && !hasSubGroups &&\r\n                            // top-0 end-0\r\n                            <div className=\"d-flex align-items-center\">\r\n                                <Button variant='link' size=\"sm\" className=\"py-0 mx-0 position-relative float-end d-flex align-items-center\"\r\n                            disabled={hasSubGroups || numOfAnswers > 0}\r\n                            onClick={deleteGroupRow}\r\n                        >\r\n                            <FontAwesomeIcon icon={faRemove} size='lg' />\r\n                        </Button>\r\n\r\n                        <Button\r\n                            variant='link'\r\n                            size=\"sm\"\r\n                            className=\"py-0 mx-0 text-secondary position-relative float-end d-flex align-items-center\"\r\n                            title=\"Add Answer\"\r\n                            onClick={async () => {\r\n                                //const groupInfo: IGroupInfo = { groupKey: { workspace: topId, id: groupRow.id }, level: groupRow.level }\r\n                                if (!isExpanded && (hasSubGroups || numOfAnswers > 0)) {\r\n                                    await handleExpandClick();\r\n                                }\r\n                                setTimeout(() => setQueue2(true), 500);\r\n                            }}\r\n                        >\r\n                            <img width=\"22\" height=\"18\" src={APlus} alt=\"Add Answer\" />\r\n                        </Button>\r\n                            </div>\r\n                        }\r\n\r\n                    </div>\r\n                }\r\n\r\n                {/* TODO what about archive answers  numOfAnswers === 0 &&*/}\r\n                {canEdit && !inAdding && hovering && !hasSubGroups &&\r\n                    // top-0 end-0\r\n                    <div className=\"\">\r\n                        \r\n                    </div>\r\n                }\r\n            </div>\r\n            {showAnswers &&\r\n                <div className='ps-3'>\r\n                    <AnswerList groupRow={groupRow} />\r\n                </div>\r\n            }\r\n        </div>\r\n\r\n    // console.log({ title, isExpanded })\r\n\r\n    // if (group.level !== 1)\r\n    //     return (<div>GroupRow {group.id}</div>)\r\n\r\n    // console.log('groupRow:', { isSelected, formMode, id})\r\n    return (\r\n        <>\r\n            <ListGroup.Item\r\n                // variant={\"primary\"}\r\n                className=\"py-0 px-1 w-100 group-bg\"\r\n                as=\"li\"\r\n            >\r\n                {isSelected && formMode === FormMode.AddingGroup &&\r\n                    <div>\r\n                        <div ref={hoverRef} className=\"\">\r\n                            {Row1}\r\n                        </div>\r\n                        {/* ms-0 d-md-none w-100 */}\r\n                        <div className=\"ms-0 d-md-none w-100\">\r\n                            <AddGroup activeGroup={activeGroup} />\r\n                        </div>\r\n                    </div>\r\n                }\r\n\r\n                {isSelected && formMode === FormMode.EditingGroup &&\r\n                    <>\r\n                        {/* <div class=\"d-none d-md-block\">\r\n                            This content will be hidden on small screens and below, \r\n                            but visible on medium screens and above.</div> */}\r\n                        <div ref={hoverRef} className=\"\">\r\n                            {Row1}\r\n                        </div>\r\n                        {/* <div id='divInLine' className=\"ms-0 d-md-none w-100\"> */}\r\n                        <div id='divInLine' className=\"ms-0 d-md-none w-100\">\r\n                            <EditGroup inLine={false} />\r\n                        </div>\r\n                    </>\r\n                }\r\n\r\n                {isSelected && formMode === FormMode.ViewingGroup &&\r\n                    <>\r\n                        {/* <div class=\"d-lg-none\">hide on lg and wider screens</div> */}\r\n                        <div ref={hoverRef} className=\"\">\r\n                            {Row1}\r\n                        </div>\r\n                        {/* <div id='divInLine' className=\"ms-0 d-md-none w-100\"> */}\r\n                        <div id='divInLine' className=\"ms-0 d-md-none w-100\">\r\n                            <ViewGroup inLine={false} />\r\n                        </div>\r\n                    </>\r\n                }\r\n\r\n                {!isSelected &&\r\n                    <div ref={hoverRef} className=\"\">\r\n                        {Row1}\r\n                    </div>\r\n                }\r\n\r\n                {/* {isSelected &&\r\n                    <div className=\"d-none d-md-block\">\r\n                        {Row1}\r\n                    </div>\r\n                } */}\r\n\r\n\r\n            </ListGroup.Item>\r\n\r\n            {state.error && state.whichRowId === id && <div className=\"text-danger\">{state.error.message}</div>}\r\n\r\n            {/* !inAdding && */}\r\n            {(isExpanded) && // Row2   //  || inAdding\r\n                <ListGroup.Item\r\n                    className=\"py-0 px-0 border-0 border-warning border-bottom-0 group-bg\" // border border-3 \"\r\n                    variant={\"primary\"}\r\n                    as=\"li\"\r\n                >\r\n                    {isExpanded &&\r\n                        <>\r\n                            {hasSubGroups &&\r\n                                <GroupList groupRow={groupRow} title={title} isExpanded={isExpanded} />\r\n                            }\r\n                            {/* {showAnswers &&\r\n                                <AnswerList groupRow={groupRow} />\r\n                            } */}\r\n                        </>\r\n                    }\r\n\r\n                </ListGroup.Item>\r\n            }\r\n        </>\r\n    );\r\n};\r\n\r\nexport default GroupRow;\r\n","import { ListGroup } from \"react-bootstrap\";\r\nimport GroupRow from \"@/groups/components/GroupRow\";\r\nimport type { IGroupRow, IParentInfo } from \"@/groups/types\";\r\nimport { useGroupContext } from \"@/groups/GroupProvider\";\r\n\r\nconst GroupList = ({ groupRow, title }: IParentInfo) => {\r\n\r\n    const { state } = useGroupContext();\r\n    let { keyExpanded } = state;\r\n    const { answerId } = keyExpanded ?? { topId: '', groupId: '', answerId: null };\r\n\r\n    let level = 1;\r\n    let groupRows: IGroupRow[] = [];\r\n    if (title === 'ROOT') {\r\n        groupRows = state.topRows;\r\n    }\r\n    else {\r\n        groupRows = groupRow!.groupRows;\r\n        level = groupRow!.level;\r\n    }\r\n\r\n    return (\r\n        <div className={level! > 1 ? 'ms-2' : ''} >\r\n            <ListGroup as=\"ul\" variant='dark' className=\"mb-0 group-bg\">\r\n                {groupRows!.map((c: IGroupRow) =>\r\n                    <GroupRow\r\n                        //groupRow={{ ...c, isSelected: c.id === id }}\r\n                        groupRow={c}\r\n                        answerId={answerId}\r\n                        // {c.topId === topId && c.id === id ? answerId : null}\r\n                        key={c.id}\r\n                    />\r\n                )}\r\n            </ListGroup>\r\n            {/* {state.error && state.error} */}\r\n            {/* {state.loading && <div>...loading</div>} */}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default GroupList;\r\n","import { useEffect, useState } from 'react'\r\nimport { Modal } from \"react-bootstrap\";\r\n\r\nimport { type IAnswerRow } from \"./types\";\r\n\r\nimport { useGlobalState } from \"@/global/GlobalProvider\";\r\n//import { useGroupDispatch } from \"./GroupProvider\";\r\n\r\nimport AddAnswer from './components/answers/AddAnswer';\r\n\r\ninterface IProps {\r\n    show: boolean,\r\n    onHide: () => void;\r\n    newAnswerRow: IAnswerRow\r\n}\r\n\r\nconst ModalAddAnswer = (props: IProps) => {\r\n\r\n    const { isDarkMode } = useGlobalState();\r\n\r\n    // const handleClose = () => {\r\n    //     setShowAddAnswer(false);\r\n    // }\r\n\r\n    const [createAnswerError, setCreateAnswerError] = useState(\"\");\r\n\r\n    //const dispatch = useGroupDispatch();\r\n\r\n    useEffect(() => {\r\n        (async () => {\r\n\r\n        })()\r\n    }, [])\r\n\r\n    return (\r\n        <Modal\r\n            show={props.show}\r\n            onHide={props.onHide}\r\n            animation={true}\r\n            centered\r\n            size=\"lg\"\r\n            className=\"modal show\"\r\n            contentClassName={`${isDarkMode ? \"bg-secondary bg-gradient\" : \"bg-info bg-gradient\"}`}\r\n        >\r\n            <Modal.Header closeButton>\r\n                Store new Answer to the Database\r\n            </Modal.Header>\r\n            <Modal.Body className=\"py-0\">\r\n                <AddAnswer\r\n                    closeModal={props.onHide}\r\n                    showCloseButton={false}\r\n                    source={1} /*gmail*/\r\n                    setError={(msg) => setCreateAnswerError(msg)}\r\n                />\r\n            </Modal.Body>\r\n            <Modal.Footer>\r\n                {createAnswerError}\r\n            </Modal.Footer>\r\n        </Modal>\r\n    );\r\n};\r\n\r\nexport default ModalAddAnswer;","import { useEffect, useState } from 'react'\r\nimport { Container, Row, Col, Button } from \"react-bootstrap\";\r\n\r\nimport { useParams } from 'react-router-dom';\r\n\r\nimport { ActionTypes, type IGroupKey, type IAnswerKey, FormMode } from \"./types\";\r\n\r\nimport { useGlobalContext, useGlobalState } from '@/global/GlobalProvider';\r\n\r\nimport { GroupProvider, useGroupContext, useGroupDispatch } from \"./GroupProvider\";\r\n\r\nimport GroupList from \"@/groups/components/GroupList\";\r\nimport ViewGroup from \"@/groups/components/ViewGroup\";\r\nimport EditGroup from \"@/groups/components/EditGroup\";\r\nimport ViewAnswer from \"@/groups/components/answers/ViewAnswer\";\r\nimport EditAnswer from \"@/groups/components/answers/EditAnswer\";\r\n\r\nimport { initialAnswer } from \"@/groups/GroupReducer\";\r\nimport ModalAddAnswer from './ModalAddAnswer';\r\nimport AddGroup from './components/AddGroup';\r\nimport { AutoSuggestAnswers } from './AutoSuggestAnswers';\r\nimport AddAnswer from './components/answers/AddAnswer';\r\n\r\ninterface IProps {\r\n    groupId_answerId?: string;\r\n    fromChatBotDlg?: string;\r\n}\r\n\r\nconst Providered = ({ groupId_answerId, fromChatBotDlg }: IProps) => {\r\n    const { state, expandNodesUpToTheTree, loadTopRows, addSubGroup } = useGroupContext();\r\n    const {\r\n        allGroupRows, //allGroupRowsLoaded,\r\n        topRows, topRowsLoading, topRowsLoaded,\r\n        keyExpanded,\r\n        groupId_answerId_done,\r\n        nodeOpening, nodeOpened,\r\n        activeGroup,\r\n        activeAnswer,\r\n        formMode,\r\n        loadingGroups, loadingGroup,\r\n        loadingAnswers, loadingAnswer\r\n    } = state;\r\n\r\n    const { searchAnswers, setLastRouteVisited } = useGlobalContext();\r\n    const { isDarkMode } = useGlobalState();\r\n\r\n    const [modalShow, setModalShow] = useState(false);\r\n    // const handleClose = () => {\r\n    //     setModalShow(false);\r\n    // }\r\n\r\n    const [newAnswer, setNewAnswer] = useState({ ...initialAnswer });\r\n\r\n    const dispatch = useGroupDispatch();\r\n\r\n    const onSelectAnswer = async (answerKey: IAnswerKey) => {\r\n        //navigate(`/groups/${answerKey.topId}_${answerKey.id}`)\r\n        dispatch({ type: ActionTypes.SET_ANSWER_SELECTED, payload: { answerKey } })\r\n    }\r\n\r\n\r\n    let tekst = '';\r\n\r\n    useEffect(() => {\r\n        (async () => {\r\n            // SET_TOP_ROWS  Level:1\r\n            if (!topRowsLoading && !topRowsLoaded) {\r\n                console.log('ZOVEM 111 loadTopRows()')\r\n                await loadTopRows()\r\n            }\r\n        })()\r\n    }, [topRowsLoading, topRowsLoaded, loadTopRows]);\r\n\r\n\r\n    useEffect(() => {\r\n        (async () => {\r\n            if (!nodeOpening && topRows.length > 0) {\r\n                if (groupId_answerId) {\r\n                    if (groupId_answerId === 'add_answer') {\r\n                        const sNewAnswer = localStorage.getItem('New_Answer');\r\n                        if (sNewAnswer) {\r\n                            const q = JSON.parse(sNewAnswer);\r\n                            setNewAnswer({ ...initialAnswer, groupTitle: 'Select', ...q })\r\n                            setModalShow(true);\r\n                            localStorage.removeItem('New_Answer');\r\n                            return null;\r\n                        }\r\n                    }\r\n                    else if (groupId_answerId !== groupId_answerId_done) { //} && !nodeOpened) {\r\n                        const arr = groupId_answerId.split('_');\r\n                        const groupId = arr[0];\r\n                        const answerId = arr[1];\r\n                        const grpKey: IGroupKey = { topId: '', id: groupId, parentId: 'ROOT' };\r\n                        console.log('zovem expandNodesUpToTheTree 1111111111111111111)', { groupId_answerId }, { groupId_answerId_done })\r\n                        await expandNodesUpToTheTree(grpKey, answerId, fromChatBotDlg ?? 'false')\r\n                            .then(() => { return null; });\r\n                    }\r\n                }\r\n                else if (keyExpanded && !nodeOpened) {\r\n                    const { topId, groupId, answerId } = keyExpanded;\r\n                    if (groupId !== '') {\r\n                        const grpKey: IGroupKey = { topId, id: groupId, parentId: 'ROOT' }\r\n                        console.log('zovem expandNodeUpToTheTree 2222222222222)', { keyExpanded, grpKey })\r\n                        await expandNodesUpToTheTree(grpKey, answerId)\r\n                            .then(() => { return null; });\r\n                    }\r\n                }\r\n            }\r\n        })()\r\n    }, [keyExpanded, nodeOpening, nodeOpened, expandNodesUpToTheTree, groupId_answerId, groupId_answerId_done, topRows, fromChatBotDlg])\r\n\r\n    useEffect(() => {\r\n        setLastRouteVisited(`/groups`);\r\n    }, [setLastRouteVisited])\r\n\r\n    if (groupId_answerId !== 'add_answer') {\r\n        if (/*keyExpanded ||*/ (groupId_answerId && groupId_answerId !== groupId_answerId_done)) {\r\n            console.log(\"zzzzzz loading...\", { keyExpanded, groupId_answerId, groupId_answerId_done })\r\n            return <div>loading...</div>\r\n        }\r\n    }\r\n\r\n\r\n    //if (!nodeOpened)\r\n    //if (!allGroupRowsLoaded || !topRowsLoaded || topRows.length === 0) {\r\n    if (!topRowsLoaded || topRows.length === 0) {\r\n        console.log('===>>> Groups  VRATIO')\r\n        return null\r\n    }\r\n\r\n    console.log('===>>> Groups !!!!!!!!!!!!!!!!!', activeGroup)\r\n\r\n    return (\r\n        <>\r\n            <Container>\r\n                <h5 className=\"text-warning mx-auto w-75 fw-bold\"><span className='groups'>Groups / </span><span className='answers'>Answers</span></h5>\r\n\r\n                <Row className={`${isDarkMode ? \"dark\" : \"\"}`}>\r\n                    <Col>\r\n                        <div className=\"d-flex justify-content-start align-items-center\">\r\n                            <div className=\"w-75 my-1 answers\">\r\n                                <AutoSuggestAnswers\r\n                                    tekst={tekst}\r\n                                    onSelectAnswer={onSelectAnswer}\r\n                                    allGroupRows={allGroupRows}\r\n                                    searchAnswers={searchAnswers}\r\n                                />\r\n                            </div>\r\n                        </div>\r\n                    </Col>\r\n                </Row>\r\n\r\n                <Button variant=\"secondary\" size=\"sm\" type=\"button\" style={{ padding: '1px 4px' }}\r\n                    onClick={\r\n                        () => addSubGroup(null)\r\n                    }\r\n                >\r\n                    Add Group\r\n                </Button>\r\n\r\n                <Row className=\"my-1 h-auto\">\r\n                    <Col xs={12} md={5}>\r\n                        <div className=\"groups-border\" style={{ position: 'relative' }}>\r\n                            <GroupList groupRow={null} title=\"ROOT\" isExpanded={true} />\r\n                        </div>\r\n                    </Col>\r\n                    <Col xs={0} md={7}>\r\n                        {/* visible on medium screens and above. */}\r\n                        <div id='div-details' className=\"d-none d-md-block\">\r\n                            {activeGroup && formMode === FormMode.ViewingGroup && <ViewGroup inLine={false} />}\r\n                            {activeGroup && formMode === FormMode.EditingGroup &&\r\n                                <EditGroup inLine={false} />\r\n                            }\r\n                            {activeGroup && formMode === FormMode.AddingGroup && <AddGroup activeGroup={activeGroup} />}\r\n\r\n                            {activeAnswer && formMode === FormMode.ViewingAnswer && <ViewAnswer inLine={false} />}\r\n                            {activeAnswer && formMode === FormMode.EditingAnswer &&\r\n                                <EditAnswer inLine={false} />\r\n                            }\r\n                            {activeAnswer && formMode === FormMode.AddingAnswer && <AddAnswer />}\r\n                        </div>\r\n                    </Col>\r\n                </Row>\r\n            </Container>\r\n            {modalShow && activeAnswer &&\r\n                <ModalAddAnswer\r\n                    show={modalShow}\r\n                    onHide={() => { setModalShow(false) }}\r\n                    newAnswerRow={newAnswer}\r\n                />\r\n            }\r\n\r\n\r\n            {(loadingGroups || loadingAnswers) &&\r\n                <div className=\"d-flex justify-content-center align-items-center\" style={{ position: 'absolute', top: '40%', left: '20%' }}>\r\n                    <div className={`spinner-border ${loadingAnswers ? 'answer' : 'group'}-spinner`} role=\"status\">\r\n                        <span className=\"visually-hidden\">Loading...</span>\r\n                    </div>\r\n                </div>\r\n            }\r\n\r\n            {loadingGroup &&\r\n                <div className=\"d-flex justify-content-center align-items-center\" style={{ position: 'absolute', top: '50%', left: '50%' }}>\r\n                    <div className=\"spinner-border group-spinner\" role=\"status\">\r\n                        <span className=\"visually-hidden\">Loading...</span>\r\n                    </div>\r\n                </div>\r\n            }\r\n\r\n            {loadingAnswer &&\r\n                <div className=\"d-flex justify-content-center align-items-center\" style={{ position: 'absolute', top: '50%', left: '50%' }}>\r\n                    <div className=\"spinner-border answer-spinner\" role=\"status\">\r\n                        <span className=\"visually-hidden\">Loading...</span>\r\n                    </div>\r\n                </div>\r\n            }\r\n        </>\r\n    );\r\n};\r\n\r\ntype Params = {\r\n    groupId_answerId?: string;\r\n    fromChatBotDlg?: string;\r\n};\r\n\r\nconst Groups = () => {\r\n\r\n    let { groupId_answerId, fromChatBotDlg } = useParams<Params>();\r\n\r\n    if (groupId_answerId && groupId_answerId === 'groups')\r\n        groupId_answerId = undefined;\r\n\r\n    if (groupId_answerId) {\r\n        const arr = groupId_answerId!.split('_');\r\n        console.assert(arr.length === 2, \"expected 'groupId_answerId'\")\r\n    }\r\n    // const globalState = useGlobalState();\r\n    // const { isAuthenticated } = globalState;\r\n\r\n    // if (!isAuthenticated)\r\n    //     return <div>groups loading...</div>;\r\n\r\n    return (\r\n        <GroupProvider>\r\n            <Providered groupId_answerId={groupId_answerId} fromChatBotDlg={fromChatBotDlg} />\r\n        </GroupProvider>\r\n    )\r\n}\r\n\r\nexport default Groups;\r\n\r\n"],"names":["initialAnswer","initialGroup","GroupReducer","state","action","groupRow","ActionTypes","keyExpanded","modifyTree","doNotModifyTree","topRows","newState","doNotCallInnerReducerActions","innerReducer","newTopRows","topId","id","c","DeepClone","topRow","newTopRow","actionStoringToLocalStorage","locStorage","allGroupRows","fromChatBotDlg","activeGroup","activeAnswer","group","formMode","grpKey","answerId","answer","row","error","whichRowId","groupKey","level","FormMode","IsGroup","parentId","newGroupRow","answerKey","groupId","newAnswerRow","title","link","kind","header","variations","numOfAnswers","hasSubGroups","groupRows","created","modified","answerRows","isExpanded","subGrpRows","catRow","GroupsContext","createContext","GroupDispatchContext","initialState","GroupProvider","children","globalState","useGlobalState","KnowledgeAPI","isAuthenticated","workspace","authUser","canEdit","nickName","dispatch","useReducer","allGroupRowsLoaded","useEffect","s","Execute","useCallback","method","endpoint","data","accessToken","response","headers","bearer","options","responseData","errors","e","loadAllGroupRows","resolve","url","catRowDtos","rowDto","GroupRow","cat","titlesUpTheTree","parentCat","cat2","getGrp","getSubGrps","parentHeader","subCats","loadTopRows","dtos","dto","getGroup","includeAnswerId","PAGE_SIZE","groupDtoEx","groupDto","msg","Group","findGroupRow","expandNodesUpToTheTree","query","GroupKey","groupRowDtoEx","groupRowDto","answerRow","q","getGroupRow","hidrate","expandGroup","selectedAnswerId","collapseGroup","addSubGroup","parentGroupRow","cancelAddGroup","expandInfo","createGroup","GroupDto","cancelAddAnswer","viewGroup","editGroup","updateGroup","deleteGroup","GroupRowDto","deleteGroupVariation","variationName","loadGroupAnswers","startCursor","addAnswer","createAnswer","answerDto","AnswerDto","answerDtoEx","Answer","updateAnswer","oldParentId","groupChanged","answerRet","deleteAnswer","isActive","AnswerRowDto","getAnswer","AnswerKey","answerEx","viewAnswer","editAnswer","onGroupTitleChanged","onAnswerTitleChanged","contextValue","jsx","useGroupContext","useContext","useGroupDispatch","APlus","GrpActionTypes","GrpRow","setParentGrp","selId","expand","_id","onSelectGrp","Row1","jsxs","Button","FontAwesomeIcon","faCaretDown","faCaretRight","Fragment","ListGroup","GrpList","GrpReducer","subGrps","expanding","cats","ids","markForClean","deca","unuci","setParentId","catKey","useState","res","mySubGrps","AnswerForm","submitForm","showCloseButton","source","closeModal","viewing","editing","adding","isDisabled","qTitle","closeForm","cancelForm","searchTerm","setSearchTerm","debouncedSearchTerm","useDebounce","nameRef","useRef","formik","useFormik","Yup.object","Yup.string","values","old","Id","Title","handleChangeTitle","event","value","CloseButton","Row","Form","Stack","Dropdown","Col","Select","sourceOptions","statusOptions","CreatedModifiedForm","FormButtons","AddAnswer","setError","cancelAdd","answerObject","newAnswer","EditAnswer","ViewAnswer","inLine","setAnswer","AnswerRow","isSelected","loadingAnswer","answerLoaded","showForm","alreadyAdding","del","onSelectAnswer","hoverRef","hovering","useHover","Q","faRemove","QPlus","AnswerList","hasMoreAnswers","loadMore","x","infiniteRef","rootRef","useInfiniteScroll","List","VariationRow","tag","groupInAdding","name","Badge","VariationList","GroupForm","catTitle","showAnswers","variation","kindOptions","EditGroup","groupObject","object","ViewGroup","AddGroup","formValues","loadingGroup","groupLoaded","inAdding","deleteGroupRow","handleExpandClick","onSelectGroup","queue","setQueue","queue2","setQueue2","faFolder","faPlus","GroupList","ModalAddAnswer","props","isDarkMode","createAnswerError","setCreateAnswerError","Modal","Providered","groupId_answerId","topRowsLoading","topRowsLoaded","groupId_answerId_done","nodeOpening","nodeOpened","loadingGroups","loadingAnswers","searchAnswers","setLastRouteVisited","useGlobalContext","modalShow","setModalShow","setNewAnswer","tekst","sNewAnswer","arr","Container","AutoSuggestAnswers","Groups","useParams"],"mappings":"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"}